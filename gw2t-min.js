$(window).on("load",function(){"use strict";var O,X,U,A,V,Q,E,D,C,M,P,G,W,T,B,K,I={};O={lengthOfPrefixes:3,prefixOption:"opt_",legalLocalStorageKeys:[],isServerReset:!1,Utilities:{programVersion:{key:"int_utlProgramVersion",value:160426},timestampDaily:{key:"int_utlTimestampDaily",value:0},timestampWeekly:{key:"int_utlTimestampWeekly",value:0},APITokens:{key:"obj_utlAPITokens",value:[]},APICache:{key:"obj_utlAPICache",value:{}},BackupPins:{key:"obj_utlBackupPins",value:[]},BackupPinsWvW:{key:"obj_utlBackupPinsWvW",value:[]},StoredPins:{key:"obj_utlStoredPins",value:[]},StoredPinsWvW:{key:"obj_utlStoredPinsWvW",value:[]},StoredWeapons:{key:"obj_utlStoredWeapons",value:[]},StoredWeaponsWvW:{key:"obj_utlStoredWeaponsWvW",value:[]}},enforceProgramVersion:function(){var e=O.Utilities.programVersion.value,t=parseInt(localStorage[O.Utilities.programVersion.key]);if(isFinite(t)&&t!==e){var n=I.ModeCurrent===I.ModeEnum.Overlay?15:30;I.clear(),I.greet(I.cSiteName+" was updated since your last visit.<br />This version: "+e+"<br />Your version: "+t+"<br />Would you like to see the <a class='urlUpdates' href='"+U.URL_META.News+"'>changes</a>?<br />",n),U.convertExternalLink(".urlUpdates")}localStorage[O.Utilities.programVersion.key]=O.Utilities.programVersion.value},Options:{enu_Language:"en",enu_Server:"1008",bol_hideChecked:!1,bol_expandWB:!0,bol_collapseChains:!0,int_setClock:0,int_setDimming:0,int_setPredictor:0,bol_alignPanelRight:!0,bol_showPanel:!0,bol_showMap:!0,bol_showDashboard:!0,bol_showTimeline:!0,bol_opaqueTimeline:!1,bol_hideHUD:!0,int_setFloor:1,int_setInitialZoom:3,int_setInitialZoomWvW:3,bol_showCoordinatesBar:!0,bol_showZoneBorders:!1,bol_showZoneGateways:!1,bol_showPersonalPaths:!0,bol_showChainPaths:!0,bol_tourPrediction:!0,bol_showWorldCompletion:!1,bol_showZoneOverview:!0,bol_displaySectors:!0,bol_displayWaypoints:!0,bol_displayPOIs:!0,bol_displayVistas:!0,bol_displayChallenges:!0,bol_displayHearts:!0,bol_displayEvents:!1,bol_showWorldCompletionWvW:!1,bol_showZoneOverviewWvW:!0,bol_displaySectorsWvW:!0,bol_displayWaypointsWvW:!0,bol_displayPOIsWvW:!0,bol_displayVistasWvW:!0,bol_displayChallengesWvW:!0,str_colorPersonalPath:"#ffffff",int_secWvWRefresh:10,int_numLogEntries:128,bol_showLog:!0,bol_opaqueLog:!1,bol_maximizeLog:!1,bol_logRedHome:!0,bol_logBlueHome:!0,bol_logGreenHome:!0,bol_logCenter:!0,bol_logNarrate:!1,bol_narrateRedHome:!0,bol_narrateBlueHome:!0,bol_narrateGreenHome:!0,bol_narrateCenter:!0,bol_narrateClaimed:!0,bol_narrateCamp:!0,bol_narrateTower:!0,bol_narrateKeep:!0,bol_narrateCastle:!0,bol_showLeaderboard:!0,bol_opaqueLeaderboard:!1,bol_condenseLeaderboard:!1,bol_showDestructibles:!1,bol_showObjectiveLabels:!0,bol_showSecondaries:!1,int_setFollow:1,bol_displayCharacter:!0,int_setFollowWvW:2,bol_displayCharacterWvW:!0,int_msecGPSRefresh:100,int_setAlarm:0,int_setVolume:75,bol_alertArrival:!0,bol_alertAtStart:!0,bol_alertAtEnd:!0,bol_alertChecked:!1,int_alertSubscribedFirst:1,int_alertSubscribedSecond:15,bol_alertAutosubscribe:!0,bol_alertUnsubscribe:!0,int_minStopwatchAlert:5,str_textStopwatchAlert:"Alert, alert, alert!",int_sizeStopwatchFont:64,int_sizeNotepadFont:12,int_sizeNotepadHeight:400,bol_refreshPrices:!0,bol_useMainTPSearch:!0,int_numTradingCalculators:25,int_numTradingResults:30,int_secTradingRefresh:60,bol_clearChainChecklistOnReset:!0,bol_clearPersonalChecklistOnReset:!0,bol_use24Hour:!0,bol_detectDST:!0,bol_useSiteTag:!0},OptionRange:{},LanguageCode:{en:"en-US",de:"de-DE",es:"es-ES",fr:"fr-FR",cs:"cs-CZ",it:"it-IT",pl:"pl-PL",pt:"pt-BR",ru:"ru-RU",zh:"zh-CN"},VoiceCode:{en:"Google US English",de:"Google Deutsch",es:"Google español",fr:"Google français",cs:"native",it:"Google italiano",pl:"Google polski",pt:"Google português do Brasil",ru:"Google русский",zh:"Google 國語（臺灣）"},OptionEnum:{Language:{Default:"en",English:"en",German:"de",Spanish:"es",French:"fr",Czech:"cs",Italian:"it",Polish:"pl",Portuguese:"pt",Russian:"ru",Mandarin:"zh"},Server:{AnvilRock:"1001",BorlisPass:"1002",YaksBend:"1003",HengeofDenravi:"1004",Maguuma:"1005",SorrowsFurnace:"1006",GateofMadness:"1007",JadeQuarry:"1008",FortAspenwood:"1009",EhmryBay:"1010",StormbluffIsle:"1011",Darkhaven:"1012",SanctumofRall:"1013",CrystalDesert:"1014",IsleofJanthir:"1015",SeaofSorrows:"1016",TarnishedCoast:"1017",NorthernShiverpeaks:"1018",Blackgate:"1019",FergusonsCrossing:"1020",Dragonbrand:"1021",Kaineng:"1022",DevonasRest:"1023",EredonTerrace:"1024",FissureofWoe:"2001",Desolation:"2002",Gandara:"2003",Blacktide:"2004",RingofFire:"2005",Underworld:"2006",FarShiverpeaks:"2007",WhitesideRidge:"2008",RuinsofSurmia:"2009",SeafarersRest:"2010",Vabbi:"2011",PikenSquare:"2012",AuroraGlade:"2013",GunnarsHold:"2014",JadeSea:"2101",FortRanik:"2102",AuguryRock:"2103",VizunahSquare:"2104",Arborstone:"2105",Kodash:"2201",Riverside:"2202",ElonaReach:"2203",AbaddonsMouth:"2204",DrakkarLake:"2205",MillersSound:"2206",Dzagonur:"2207",BaruchBay:"2301"}},IntEnum:{Predictor:{Auto:0,Min:1,MinAvg:2,Avg:3},Clock:{Compact:0,Full:1,Bar:2,None:3},Alarm:{Off:0,Checklist:1,Subscription:2},Follow:{Off:0,Character:1,Zone:2}},validateEnum:function(e,t){var n,i=O.OptionEnum[U.getVariableSuffix(e)];for(n in i)if(i[n]===t)return t;return O.Options[e]},TypeEnum:{isBoolean:"bol",isInteger:"int",isFloat:"flt",isEnum:"enu",isString:"str"},initializeLegalLocalStorageKeys:function(){var e;for(e in O.Utilities)O.legalLocalStorageKeys.push(O.Utilities[e].key);for(e in O.Options)O.legalLocalStorageKeys.push(e);for(e in X.Checklists)O.legalLocalStorageKeys.push(X.Checklists[e].key);for(e in X.Collectibles)O.legalLocalStorageKeys.push(X.Collectibles[e].key);for(e in X.Textlists)O.legalLocalStorageKeys.push(X.Textlists[e].key)},cleanLocalStorage:function(){var e,t,n,i;for(e=0;e<localStorage.length;e++){n=localStorage.key(e);for(t in O.legalLocalStorageKeys)if(n===O.legalLocalStorageKeys[t]){i=!0;break}i!==!0?localStorage.removeItem(n):i=!1}},convertLocalStorageDataType:function(e){var t=e.toLowerCase();return"true"===t?!0:"false"===t?!1:isFinite(t)?t%0===0?parseInt(t):parseFloat(t):e},sortObjects:function(e,t,n){var i=t?t:D.getNameKey();n?e.sort(function(e,t){return e[i]<t[i]?1:e[i]>t[i]?-1:0}):e.sort(function(e,t){return e[i]>t[i]?1:e[i]<t[i]?-1:0})},getObjectLength:function(e){var t=0;for(var n in e)t++;return t},intToBool:function(e){return e>0?!0:!1},boolToInt:function(e){return e?1:0},stringToBool:function(e){return"true"===e.toLowerCase()?!0:!1},boolToString:function(e){return e?"true":"false"},randomBool:function(){return Math.random()>.5?!0:!1},isInteger:function(e){return!isNaN(e)&&function(e){return(0|e)===e}(parseFloat(e))},objToBool:function(e){return e?!0:!1},initializeTimestamp:function(e){var t=T.getUNIXSeconds(),n=parseInt(localStorage[e.key]);void 0===localStorage[e.key]||isFinite(n)===!1||n>t?(e.value=t,localStorage[e.key]=e.value):e.value=n},updateResetTimestamp:function(e){e.value=T.getUNIXSeconds(),localStorage[e.key]=e.value},checkResetTimestamps:function(){var e=T.getUNIXSeconds(),t=T.getTimeSinceMidnight(),n=T.getSecondsSinceWeekstart(t),i=e-t,a=n>T.cWEEKLY_RESET_SECONDS?e-(n-T.cWEEKLY_RESET_SECONDS):e-T.cSECONDS_IN_WEEK+(T.cWEEKLY_RESET_SECONDS-n),r=0===t,o=n===T.cWEEKLY_RESET_SECONDS;(O.Utilities.timestampDaily.value<i||r)&&(O.clearDailySensitiveOptions(r),O.updateResetTimestamp(O.Utilities.timestampDaily)),(O.Utilities.timestampWeekly.value<a||o)&&(O.clearWeeklySensitiveOptions(o),O.updateResetTimestamp(O.Utilities.timestampWeekly))},getIndexOfSelectedRadioButton:function(e){var t=$("fieldset[name="+e+"] input:radio[name="+e+"]");return t.index(t.filter(":checked"))},initializeOptions:function(){O.initializeLegalLocalStorageKeys();var e,t,n,i;for(e in O.Options)i=$("#"+O.prefixOption+e),t=i.attr("type"),n=U.getVariablePrefix(e),"radio"===t?O.OptionRange[e]=new Array(0,$("fieldset[name="+e+"] input").length-1):("number"===t||"range"===t)&&(O.OptionRange[e]=new Array(i.prop("min"),i.prop("max"))),I.isProgramEmbedded?void 0!==U.Args[e]&&n!==O.TypeEnum.isString&&(O.Options[e]=O.convertLocalStorageDataType(U.sanitizeURLOptionsValue(e,U.Args[e]))):(void 0!==U.Args[e]&&n!==O.TypeEnum.isString&&(localStorage[e]=U.sanitizeURLOptionsValue(e,U.Args[e])),void 0===localStorage[e]?localStorage[e]=O.Options[e]:O.Options[e]=O.convertLocalStorageDataType(localStorage[e])),O.setInputValue(i,O.Options[e]),"radio"===t?$("fieldset[name="+e+"]").change(function(){var e=$(this).attr("name");O.Options[e]=O.getIndexOfSelectedRadioButton(e),localStorage[e]=O.Options[e]}):i.change(function(){var e=$(this).attr("id").slice(O.prefixOption.length);O.Options[e]=O.getInputValue($(this),e),localStorage[e]=O.Options[e]}).click(function(){$(this).select()});O.bindOptionsInputs(),U.initializeAPIURLs()},setInputValue:function(e,t){var n=$(e),i=n.attr("type");"checkbox"===i?n.prop("checked",t):"number"===i||"range"===i?n.val(t):"radio"===i?$("input:radio[name="+n.attr("name")+"]:eq("+t+")").prop("checked",!0):n.val(t)},getInputValue:function(e,t){var n,i=$(e),a=i.attr("type");if("checkbox"===a)n=i.prop("checked");else if("number"===a||"range"===a){var n=i.val(),r=parseInt(n);n=isFinite(n)&&r>=O.OptionRange[t][0]&&r<=O.OptionRange[t][1]?r:O.OptionRange[t][0],i.val(n)}else if("text"===a){n=i.val();var o=i.attr("maxlength");n.length>o&&(n=n.substring(0,o))}else n=i.val();return n},mimicInput:function(e,t){var n=$(e);O.setInputValue(n,O.Options[t]);var i=$("#"+O.prefixOption+t);return n.change(function(){var e=O.getInputValue($(this),t);O.setInputValue(i,e),i.trigger("change")}),i.change(function(){O.setInputValue(n,O.Options[t])}),n},clearDailySensitiveOptions:function(e){O.isServerReset=!0;var t=10,n=e?"Daily Reset!":"Daily Timestamp Expired!";I.greet(n,t),T.getDaily({aIsReset:!0});var i,a;if(O.Options.bol_clearChainChecklistOnReset){for(i in C.Chains)a=C.Chains[i],$("#chnCheck_"+a.nexus).removeClass("chnChecked"),$("#chnBar_"+a.nexus).css({opacity:1}),X.getChecklistItem(X.Checklists.Chain,a.nexus)!==X.ChecklistEnum.Disabled&&$("#chnBar_"+a.nexus).show();X.clearChecklist(X.Checklists.Chain,X.ChecklistJob.UncheckTheChecked)}O.Options.bol_clearPersonalChecklistOnReset&&X.clearCustomChecklistDaily();var r=1e4;I.isSectionLoaded_Daily&&setTimeout(function(){G.generateAndInitializeDailies()},r),I.write("",t)},clearWeeklySensitiveOptions:function(e){var t=10,n=e?"Weekly Reset!":"Weekly Timestamp Expired!";I.greet(n,t),O.Options.bol_clearPersonalChecklistOnReset&&X.clearCustomChecklistWeekly()},bindOptionsInputs:function(){var e;for(e in O.Enact)!function(e){var t,n=O.prefixOption+e,i=$("#"+n).attr("type");t="radio"===i?"fieldset[name="+e+"]":"#"+n,$(t).change(function(){O.Enact[e]()})}(e);$("#opt_bol_showWorldCompletion").change(function(){O.Options.bol_showWorldCompletion===!0&&M.isMappingIconsGenerated===!1&&location.reload(),$("#mapOptionsCompletion label input").each(function(){X.setCheckboxEnumState($(this),X.boolToChecklistEnum(O.Options.bol_showWorldCompletion))})}),$("#opt_bol_showWorldCompletionWvW").change(function(){O.Options.bol_showWorldCompletionWvW===!0&&W.isMappingIconsGenerated===!1&&location.reload(),$("#wvwOptionsCompletion label input").each(function(){X.setCheckboxEnumState($(this),X.boolToChecklistEnum(O.Options.bol_showWorldCompletionWvW))})}),$("#opt_bol_displayEvents").change(function(){O.Options.bol_displayEvents===!0&&M.isEventIconsGenerated===!1&&location.reload(),M.isEventIconsGenerated&&M.refreshCurrentZone()}),$("#mapOptionsCompletion label input").each(function(){$(this).change(function(){M.isAPIRetrieved_MAPFLOOR&&M.refreshCurrentZone()})}),$("#wvwOptionsCompletion label input").each(function(){$(this).change(function(){W.isAPIRetrieved_MAPFLOOR&&W.refreshCurrentZone()})}),O.Enact.int_setAlarm(),O.Enact.bol_detectDST(),O.Enact.bol_useSiteTag(),O.Enact.bol_alignPanelRight(!0),O.Enact.bol_showPanel(),O.Enact.bol_showTimeline(),I.ModeCurrent!==I.ModeEnum.Simple&I.ModeCurrent!==I.ModeEnum.Tile&&(O.Enact.int_setClock(),O.Enact.int_setDimming(),O.Enact.bol_showMap()),$("#optRestoreAllChains").click(function(){var e,t=I.ModeCurrent===I.ModeEnum.Tile?"inline-block":"block";for(var n in C.Chains)e=C.Chains[n],$("#chnCheck_"+e.nexus).removeClass("chnChecked"),$("#chnBar_"+e.nexus).show().css({opacity:1}).css({display:t}),C.isTimetableGenerated&&$(".chnSlot_"+e.nexus).show().css({opacity:1}).css({display:t}).find(".chnCheck").removeClass("chnChecked");for(X.clearChecklist(X.Checklists.Chain),n=0;n<T.cNUM_TIMEFRAMES_IN_HOUR;n++){K.checkoffChainIcon(T.getStandardChain(n).nexus);var i=T.getHardcoreChain(n);i&&K.checkoffChainIcon(i.nexus)}}),$("#optChainsExpand").click(function(){$(".chnDetails").show()}),$("#optChainsCollapse").click(function(){$(".chnDetails").hide(),I.scrollToElement("#plateChains")}),$("#optClearLocalStorage").click(function(){confirm(I.cSiteName+" Reset: This is will clear all options and everything you have written in this website. Continue?")&&(localStorage.clear(),location.reload())}),$("#optPrintLocalStorage").click(function(){var e,t=[];for(e=0;e<localStorage.length;e++){var n=U.escapeHTML(localStorage.key(e));t.push(n)}t.sort();var i="";for(e in t){var a=U.escapeHTML(localStorage.getItem(t[e]));i+=t[e]+": "+a+"<br />"}I.print(i,!0)})},Enact:{int_setAlarm:function(){var e="img/ui/placeholder.png";switch(O.Options.int_setAlarm){case O.IntEnum.Alarm.Checklist:e="img/ui/check.png";break;case O.IntEnum.Alarm.Subscription:e="img/ui/subscription.png"}O.Options.int_setAlarm===O.IntEnum.Alarm.Off?$("#optAlarmSpeaker").attr("src","img/ui/mute.png"):$("#optAlarmSpeaker").attr("src","img/ui/speaker.png"),$("#optAlarmIcon").attr("src",e)},int_setVolume:function(){D.isSpeaking()===!1&&D.speak(D.getWord("alarm"))},bol_logNarrate:function(){O.Options.bol_logNarrate===!1&&D.stopSpeech()},bol_hideChecked:function(){$(".chnBar").each(function(){X.hideCheckedChainBar(U.getSubintegerFromHTMLID($(this)))})},bol_expandWB:function(){for(var e in C.CurrentChains)if(C.isChainRegular(C.CurrentChains[e])){var t=$("#chnDetails_"+C.CurrentChains[e].nexus);O.Options.bol_expandWB?t.show("fast"):t.hide("fast")}},bol_use24Hour:function(){C.initializeTimetableHTML(),C.updateChainsTimeHTML(),K.updateDigitalClockMinutely(),B.updateTimelineLegend()},bol_detectDST:function(){T.checkDST()},int_setClock:function(){K.setClock()},int_setDimming:function(){switch(O.Options.int_setDimming){case 1:$("#paneClockBackground").css({opacity:1});break;case 2:$("#paneClockBackground").css({opacity:0})}},int_setFloor:function(){M.changeFloor(O.Options.int_setFloor)},int_setInitialZoom:function(){M.Map.setZoom(O.Options.int_setInitialZoom)},int_setInitialZoomWvW:function(){W.Map.setZoom(O.Options.int_setInitialZoomWvW)},bol_showZoneBorders:function(){P.drawZoneBorders()},bol_showZoneGateways:function(){P.drawZoneGateways()},bol_showPersonalPaths:function(){M.isMapInitialized&&M.drawPersonalPath(),W.isMapInitialized&&W.drawPersonalPath()},str_colorPersonalPath:function(){M.isMapInitialized&&M.drawPersonalPath(),W.isMapInitialized&&W.drawPersonalPath()},bol_showChainPaths:function(){M.toggleLayerArray(P.LayerArray.ChainPath,O.Options.bol_showChainPaths)},int_setFollow:function(){O.Options.int_setFollow!==O.IntEnum.Follow.Off&&(M.GPSPreviousZoneID="",P.updateCharacter(0))},int_setFollowWvW:function(){O.Options.int_setFollowWvW!==O.IntEnum.Follow.Off&&(W.GPSPreviousZoneID="",P.updateCharacter(0))},bol_displayCharacter:function(){O.Options.bol_displayCharacter?(P.tickGPS(),P.updateCharacter(0)):(M.movePin(M.Pin.Character),M.movePin(M.Pin.Camera))},bol_displayCharacterWvW:function(){O.Options.bol_displayCharacterWvW?(P.tickGPS(),P.updateCharacter(0)):(W.movePin(W.Pin.Character),W.movePin(W.Pin.Camera))},bol_showPanel:function(){O.Options.bol_showMap&&I.isMapEnabled&&($("#panelApp").toggle(O.Options.bol_showPanel),M.refreshMap(),W.isMapInitialized&&W.refreshMap(),A.isAccountInitialized&&A.adjustAccountPanel())},bol_alignPanelRight:function(e){I.isMapEnabled&&(O.Options.bol_alignPanelRight?e!==!0&&($("#panelApp").insertAfter("#panelMap"),$(".paneApp").css({right:"0px",borderLeft:"1px solid #444",borderRight:"none",boxShadow:"-5px 0px 5px #223"}),$("#itemLanguagePopup").css({left:"-98px"}),$("#cslContent").css({left:"24px"}),$(".mapExpandButton").css({right:0,left:"auto"})):($("#panelApp").insertBefore("#panelMap"),$(".paneApp").css({right:"auto",borderLeft:"none",borderRight:"1px solid #444",boxShadow:"5px 0px 5px #223"}),$("#itemLanguagePopup").css({left:"64px"}),$("#cslContent").css({left:I.cPANEL_WIDTH+24+"px"}),$(".mapExpandButton").css({right:"auto",left:0})))},bol_showMap:function(){I.isMapEnabled&&($("#panelMap").toggle(O.Options.bol_showMap),M.refreshMap())},bol_showCoordinatesBar:function(){M.toggleCoordinatesBar()},bol_hideHUD:function(){O.Options.bol_hideHUD===!1&&$("#mapHUDBoxes").show()},bol_showTimeline:function(){if(O.Options.bol_showTimeline){if(B.isTimelineGenerated)return void B.toggleTimeline(!0);B.generateTimeline(),O.Enact.bol_opaqueTimeline()}else B.toggleTimeline(!1)},bol_opaqueTimeline:function(){var e;e=O.Options.bol_opaqueTimeline?I.ModeCurrent===I.ModeEnum.Overlay?"linear-gradient(to right, #111 0%, #383838 50%, #111 100%)":"rgba(0, 0, 0, 0.6)":"none",$("#itemTimeline").css({background:e})},bol_refreshPrices:function(){O.Options.bol_refreshPrices&&E.isTradingCalculatorsInitialized?E.loopRefresh():E.cancelLoopRefresh()},bol_useSiteTag:function(){O.Options.bol_useSiteTag?I.siteTagCurrent=I.siteTagDefault:I.siteTagCurrent=""},bol_showLog:function(){W.toggleLog()},bol_opaqueLog:function(){W.opaqueLog()},bol_maximizeLog:function(){W.toggleLogHeight()},bol_showLeaderboard:function(){W.toggleLeaderboard()},bol_opaqueLeaderboard:function(){W.opaqueLeaderboard()},bol_condenseLeaderboard:function(){W.toggleLeaderboardWidth(!0)},bol_showSecondaries:function(){W.toggleSecondaries(!0)},bol_showDestructibles:function(){W.toggleWalls(!0)},bol_showObjectiveLabels:function(){W.toggleObjectiveLabels()}}},X={Checklists:{Chain:{key:"str_chlChain",value:""},ChainSubscription:{key:"str_chlChainSubscription",value:""},JP:{key:"str_chlJP",value:""},Chest:{key:"str_chlChest",value:""},ResourceRich:{key:"str_chlResourceRich",value:""},ResourceRegular:{key:"str_chlResourceRegular",value:""},ResourceHotspot:{key:"str_chlResourceHotspot",value:""},Dungeon:{key:"str_chlDungeon",value:"",money:0},CustomDaily:{key:"str_chlCustomDaily",value:""},CustomWeekly:{key:"str_chlCustomWeekly",value:""},TradingOverwrite:{key:"str_chlTradingOverwrite",value:""},TradingNotify:{key:"str_chlTradingNotify",value:""}},Collectibles:{NoxiousPods:{key:"str_chlNoxiousPods",urlkey:"noxiouspods",value:""},CrystallizedCaches:{key:"str_chlCrystallizedCaches",urlkey:"crystallizedcaches",value:""},ExaltedChests:{key:"str_chlExaltedChests",urlkey:"exaltedchests",value:""},AirshipCargo:{key:"str_chlAirshipCargo",urlkey:"airshipcargo",value:""},BuriedChests:{key:"str_chlBuriedChests",urlkey:"chests",value:""},BanditChests:{key:"str_chlBanditChests",urlkey:"banditchests",value:""},MatrixCubeKey:{key:"str_chlMatrixCubeKey",urlkey:"matrixcubekey",value:""},ItzelTotems:{key:"str_chlItzelTotems",urlkey:"itzeltotems",value:""},PriorySeals:{key:"str_chlPriorySeals",urlkey:"prioryseals",value:""},AuricTablets:{key:"str_chlAuricTablets",urlkey:"aurictablets",value:""},ExaltedMasks:{key:"str_chlExaltedMasks",urlkey:"exaltedmasks",value:""},LionsArchExterminator:{key:"str_chlLionsArchExterminator",urlkey:"lionsarchexterminator",value:""},CoinProspect:{key:"str_chlCoinProspect",urlkey:"coinprospect",value:""},CoinUplands:{key:"str_chlCoinUplands",urlkey:"coinuplands",value:""},CoinChallenger:{key:"str_chlCoinChallenger",urlkey:"coinchallenger",value:""},LostBadges:{key:"str_chlLostBadges",urlkey:"lostbadges",value:""},GoldenLostBadges:{key:"str_chlGoldenLostBadges",urlkey:"goldenlostbadges",value:""},DiveMaster:{key:"str_chlDiveMaster",urlkey:"divemaster",value:""},SpeedyReader:{key:"str_chlSpeedyReader",urlkey:"speedyreader",value:""},CleaningUp:{key:"str_chlCleaningUp",urlkey:"cleaningup",value:""},HistoryBuff:{key:"str_chlHistoryBuff",urlkey:"historybuff",value:""},Strongboxes:{key:"str_chlStrongboxes",urlkey:"strongboxes",value:""},MasteryInsight:{key:"str_chlMasteryInsight",urlkey:"masteryinsight",value:""},HeroChallenge:{key:"str_chlHeroChallenge",urlkey:"herochallenge",value:""},RangerPets:{key:"str_chlRangerPets",urlkey:"pets",value:""}},ChecklistEnum:{Unchecked:"0",Checked:"1",Disabled:"2",Unfound:"0",Tracked:"1",Found:"2"},ChecklistJob:{UncheckAll:0,CheckAll:1,UncheckTheChecked:2},Textlists:{CustomTextDaily:{key:"str_txlCustomTextDaily",value:[],valueDefault:[]},CustomTextWeekly:{key:"str_txlCustomTextWeekly",value:[],valueDefault:[]},NotepadText:{key:"str_txlNotepadText",value:[],valueDefault:[]},TradingItem:{key:"str_txlTradingItem",value:[]},TradingName:{key:"str_txlTradingName",value:[]},TradingBuy:{key:"str_txlTradingBuy",value:[]},TradingSell:{key:"str_txlTradingSell",value:[]},TradingQuantity:{key:"str_txlTradingQuantity",value:[]},NotifyBuyLow:{key:"str_txlNotifyBuyLow",value:[]},NotifyBuyHigh:{key:"str_txlNotifyBuyHigh",value:[]},NotifySellLow:{key:"str_txlNotifySellLow",value:[]},NotifySellHigh:{key:"str_txlNotifySellHigh",value:[]},ExchangeUnit:{key:"str_txlExchangeUnit",value:[]}},boolToChecklistEnum:function(e){return e?X.ChecklistEnum.Checked:X.ChecklistEnum.Unchecked},initializeChecklist:function(e,t,n,i){var a,r,o,s=localStorage[e.key];if(e.length=t,n){X.clearChecklist(e),r=n.split(",");for(a in r)o=parseInt(r[a]),isFinite(o)&&X.setChecklistItem(e,o-1,X.ChecklistEnum.Checked)}else if(void 0===s)X.clearChecklist(e,i);else if(s.length>t)localStorage[e.key]=s.substring(0,t);else if(s.length<t){var c=U.repeatChar(X.ChecklistEnum.Unchecked,t-s.length);localStorage[e.key]=s+c}e.value=localStorage[e.key]},setChecklistItem:function(e,t,n){t=parseInt(t);var i=n.toString();if(1===i.length&&e.value[t]!==i&&t>=0&&t<e.value.length){var a=U.replaceCharAt(e.value,t,i);localStorage[e.key]=a,e.value=a}},trackChecklistItem:function(e,t){t=parseInt(t);var n=e.value.charAt(t);switch(n){case X.ChecklistEnum.Unfound:n=X.ChecklistEnum.Tracked;break;case X.ChecklistEnum.Tracked:n=X.ChecklistEnum.Found;break;case X.ChecklistEnum.Found:n=X.ChecklistEnum.Unfound;break;default:n=X.ChecklistEnum.Unfound}var i=U.replaceCharAt(e.value,t,n);return localStorage[e.key]=i,e.value=i,n},getChecklistItem:function(e,t,n){var i=e.value.charAt(t);return void 0===n?i:n===O.TypeEnum.isInteger?parseInt(i):n===O.TypeEnum.isBoolean?O.intToBool(parseInt(i)):i},isChecked:function(e,t){var n=U.getSubintegerFromHTMLID(t);return X.getChecklistItem(e,n)===X.ChecklistEnum.Checked?!0:!1},getCheckedIndexes:function(e){var t,n="",i=e.value;for(t=0;t<i.length;t++)i[t]===X.ChecklistEnum.Checked&&(n+=t+1+",");return n=n.slice(0,-1)},clearChecklist:function(e,t){var n,i="",a="";switch(t){case X.ChecklistJob.CheckAll:for(n=0;n<e.length;n++)i+=X.ChecklistEnum.Checked;break;case X.ChecklistJob.UncheckTheChecked:for(a=void 0!==localStorage[e.key]?localStorage[e.key]:e.value,n=0;n<a.length;n++)i+=a[n]===X.ChecklistEnum.Checked?X.ChecklistEnum.Unchecked:a[n];break;default:for(n=0;n<e.length;n++)i+=X.ChecklistEnum.Unchecked}e.value=i,localStorage[e.key]=i},countChecklist:function(e,t){return U.countOccurrence(e.value,t)},getCheckboxEnumState:function(e){return e.prop("disabled")===!0?X.ChecklistEnum.Disabled:e.prop("checked")===!0?X.ChecklistEnum.Checked:X.ChecklistEnum.Unchecked},setCheckboxEnumState:function(e,t){switch(t){case X.ChecklistEnum.Disabled:e.prop("disabled",!0),e.prop("checked",!1);break;case X.ChecklistEnum.Checked:e.prop("checked",!0);break;default:e.prop("checked",!1)}e.trigger("change")},setFieldsetState:function(e,t){$("fieldset[name='"+e+"'] input:eq("+t+")").trigger("click")},triggerCheckbox:function(e,t){var n=X.getCheckboxEnumState(e);t===X.ChecklistEnum.Checked&&n===X.ChecklistEnum.Unchecked||t===X.ChecklistEnum.Unchecked&&n===X.ChecklistEnum.Checked?e.trigger("click"):t===X.ChecklistEnum.Disabled&&n!==X.ChecklistEnum.Disabled&&e.trigger("dblclick")},triggerCheckboxEnumState:function(e,t,n){var i=X.getChecklistItem(e,t);X.triggerCheckbox(n,i)},styleCheckbox:function(e,t,n){var i=X.getChecklistItem(e,t);switch(i){case X.ChecklistEnum.Disabled:n.parent().removeClass("chlCheckboxChecked").addClass("chlCheckboxDisabled");break;case X.ChecklistEnum.Checked:n.parent().removeClass("chlCheckboxDisabled").addClass("chlCheckboxChecked");break;default:n.parent().removeClass("chlCheckboxDisabled").removeClass("chlCheckboxChecked")}},initializeCheckboxlist:function(e,t,n){X.initializeChecklist(e,t.length,null,n),t.each(function(t){$(this).change(function(){var n=X.getCheckboxEnumState($(this));X.setChecklistItem(e,t,n)}),X.triggerCheckboxEnumState(e,t,$(this))})},initializeTextlist:function(e,t,n,i,a){t.each(function(){var t=$(this).val();e.value.push(t),e.valueDefault&&e.valueDefault.push(t)});var r;if(void 0===localStorage[e.key])localStorage[e.key]=e.value.join(I.cTextDelimiterChar);else{var o=localStorage[e.key].split(I.cTextDelimiterChar);for(r=0;r<e.value.length;r++)o[r]?e.value[r]=o[r]:e.value[r]="";localStorage[e.key]=e.value.join(I.cTextDelimiterChar)}var s=function(){t.each(function(t){e.value[t]=$(this).val().replace(I.cTextDelimiterRegex,"")}),localStorage[e.key]=e.value.join(I.cTextDelimiterChar)};t.each(function(t){$(this).attr("maxlength",i),$(this).val(e.value[t]),$(this).change(function(){n&&I.write(n+" #"+(t+1)+" updated."),s()})}),a&&a.click(function(){confirm("Reset texts to default?")&&t.each(function(t){$(this).val(e.valueDefault[t]).trigger("change")})})},initializeChainChecklist:function(e){var t=$("#chnBar_"+e.nexus),n=$("#chnCheck_"+e.nexus),i=$("#chnTime_"+e.nexus);X.reapplyChainBarState(e.nexus,t,n,i),C.isChainRegular(e)&&i.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=$(".chnSlot_"+e).find("time");X.getChecklistItem(X.Checklists.ChainSubscription,e)===X.ChecklistEnum.Checked?($(this).removeClass("chnTimeSubscribed"),t.removeClass("chnTimeSubscribed"),X.setChecklistItem(X.Checklists.ChainSubscription,e,X.ChecklistEnum.Unchecked)):($(this).addClass("chnTimeSubscribed"),t.addClass("chnTimeSubscribed"),X.setChecklistItem(X.Checklists.ChainSubscription,e,X.ChecklistEnum.Checked),O.Options.int_setAlarm!==O.IntEnum.Alarm.Subscription&&I.write("Please set <img src='img/ui/speaker.png' /> to &quot;"+D.getWordCapital("subscription")+"&quot; to enable alarm."))}),n.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=$("#chnBar_"+e),n=$(".chnSlot_"+e),i=I.ModeCurrent===I.ModeEnum.Tile?"inline-block":"block";switch(X.getChecklistItem(X.Checklists.Chain,e)){case X.ChecklistEnum.Unchecked:t.css({opacity:1}).animate({opacity:K.iconOpacityChecked},K.iconOpacitySpeed),I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+e).hide("fast"),$(this).addClass("chnChecked"),X.setChecklistItem(X.Checklists.Chain,e,X.ChecklistEnum.Checked),C.isTimetableGenerated&&n.css({opacity:1}).animate({opacity:K.iconOpacityChecked},K.iconOpacitySpeed).find(".chnCheck").addClass("chnChecked");break;case X.ChecklistEnum.Checked:t.css({opacity:1}).show("fast").css({display:i}),t.css({opacity:K.iconOpacityChecked}).animate({opacity:1},K.iconOpacitySpeed),I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+e).show("fast").css({display:i}),$(this).removeClass("chnChecked"),X.setChecklistItem(X.Checklists.Chain,e,X.ChecklistEnum.Unchecked),C.isTimetableGenerated&&n.show("fast").css({display:i}).css({opacity:K.iconOpacityChecked}).animate({opacity:1},K.iconOpacitySpeed).find(".chnCheck").removeClass("chnChecked");break;case X.ChecklistEnum.Disabled:t.css({opacity:1}).show("fast").css({display:i}),I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+e).show("fast").css({display:i}),$(this).removeClass("chnChecked"),X.setChecklistItem(X.Checklists.Chain,e,X.ChecklistEnum.Unchecked),C.isTimetableGenerated&&n.hide().css({opacity:1}).find(".chnCheck").removeClass("chnChecked")}X.hideCheckedChainBar(e),K.checkoffChainIcon(e)}),$("#chnDelete_"+e.nexus).click(function(){var e=U.getSubintegerFromHTMLID($(this));$("#chnBar_"+e).hide("slow"),C.isTimetableGenerated&&$(".chnSlot_"+e).hide("slow"),X.setChecklistItem(X.Checklists.Chain,e,X.ChecklistEnum.Disabled),K.checkoffChainIcon(e)})},reapplyChainBarState:function(e,t,n,i){switch(X.getChecklistItem(X.Checklists.Chain,e)){case X.ChecklistEnum.Unchecked:break;case X.ChecklistEnum.Checked:t.css({opacity:K.iconOpacityChecked}),n.addClass("chnChecked"),O.Options.bol_hideChecked&&t.hide();break;case X.ChecklistEnum.Disabled:t.hide()}C.isChainRegular(C.Chains[e])&&X.getChecklistItem(X.Checklists.ChainSubscription,e)===X.ChecklistEnum.Checked&&i.addClass("chnTimeSubscribed")},hideCheckedChainBar:function(e){var t=I.ModeCurrent===I.ModeEnum.Tile?"inline-block":"block";X.getChecklistItem(X.Checklists.Chain,e)===X.ChecklistEnum.Checked&&(O.Options.bol_hideChecked?($("#chnBar_"+e).hide("fast"),C.isTimetableGenerated&&$(".chnSlot_"+e).hide("fast")):($("#chnBar_"+e).show("fast").css({display:t}),C.isTimetableGenerated&&$(".chnSlot_"+e).show("fast").css({display:t})))},getChainChecklistState:function(e){return X.getChecklistItem(X.Checklists.Chain,e.nexus)},initializePersonalChecklist:function(){T.isChecklistCountdownsStarted=!0,T.updateChecklistCountdowns(),$("#chlDungeon, #chlCustomWeekly").hide();var e=$("#chlCustomTabs button"),t=$("#chlCustom"),n=$("#chlDungeon"),i=$("#chlCustomDaily"),a=$("#chlCustomWeekly"),r=$("#chlCountdownToDaily").hide(),o=$("#chlCountdownToWeekly").hide();$("#chlDungeonButton").click(function(){e.removeClass("btnFocused"),$(this).addClass("btnFocused"),t.hide(),n.show().css({opacity:.5}).animate({opacity:1},400),r.show(),o.hide()}),$("#chlCustomDailyButton").click(function(){e.removeClass("btnFocused"),$(this).addClass("btnFocused"),n.hide(),t.show(),a.hide(),i.show().css({opacity:.5}).animate({opacity:1},400),r.show(),o.hide()}).trigger("click"),$("#chlCustomWeeklyButton").click(function(){e.removeClass("btnFocused"),$(this).addClass("btnFocused"),n.hide(),t.show(),i.hide(),a.show().css({opacity:.5}).animate({opacity:1},400),r.hide(),o.show()}),X.initializeDungeonChecklist(),X.initializeCustomChecklist()},initializeDungeonChecklist:function(){X.initializeChecklist(X.Checklists.Dungeon,$("#chlDungeon input").length),$("#chlDungeon .chlDungeonBar").each(function(){$(this).prepend("<ins class='chl_"+$(this).data("name").toLowerCase()+"'></ins>")});var e=function(){var e=X.Checklists.Dungeon.money,t=~~(e/E.Exchange.COPPER_IN_GOLD),n=~~(e/E.Exchange.SILVER_IN_GOLD)%E.Exchange.COPPER_IN_SILVER,i=e%E.Exchange.COPPER_IN_SILVER;$("#chlDungeonCalculator_Gold").text(t),$("#chlDungeonCalculator_Silver").text(n),$("#chlDungeonCalculator_Copper").text(i)};$("#chlDungeon input").each(function(t){$(this).change(function(){var n=X.getCheckboxEnumState($(this));X.setChecklistItem(X.Checklists.Dungeon,t,n),X.styleCheckbox(X.Checklists.Dungeon,t,$(this));var i=$("#chlDungeonCalculator"),a=X.Checklists.Dungeon.money,r=$(this).data("money");switch($(this).data("mode")){case"E":r+=i.data("moneyaddexp")}switch(n){case X.ChecklistEnum.Disabled:X.Checklists.Dungeon.money=a-r;break;case X.ChecklistEnum.Checked:X.Checklists.Dungeon.money=a+r;break;default:X.Checklists.Dungeon.money=a-r}e()})}),$("#chlDungeon label").each(function(e){$(this).dblclick(function(){var t=$(this).find("input:first-child");t.prop("disabled")===!1?(t.prop("checked")===!0&&X.triggerCheckbox(t,X.ChecklistEnum.Unchecked),t.prop("disabled",!0).prop("checked",!1)):t.prop("disabled",!1),X.setChecklistItem(X.Checklists.Dungeon,e,X.getCheckboxEnumState(t)),X.styleCheckbox(X.Checklists.Dungeon,e,t)})}),$("#chlDungeon input").each(function(e){X.triggerCheckboxEnumState(X.Checklists.Dungeon,e,$(this))}),$("#chlDungeonUncheck").click(function(){X.clearChecklist(X.Checklists.Dungeon,X.ChecklistJob.UncheckTheChecked),$("#chlDungeon input").each(function(e){$(this).prop("checked")===!0&&$(this).trigger("click"),X.styleCheckbox(X.Checklists.Dungeon,e,$(this))})})},initializeCustomChecklist:function(){for(var e=12,t="<li><label><input type='checkbox' />"+I.Symbol.Filler+"</label><input type='text' /></li>",n=0;e>n;n++)$("#chlCustomListDaily").append(t),
$("#chlCustomListWeekly").append(t);var i=function(e){for(var t=$(e).attr("data-samples").split(I.cTextDelimiterChar),n=0;n<t.length;n++)$(e+" input[type='text']:eq("+n+")").val(t[n])};i("#chlCustomListDaily"),i("#chlCustomListWeekly");var a=function(e,t,n){var i=$("#chlCustomList"+n+" input:checkbox");X.initializeChecklist(e,i.length),i.each(function(t){$(this).change(function(){var n=X.getCheckboxEnumState($(this));X.setChecklistItem(e,t,n),X.styleCheckbox(e,t,$(this)),n===X.ChecklistEnum.Checked?$(this).parent().next().addClass("chlCustomTextChecked"):$(this).parent().next().removeClass("chlCustomTextChecked")}),X.triggerCheckboxEnumState(e,t,$(this))}),$("#chlCustomUncheck"+n).click(function(){X.clearChecklist(e,X.ChecklistJob.UncheckTheChecked),$("#chlCustomList"+n+" input:checkbox").each(function(t){$(this).prop("checked")&&$(this).trigger("click"),X.styleCheckbox(e,t,$(this))})});var a=$("#chlCustomList"+n+" input:text"),r=$("#chlCustomRestore"+n);X.initializeTextlist(t,a,"Custom checklist item",48,r)};a(X.Checklists.CustomDaily,X.Textlists.CustomTextDaily,"Daily"),a(X.Checklists.CustomWeekly,X.Textlists.CustomTextWeekly,"Weekly")},clearCustomChecklistDaily:function(){$("#chlDungeonUncheck").trigger("click"),$("#chlCustomUncheckDaily").trigger("click"),X.clearChecklist(X.Checklists.Dungeon,X.ChecklistJob.UncheckTheChecked),X.clearChecklist(X.Checklists.CustomDaily,X.ChecklistJob.UncheckTheChecked)},clearCustomChecklistWeekly:function(){$("#chlCustomUncheckWeekly").trigger("click"),X.clearChecklist(X.Checklists.CustomWeekly,X.ChecklistJob.UncheckTheChecked)},initializeNotepad:function(){$("#chlNotepadButtons button").each(function(e){$(this).click(function(){$("#chlNotepadSheets textarea").hide().eq(e).show().css({opacity:.5}).animate({opacity:1},400),$("#chlNotepadButtons button").removeClass("btnFocused"),$(this).addClass("btnFocused")})}).first().click();var e=$("#chlNotepadSheets textarea"),t=$("#chlNotepadRestore");X.initializeTextlist(X.Textlists.NotepadText,e,"Notepad sheet",4096,t),e.css("height",O.Options.int_sizeNotepadHeight),e.css("font-size",O.Options.int_sizeNotepadFont),e.first().show()}},U={CommandPrefix:"/",URL_META:{News:"http://forum.renaka.com/topic/5500046/",Overlay:"http://forum.renaka.com/topic/5546166/"},URL_API:{Daily:"https://api.guildwars2.com/v2/achievements/daily",Tomorrow:"https://api.guildwars2.com/v2/achievements/daily/tomorrow",Fractal:"https://api.guildwars2.com/v2/achievements/categories/88",LangKey:"",TilesTyria:"https://tiles.guildwars2.com/1/1/{z}/{x}/{y}.jpg",TilesMists:"https://tiles.guildwars2.com/2/1/{z}/{x}/{y}.jpg",MapFloorTyria:"https://api.guildwars2.com/v1/map_floor.json?continent_id=1&floor=1",MapFloorMists:"https://api.guildwars2.com/v1/map_floor.json?continent_id=2&floor=1",MapsList:"https://api.guildwars2.com/v1/maps.json",EventDetails:"https://api.guildwars2.com/v1/event_details.json",ItemListing:"https://api.guildwars2.com/v2/commerce/listings/",ItemPrices:"https://api.guildwars2.com/v2/commerce/prices/",ItemDatabase:"https://api.guildwars2.com/v2/items",ItemRender:"https://render.guildwars2.com/file/",CoinPrice:"https://api.guildwars2.com/v2/commerce/exchange/gems?quantity=",GemPrice:"https://api.guildwars2.com/v2/commerce/exchange/coins?quantity=",ItemSearch:"http://www.gw2spidy.com/api/v0.9/json/item-search/",ItemSearchFallback:"http://www.gw2shinies.com/api/json/idbyname/",Match:"https://api.guildwars2.com/v2/wvw/matches?world=",Matches:"https://api.guildwars2.com/v2/wvw/matches/",GuildDetails:"https://api.guildwars2.com/v1/guild_details.json?guild_id=",MatchFallback:"https://api.guildwars2.com/v1/wvw/match_details.json?match_id=",MatchesFallback:"https://api.guildwars2.com/v1/wvw/matches.json",Worlds:"https://api.guildwars2.com/v2/worlds",Prefix:"https://api.guildwars2.com/v2/",Prefix1:"https://api.guildwars2.com/v1/",TextToSpeech:"http://code.responsivevoice.org/getvoice.php?tl="},URL_IMG:{Placeholder:"img/ui/placeholder.png",Waypoint:"img/map/waypoint.png",WaypointOver:"img/map/waypoint_h.png",Landmark:"img/map/landmark.png",LandmarkOver:"img/map/landmark_h.png",Vista:"img/map/vista.png",Challenge:"img/map/challenge.png",Heart:"img/map/heart.png"},URL_DATA:{Account:"data/account.js",WvW:"data/wvw.js",Itinerary:"data/itinerary.js",Skins:"data/skins.js",Unscheduled:"data/chains-add.js",Daily:"data/daily.js",DryTop:"data/drytop.js",Resource:"data/resource.js",JP:"data/jp.js",Collectible:"data/collectible.js",Guild:"data/guild.js"},initializeAPIURLs:function(){var e=D.getPartiallySupportedLanguage();U.URL_API.LangKey="?lang="+e;var t="&lang="+e;U.URL_API.Worlds+=U.URL_API.LangKey+"&ids=",U.URL_API.MapFloorTyria+=t,U.URL_API.MapFloorMists+=t,U.URL_API.TextToSpeech+=e+"&sv=&vn=&pitch=0.5&rate=0.4"},getAPI:function(e,t){return U.URL_API.Prefix+e+"/"+t+U.URL_API.LangKey},getAPIAchievement:function(e){return U.getAPI("achievements",e)},getAPIItem:function(e){return U.getAPI("items",e)},getAPISkin:function(e){return U.getAPI("skins",e)},getAPIRecipe:function(e){return U.getAPI("recipes",e)},getAPIMaterial:function(e){return U.getAPI("materials",e)},getAPIMini:function(e){return U.getAPI("minis",e)},getAPITrait:function(e){return U.getAPI("traits",e)},getAPISpecialization:function(e){return U.getAPI("specializations",e)},getAPIPrice:function(e){return U.URL_API.ItemPrices+e},Args:{},KeyEnum:{Page:"page",Section:"section",Article:"article",Mode:"mode",Go:"go",Draw:"draw"},CaseEnum:{Original:-1,None:0,Lower:1,Sentence:2,Title:3,Every:4,All:5},APICacheArrayOfIDs:null,APICacheArrayOfObjects:null,APICacheConsole:null,loadAPICache:function(){var e=localStorage[O.Utilities.APICache.key];if(e)try{return U.APICacheConsole=JSON.parse(e),!0}catch(t){I.print("Error loading API cache object.")}return!1},saveAPICache:function(){return U.APICacheConsole?(localStorage[O.Utilities.APICache.key]=JSON.stringify(U.APICacheConsole),!0):(I.print("Error saving cache object."),!1)},interpretCommand:function(e,t,n,i){0===e.indexOf(I.cConsoleCommandPrefix)?U.parseConsoleCommand(e,t):0===e.indexOf(I.cChatcodePrefix)?I.print(U.getGameIDFromChatlink(e,!0)):t.parsePersonalPath(e)===!1&&t.goToArguments(e,n,i)},parseConsoleCommand:function(e,t){var n=t,i=e.substring(1,e.length).split(" "),a=e.substring(e.indexOf(" ")+1,e.length),r=i[0].toLowerCase(),o={clear:{usage:"Clears the console screen.",f:function(){I.clear()}},speak:{usage:"Speaks the given text. <em>Parameters: str_text</em>",f:function(){D.speak(a)}},gps:{usage:"Prints GPS location information.",f:function(){I.print("Position: "+U.formatJSON(GPSPositionArray)+"<br />Direction: "+U.formatJSON(GPSDirectionArray)+"<br />Camera: "+U.formatJSON(GPSCameraArray))}},identity:{usage:"Prints GPS general information.",f:function(){U.printJSON(GPSIdentityJSON)}},lock:{usage:"Map cannot be moved.",f:function(){n.Map.dragging.disable(),n.Map.scrollWheelZoom.disable(),I.write("Map locked.")}},unlock:{usage:"Map can be moved.",f:function(){n.Map.dragging.enable(),n.Map.scrollWheelZoom.enable(),I.write("Map unlocked.")}},nct:{usage:"Disables the map's context menu.",f:function(){n.Map.off("contextmenu"),I.write("Map context menu disabled.")}},link:{usage:"Prints a coordinates URL of the current map view.",f:function(){I.print(I.cSiteURL+n.convertLCtoGC(n.Map.getCenter()),!0)}},dart:{usage:"Draws personal pins at random map locations. <em>Parameters: int_quantity</em>",f:function(){n.drawRandom(i[1])}},nodes:{usage:"Sorts and prints a list coordinates. <em>Parameters: arr_coordinates</em>",f:function(){P.printNodes(P.sortCoordinates(M.parseCoordinatesMulti(i[1])))}},needles:{usage:"Numbers and prints a list of coordinates. <em>Parameters: arr_coordinates</em>",f:function(){P.printNodes(M.parseCoordinatesMulti(i[1]),!0)}},latlng:{usage:"Converts an array of LatLng's to standard coordinates. <em>Parameters: arr_latlngs</em>",f:function(){n.convertLatLngs(JSON.parse(a))}},jsonparse:{usage:"Converts a JSON string into an object for testing. <em>Parameters: str_json</em>",f:function(){try{U.APICacheConsole=JSON.parse(a),I.print("Parse JSON successful.")}catch(e){I.print("Parse JSON failed.")}}},api:{usage:"Prints the output of an API URL &quot;"+U.URL_API.Prefix+"&quot;. <em>Parameters: str_apiurlsuffix, int_limit (optional), str_querystring (optional)</em>",f:function(){U.printAPI(i[1],i[2],i[3])}},apicache:{usage:"Prints the cache result of the previous console API call.",f:function(){U.printAPICache()}},apicacheassoc:{usage:"Prints API cache as an associative array.",f:function(){U.printAPICacheAssoc()}},acc:{usage:"Prints the output of an account API URL &quot;"+U.URL_API.Prefix+"&quot;. Token must be initialized from the account page. <em>Parameters: str_apiurlsuffix</em>. Replace spaces with &quot;%20&quot;",f:function(){A.printAccount(i[1])}},daily:{usage:"Prints today's and tomorrow's daily achievements.",f:function(){U.printDaily()}},item:{usage:"Prints an item's information. <em>Parameters: int_itemid</em>",f:function(){U.printAPI("items/"+i[1])}},items:{usage:"Prints the highest numbered item IDs in the API. <em>Parameters: int_offset</em>",f:function(){U.printItemsAPI(i[1])}},events:{usage:"Prints the event names of the current zone, dynamic events option must be enabled.",f:function(){P.printZoneEvents()}},help:{usage:"Prints this help message.",f:function(){I.write("Available console commands:<br />");var e="";for(var t in o)e+="<b>"+t+"</b> - "+o[t].usage+"<br />";e+="<br />The console also accepts: coordinates, array of coordinates, zone names, and chatcodes.<br />",I.print(e)}},test:{usage:"Test function for debugging.",f:function(){}}};void 0!==o[r]&&o[r].f()},printAPI:function(e,t,n){I.print("Gathering elements...");var i="v1",a=Number.POSITIVE_INFINITY,r=256,o=void 0===n?"":n;void 0!==t&&e!==i&&(O.isInteger(t)?a=t:o=t);var s=[],c=0,l=U.URL_API.Prefix+e,u=function(e){I.clear(),e.sort();for(var t=0;t<e.length;t++)d(e[t]),I.print(U.escapeHTML(e[t]))},d=function(e){var t="string"==typeof e?JSON.parse(e):e;t.icon&&I.print("<img class='cssRight' src='"+U.escapeHTML(t.icon)+"' />")};e===i&&(l=U.URL_API.Prefix1+t),$.get(l+o,function(t){var i=void 0===t.length?0:t.length;if(Array.isArray(t))if(i>r)I.print("Array is too big for one simultaneous request, requesting in batches with wait in between..."),U.scrapeAPIArray(t,e,n);else{I.print("Retrieved array:<br />"+U.escapeJSON(t)),U.APICacheArrayOfIDs=t,U.APICacheArrayOfObjects=[];for(var p=i,h=0;i>h&&h!==a;h++)!function(e){$.getJSON(l+"/"+t[e]+o,function(t){I.print("Retrieved an element: "+e),s.push(U.formatJSON(t)),U.APICacheArrayOfObjects.push(t)}).done(function(){(c===p-1||c===a-1)&&u(s),c++}).fail(function(){p--,(c===p-1||c===a-1)&&u(s),I.print("Unable to retrieve API array element at: "+U.escapeHTML(l+"/"+t[e]))})}(h)}else d(t),U.printJSON(t)}).fail(function(){I.print("Unable to retrieve API at: "+U.escapeHTML(l))})},printAPICache:function(){I.print(U.APICacheArrayOfIDs?"API IDs Array:<br />"+U.escapeJSON(U.APICacheArrayOfIDs)+"<br />":"API IDs Array is empty."),I.print(U.APICacheArrayOfObjects?"API Objects Array:<br />"+U.escapeJSON(U.APICacheArrayOfObjects)+"<br />":"API Objects Array is empty.")},printAPICacheAssoc:function(){for(var e,t="",n=0;n<U.APICacheArrayOfObjects.length;n++)e=U.APICacheArrayOfObjects[n],t+="&quot;"+e.id+"&quot;: "+U.escapeJSON(e)+",<br />";I.print(t)},printItemsAPI:function(e){if(O.isInteger(e)===!1)return void I.write("Invalid reverse index.");if(I.write("Retrieving items..."),e=parseInt(e),0===E.ItemsArray.length)$.get(U.URL_API.ItemDatabase,function(e){E.ItemsArray=e}).done(function(){U.printItemsAPI(e)}).fail(function(){I.write("Unable to retrieve API items database.")});else{var t=0,n=0;if(0>=e)n=E.ItemsArray.length+e-1,t=E.ItemsArray[n],Q.getItem(t,function(e){I.print("<img class='cssLeft' src='"+e.icon+"' />"+U.escapeJSON(e))}).fail(function(){I.write("Unable to retrieve item: "+n)});else{I.clear();for(var i=0;e>i;i++)n=E.ItemsArray.length-e-1-i,t=E.ItemsArray[n],Q.getItem(t,function(e){I.print("<img class='cssLeft' src='"+e.icon+"' />"+U.escapeJSON(e))}).fail(function(){I.write("Unable to retrieve item: "+n)})}}},scrapeAPIArray:function(e,t,n){var i=n||"",a=[],r=[],o=0,s=500,c=3e4,l=0,u=0,d=function(){u===l&&(r.length>0?I.print("WARNING - Failed to retrieve some IDs: "+r):I.print("All IDs successfully retrieved."),U.APICacheArrayOfObjects.length>0&&U.APICacheArrayOfObjects[0].id&&O.sortObjects(U.APICacheArrayOfObjects,"id"),I.print("Scrape completed. Enter /apicache to print the results."))},p=function(){for(var e=0,t=o;t<a.length;t++){if(e===s)return void m();h(a[t],o),o++,e++}},h=function(e,n){$.getJSON(U.URL_API.Prefix+t+"/"+e+i,function(e){U.APICacheArrayOfObjects.push(e),u++,d()}).fail(function(){r.push(e),l--,d()})},m=function(){var e=U.convertRatioToPercent(o/a.length),t=Math.ceil((a.length-o)/s)*~~(c/T.cMSECONDS_IN_SECOND);I.print("Cooldown... "+o+" / "+a.length+" ("+e+") "+T.formatTimeLetter(t,!0)+" remaining."),setTimeout(function(){p()},c)};U.APICacheArrayOfIDs=e,U.APICacheArrayOfObjects=[],a=e,l=a.length,p()},collateSkins:function(){var e,t,n=A.Metadata.Skins,i=U.APICacheArrayOfObjects,a=[];if(void 0===i||null===i)return void I.print("API cache array is unassigned.");for(var r=0;r<i.length;r++)t=null,e=i[r],void 0!==e.type&&("Armor"===e.type&&e.details&&e.details.type&&e.details.weight_class?t=e.type+"_"+e.details.weight_class+"_"+e.details.type:"Weapon"===e.type&&e.details&&e.details.type?t=e.type+"_"+e.details.type:"Back"===e.type&&(t=e.type),t&&n[t]?n[t].push(e.id):a.push(e.id));a.length>0&&I.print("Uncategorized IDs: "+U.printJSON(a)),U.printJSON(n)},printDaily:function(e){var t=0,n=0,i={},a=function(){if(n===t){void 0===e&&I.print("TODAY'S DAILIES");for(var a in i){I.print(a);for(var r in i[a]){var o=i[a][r];U.printJSON(o)}}void 0===e&&(I.print("<br />"),I.print("TOMORROW'S DAILIES"),U.printDaily(!0))}},r=e?U.URL_API.Tomorrow:U.URL_API.Daily;$.getJSON(r+U.URL_API.LangKey,function(e){for(var r in e)n+=e[r].length;for(var r in e){i[r]=[];for(var o in e[r]){var s=e[r][o];!function(e,n){$.getJSON(U.getAPIAchievement(n.id),function(t){t.level=n.level,e.push(t)}).always(function(){t++,a()})}(i[r],s)}}})},isEnumWithin:function(e,t){for(var n in t)if(t[n].toLowerCase()===e.toLowerCase())return!0;return!1},getURLArguments:function(){var e=window.location.search.substr(1).split("&");if(""===e)return{};for(var t={},n=0;n<e.length;++n){var i=e[n].split("=");2===i.length&&(t[i[0]]=decodeURIComponent(i[1].replace(/\+/g," ")))}return t},enforceURLArgumentsFirst:function(){U.Args=U.getURLArguments(),U.enforceURLArgumentsSpecial();var e,t=U.Args[U.KeyEnum.Mode];if(t)for(e in I.ModeEnum)if(I.ModeEnum[e].toLowerCase()===t.toLowerCase()){I.ModeCurrent=I.ModeEnum[e];break}null===I.ModeCurrent&&(I.ModeCurrent=I.ModeEnum.Website),I.ArticleCurrent=U.Args[U.KeyEnum.Article]},enforceURLArgumentsLast:function(){U.openPageFromURL()},enforceURLArgumentsSpecial:function(){var e,t,n,i=function(e){$("body").hide(),document.location=e},a=U.Args[U.KeyEnum.Page];if(a)if(a=a.toLowerCase(),"a"===a)U.Args[U.KeyEnum.Page]=I.SpecialPageEnum.Account;else if(U.isEnumWithin(a,I.PageEnum)===!1)if("navi"===a||"overlay"===a)i(U.URL_META.Overlay);else if("m"===a||"mobile"===a)U.Args[U.KeyEnum.Mode]=I.ModeEnum.Mobile;else if("s"===a||"simple"===a)U.Args[U.KeyEnum.Mode]=I.ModeEnum.Simple;else if("t"===a||"tile"===a)U.Args[U.KeyEnum.Mode]=I.ModeEnum.Tile;else{for(e in I.SectionEnum){n=I.SectionEnum[e];for(t in n)if(t.toLowerCase()===a)return void 0!==U.Args[U.KeyEnum.Section]&&(U.Args[U.KeyEnum.Article]=U.Args[U.KeyEnum.Section]),U.Args[U.KeyEnum.Page]=e,void(U.Args[U.KeyEnum.Section]=t)}for(e in M.Zones)if(-1!==a.indexOf(e))return void(U.Args[U.KeyEnum.Go]=e)}void 0!==U.Args[U.KeyEnum.Page]&&(I.PageInitial=U.Args[U.KeyEnum.Page].toLowerCase());for(e in X.Collectibles)if(n=X.Collectibles[e].urlkey,n===a||void 0!==U.Args[n])return U.Args[U.KeyEnum.Page]=I.PageEnum.Map,U.Args[U.KeyEnum.Section]=I.SectionEnum.Map.Collectible,void(U.Args[U.KeyEnum.Article]=n)},sanitizeURLOptionsValue:function(e,t){var n=e.substring(0,O.lengthOfPrefixes),i=t.toLowerCase();switch(n){case O.TypeEnum.isBoolean:return"true"===i||"false"===i?i:O.Options[e].toString();case O.TypeEnum.isInteger:if(isFinite(i)){var a=parseInt(i);if(a>=O.OptionRange[e][0]&&a<=O.OptionRange[e][1])return a.toString()}return O.Options[e].toString();case O.TypeEnum.isFloat:if(isFinite(i)){var r=parseFloat(i);if(r>=O.OptionRange[e][0]&&r<=O.OptionRange[e][1])return r.toString()}return O.Options[e].toString();case O.TypeEnum.isEnum:return O.validateEnum(e,t);case O.TypeEnum.isString:return U.escapeHTML(t)}return"null"},formatJSON:function(e){return JSON.stringify(e,null,"	")},escapeJSON:function(e){return U.escapeHTML(U.formatJSON(e))},printJSON:function(e){I.print("<pre>"+U.escapeJSON(e)+"</pre>")},stripToAlphanumeric:function(e){return e.replace(/\W/g,"")},stripToAlphanumericDash:function(e){return e.replace(/[^a-zA-Z0-9\-]/g,"")},stripToNumbers:function(e){return parseInt(e.replace(/[^0-9]/g,""))},stripToColorString:function(e){return e.replace(/[^a-zA-Z0-9#]/g,"")},stripToVariable:function(e){return e.replace(/ /g,"_").replace(/[0-9\u0021-\u002f\u003a-\u0040\u005b-\u005e\u0060\u007b-\u007e]/g,"")},stripToSentence:function(e){return e.replace(/[^\w\s\'\"\:\,]/gi,"")},stripToCalculation:function(e){return e.replace(/[^0-9.()\-+\/*]/gi,"")},toFirstUpperCase:function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},toCase:function(e,t){var n,i=[];if(void 0===t||t===U.CaseEnum.None)return e;switch((t===U.CaseEnum.Title||t===U.CaseEnum.Every)&&(i=e.split(" ")),t){case U.CaseEnum.Lower:return e.toLowerCase();case U.CaseEnum.Sentence:return U.toFirstUpperCase(e);case U.CaseEnum.Title:if(i.length>1){for(i[0]=U.toFirstUpperCase(i[0]),n=1;n<i.length;n++)2!==i[n].length&&(i[n]=U.toFirstUpperCase(i[n]));return i.join(" ")}return U.toFirstUpperCase(e);case U.CaseEnum.Every:if(i.length>1){for(n in i)i[n]=U.toFirstUpperCase(i[n]);return i.join(" ")}return U.toFirstUpperCase(e);case U.CaseEnum.All:return e.toUpperCase()}return e},truncateString:function(e,t,n){return n=n||"",e.length>t?e.substring(0,t)+n:e},wrapSubstringHTML:function(e,t,n){var i=e.toLowerCase().indexOf(t.toLowerCase()),a=i+t.length,r="";return-1!==i?(void 0===n&&(n="u"),r=e.substring(0,i)+"<"+n+">"+e.substring(i,a)+"</"+n+">"+e.substring(a,e.length)):r=e,r},escapeHTML:function(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):void 0===e?"undefined":"null"},replaceCharAt:function(e,t,n){return e.substr(0,t)+n+e.substr(t+n.length)},repeatChar:function(e,t){return Array(t+1).join(e)},countOccurrence:function(e,t){return e.split(t).length-1},updateAddressBar:function(e){history.replaceState("",null,e),K.reapplyFilters()},updateQueryString:function(e){if(""!==I.PageCurrent){var t=I.SectionCurrent[I.PageCurrent],n=I.ArticleCurrent,i=U.Args[U.KeyEnum.Go],a="?"+U.KeyEnum.Page+"="+I.PageCurrent,r="",o="",s="",c="";e=void 0===e?"":"&"+e;var l=I.PageCurrent;I.ModeCurrent!==I.ModeEnum.Website&&(c="&mode="+I.ModeCurrent),t&&(r="&"+U.KeyEnum.Section+"="+t,l=t),n&&(o="&"+U.KeyEnum.Article+"="+n),i&&(s="&"+U.KeyEnum.Go+"="+i),U.updateAddressBar(a+r+o+s+c+e),U.updateTitle(l),U.updateLanguageLinks(a+r+c)}},updateTitle:function(e){document.title=I.cSiteName+"/"+e},updateLanguageLinks:function(e){$(".linkLanguage").each(function(){var t=$(this).attr("data-lang"),n="";n=void 0===e?I.ModeCurrent===I.ModeEnum.Website?"?enu_Language="+t:"?enu_Language="+t+"&mode="+I.ModeCurrent:e+"&enu_Language="+t,$(this).attr("href","./"+n)})},openSectionFromURL:function(e){var t=$.extend({aPrefix:I.cHeaderPrefix+I.PageCurrent+"_",aSection:null,aInitialSection:null,aButton:null},e);setTimeout(function(){var e=U.Args[U.KeyEnum.Section]?U.Args[U.KeyEnum.Section].toString():null;if(e){U.Args[U.KeyEnum.Section]=null,e=U.stripToAlphanumeric(e);var n=$(null);"string"==typeof t.aButton?void 0!==t.aSection&&t.aSection.toLowerCase()===e.toLowerCase()&&(n=$(t.aButton)):(n=$(t.aPrefix+U.toFirstUpperCase(e)),n.length||(n=$(t.aPrefix+e.toUpperCase())),I.PageCurrent===I.PageEnum.Chains&&$("#headerChains_Scheduled").trigger("click")),n.trigger("click")}else"string"==typeof t.aInitialSection&&$(t.aPrefix+t.aInitialSection).trigger("click")},0)},openPageFromURL:function(){if(void 0!==U.Args[U.KeyEnum.Page]){var e=U.stripToAlphanumeric(U.Args[U.KeyEnum.Page]);for(var t in I.PageEnum)if(e.toLowerCase()===I.PageEnum[t].toLowerCase())return void $(I.cMenuPrefix+I.PageEnum[t]).trigger("click");switch(e=e.toLowerCase()){case"account":$("#mapAccountButton").trigger("click");break;case"wvw":$("#mapSwitchButton").trigger("click")}}},convertExternalLink:function(e){$(e).each(function(){$(this).attr("href",I.cSiteURL+"out/?u="+U.encodeURL($(this).attr("href"))).attr("target","_blank")})},convertExternalURL:function(e){return I.cSiteURL+"out/?u="+U.encodeURL(e)},convertExternalAnchor:function(e){return" href='"+I.cSiteURL+"out/?u="+U.encodeURL(e)+"' target='_blank' "},convertPrivateAnchor:function(e){return" href='"+e+"' target='_blank' "},convertExternalString:function(e){return e.replace(/href='/g,"target='_blank' href='"+I.cSiteURL+"out/?u=")},openExternalURL:function(e){window.open(I.cSiteURL+"out/?u="+U.encodeURL(e),"_blank")},openPrivateURL:function(e){window.open(e,"_blank")},getVariableSuffix:function(e){var t=e.indexOf("_");return e.substring(t+1,e.length)},getVariablePrefix:function(e){var t=e.indexOf("_");return e.substring(0,t)},getSubstringFromHTMLID:function(e){return U.getVariableSuffix(e.attr("id"))},getSubintegerFromHTMLID:function(e){return parseInt(U.getVariableSuffix(e.attr("id")))},getPageSrc:function(e){return"page/"+e.toLowerCase()+".html"},encodeURL:function(e){return encodeURI(e).replace(/'/g,"%27")},getWikiLink:function(e){return e=e.replace(/ /g,"_"),"http://wiki.guildwars2.com/wiki/"+U.encodeURL(e)},getWikiLanguageLink:function(e){return e=e.replace(/ /g,"_"),"http://wiki-"+D.getFullySupportedLanguage()+".guildwars2.com/wiki/"+U.encodeURL(e)},getWikiSearchLink:function(e){return e=e.replace(/ /g,"+"),"http://wiki.guildwars2.com/index.php?title=Special%3ASearch&search="+U.encodeURL(e)},getGW2OfficialLink:function(e){return"https://www.guildwars2.com/"+D.getFullySupportedLanguage()+"/"+e},getYouTubeLink:function(e){return"http://www.youtube.com/results?search_query="+U.encodeURL(e+" "+I.cGameNick)},getTradingSearchLink:function(e){return"https://www.gw2tp.com/search?name="+U.encodeURL(e)},getTradingItemLink:function(e,t){return"http://www.gw2spidy.com/item/"+U.encodeURL(e)+"#"+U.stripToSentence(t)},getGuildBannerURL:function(e){if(e){var t=U.escapeHTML(e.split(" ").join("-").toLowerCase());return"http://guilds.gw2w2w.com/guilds/"+t+"/128.svg"}return"img/ui/placeholder.png"},getChatlinkFromPoiID:function(e){for(var t=String.fromCharCode(4),n=0;4>n;n++)t+=String.fromCharCode(e>>8*n&255);return I.cChatcodePrefix+btoa(t)+I.cChatcodeSuffix},getChatlinkFromItemID:function(e){var t="";try{t=I.cChatcodePrefix+btoa(String.fromCharCode(2)+String.fromCharCode(1)+String.fromCharCode(e%256)+String.fromCharCode(Math.floor(e/256))+String.fromCharCode(0)+String.fromCharCode(0))+I.cChatcodeSuffix}catch(n){}return t},getGameIDFromChatlink:function(e,t){var n=function(e){for(var t=window.atob(e),n=new Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n},i=null;"string"==typeof e&&0===e.indexOf(I.cChatcodePrefix)&&e.indexOf(I.cChatcodeSuffix===e.length-1)&&(e=e.substring(2,e.length-1));try{var a=n(e),i=a[2]<<8|a[1],r=null;switch(a[0]){case 2:r="item",i=a[3]<<8|a[2],i=(a.length>4?a[4]<<16:0)|i;break;case 4:r="location";break;case 6:r="skill";break;case 8:r="trait";break;case 9:r="recipe";break;case 10:r="skin";break;case 11:r="outfit"}}catch(o){I.write("Invalid chatlink to decode.")}return void 0===t?i:i+" ("+r+")"},convertRatioToPercent:function(e,t){if(void 0===e||isFinite(e)===!1)return"0%";void 0===t&&(t=0);var n=0>e?"−":"";return n+Math.abs(100*e).toFixed(t)+"%"},formatPercentage:function(e,t,n){return e===parseInt(e)?void 0!==n?e.toFixed(n).toLocaleString()+"%":e.toLocaleString()+"%":e.toFixed(void 0===t?2:t).toLocaleString()+"%"}},A={TokenCurrent:null,CharIndexCurrent:null,isAccountInitialized:!1,Metadata:{},Equipment:{},Attribute:{},Data:{Account:{},Characters:[],CharacterNames:null,Guilds:{},Wallet:{},Specializations:{},Traits:{}},Worth:{Equipment:{},Inventory:{},Bank:{},Materials:{},Wardrobe:{},Dyes:{},Minis:{},Trading:{}},URL:{Account:"account",Achievements:"account/achievements",Bank:"account/bank",Dyes:"account/dyes",Materials:"account/materials",Minis:"account/minis",Skins:"account/skins",Wallet:"account/wallet",Characters:"characters",Transactions:"commerce/transactions",Stats:"pvp/stats",Games:"pvp/games",TokenInfo:"tokeninfo"},Permissions:{},PermissionEnum:{Account:"account",Builds:"builds",Characters:"characters",Guilds:"guilds",Inventories:"inventories",Progression:"progression",PvP:"pvp",TradingPost:"tradingpost",Wallet:"wallet",Unlocks:"unlocks"},DishCurrent:null,getURL:function(e){var t=-1!==e.indexOf("?")?"&":"?";return"https://api.guildwars2.com/v2/"+e+t+"access_token="+A.TokenCurrent},setProgressBar:function(e,t){document.getElementById("accProgress").style.width=e/t*T.cPERCENT_100+"%",document.getElementById("accProgressCount").innerHTML=e+" / "+t,e===t&&A.resetProgressBar()},resetProgressBar:function(e){var t=$("#accProgress"),n=$("#accProgressCount");e||void 0===e?t.css({opacity:1}).animate({opacity:0},800,function(){$(this).css({width:"0px",opacity:1})}):t.css({width:"0px",opacity:1}),n.empty()},initializeAccount:function(){D.addDictionary(GW2T_ACCOUNT_DICTIONARY),A.Metadata=GW2T_ACCOUNT_METADATA,A.Equipment=GW2T_EQUIPMENT_DATA,A.Attribute=GW2T_ATTRIBUTE_DATA;var e=$("#accContent");e.find("section").addClass("accPlatter"),e.find("article").addClass("accDishContainer jsScrollable").each(function(){var e=$(this).attr("data-section");$(this).is(":empty")?$(this).html("<div class='accDishPadding'></div><div id='accDish_"+e+"' class='accDish cntComposition'></div>"):($(this).wrapInner("<div id='accDish_"+e+"' class='accDish cntComposition'></div>"),$(this).prepend("<div class='accDishPadding'></div>")),I.initializeScrollbar($(this))}),$("#accContent").show(),U.convertExternalLink("#accHelp a"),A.generateMenu(),$("#accToggle").click(function(){$("#accMenu").slideToggle("fast",function(){A.adjustAccountPanel()})}),$("#accExpand").click(function(){$("#mapDisplayButton").trigger("click")}),$("#accClose").click(function(){$("#mapAccountButton").trigger("click")}),A.initializeTokens(),I.qTip.init($("#panelAccount").find("a, label, button, kbd, img")),$("#accContent .jsTranslate").each(function(){$(this).text(D.getPhraseOriginal($(this).text())).removeClass("jsTranslate")}),$("#accConsole").onEnterKey(function(){var e=$(this).val(),t=e.charAt(0)===U.CommandPrefix?e:U.CommandPrefix+e;U.parseConsoleCommand(t,M)}),Q.initializeBankContextMenu(),setTimeout(function(){A.adjustAccountPanel()},1e3),A.isAccountInitialized=!0},generateMenu:function(){var e=$("#accMenu");$("#accContent").find(".accDishMain").each(function(){var t=$(this).attr("data-section"),n=t.toLowerCase(),i=$("<aside id='accMenu_"+t+"' class='accMenuTab accMenuClick curClick'><span><img class='accMenuIcon accMenuIconMain' src='img/account/menu/"+n+I.cPNG+"' title='<dfn>"+D.getWordCapital(n)+"</dfn>' /><var class='accMenuTitle'>"+D.getPhraseOriginal(t)+"</var></span><span class='accMenuSubtab' style='display:none;'></span></aside>");e.append(i),function(e,t){var n=$("#accPlatter"+t);e.click(function(){$(".accMenuTab").find(".accMenuIcon").removeClass("accMenuButtonFocused"),$(".accPlatter").hide(),$(this).data("iscurrentaccounttab")&&$(this).hasClass("accMenuTabFocused")===!1?(n.show(),$(this).find(".accMenuCurrent").trigger("click")):($(this).data("iscurrentaccounttab",null),A.DishCurrent=$("#accDish_"+t),$(".accDishMenu").hide(),$("#accDishMenu_"+t).show(),n.find(".accDishContainer").hide(),n.find(".accDishMain").show(),$(this).find(".accMenuIconMain").addClass("accMenuButtonFocused"),n.fadeIn(400),A.adjustAccountPanel(),I.PageCurrent=I.SpecialPageEnum.Account,I.SectionCurrent[I.SpecialPageEnum.Account]=t===I.SectionEnum.Account.Manager?"":t,U.updateQueryString()),$(".accMenuTab").removeClass("accMenuTabFocused").find(".accMenuSubtab").hide(),$(this).addClass("accMenuTabFocused").find(".accMenuSubtab").show(),A.resetProgressBar(!1)});var i=n.find(".accDishContainer");if(i.length){var a=e.find(".accMenuSubtab");a.append("<img src='img/ui/view.png' />"),i.each(function(){if($(this).hasClass("accDishMain")===!1){var t=$(this).attr("data-section"),n=t.toLowerCase(),i=$("<img id='accMenu_"+t+"' class='accMenuButton accMenuIcon accMenuClick' title='<dfn>"+D.getWordCapital(n)+"</dfn>' src='img/account/menu/"+n+I.cPNG+"' />");a.append(i),function(n,i){n.click(function(n){var a=$(this).parents(".accMenuTab").data("iscurrentaccounttab",t);a.find(".accMenuCurrent").removeClass("accMenuCurrent"),$(this).addClass("accMenuCurrent"),A.DishCurrent=$("#accDish_"+t),a.hasClass("accMenuTabFocused")===!1&&a.addClass("accMenuTabFocused").find(".accMenuSubtab").show(),$(".accDishMenu").hide(),$("#accDishMenu_"+t).show(),n.stopPropagation(),i.parent().find(".accDishContainer").hide(),i.fadeIn(200),A.adjustAccountPanel(),e.find(".accMenuIcon").removeClass("accMenuButtonFocused"),$(this).addClass("accMenuButtonFocused"),I.PageCurrent=I.SpecialPageEnum.Account,I.SectionCurrent[I.SpecialPageEnum.Account]=t,U.updateQueryString()})}(i,$(this))}}),I.qTip.init(".accMenuButton")}}(i,t)}),$(".accMenuClick").click(function(){var e=U.getSubstringFromHTMLID($(this));A.generateDish(e)}),$("#accPlatterManager").show(),U.openSectionFromURL({aPrefix:"#accMenu_",aInitialSection:I.SectionEnum.Account.Manager})},adjustAccountPanel:function(){$("#accOverhead").css({width:$("#accContent").width()-8+"px"}),A.DishCurrent&&(A.DishCurrent.parent().find(".accDishPadding").css({height:$("#accOverhead").height()+"px"}),A.adjustAccountScrollbar())},adjustAccountScrollbar:function(){I.updateScrollbar(A.DishCurrent.parent())},initializeTokens:function(){var e=32,t=localStorage[O.Utilities.APITokens.key];try{t=JSON.parse(t)}catch(n){}void 0===t&&(t=[],t.push(A.createToken("Example Key Name","EXAMPLE-API-KEY-PLEASE-REPLACE-WITH-YOUR-OWN-HERE")));for(var i=0;i<t.length;i++){var a=t[i];A.insertTokenRow(a.name,a.key,a.isUsed)}A.saveTokens(),A.loadToken(),$("#accTokenNew").click(function(){O.Utilities.APITokens.value.length<e?(A.insertTokenRow("",""),A.saveTokens()):I.write("API tokens limit reached.")}),I.qTip.init($("#accManager").find("button"))},createToken:function(e,t){return{name:e,key:t}},saveTokens:function(){var e=[];$(".accToken").each(function(){var t=U.escapeHTML($(this).find(".accTokenName").val()),n=U.stripToAlphanumericDash($(this).find(".accTokenKey").val()),i=A.createToken(t,n);$(this).find(".accTokenUse").hasClass("btnFocused")&&(i.isUsed=!0),e.push(i)});var t=O.Utilities.APITokens;t.value=e,localStorage[t.key]=JSON.stringify(t.value)},loadToken:function(){if(null!==A.TokenCurrent){for(var e in A.Permissions)A.Permissions[e]=null;A.Data.CharacterNames=null,$("#accMenu_Characters").data("iscurrentaccounttab",null);for(var e in A.Worth)A.Worth[e].Vendor=0,A.Worth[e].Buy=0,A.Worth[e].Sell=0,A.Worth[e].Estimate=0;$.getJSON(A.getURL(A.URL.TokenInfo),function(e){for(var t in e.permissions){var n=e.permissions[t];A.Permissions[n]=!0}}).fail(function(){A.printError(A.PermissionEnum.Account)})}},printError:function(e,t){"error"===t?I.write("Unable to retrieve response. ArenaNet API servers may be down."):I.write("Unable to retrieve data for this key from ArenaNet API servers."),I.write(A.TokenCurrent),e&&I.write("Requested permission: "+e,10)},checkPermission:function(e){return A.Permissions[e]?!0:(A.printError(e),!1)},printAccount:function(e){if(e)I.print("Loading "+e+"..."),$.ajax({dataType:"json",url:A.getURL(e),cache:!1,success:function(e,t,n){U.printJSON(e)},error:function(e,t){
A.printError(null,t)}});else{I.print("Available account API URL suffixes:");for(var t in A.URL)I.print(A.URL[t])}},insertTokenRow:function(e,t,n){var i=$("<div class='accToken'></div>").appendTo("#accManager"),a=$("<input class='accTokenKey' type='text' value='"+t+"' maxlength='128' />").appendTo(i),r=$("<input class='accTokenName' type='text' value='"+e+"' maxlength='64' />").appendTo(i),o=$("<div class='accTokenButtons'></div>").appendTo(i),s=$("<button class='accTokenUse' title='<dfn>Use</dfn> this key.'><img src='img/ui/check.png' /></button>").appendTo(o),c=$("<button class='accTokenDelete' title='<dfn>Delete</dfn> this key.'><img src='img/ui/default.png' /></button>").appendTo(o),l=$("<span class='btnSwap'></span>").appendTo(o),u=$("<button class='btnSwapUp'></button>").appendTo(l),d=$("<button class='btnSwapDown'></button>").appendTo(l);void 0!==n&&n===!0&&(A.TokenCurrent=U.stripToAlphanumericDash(t),r.addClass("accTokenNameUsed"),s.addClass("btnFocused")),s.click(function(){var e=a.val();e.length>0?($(".accTokenName").removeClass("accTokenNameUsed"),$(".accTokenUse").removeClass("btnFocused"),r.addClass("accTokenNameUsed"),s.addClass("btnFocused").find("img"),A.TokenCurrent=U.stripToAlphanumericDash(e),A.loadToken(),A.saveTokens()):I.write("Please enter a valid API key.")}),a.change(function(){s.trigger("click")}),c.click(function(){var e=a.val();O.Utilities.APITokens.value.length>1?e.length>0?confirm("Delete this API token?")&&(i.remove(),A.saveTokens()):(i.remove(),A.saveTokens()):I.write("Must have at least one API token.")}),$([r,a]).each(function(){$(this).click(function(){$(this).select()}).change(function(){A.saveTokens()})}),o.hover(function(){r.addClass("accTokenHovered"),a.addClass("accTokenHovered")},function(){r.removeClass("accTokenHovered"),a.removeClass("accTokenHovered")}),$([u,d]).each(function(){$(this).click(function(){$(this).hasClass("btnSwapUp")?i.prev().hasClass("accToken")&&i.insertBefore(i.prev()):i.next().hasClass("accToken")&&i.insertAfter(i.next()),A.saveTokens()})})},getCurrentCharacter:function(){try{return A.Data.Characters[A.CharIndexCurrent]}catch(e){}return null},reinitializeDish:function(e){return e.is(":empty")===!1&&e.data("token")===A.TokenCurrent?!1:(e.empty().data("token",A.TokenCurrent),!0)},generateDish:function(e){var t="serve"+e;V[t]&&V[t]()},regenerateDish:function(e){$("#accDish_"+e).empty(),A.generateDish(e)},createDishMenu:function(e){return $("#accDishMenu_"+e).remove(),$("<aside id='accDishMenu_"+e+"' class='accDishMenu'></aside>").appendTo("#accDishMenuContainer")}},V={bindSortableList:function(e){var t=$(e).find("li").first();t.click(function(){V.toggleSortableHeader($(this)),V.sortList($(this).parent(),$(this).data("isdescending"))})},toggleSortableHeader:function(e){var t=$(e),n=t.data("isdescending");void 0===n&&(n=!1),t.data("isdescending",!n);var i=n?I.Symbol.TriUp:I.Symbol.TriDown;t.find(".chrHeaderToggle").html(i)},sortList:function(e,t){var n=$(e),i=[];n.find("li").slice(1).each(function(){i.push({item:$(this),value:parseFloat($(this).attr("data-value"))})}),O.sortObjects(i,"value",t);for(var a=0;a<i.length;a++)i[a].item.appendTo(n)},sortCharacters:function(e,t){var n=[];$("."+e).each(function(){n.push({index:U.getSubintegerFromHTMLID($(this).parent()),value:parseInt($(this).attr("data-value"))})}),O.sortObjects(n,"value",t);for(var i=0;i<n.length;i++){var a=n[i].index;$("#chrSelection_"+a).appendTo("#chrSelection"),$("#chrUsage_"+a).appendTo("#chrUsage"),$("#chrSeniority_"+a).appendTo("#chrSeniority")}},serveCharacters:function(e){var t=$("#accDish_Characters");if(A.reinitializeDish(t)!==!1){var n=$("#accMenu_Characters").find(".accMenuSubtab"),i=function(){I.suspendElement(n,!1),V.generateCharactersStatistics(),V.createHeroMenu(),e&&$("#accMenu_"+e).trigger("click")};t.html("<div id='chrSummary'></div><div id='chrStatistics'><ul id='chrSelection'></ul><ul id='chrUsage' class='chrStats'></ul><ul id='chrSeniority' class='chrStats'></ul><ul id='chrGuilds' class='chrStats'></ul></div>"),$("#accDish_Hero, #accDish_Inventory").empty(),$(".chrWallet").remove(),$(".chrStats").hide(),I.suspendElement(n),t.prepend(I.cThrobber),$.getJSON(A.getURL(A.URL.Characters),function(e){I.removeThrobber(t);var n=0,a=e.length,r=0,o=a;A.Data.CharacterNames=e,A.CharIndexCurrent=null,A.Data.Characters=null,A.Data.Characters=new Array(a),A.Data.CharacterNames.forEach(function(e){$("#chrSelection").append("<li id='chrSelection_"+n+"' class='chrSelection curClick'></li>"),$("#chrUsage").append("<li id='chrUsage_"+n+"'></li>"),$("#chrSeniority").append("<li id='chrSeniority_"+n+"'></li>"),function(t){$.ajax({dataType:"json",url:A.getURL(A.URL.Characters+"/"+U.encodeURL(e)),cache:!0,success:function(e,n,a){A.Data.Characters[t]=e,A.Data.Characters[t].charindex=t,A.Data.Characters[t].charname=U.escapeHTML(e.name),V.generateCharactersSelection(e),r++,A.setProgressBar(r,o),r===o&&i()},error:function(t,n){o--,r===o&&i(),I.write("Error retrieving data for character: "+U.escapeHTML(e))}})}(n),n++})}).fail(function(){I.removeThrobber(t),A.printError(A.PermissionEnum.Characters)})}},generateCharactersSelection:function(e){var t=e.profession.toLowerCase();if(e.charelite=t,e.charprofession=t,e.charcolor=A.Metadata.Profession[t].color,e.charislowlevel=e.level<A.Metadata.ProfLevel.Max,e.specializations&&e.specializations.pve)for(var n=e.specializations.pve,i=0;i<n.length;i++)if(n[i]){var a=n[i].id;if(void 0!==A.Metadata.ProfElite[a]){t=A.Metadata.ProfElite[a],e.charelite=t;break}}var r="",o="";e.crafting&&e.crafting.length>0&&e.crafting.forEach(function(e){var t=e.rating>=A.Metadata.CraftingRank.Master?"":"accTrivial",n="<b class='"+t+"'><ins class='acc_craft acc_craft_"+e.discipline.toLowerCase()+"'></ins><sup class='chrCraftingRating'>"+e.rating+"</sup></b> ";e.active&&(r+=n),o+=n+" "});var s=A.Metadata.Race[e.race.toLowerCase()+"_"+e.gender.toLowerCase()]||1,c=A.Metadata.Profession[e.profession.toLowerCase()].weight,l=e.charislowlevel?"":"accTrivial";e.charportrait="img/account/characters/"+e.race.toLowerCase()+"_"+e.gender.toLowerCase()+I.cPNG,$("#chrSelection_"+e.charindex).append("<img class='chrPortrait' src='"+e.charportrait+"' /><var id='chrName_"+e.charindex+"' class='chrName' data-value='"+s+"'>"+e.charname+"</var><span class='chrCommitment' data-value='"+c+"'><var class='chrProfession "+l+"'><ins class='chrProfessionIcon acc_prof acc_prof_"+t+"'></ins><sup>"+e.level+"</sup></var><var class='chrCrafting'>"+r+"</var></span><img class='chrProceed' src='img/ui/view.png' />").click(function(){var e=U.getSubintegerFromHTMLID($(this));A.CharIndexCurrent===e?(A.CharIndexCurrent=null,$(this).find(".chrProceed").animate({rotation:0},{duration:200,queue:!1}),$(this).removeClass("chrSelected")):(A.CharIndexCurrent=e,$(".chrProceed").animate({rotation:0},{duration:200,queue:!1}),$(this).find(".chrProceed").animate({rotation:90},{duration:200,queue:!1}),$(".chrSelection").removeClass("chrSelected"),$(this).addClass("chrSelected"),$("#accMenu_Hero").trigger("click"))}).dblclick(function(){var e=U.getSubintegerFromHTMLID($(this));U.printJSON(A.Data.Characters[e])}),I.qTip.init($("#chrSelection_"+e.charindex).find(".chrCommitment").attr("title",o))},generateCharactersStatistics:function(){var e=new Date,t=e.getTime(),n=D.getWord("h"),i=D.getWord("d"),a=D.getWord("y"),r=0,o=0,s=0,c=0,l=0;A.Data.Characters.forEach(function(e){r<e.age&&(r=e.age),o<e.deaths&&(o=e.deaths),e.charlifetime=~~((t-new Date(e.created).getTime())/T.cMSECONDS_IN_SECOND),s<e.charlifetime&&(s=e.charlifetime)}),A.Data.Characters.forEach(function(e){var t="<abbr>"+U.escapeHTML(e.name)+"</abbr>";c+=e.age,l+=e.deaths;var u=Math.round(e.age/T.cSECONDS_IN_HOUR),d=e.age/r*T.cPERCENT_100,p=e.deaths/o*T.cPERCENT_100,h="<var class='chrAge' title='"+T.formatTimeLetter(e.age)+"' data-value='"+u+"'>"+u+n+"</var><span class='chrHoverName'>"+t+"<samp><s class='cssRight' style='width:"+d+"%'></s></samp><samp><s style='width:"+p+"%'></s></samp></span><var class='chrDeaths' title='"+T.parseRatio(u/e.deaths,3)+"' data-value='"+e.deaths+"'>"+e.deaths+"x</var>";$("#chrUsage_"+e.charindex).append(h);var m=new Date(e.created).toLocaleString(),g=~~(e.charlifetime/T.cSECONDS_IN_YEAR),f=~~(e.charlifetime/T.cSECONDS_IN_DAY),C=e.charlifetime/s*T.cPERCENT_100,v=~~(e.charlifetime%T.cSECONDS_IN_YEAR/T.cSECONDS_IN_DAY),b=T.cDAYS_IN_YEAR-v,y=v/T.cDAYS_IN_YEAR*T.cPERCENT_100,S="<var class='chrLifetime' data-value='"+e.charlifetime+"'>"+f+i+" ("+g+a+")</var><span class='chrHoverName'>"+t+"<samp><s class='cssRight' style='width:"+C+"%'></s></samp><samp><s style='width:"+y+"%'></s></samp></span><var class='chrBirthday' data-value='"+v+"'>"+b+i+"</var><var class='chrBirthdate'>"+m+"</var>";$("#chrSeniority_"+e.charindex).append(S)}),$(".chrStats li").hover(function(){$("#chrSelection_"+U.getSubstringFromHTMLID($(this))).css({outline:"1px solid red"})},function(){$("#chrSelection_"+U.getSubstringFromHTMLID($(this))).css({outline:"none"})});var u=" <b class='chrHeaderToggle'>"+I.Symbol.TriDown+"</b>";$("#chrSelection").prepend("<li class='chrHeader'><var class='chrHeaderLeft curClick' data-classifier='chrName'>"+A.Data.Characters.length+" "+D.getWordCapital("characters")+u+"</var><var class='chrHeaderRight curClick' data-classifier='chrCommitment'>"+D.getWordCapital("profession")+u+"</var></li>"),$("#chrUsage").prepend("<li class='chrHeader'><var class='chrHeaderLeft curClick' data-classifier='chrAge'>"+D.getWordCapital("age")+u+"</var><var class='chrHeaderRight curClick' data-classifier='chrDeaths'>"+D.getWordCapital("deaths")+u+"</var></li>"),$("#chrSeniority").prepend("<li class='chrHeader'><var class='chrHeaderLeft curClick' data-classifier='chrLifetime'>"+D.getWordCapital("lifetime")+u+"</var><var class='chrHeaderRight curClick' data-classifier='chrBirthday'>"+D.getWordCapital("birthday")+u+"</var></li>"),$(".chrHeaderLeft, .chrHeaderRight").click(function(){V.toggleSortableHeader($(this)),V.sortCharacters($(this).attr("data-classifier"),$(this).data("isdescending"))}),$.getJSON(A.getURL(A.URL.Account),function(e){A.Data.Account=e;var i=U.escapeHTML(e.name.split(".")[0]),a=U.convertPrivateAnchor("https://forum-en.guildwars2.com/members/"+e.name.replace(/[\s\.]/g,"-")+"/showposts"),r=Math.round(c/T.cSECONDS_IN_HOUR),o=new Date(e.created),s=~~((t-o.getTime())/T.cMSECONDS_IN_SECOND),u=T.formatTimeLetter(s).trim(),d=T.parseRatio(c/s*T.cHOURS_IN_DAY,2),p=e.commander?"":"accTrivial",h=e.access?"":"accTrivial",m="<span id='chrAccountMisc'><dfn><a id='chrAccountLink' title='"+U.escapeHTML(e.id)+"'"+a+">"+U.escapeHTML(e.name)+"</a></dfn><br />"+o.toLocaleString()+"<br /><img class='"+p+"' src='img/account/summary/commander.png' /><img class='"+h+"' src='img/account/summary/access_hot.png' /> <img src='img/account/summary/fractal.png' />"+(e.fractal_level||"?")+" <img src='img/account/summary/worldabilitypoint.png' />"+(e.wvw_rank||"?")+" <img src='img/account/summary/daily.png' />"+(e.daily_ap||"?")+" <img src='img/account/summary/monthly.png' />"+(e.monthly_ap||"?")+"</span><br />",g="<var id='chrAccountName'>"+i+"</var>"+m+"<var id='chrAccountServer'></var><br /><var id='chrAccountAge' title='"+d+n+" / "+T.cHOURS_IN_DAY+n+"<br />"+T.formatTimeLetter(c)+" / "+u+"'>"+r+n+"</var> / <var id='chrAccountDeaths' title='"+T.parseRatio(l/r,3)+"x / 1"+n+"'>"+l+"x</var> &nbsp; <var id='chrAccountLifetime'>"+u+"</var> &nbsp; <button id='chrAccountReload' title='<dfn>Reload</dfn> characters data (statistics, equipment, inventory).'><img src='img/ui/refresh.png' /></button>";$("#chrSummary").append(g),I.qTip.init("#chrSummary var, #chrAccountReload"),$("#chrAccountReload").click(function(){A.regenerateDish("Characters")}),$.getJSON(U.URL_API.Worlds+e.world,function(e){Array.isArray(e)&&e.length>0&&$("#chrAccountServer").text(e[0].name)}),V.initializeGuilds(e.guilds),V.initializeWallet(),$("#chrSummary").show("fast")}),I.qTip.init("#accPlatterCharacters var"),$(".chrStats").show("fast")},initializeGuilds:function(e){if(!(void 0===e||null===e||e.length<=0))for(var t=function(){A.Data.Characters.forEach(function(e){if(e.guild){var t="<sup class='chrTag'>["+A.Data.Guilds[e.guild].tag+"]</sup>";$("#chrName_"+e.charindex).append(t)}});var t="<li class='chrHeader'><var class='chrHeaderLeft'>"+D.getWordCapital("guilds")+"</var></li>";$("#chrGuilds").append(t);for(var n in e){var i=A.Data.Guilds[e[n]],a=U.getGuildBannerURL(i.guild_name),r="<li class='chrGuild'><span class='chrGuildHover'><img class='chrGuildBanner' src='"+a+"' /><img class='chrGuildBanner chrGuildBannerLarge' src='"+a+"' /></span><var class='chrGuildName'>"+i.guild_name+" ["+i.tag+"]</var></li>";$("#chrGuilds").append(r)}},n=0,i=0;i<e.length;i++)void 0===A.Data.Guilds[e[i]]?$.getJSON(U.URL_API.GuildDetails+e[i],function(i){A.Data.Guilds[i.guild_id]=i,n++,n===e.length&&t()}):(n++,n===e.length&&t())},initializeWallet:function(){var e=function(e,t){var n=$("<ul id='chrWallet_"+t+"' class='chrStats chrWallet'></ul>").insertBefore("#chrGuilds"),i="";switch(t){case"General":i=D.getModifiedWord("currencies","general",U.CaseEnum.Every);break;case"Dungeon":i=D.getModifiedWord("tokens","dungeon",U.CaseEnum.Every);break;case"Map":i=D.getModifiedWord("tokens","map",U.CaseEnum.Every)}var a=" <b class='chrHeaderToggle'>"+I.Symbol.TriDown+"</b>";n.append("<li class='chrHeader'><var class='chrHeaderLeft curClick'>"+i+a+"</var></li>"),V.bindSortableList(n);for(var r,o,s,c,l=0;l<e.length;l++)o=A.Data.Wallet[e[l].id],o=void 0===o||null===o?0:o,s=e[l].coefficient,e[l].value=void 0===s?o:o*s;for(var u=T.getMinMax(e,"value").max,l=0;l<e.length;l++){var d=e[l];switch(o=A.Data.Wallet[d.id],o=void 0===o||null===o?0:o,c=o.toLocaleString(),r=d.value,d.id){case 1:c=E.formatCoinStringColored(o);break;case 2:c=E.formatKarmaString(o,!0);break;case 3:c=E.formatLaurelString(o,!0);break;case 4:c=E.formatGemString(o,!0)}var p=r/u*T.cPERCENT_100,h=D.getObjectName(d),m=U.getWikiLanguageLink(h);n.append("<li data-value='"+r+"'><var class='chrWalletAmount'>"+c+"</var><ins class='acc_wallet acc_wallet_"+d.id+"'></ins><var class='chrWalletCurrency'><a class='chrWalletLink'"+U.convertExternalAnchor(m)+">"+h+"</a></var><samp><s style='width:"+p+"%'></s></samp></li>")}};$.getJSON(A.getURL(A.URL.Wallet),function(t){A.Data.Wallet=null,A.Data.Wallet={};for(var n=0;n<t.length;n++){var i=t[n];A.Data.Wallet[i.id]=parseInt(i.value)}var a=GW2T_CURRENCY_DATA;for(var n in a)e(a[n],n)})},requireCharacters:function(e){return $("#accDish_Characters").is(":empty")?(V.serveCharacters(e),$("#accMenu_Characters").trigger("click"),!0):!1},serveHero:function(){if(!V.requireCharacters("Hero")){if(!A.Data.Characters[0].equipment)return void A.printError(A.PermissionEnum.Builds);var e=$("#eqpContainer_"+A.CharIndexCurrent),t=$(".eqpContainer");null!==A.CharIndexCurrent?(V.generateHero(),t.hide(),e.show()):(A.Data.Characters.forEach(function(e){V.generateHero(e)}),t.show())}},createHeroMenu:function(){var e=A.createDishMenu("Hero").hide(),t=$("<div class='eqpSelectContainer'></div>").appendTo(e);A.Data.Characters.forEach(function(e){var n=$("<span class='eqpSelect curClick' title='"+e.charname+" ("+e.level+")' style='border-left: 2px solid "+e.charcolor+"'><img class='eqpSelectPortrait' src='"+e.charportrait+"' /><img class='eqpSelectProfession' src='img/account/classes/"+e.charelite+".png' /></span>").appendTo(t);e.charislowlevel&&n.addClass("accTrivial"),function(e){n.click(function(){var t=$("#eqpContainer_"+e);t.is(":visible")?I.scrollToElement(t,{aContainer:$("#accDish_Hero").parent(),aOffset:-($("#accOverhead").height()+32),aSpeed:"fast"}):($("#chrSelection_"+A.CharIndexCurrent).trigger("click"),$("#chrSelection_"+e).trigger("click")),A.adjustAccountScrollbar()})}(e.charindex)}),I.qTip.init(t.find(".eqpSelect"))},generateHero:function(e){var t=e||A.getCurrentCharacter();if(void 0!==t&&null!==t&&Array.isArray(t.equipment)!==!1&&!$("#eqpContainer_"+t.charindex).length){var n=$("#accDish_Hero"),i=$("<div id='eqpContainer_"+t.charindex+"' class='eqpContainer'></div>").appendTo(n);$("<div class='eqpCharSeparator'><img class='eqpCharPortrait' src='"+t.charportrait+"' /><img class='eqpCharProfession' src='img/account/classes/"+t.charelite+".png' /><span class='eqpCharName'>"+t.charname+"</span></div>").appendTo(i);var a=$("<div class='eqpSubcontainer eqpSubcontainer_"+t.profession+"'></div>").appendTo(i),r=$("<div class='eqpLeft eqpColumn'></div>").appendTo(a),o=$("<div class='eqpRight eqpColumn'></div>").appendTo(a),s=$("<div class='eqpBuild eqpColumn'></div>").appendTo(a),c=A.Equipment,l=c.ColumnLeft,u=c.ColumnRight,d=c.BriefRight,p=c.ToggleableSlots,h=c.GatheringCharges,m=$("<div class='eqpAttrWindow'><aside class='eqpAttrHeader'><span class='eqpAttrTitle'>"+D.getWordCapital("attributes")+"</span></aside><aside class='eqpAttrContent'></aside></div>").appendTo(s),g=new A.Attribute.Base,f=t.equipment.length,C=0,v=function(e){return"<aside class='eqpRow eqp"+e+"'><span class='eqpSlotOuter'><span class='eqpSlot eqpSlot_"+e+"' style='background-image:url(\"img/account/equipment/"+e.toLowerCase()+".png\")'></span></span><span class='eqpBrief eqpBrief_"+e+"'></span></aside>"},T=function(e){return"<aside class='eqpCell eqp"+e+"'><span class='eqpSlot eqpSlot_"+e+"' style='background-image:url(\"img/account/equipment/"+e.toLowerCase()+".png\")'></span></aside>"},b=function(e){var t="",n=e.item.level<A.Metadata.ProfLevel.Max?" ("+e.item.level+")":"";return t="<span class='eqpBriefName "+Q.getRarityClass(e.item.rarity)+"'>"+e.item.name+n+"</span><br />",e.infusions.forEach(function(e){t+="<span class='"+Q.getRarityClass(e.rarity)+"'><img src='"+e.icon+"' /> "+e.name+"</span><br />"}),e.upgrades.forEach(function(e){t+="<span class='"+Q.getRarityClass(e.rarity)+"'><img src='"+e.icon+"' /> "+e.name+"</span><br />"}),t},y=function(){var e=m.find(".eqpAttrContent"),n=Q.calculateAttributes(g,t);for(var i in n)e.append("<span class='eqpAttrBlock eqpAttr_"+i+"' title='<dfn>"+D.getString(i)+"</dfn>'><img src='img/account/attributes/"+i.toLowerCase()+".png' /><var class='eqpAttrSum'>"+n[i]+"</var><var class='eqpAttrBonus'>+"+g[i]+"</var></span>");e.find(".eqpAttr_Power").after("<span class='eqpAttrBlock eqpAttr_Profession'><img src='img/account/attributes/"+t.profession.toLowerCase()+".png' /><var>0%</var></span>"),I.qTip.init(e.find("span"))},S=function(){var e=t.specializations;if(void 0!==e){var n=$("<div class='spzWindow'><aside class='spzSwitchContainer'><span class='spzSwitchWrapper'><img class='spzBuildIcon' src='img/account/menu/build.png' /><img src='img/ui/view.png' /><img class='spzSwitch curClick' data-assoc='PVE' src='img/ui/pages/map.png' /><img class='spzSwitch curClick' data-assoc='WVW' src='img/ui/pages/wvw.png' /><img class='spzSwitch curClick' data-assoc='PVP' src='img/account/menu/pvp.png' /></span></aside><div class='spzContainer'><div class='spzPanel spzPanel_PVE'></div><div class='spzPanel spzPanel_WVW'></div><div class='spzPanel spzPanel_PVP'></div></div></div>").appendTo(s);n.find(".spzSwitch").each(function(){$(this).click(function(){n.find(".spzSwitch").removeClass("spzSwitchFocused"),$(this).addClass("spzSwitchFocused");var t=$(this).attr("data-assoc"),i=n.find(".spzPanel_"+t);n.find(".spzPanel").hide(),i.show(),V.generateTraits(e[t.toLowerCase()],i)})})}},_=function(){A.setProgressBar(C,f),f===C&&(y(),S())};l.forEach(function(e){r.append(v(e))}),r.find(".eqpWeaponA2").after("<aside class='eqpSwap'><img class='eqpSwapIcon' src='img/account/equipment/swap.png' /></aside>"),r.find(".eqpWeaponA1").after("<span class='eqpSwapOuter eqpSwapA'><img class='eqpSwapIcon' src='img/account/equipment/swapa.png' /></span>"),r.find(".eqpWeaponB1").after("<span class='eqpSwapOuter eqpSwapB'><img class='eqpSwapIcon' src='img/account/equipment/swapb.png' /></span>"),u.forEach(function(e){o.append(T(e))}),o.prepend("<aside class='eqpSepTrinket'></aside>");var k=$("<aside class='eqpBriefRight'></aside>").prependTo(o);d.forEach(function(e){k.append("<span class='eqpBrief eqpBrief_"+e+"' style='display:none;'></span>")}),o.find(".eqpRing2").after("<aside class='eqpSepGathering'><span class='eqpSepInner'></span></aside>"),o.find(".eqpPick").after("<aside class='eqpSepUnderwater'><span class='eqpSepInner'></span></aside>"),o.find(".eqpWeaponAquaticA").after("<aside class='eqpSwapAquatic eqpCell'><img class='eqpSwapIcon' src='img/account/equipment/swap.png' /></aside>"),o.find(".eqpWeaponAquaticA").after("<span class='eqpSwapAquaticOuter eqpSwapAquaticA'><img class='eqpSwapIcon' src='img/account/equipment/swapaquatica.png' /></span>"),o.find(".eqpWeaponAquaticB").after("<span class='eqpSwapAquaticOuter eqpSwapAquaticB'><img class='eqpSwapIcon' src='img/account/equipment/swapaquaticb.png' /></span>"),o.append("<img class='eqpAquaticBackground' src='img/account/equipment/aquatic.png' />");var E=Q.countRuneSets(t);for(var M in t.equipment)!function(e){Q.getItem(e.id,function(n){var i=$("#eqpContainer_"+t.charindex),r=i.find(".eqpSlot_"+e.slot),o=e.skin?"img/ui/placeholder.png":n.icon,s=$("<img class='eqpIcon' src='"+o+"' />").appendTo(r);Q.scanItem(n,{aElement:r,aItemMeta:e,aRuneSets:E,aWantAttr:!0,aCallback:function(t){i.find(".eqpBrief_"+e.slot).append(b(t)).show(),t.skin&&s.attr("src",t.skin.icon),A.Equipment.AttributableSlots[e.slot]&&Q.sumAttributeObject(g,t.attr),p[e.slot]&&a.find(".eqpSlot_"+e.slot).prepend("<img class='eqpCheckbox' src='img/ui/checkbox.png' />"),"Gathering"===n.type&&n.rarity!==Q.Rarity.Rare&&(s.attr("src",t.item.icon),a.find(".eqpSlot_"+e.slot).prepend("<span class='eqpCharges'>"+h[n.details.type]+"</span>")),s.click(function(e){e.which===I.ClickEnum.Left&&U.openPrivateURL(U.getWikiSearchLink(t.item.name))}),C++,_()}})})}(t.equipment[M]);if(0===t.equipment.length&&_(),A.Metadata.Profession[t.charprofession].isswappable===!1){var P=[".eqpSwap",".eqpSwapB",".eqpWeaponB1",".eqpWeaponB2"],L=[".eqpSwapAquatic",".eqpSwapAquaticB",".eqpWeaponAquaticB"];P.forEach(function(e){a.find(e).css({visibility:"hidden"})}),L.forEach(function(e){a.find(e).hide()}),o.find(".eqpAquaticBackground").addClass("eqpAquaticBackgroundSingle"),o.find(".eqpHelmAquatic").addClass("eqpHelmAquaticSingle")}}},generateTraits:function(e,t){if(void 0!==e&&t.is(":empty")!==!1){var n=function(e,n){var a=$("<aside class='spzLine'><span class='spzLineBackground'><span class='spzLineForeground'><span class='spzSpecSide'><var class='spzSpecSideIcon'></var></span><span class='spzSpecColumn'><var class='spzSpecName'></var></span><span class='spzColumn'><var class='spzMinor spzMinor_10' data-tier='0'><em class='spzCon_01'></em></var></span><span class='spzColumn'><var class='spzMajor_10'><em class='spzCon_10L'></em><em class='spzCon_10R'></em></var><br /><var class='spzMajor_11'><em class='spzCon_11L'></em><em class='spzCon_11R'></em></var><br /><var class='spzMajor_12'><em class='spzCon_12L'></em><em class='spzCon_12R'></em></var><br /></span><span class='spzColumn'><var class='spzMinor spzMinor_20' data-tier='1'></var></var></span><span class='spzColumn'><var class='spzMajor_20'><em class='spzCon_20L'></em><em class='spzCon_20R'></em></var><br /><var class='spzMajor_21'><em class='spzCon_21L'></em><em class='spzCon_21R'></em></var><br /><var class='spzMajor_22'><em class='spzCon_22L'></em><em class='spzCon_22R'></em></var><br /></span><span class='spzColumn'><var class='spzMinor spzMinor_30' data-tier='2'></var></span><span class='spzColumn'><var class='spzMajor_30'><em class='spzCon_30L'></em></var><br /><var class='spzMajor_31'><em class='spzCon_31L'></em></var><br /><var class='spzMajor_32'><em class='spzCon_32L'></em></var><br /></span></span></span></aside>").appendTo(t);a.find("img").attr("src","img/ui/placeholder.png");var r=function(e){var t=A.Data.Traits[e],r=a.find(".spz"+t.slot+"_"+t.tier+t.order);r.css({backgroundImage:"url("+t.icon+")"});var o="",s="",c=r.attr("data-tier");(i[e]||n[c])&&(r.find("em").show(),o="spzActive","Major"===t.slot&&(s="<span class='spzMajorName'>"+t.name+"</span>")),r.append(s+"<mark class='"+o+"'>"+I.Symbol.Filler+"</mark>"),Q.analyzeTrait(t,{aElement:r})},o=function(){var t=A.Data.Specializations[e];a.css({backgroundImage:"url("+t.background+")"}),a.find(".spzSpecName").text(t.name),t.elite&&a.find(".spzLineBackground").addClass("spzLineBackgroundElite");for(var n=t.minor_traits.concat(t.major_traits),i=0;i<n.length;i++){var o=n[i];A.Data.Traits[o]?r(o):!function(e){$.getJSON(U.getAPITrait(e),function(t){A.Data.Traits[e]=t,r(e)})}(o)}};A.Data.Specializations[e]?o():$.getJSON(U.getAPISpecialization(e),function(t){A.Data.Specializations[e]=t,o()})},i={};e.forEach(function(e){e&&(e.traits&&e.traits.forEach(function(e){e&&(i[e]=!0)}),n(e.id,e.traits))})}},serveEquipment:function(){if(!V.requireCharacters("Equipment")){if(!A.Data.Characters[0].equipment)return void A.printError(A.PermissionEnum.Builds);var e=$("#accDish_Equipment");if(A.reinitializeDish(e)!==!1){var t,n,i,a,r=Q.createBank(e).find(".bnkBank"),o=0,s=0;A.Data.Characters.forEach(function(e){o+=e.equipment.length}),A.Data.Characters.forEach(function(e){n=Q.createBankTab(r,{aTitle:e.charname}),i=n.find(".bnkTabSlots");for(var c=0;c<e.equipment.length;c++)t=e.equipment[c],a=Q.createBankSlot(i),function(e,t){Q.getItem(t.id,function(n){Q.styleBankSlot(e,{aItem:n,aSlotMeta:t,aCallback:function(){s++,A.setProgressBar(s,o)}})})}(a,t)}),Q.createBankMenu(r)}}},serveInventory:function(){if(!V.requireCharacters("Inventory")){if(!A.Data.Characters[0].bags)return void A.printError(A.PermissionEnum.Inventories);var e=$("#accDish_Inventory");if(A.reinitializeDish(e)!==!1){for(var t,n,i,a,r,o,s=Q.createBank(e).find(".bnkBank"),c=0,l=0,u=0;u<A.Data.Characters.length;u++){r=A.Data.Characters[u];for(var d=0;d<r.bags.length;d++)if(o=r.bags[d])for(var p=0;p<o.inventory.length;p++)o.inventory[p]&&c++}for(var u=0;u<A.Data.Characters.length;u++){r=A.Data.Characters[u],n=Q.createBankTab(s,{aTitle:r.charname}),Q.createInventorySidebar(n,r.bags),i=n.find(".bnkTabSlots");for(var d=0;d<r.bags.length;d++)if(o=r.bags[d])for(var p=0;p<o.inventory.length;p++)t=o.inventory[p],a=Q.createBankSlot(i),t?!function(e,t){Q.getItem(t.id,function(n){Q.styleBankSlot(e,{aItem:n,aSlotMeta:t,aCallback:function(){l++,A.setProgressBar(l,c)}})})}(a,t):Q.styleBankSlot(a)}Q.createBankMenu(s)}}},serveBank:function(){var e=$("#accDish_Bank");if(A.reinitializeDish(e)!==!1){var t,n,i,a,r,o=Q.createBank(e),s=o.find(".bnkBank").append(I.cThrobber);$.getJSON(A.getURL(A.URL.Bank),function(e){s.empty();for(var o=0,c=0,l=0;l<e.length;l++)e[l]&&o++;for(var l=0;l<e.length;l++)0!==l&&r%A.Metadata.Bank.NumSlotsPerTab!==0||r===e.length||(n=Q.createBankTab(s),i=n.find(".bnkTabSlots")),r=l+1,t=e[l],a=Q.createBankSlot(i),t?!function(e,t){Q.getItem(t.id,function(n){Q.styleBankSlot(e,{aItem:n,aSlotMeta:t,aCallback:function(){c++,A.setProgressBar(c,o)}})})}(a,t):Q.styleBankSlot(a);s.append("<div class='bnkTabSeparator'><var class='bnkTabLocked'>"+I.Symbol.Filler+"</var></div>"),Q.createBankMenu(s)}).fail(function(){A.printError(A.PermissionEnum.Inventories),e.empty()})}},serveMaterials:function(){var e=$("#accDish_Materials");if(A.reinitializeDish(e)!==!1){var t,n,i,a,r,o,s=Q.createBank(e),c=s.find(".bnkBank").append(I.cThrobber),l=GW2T_MATERIALS_CATEGORIES,u={},d={};$.getJSON(A.getURL(A.URL.Materials),function(e){c.empty();for(var s=0,p=0,h=0;h<l.length;h++){o=l[h],t=Q.createBankTab(c,{aTitle:D.getObjectName(o)}),i=t.find(".bnkTabSlots"),u[o.id]=i;for(var m=0;m<o.items.length;m++)r=o.items[m],n=Q.createBankSlot(i),d[r]=n,s++}for(var h=0;h<e.length;h++)a=e[h],d[a.id]&&!function(e,t){Q.getItem(a.id,function(n){Q.styleBankSlot(e,{aItem:n,aSlotMeta:t,aCallback:function(){p++,A.setProgressBar(p,s)}})})}(d[a.id],a);Q.createBankMenu(c,{aWantHighlightSearch:!0})}).fail(function(){A.printError(A.PermissionEnum.Inventories),e.empty()})}},serveWardrobe:function(){var e=$("#accDish_Wardrobe");if(A.reinitializeDish(e)!==!1){var t,n,i,a,r=D.getWordCapital("gallery"),o=function(e,n){var a=t[n].set||n,o=i[a],s=$("<aside class='bnkTabHover'></aside>").prependTo(e.find(".bnkTabSeparator"));if("string"==typeof o)$("<button class='bnkTabHoverButton'>"+r+"</button>").click(function(e){e.stopPropagation(),U.openExternalURL(o)}).appendTo(s);else{var c=0;for(var l in o)c++,function(e){$("<button class='bnkTabHoverButton'><img src='img/account/characters/"+l.toLowerCase()+".png' /></button>").click(function(t){t.stopPropagation(),U.openExternalURL(e)}).appendTo(s)}(o[l]),c%2===0&&s.append("<br />")}},s=Q.createBank(e,{aIsCollection:!0}),c=s.find(".bnkBank").append(I.cThrobber),l={},u=[],d=function(){t=GW2T_SKINS_NAMES,n=GW2T_SKINS_CATEGORIES,i=GW2T_SKINS_GALLERIES,a=GW2T_SKINS_DATA,c.empty();var e,r,u,d,p,h,m,g=0,f=0;for(var C in n){r=n[C],u=D.getObjectName(t[C]),d="<ins class='bnkTabIcon acc_wardrobe acc_wardrobe_"+C.toLowerCase()+"'></ins>",e=Q.createBankTab(c,{aTitle:u,aIcon:d,aIsCollapsed:!0}),o(e,C,u),function(e,t){e.find(".bnkTabSeparator").one("click",function(){for(var n=t.length,i=0,r=e.find(".bnkTabSlots"),o=0;o<t.length;o++)m=t[o],p=Q.createBankSlot(r),p.attr("data-skinid",m),h=a[m],h&&!function(e,t,a,r,o){Q.getItem(a,function(a){var s=l[t]?1:0;Q.styleBankSlot(e,{aItem:a,aSlotMeta:{count:s},aWiki:r,aCallback:function(){if(o)for(var t in o){var a=o[t];e.append("<var class='bnkSlotPrice'>"+E.Payment[t](a)+"</var>")}i++,A.setProgressBar(i,n)}})})}(p,m,h.i,h.n,h.p);Q.createBankMenu(c,{aHelpMessage:"#accWardrobeHelp"})})}(e,r);for(var v=0,T=0;T<r.length;T++)l[r[T]]&&(v++,f++);var b=r.length;g+=b;var y=v+" / "+b+"<span class='accTrivial'> ("+U.convertRatioToPercent(v/b)+")</span>";e.find(".bnkTabStats").html(y)}var S=f+" / "+g+"<span class='accTrivial'> ("+U.convertRatioToPercent(f/g)+")</span>";s.find(".bnkCount").append(S),Q.createBankMenu(c,{aHelpMessage:"#accWardrobeHelp"})};$.getScript(U.URL_DATA.Skins).done(function(){$.getJSON(A.getURL(A.URL.Skins),function(e){u=e;for(var t=0;t<u.length;t++)l[u[t]]=!0;d()}).fail(function(){A.printError(A.PermissionEnum.Unlocks),e.empty()})})}},serveMinis:function(){var e=$("#accDish_Minis");if(A.reinitializeDish(e)!==!1){var t=Q.createBank(e),n=t.find(".bnkBank").append(I.cThrobber);$.getJSON(A.getURL(A.URL.Minis),function(e){n.empty()})}},serveLab:function(){var e=$("#accDish_Lab");if(A.reinitializeDish(e)!==!1){var t=[],n=0,i={},a="",r={},o=function(e){var r=[],o=$("#labSelection"),s=$("#labSkinInfo"),c=$("#labRetrievalDisplay");o.empty().append(I.cThrobber),s.empty();var l=i[a],u=l.length,d=0;$.getJSON(U.getAPISkin(a),function(e){var t=e.icon||"";s.empty(),$("<var id='labSkinLink'><img src='"+t+"' style='float:left;' /></var>").appendTo(s).click(function(){U.openPrivateURL(U.getWikiSearchLink(e.name))}),s.append(U.escapeJSON(e))});var p,h=function(){if(u===d){c.empty(),o.empty();for(var e=[],i=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY,p=-1,h=-1,m=-1,g=-1,f=0;f<r.length;f++){var C=r[f],v=C.item;C.istradeable?(e.push(C.item.id),C.pricesell<i&&(i=C.pricesell,p=f),v.level>0&&(v.level<a&&(a=v.level,h=f),v.level>s&&(s=v.level,m=f))):v.level>0&&"Fine"===v.rarity&&-1!==C.html.indexOf("itmColor_flavor")&&v.level<l&&(l=v.level,g=f)}p>=0&&(r[p].islowestprice=!0),h>=0&&(r[h].islowestlevel=!0),m>=0&&(r[m].ishighestlevel=!0),g>=0&&(r[g].islowestlevelbound=!0);for(var f=0;f<r.length;f++){var C=r[f],T=$("<div style='display:inline-block; padding:4px; margin-right:8px; margin-bottom:8px; border:1px solid gray; vertical-align:top; zoom:75%;'>"+C.html+"<div>ID: "+C.item.id+"</div></div>").appendTo(o),b=$("<button class='labSelectItemButton' style='width:100%; height:32px;'>Select</button>").appendTo(T);!function(i){b.click(function(a){a.which===I.ClickEnum.Left&&(t[n].itemid=i,t[n].tradeableids=e.length>0?e:null,$("#labControlNext").trigger("click"),A.adjustAccountScrollbar())}),b.contextmenu(function(a){a.preventDefault(),t[n].itemid=i,t[n].tradeableids=e.length>0?e:null,$(this).addClass("btnFocused")})}(C.item.id),function(e){T.find(".itmIconMain").click(function(){U.openExternalURL(U.getWikiSearchLink(e));
})}(C.item.name),C.istradeable?(C.islowestprice&&T.css({border:"4px dashed red"}).append("<div>LOWEST PRICE</div>"),C.islowestlevel&&T.css({outline:"4px dashed yellow"}).append("<div>LOWEST LEVEL</div>"),C.ishighestlevel&&T.css({outline:"4px solid orange"}).append("<div>HIGHEST LEVEL</div>"),31===C.item.level&&T.css({background:"rgba(96,32,128,0.2)"}),80===C.item.level&&(-1!==C.item.name.indexOf("Berserker")&&"Masterwork"!==C.item.rarity?T.css({background:"rgba(0,0,255,0.2)"}):T.css({outline:"4px solid blue"}),"Rare"!==C.item.rarity&&"Exotic"!==C.item.rarity||-1===C.item.name.indexOf("Cleric")||T.css({background:"rgba(255,0,0,0.2)"})),"Consumable"===C.item.type&&T.css({background:"rgba(0,255,255,0.2)"}),"Fine"!==C.item.rarity||-1===C.item.name.indexOf("Mighty")&&-1===C.item.name.indexOf("Strong")&&-1===C.item.name.indexOf("Berserker")||T.css({background:"rgba(0,0,255,0.2)"})):(T.css({opacity:.6}),C.islowestlevelbound&&T.css({outline:"4px dashed yellow"}).append("<div>LOWEST LEVEL</div>"),80===C.item.level&&(T.css({outline:"4px solid blue"}),-1!==C.item.name.indexOf("Berserker")?T.css({background:"rgba(0,0,255,0.2)"}):"Ascended"!==C.item.rarity||-1===C.item.name.indexOf("Zojja")&&-1===C.item.name.indexOf("Soros")&&-1===C.item.name.indexOf("Beigarth")&&-1===C.item.name.indexOf("Verata")&&-1===C.item.name.indexOf("Tonn")&&-1===C.item.name.indexOf("Theodosus")&&-1===C.item.name.indexOf("Wupwup")||T.css({background:"rgba(0,0,255,0.2)"})),"Consumable"===C.item.type&&T.css({background:"rgba(0,255,255,0.2)"})),C.item.id===t[n].itemid&&b.css({background:"rgba(221,255,119,1)"})}A.adjustAccountScrollbar()}};if(e&&t[n].itemid)u=1,p=t[n].itemid,Q.getItem(p,function(e){Q.scanItem(e,{aWantPrice:!0,aCallback:function(e){r.push(e),d++,c.html(d+" / "+u),h()}})});else for(var m=0;m<l.length;m++)p=l[m],Q.getItem(p,function(e){Q.scanItem(e,{aWantPrice:!0,aCallback:function(e){r.push(e),d++,c.html(d+" / "+u),h()}})})},s=function(){$("#labIndexDisplay").html("Index: "+n+" / "+(t.length-1)+"&nbsp; Skin: "+t[n].skinid+"&nbsp; Item: "+t[n].itemid),$(".labPaymentInput").val(""),$(".labAcquisitionButton").removeClass("btnFocused");var e=t[n].payment;if(e)for(var i in e)$("#lab"+U.toFirstUpperCase(i)+"Input").val(e[i]),$("#lab"+U.toFirstUpperCase(i)+"Button").addClass("btnFocused")},c=function(e){a=t[n].skinid,o(e),s()};$.getScript(U.URL_DATA.Skins).done(function(){$.getScript("data/skins_assoc.js",function(){i=GW2T_SKINS_ASSOC.SkinItems,r=GW2T_SKINS_ASSOC.Blacklist;var a=GW2T_SKINS_DATA,o=A.createDishMenu("Lab"),l=$("<div style='color:white; font-family:monospace;'></div>").appendTo(o),u=$("<div id='labContainer'></div>").appendTo(e),d=$("<div id='labControls' style='margin:8px;'></div>").appendTo(l),p=$("<button id='labControlPrev' style='width:96px; height:40px; margin-right:8px;'>Prev</button>").appendTo(d),h=$("<button id='labControlNext' style='width:96px; height:40px; margin-right:8px;'>Next</button>").appendTo(d),m=$("<button id='labControlAuto' style='width:96px; height:40px; margin-right:8px;'>Auto</button>").appendTo(d),g=$("<button id='labControlPrint' style='width:64px; height:40px; margin-right:8px;'>Print</button>").appendTo(d),f=$("<button id='labControlPrint' style='width:64px; height:40px; margin-right:8px;'><strong>SAVE</strong></button>").appendTo(d),C=($("<var id='labIndexDisplay' style='margin-right:8px; font-size:20px;'></var>").appendTo(d),$("<input id='labIndexInput' type='number' value='0' style='width:64px; margin-right:8px;' />").appendTo(d));C.before("Go To Skin: ");var v=$("<input id='labSearchInput' type='text' style='width:128px; margin-right:8px;' />").appendTo(d);v.before("Search: ");var T=$("<input id='labItemInput' type='text' style='width:64px; margin-right:8px;' />").appendTo(d);T.before("Input Custom ID: ");var b=$("<div id='labSelection'></div>").appendTo(u),y=($("<div id='labSkinInfo' style='font-family:monospace'></div>").appendTo(u),$("<div id='labCurrencies' style='margin:8px; color:white;'></div>").appendTo(l)),S=$("<button id='labPaymentPrev' style='width:96px; height:40px; margin-right:8px;'>←</button>").appendTo(y),_=$("<button id='labPaymentNext' style='width:96px; height:40px; margin-right:8px;'>→</button>").appendTo(y),k=$("<input id='labKarmaInput' class='labPaymentInput' type='text' value='0' style='width:64px; margin-right:8px;' />").appendTo(y);k.before("<ins class='s16 s16_karma'></ins");var M=$("<input id='labGemInput' class='labPaymentInput' type='text' value='0' style='width:64px; margin-right:8px;' />").appendTo(y);M.before("<ins class='s16 s16_gem'></ins");var P=$("<input id='labCoinInput' class='labPaymentInput' type='text' value='0' style='width:64px; margin-right:8px;' />").appendTo(y);P.before("<ins class='s16 s16_coincopper'></ins");var L=$("<input id='labBadgeInput' class='labPaymentInput' type='text' value='0' style='width:64px; margin-right:8px;' />").appendTo(y);L.before("<ins class='s16 s16_badge'></ins");var w=$("<input id='labTokenInput' class='labPaymentInput' type='text' value='0' style='width:64px; margin-right:8px;' />").appendTo(y);w.before("<ins class='s16 s16_token'></ins");var O=$("<input id='labAchievementInput' class='labPaymentInput' type='text' value='0' style='width:64px; margin-right:8px;' />").appendTo(y);O.before("<ins class='s16 s16_achievement'></ins");var D=$("<input id='labMonumentInput' class='labPaymentInput' type='text' value='0' style='width:64px; margin-right:8px;' />").appendTo(y);D.before("<ins class='s16 s16_monument'></ins");var x=$("<button id='labCraftButton' class='labAcquisitionButton' style='margin-right:8px;'><ins class='s16 s16_craft'></ins></button>").appendTo(y),N=$("<button id='labPvpButton' class='labAcquisitionButton' style='margin-right:8px;'><ins class='s16 s16_pvp'></ins></button>").appendTo(y),W=$("<button id='labStartingButton' class='labAcquisitionButton' style='margin-right:8px;'><ins class='s16 s16_starting'></ins></button>").appendTo(y),R=$("<button id='labPaymentClear' style='width:96px; height:40px; margin-right:8px;'>Clear</button>").appendTo(y);$("<div id='labRetrievalDisplay' style='font-size:20px;'></div>").appendTo(l);l.find("input[type=text], input[type=number]").click(function(){$(this).select()}),S.click(function(){for(;n>0;)if(n--,!t[n].tradeableids){c(!0);break}}),_.click(function(){for(;n<t.length-1;)if(n++,!t[n].tradeableids){c(!0);break}});var B=["karma","gem","coin","badge","token","achievement","monument"],H=0;$([k,M,P,L,w,O,D]).each(function(){!function(e,i){e.onEnterKey(function(){var e=parseInt($(this).val());if(e>=0){t[n].payment={};var a="coin"===i?E.parseCoinString($(this).val()):parseInt($(this).val());t[n].payment[i]=a,_.trigger("click"),f.trigger("click"),$(this).select()}else"karma"===i?b.find(".itmIconMain").first().trigger("click"):$("#labSkinLink").click()})}($(this),B[H]),H++});var z=["craft","pvp","starting"],G=0;$([x,N,W]).each(function(){!function(e,i){e.click(function(){t[n].payment={},t[n].payment[i]=!0,_.trigger("click"),f.trigger("click")})}($(this),z[G]),G++}),R.click(function(){t[n].payment=null,_.trigger("click")}),m.click(function(){b.find(".labSelectItemButton").first().trigger("click")}),p.click(function(){n>0&&(n--,c())}),h.click(function(){n<t.length-1&&(n++,c())}),g.click(function(){for(var e,n="",i=0;i<t.length;i++)e=t[i],n+="&quot;"+e.skinid+"&quot;: {i: "+e.itemid+", n: &quot;"+U.escapeHTML(e.name)+"&quot;"+(e.payment?", p: "+U.formatJSON(e.payment):"")+(e.tradeableids&&!e.payment?", t: ["+e.tradeableids+"]":"")+"},<br />";I.print(n)}),f.click(function(){for(var e,n={},i=0;i<t.length;i++){e=t[i];var a=e.payment?null:e.tradeableids;n[e.skinid]={i:e.itemid,n:e.name,p:e.payment,t:a}}U.APICacheConsole=n,U.saveAPICache()}),C.onEnterKey(function(){for(var e=parseInt($(this).val()),i=0;i<t.length;i++)if(parseInt(t[i].skinid)===parseInt(e)){e=i;break}e<=t.length-1&&e>=0&&(n=e,c())}),T.onEnterKey(function(){var e=parseInt($(this).val());e&&(t[n].itemid=e,$("#labControlNext").trigger("click"))}),v.onEnterKey(function(){for(var e,i=$(this).val().toLowerCase(),a=0;a<t.length;a++)if(e=t[a].name.toLowerCase(),-1!==e.indexOf(i)){n=a,c();break}}),U.loadAPICache()&&(a=U.APICacheConsole);for(var F in a)t.push({skinid:F,name:a[F].n,itemid:a[F].i,payment:a[F].p,tradeableids:a[F].t});s(),A.adjustAccountPanel()})})}}},Q={Box:{},Rarity:{Junk:"Junk",Basic:"Basic",Fine:"Fine",Masterwork:"Masterwork",Rare:"Rare",Exotic:"Exotic",Ascended:"Ascended",Legendary:"Legendary"},RunePieces:{Masterwork:2,Rare:4,Exotic:6},cSEARCH_LIMIT:200,Context:{ItemID:"",ItemName:"",ItemNameSearch:""},setRarityClass:function(e,t){for(var n in Q.Rarity)e.removeClass("rarity_"+n);void 0!==Q.Rarity[t]&&e.addClass("rarity_"+t)},getRarityClass:function(e){return"rarity_"+e},getItemType:function(e){var t=e.details,n=e.type,i={Back:1,Consumable:1,Container:1,CraftingMaterial:1,Gizmo:1,MiniPet:1,Trophy:1,UpgradeComponent:1};return i[n]?"<br />"+D.getString(n)+"<br />":t.type&&"Default"!==t.type?D.getString(t.type)+"<br />":""},getAttributeString:function(e){var t=e,n={CritDamage:"Ferocity",Healing:"HealingPower",ConditionDuration:"Expertise",BoonDuration:"Concentration"};return n[e]&&(t=n[e]),D.getString(t)},sumItemAttribute:function(e,t,n){var i=A.Attribute["KeyDescription_"+D.getFullySupportedLanguage()],a=function(a){var r,s,c,l,u=a.length,d=0;if(n&&n[t.id]){if(n[t.id].issummed===!0)return;d=n[t.id].numslotted,u=d}for(var p=0;u>p;p++)if(r=a[p],s=U.stripToNumbers(r),c=r.replace(/[\s0-9%,.\-+']/g,"").toLowerCase(),i[c]){if(l=i[c],"AgonyResistance"===l&&o.infusion_slots)continue;e[l]+=s}n&&n[t.id]&&(n[t.id].issummed=!0)},r=t;if(void 0!==r&&void 0!==r.details){var o=r.details;if(o.infix_upgrade&&o.infix_upgrade.attributes&&o.infix_upgrade.attributes.forEach(function(t){var n=A.Attribute.KeyAttributes[t.attribute];n&&(e[n]+=t.modifier)}),o.bonuses&&a(o.bonuses),o.infix_upgrade&&o.infix_upgrade.buff&&o.infix_upgrade.buff.description){var s=o.infix_upgrade.buff.description;s.replace(/<br>/g,""),a(s.split("\n"))}void 0!==o.defense&&(e.Armor+=o.defense)}},sumAttributeObject:function(e,t){for(var n in e)e[n]+=t[n]},calculateAttributes:function(e,t,n){var i={},a=t.level,r=t.charprofession,o=A.Attribute.Constants,s=A.Attribute.PrimaryPoints[a-1],c=A.Attribute.PrecisionDivisor[a-1],l=c/A.Attribute.SecondaryDivisorRatio,u=0,d=0,p=A.Metadata.Profession[r].health,h=A.Attribute.HealthGrowth[p],m=0;for(var g in h){if(m=parseInt(g),!(a>=m)){u+=(a-d)*h[g];break}u+=(m-d)*h[g],d=m}var f={Power:s+e.Power,Toughness:s+e.Toughness,Armor:s+e.Armor+e.Toughness,Vitality:s+e.Vitality,Health:s/o.VITALITY_IN_HEALTH+u+e.Health+e.Vitality/o.VITALITY_IN_HEALTH,Precision:s+e.Precision,CriticalChance:o.BASE_CRITICALCHANCE+e.CriticalChance+e.Precision/c,Ferocity:e.Ferocity,CriticalDamage:o.BASE_CRITICALDAMAGE+e.CriticalDamage+e.Ferocity/l,ConditionDamage:e.ConditionDamage,HealingPower:e.HealingPower,Expertise:e.Expertise,ConditionDuration:e.ConditionDuration+e.Expertise/l,Concentration:e.Concentration,BoonDuration:e.BoonDuration+e.Concentration/l,AgonyResistance:e.AgonyResistance,MagicFind:e.MagicFind};if(n)return f;for(var g in f)i[g]=A.Attribute.KeyType[g]?U.formatPercentage(f[g],2,1):parseInt(f[g]).toLocaleString();return i},countRuneSets:function(e){var t=e.equipment,n=0;if(t){for(var i={},a=0;a<t.length;a++){if(A.Equipment.ArmorSlots[t[a].slot]&&t[a].upgrades){var r=t[a].upgrades[0];void 0===i[r]&&(i[r]={numslotted:0,issummed:!1}),i[r].numslotted=i[r].numslotted+1,n++}if(n===A.Equipment.NumArmorSlots)break}return i}return null},getRuneBonus:function(e,t){var n="",i=e.details,a=0,r=Q.RunePieces[e.rarity],o=t&&t[e.id]?t[e.id].numslotted:null;"number"==typeof t&&(o=t),o>r&&(o=r);var s="";if(i.bonuses){n+=null!==o?"":"<br />",n+="<span class='itmGrayed'>",null!==o&&(n+="<var class='itmBuff'>"+e.name+" ("+o+"/"+r+")</var><br />");for(var c in i.bonuses)s=o>a?" class='itmBuff'":"",a++,n+="<var"+s+">("+a+"): "+i.bonuses[c]+"</var><br />";n+="</span>"}return n},formatItemDescription:function(e){try{var t="string"==typeof e?e:e.details.infix_upgrade.buff.description;return-1!==t.indexOf("<c=@")&&(t=t.replace(/<c=@abilitytype>/g,"<c class='itmColor_abilitytype'>"),t=t.replace(/<c=@flavor>/g,"<c class='itmColor_flavor'>"),t=t.replace(/<c=@reminder>/g,"<c class='itmColor_reminder'>"),t=t.replace(/<c=@warning>/g,"<c class='itmColor_warning'>")),-1!==t.indexOf("\n")?t.replace(/\n/g,"<br />"):t}catch(n){}return""},getItem:function(e,t){var n=Q.Box[e];if(n)return t(n.item),{fail:function(){}};var i=$.ajax({dataType:"json",url:U.getAPIItem(e),cache:!0,success:function(n){void 0===Q.Box[n.id]&&(Q.Box[e]={},Q.Box[e].item=n),t(n)}});return i},scanItem:function(e,t){var n=t||{},i=n.aItemMeta||{},a=Q.Box[e.id];if(a&&a.html)if(i.upgrades||i.infusions||i.skin||i.slot||i.bound_to||n.aWantAttr)Q.analyzeItem(e,t);else{if(n.aElement){var r=$(n.aElement);r.attr("title",a.html),I.qTip.init(r)}n.aCallback&&n.aCallback(a)}else Q.analyzeItem(e,t)},analyzeItem:function(e,t){var n,i,a=t||{},r=[],o=[],s=null,c=null,l=!1,u=!0;a.aItemMeta&&(l=!0),a.aItemMeta=a.aItemMeta||{},a.aWantAttr&&A.isAccountInitialized&&(c=new A.Attribute.Base);var d=e,p=d.type,h="",m=d.details,g="Weapon"===p,f=g||"Armor"===p||"Trinket"===p||"Back"===p,C="Back"===p,v="Trinket"===p||C,b=d.rarity===Q.Rarity.Ascended||d.rarity===Q.Rarity.Legendary,y=!1,S=!0,_=!1,k=!1,M=0,P=0;m&&m.type&&(h=m.type,"Weapon"===p&&(y="Greatsword"===h||"Hammer"===h||"LongBow"===h||"ShortBow"===h||"Rifle"===h||"Staff"===h||"Harpoon"===h||"Speargun"===h||"Trident"===h)),"Gathering"===p&&d.rarity!==Q.Rarity.Rare&&(d.icon="img/account/item/gathering_"+m.type.toLowerCase()+I.cPNG);var L="",w=void 0!==d.rarity?d.rarity:Q.Rarity.Basic;L="<aside class='itmName "+Q.getRarityClass(w)+"'><img class='itmIcon itmIconMain' src='"+d.icon+"' />"+U.escapeHTML(d.name)+"</aside>";var O="";m&&void 0!==m.min_power&&void 0!==m.max_power&&(O+="<span class='itmText'>"+D.getString("WeaponStrength")+":</span> <span class='itmAttr'>"+m.min_power.toLocaleString()+" - "+m.max_power.toLocaleString()+"</span><br />");var x="";m&&m.defense>0&&(x+="<span class='itmText'>"+D.getString("Defense")+":</span> <span class='itmAttr'>"+m.defense.toLocaleString()+"</span><br />");var N="",W="",R=[],B=0,H=0,z=[];if(m&&m.infix_upgrade){var G=m.infix_upgrade.attributes;N+="<aside class='itmAttr'>",void 0!==m.infix_upgrade&&(f?(m.infix_upgrade.buff&&m.infix_upgrade.buff.description&&(z=m.infix_upgrade.buff.description.split("\n"),z.forEach(function(e){R.push(U.stripToNumbers(e))})),G.forEach(function(e){B<R.length&&(H=R[B],B++),N+="+"+(parseInt(e.modifier)+H)+" "+Q.getAttributeString(e.attribute)+"<br />"})):m.infix_upgrade.buff?(N+="<span class='itmBuff'>"+Q.formatItemDescription(d)+"</span>",W="<br />"):m.bonuses&&"Rune"===m.type&&(N+=Q.getRuneBonus(d))),N=W+N,N+="</aside>"}else if("Consumable"===p)if(N+=D.getString("DoubleClickToConsume")+"<br />",void 0!==m.duration_ms){var F="Food"===m.type||"Utility"===m.type?"_"+m.type.toLowerCase():"",j="Immediate"===m.type?D.getString("Boost"):D.getString("Nourishment"),K=m.duration_ms>0?" ("+T.formatTooltipTimeMS(m.duration_ms,!0)+")":"";N+="<span class='itmConsumableLine'><img class='itmIcon itmConsumableIcon' src='img/account/item/nourishment"+F+".png' /> <var class='itmGrayed itmConsumableDesc'>"+j+K+": "+Q.formatItemDescription(m.description)+"</var></span>"}else"Booze"===m.type&&(N+=D.getString("ExcessiveAlcohol")+"<br />");c&&Q.sumItemAttribute(c,d);var X="";f&&(X=D.getString(d.rarity)+(C?"":"<br />"));var Z="";m&&m.weight_class&&(Z=D.getString(m.weight_class)+"<br />");var q=Q.getItemType(d),V="";d.level>1&&(V+=D.getString("RequiredLevel")+": "+d.level+"<br />");var Y="",J="",ee=d.description||"";ee=Q.formatItemDescription(ee),d.description&&(ee="<aside>"+ee+"</aside>",f?J=ee:Y=ee);var te="";f&&m&&void 0===m.infix_upgrade&&(te=D.getString("DoubleClickToSelectStats")+"<br />");var ne="",ie={},ae=function(e){ne+=D.getString(e)+"<br />"};d.flags&&(d.flags.forEach(function(e){ie[e]=!0}),ie.Unique&&ae("Unique"),l&&a.aItemMeta.binding?(u=!1,"Character"===a.aItemMeta.binding&&a.aItemMeta.bound_to?ne+="<var class='itmColor_warning'>"+D.getString("SoulboundToCharacter")+": "+a.aItemMeta.bound_to+"</var><br />":"Account"===a.aItemMeta.binding&&ae("AccountBound")):(ie.SoulbindOnAcquire?(k=!0,u=!1,ae("SoulbindOnAcquire")):ie.SoulBindOnUse&&k===!1&&ae("SoulBindOnUse"),ie.AccountBound?(_=!0,u=!1,ae("AccountBound")):ie.AccountBindOnUse&&_===!1&&ae("AccountBindOnUse")),ie.NoSell&&(S=!1));var re="";a.aSoulbound&&(re=D.getString("SoulboundToCharacter")+": "+U.escapeHTML(a.aSoulbound));var oe="",se=0;d.vendor_value>0&&S&&(se=a.aItemMeta.count?a.aItemMeta.count*d.vendor_value:d.vendor_value,oe=E.formatCoinString(se,{aWantColor:!0,aWantSpace:!0}));var ce="";a.aWantPrice&&M++;var le,ue="",de="",pe=[],he=[],me=[],ge=[];if(f){if((b||(b&&v)===!1)&&(ue="<br />"),b&&m&&m.infusion_slots)for(var fe=0;fe<m.infusion_slots.length;fe++)le=m.infusion_slots[fe],de=le.flags[0],he.push("<img class='itmSlotIcon' src='img/account/item/infusion_"+de.toLowerCase()+".png' /> "+D.getString(de+"_Infusion")+"<br /><br />"),void 0!==le.item_id&&void 0===a.aItemMeta.infusions?(pe.push(le.item_id),M++):pe.push(null);if((b&&v)===!1){var Ce="<img class='itmSlotIcon' src='img/account/item/upgrade.png' /> "+D.getString("UnusedUpgradeSlot")+"<br /><br />";ge.push(Ce),ge.push(y?Ce:""),m&&m.suffix_item_id&&void 0===a.aItemMeta.upgrades?(me.push(m.suffix_item_id),M++):(me.push(null),y&&me.push(null))}}if(a.aItemMeta.infusions)for(var fe=0;fe<a.aItemMeta.infusions.length;fe++)fe<pe.length&&(pe[fe]=a.aItemMeta.infusions[fe],pe[fe]&&M++);if(a.aItemMeta.upgrades)for(var fe=0;fe<a.aItemMeta.upgrades.length;fe++)fe<me.length&&(me[fe]=a.aItemMeta.upgrades[fe],me[fe]&&M++);var ve="";a.aItemMeta.skin&&M++;for(var Te=function(){if(P===M){var e="<div class='itmTooltip'>"+L+O+x+N+Y+ue+(g?ge.join("")+he.join(""):he.join("")+ge.join(""))+ve+X+Z+q+V+J+te+ne+re+oe+ce+"</div>";if(a.aElement){var t=$(a.aElement);t.attr("title",e),I.qTip.init(t)}var p={item:d,infusions:r,upgrades:o,skin:s,attr:c,html:e,istradeable:u,pricebuy:n,pricesell:i};l===!1&&(Q.Box[d.id]=p),a.aCallback&&a.aCallback(p)}},fe=0;fe<pe.length;fe++)null!==pe[fe]&&!function(e,t){$.getJSON(U.getAPIItem(t),function(t){he[e]="<span class='itmUpgrade'><img class='itmSlotIcon' src='"+t.icon+"' /> "+t.name+"<br />"+t.details.infix_upgrade.buff.description+"</span><br /><br />",a.aCallback&&r.push(t),c&&Q.sumItemAttribute(c,t),P++,Te()}).fail(function(){M--,Te()})}(fe,pe[fe]);for(var fe=0;fe<me.length;fe++)null!==me[fe]&&!function(e,t){$.getJSON(U.getAPIItem(t),function(t){var n="";if("Rune"===t.details.type){var i=0;"HelmAquatic"===m.type?i=a.aRuneSets&&a.aRuneSets[t.id]?1+a.aRuneSets[t.id].numslotted:1:a.aRuneSets&&(i=a.aRuneSets),n=Q.getRuneBonus(t,i),c&&Q.sumItemAttribute(c,t,a.aRuneSets)}else n=t.name+"<br />"+Q.formatItemDescription(t),c&&Q.sumItemAttribute(c,t);ge[e]="<aside class='itmUpgrade'><img class='itmSlotIcon' src='"+t.icon+"' /> "+n+"</aside><br />",a.aCallback&&o.push(t),P++,Te()}).fail(function(){M--,Te()})}(fe,me[fe]);a.aItemMeta.skin&&$.getJSON(U.getAPISkin(a.aItemMeta.skin),function(e){L="<aside class='itmName "+Q.getRarityClass(w)+"'><img class='itmIcon itmIconMain' src='"+e.icon+"' />"+U.escapeHTML(e.name)+"</aside>",ve="<aside='itmTransmute'>"+D.getString("Transmuted")+"<br />"+U.escapeHTML(d.name)+"</aside><br /><br />",a.aCallback&&(s=e),P++,Te()}).fail(function(){M--,Te()}),a.aWantPrice&&$.getJSON(U.getAPIPrice(d.id),function(e){var t=E.processPrice(e,a.aItemMeta.count);ce="<aside>"+E.formatCoinString(t.pricesell,{aWantColor:!0,aWantSpace:!0})+" <span class='accTrivial'>"+E.formatCoinString(t.pricebuy,{aWantColor:!0,aWantSpace:!0})+"</span></aside>",a.aCallback&&(n=t.pricebuy,i=t.pricesell),P++,Te()}).fail(function(){M--,Te()}),P===M&&Te()},formatSkillTrait:function(e){var t=function(e){var t=e.text,n=e.type,i=e.value,a=void 0!==e.target?Q.getAttributeString(e.target):"",r=void 0!==e.source?Q.getAttributeString(e.source):"",o="BuffConversion"===n?D.getString("GainBasedPercentage").replace("{0}",r).replace("{1}",a):"",s="<img class='trtFactIcon' src='"+e.icon+"' />",c=e.prefix&&e.prefix.icon?"<img class='trtFactIcon' src='"+e.prefix.icon+"' />":"",l=e.description,u=e.apply_count>1?"<var class='trtStacks'>"+e.apply_count+"</var>":"",d=void 0!==e.duration?e.duration+" "+D.getWord("seconds"):"",p=void 0!==e.duration?" ("+T.formatTooltipTime(e.duration)+")":"",h=e.status,m=e.field_type,g=e.finisher_type,f=e.percent+"%",C=e.hit_count+"x",v=e.distance,b=function(e,t){return"<var class='trtFactIcons'>"+e+"</var><var class='trtFactText'>"+t+"</var>"},y={AttributeAdjust:function(){return b(s,"+"+i+" "+a)},Buff:function(){return b(u+s,h+p+": "+l)},BuffConversion:function(){return b(s,o)},ComboField:function(){return b(s,t+": "+m)},ComboFinisher:function(){return b(s,t+": "+g+" ("+f+")")},Damage:function(){return b(s,t+": "+C)},Distance:function(){return b(s,t+": "+v)},Duration:function(){return b(s,t+": "+d)},Heal:function(){return b(s,t+": "+C)},HealingAdjust:function(){return b(s,t+": "+C)},NoData:function(){return b(s,t)},Number:function(){return b(s,t+": "+i)},Percent:function(){return b(s,t+": "+f)},PrefixedBuff:function(){return b(s+c,h+p+": "+l)},Radius:function(){return b(s,t+": "+v)},Range:function(){return b(s,t+": "+i)},Time:function(){return b(s,t+": "+d)},Unblockable:function(){return b(s,t)}};return y[n]?"<span class='trtFactLine'>"+y[n]()+"</span>":""},n="<span class='trtName'>"+e.name+"</span>",i="<span class='trtDesc'>"+Q.formatItemDescription(e.description)+"</span>",a="",r="",o="";return e.facts&&e.facts.length>0&&(r+="<aside class='trtFacts'>",e.facts.forEach(function(e){"Recharge"===e.type?a="<span class='trtRecharge'>"+e.value+"<img class='trtRechargeIcon' src='"+e.icon+"' /></span>":o+=t(e)}),r=""===o?"":r+o+"</aside>"),a+n+i+r},analyzeTrait:function(e,t){var n=t||{},i=Q.formatSkillTrait(e),a=function(e){var t=$("#itemNull").empty(),n=$(e).appendTo(t).height();return t.empty(),n},r="",o=6,s=20;e.skills&&e.skills.forEach(function(e){var t="<div class='qTip'><div class='trtTooltip'>"+Q.formatSkillTrait(e)+"</div></div>";o+=a(t)+s,r+="<div class='trtTooltip trtTooltipExtra' style='margin-top:-"+o+"px'>"+Q.formatSkillTrait(e)+"</div>"});var c="<div class='trtTooltipBorder'>"+I.Symbol.Filler+"</div>"+r+"<div class='trtTooltip'>"+i+"</div>";if(n.aElement){var l=$(n.aElement);l.attr("title",c),I.qTip.init(l)}},createBank:function(e,t){var n=t||{},i=$("<div class='bnkContainer'><div class='bnkTop'><aside class='bnkCount'></aside><aside class='bnkPrice'><var class='bnkPriceTitleA'></var><var class='bnkPriceValueA'></var> &nbsp; <var class='bnkPriceTitleB'></var><var class='bnkPriceValueB'></var></aside></div><div class='bnkBank'></div></div>").appendTo(e);return n.aIsCollection&&(i.data("iscollection",!0),i.find(".bnkPriceTitleA").html(D.getWordCapital("unlocked")+": +"),i.find(".bnkPriceTitleB").html(D.getWordCapital("locked")+": −"),i.find(".bnkPriceValueA").html(E.formatCoinStringColored(0)),i.find(".bnkPriceValueB").html(E.formatCoinStringColored(0))),i},createBankTab:function(e,t){var n=t||{},i=$("<div class='bnkTab'></div>"),a=n.aIcon?n.aIcon:"",r=n.aTitle?"<var class='bnkTabText'>"+n.aTitle+"</var>":"",o=$("<div class='bnkTabSeparator curToggle'><aside class='bnkTabHeader'>"+a+r+"<var class='bnkTabPrice'></var><var class='bnkTabToggle'></var><var class='bnkTabStats'></var></aside></div>").appendTo(i),s=o.find(".bnkTabToggle"),c=$("<div class='bnkTabSlots'></div>").appendTo(i);return o.click(function(e){if(e.which===I.ClickEnum.Left){var t=c.is(":visible");I.toggleToggleIcon(s,!t),c.slideToggle("fast")}}),n.aIsCollapsed&&(I.toggleToggleIcon(s,!1),c.hide()),e.append(i),i},createInventorySidebar:function(e,t){if(void 0!==t){e.addClass("bnkTabInventory");var n=$("<div class='bnkSidebarContainer'></div>").prependTo(e),i=$("<div class='bnkSidebar'></div>").prependTo(n);$("<div class='bnkSidebarBorder'></div>").appendTo(n);var a,r,o=$("<div class='bnkSidebarColumn'></div>").appendTo(i);t.forEach(function(e){if(e){for(var t=0,n=0;n<e.inventory.length;n++)e.inventory[n]&&t++;a=$("<div class='bnkSidebarBagOuter'></div>").appendTo(o),r=$("<span class='bnkSidebarBag'><var class='bnkSidebarBagCount'>"+t+"/"+e.size+"</var></span>").appendTo(a),function(t){Q.getItem(e.id,function(e){t.css({backgroundImage:"url("+e.icon+")"}),Q.scanItem(e,{aElement:t})})}(r)}})}},createBankSlot:function(e){var t=document.createElement("span");return t.innerHTML="<var class='bnkSlotBackground'></var><var class='bnkSlotIcon'></var><var class='bnkSlotForeground'></var>",t.className="bnkSlot",e[0].appendChild(t),$(t)},styleBankSlot:function(e,t){var n=t||{};if(t){var i=e.parents(".bnkContainer"),a=i.find(".bnkTop"),r=e.parents(".bnkTab").find(".bnkTabPrice"),o=i.data("iscollection"),s=n.aSlotMeta.count||1,c=null,l={upgrades:!0,infusions:!0,skin:!0,bound_to:!0};for(var u in n.aSlotMeta)if(l[u]){c=n.aSlotMeta;break}Q.scanItem(n.aItem,{aElement:e,aItemMeta:c,aCallback:function(t){var i=t.skin?t.skin.icon:n.aItem.icon;e.find(".bnkSlotIcon").css({backgroundImage:"url("+i+")"});var c=($(t.html).text()+" "+D.getString(n.aItem.rarity)).toLowerCase();e.data("keywords",c);var l=n.aWiki||n.aItem.name;if(e.click(function(e){e.which===I.ClickEnum.Left&&U.openPrivateURL(U.getWikiSearchLink(l))}),e.contextmenu(function(e){e.preventDefault(),Q.Context.ItemID=n.aItem.id,Q.Context.ItemName=n.aItem.name,Q.Context.ItemNameSearch=l,Q.showBankContextMenu(),I.updateClipboard("#bnkContextChatlink",n.aItem.chat_link+" "+Q.Context.ItemNameSearch)}),s>1)e.append("<var class='bnkSlotCount'>"+s+"</var>");else if("Tool"===n.aItem.type){var u=A.Equipment.SalvageCharges;u&&u[n.aItem.id]&&e.append("<var class='bnkSlotCount'>"+u[n.aItem.id]+"</var>")}else if("Gathering"===n.aItem.type){var d=A.Equipment.GatheringCharges;d&&n.aItem.rarity!==Q.Rarity.Rare&&e.append("<var class='bnkSlotCount'>"+d[n.aItem.details.type]+"</var>")}0===n.aSlotMeta.count?(e.addClass("bnkSlotZero"),e.data("count",n.aSlotMeta.count)):e.data("count",s),t.istradeable&&$.getJSON(U.getAPIPrice(n.aItem.id),function(t){var i=E.processPrice(t,s),c=o?i.pricesell:i.priceselltaxed,l=function(e,t,n,i){var a=(e.data("priceleft")||0)+t,r=(e.data("priceright")||0)+n;e.data("priceleft",a).data("priceright",r);var o=E.formatCoinStringColored(a),s=E.formatCoinStringColored(r),c=i?"+"+o+" −"+s:s+" <span class='accTrivial'>"+o+"</span>";e.html(c)};e.append("<var class='bnkSlotPrice'>"+E.formatCoinString(c,{aWantColor:!0,aWantShort:!0})+"</var>"),o?0!==n.aSlotMeta.count?(l(r,i.pricebuy,0,!0),l(a.find(".bnkPriceValueA"),i.pricebuy,i.pricesell),e.data("price",c)):(l(r,0,i.pricebuy,!0),l(a.find(".bnkPriceValueB"),i.pricebuy,i.pricesell)):0!==n.aSlotMeta.count&&(l(r,i.pricebuytaxed,i.priceselltaxed),l(a.find(".bnkPriceValueA"),i.pricebuytaxed,i.priceselltaxed),e.data("price",c))}),n.aCallback&&n.aCallback()}})}else e.data("keywords","*")},createBankMenu:function(e,t){var n=t||{},i=e.parents(".accDishContainer").attr("data-section"),a=e.find(".bnkSlot"),r=e.find(".bnkTabSlots"),o=e.find(".bnkTabToggle"),s=A.createDishMenu(i),c=$("<div class='bnkSearch'></div>").prependTo(s),l=$("<input class='bnkSearchInput' type='text' />").appendTo(c),u=$("<div class='bnkSearchFiller'>"+D.getWordCapital("search")+"...</div>").appendTo(c);l.on("input",$.throttle(Q.cSEARCH_LIMIT,function(){var e=$(this).val().toLowerCase(),t=[],i="",r="";if(e.length>0)if(i=e.charAt(0),u.hide(),("<"===i||">"===i)&&e.length>1){var o=E.parseCoinString(e.substring(1,e.length));a.each(function(){var e=$(this).data("price");e&&(">"===i&&e>=o||"<"===i&&o>=e)?$(this).show():$(this).hide()})}else t=e.split(" "),a.each(function(){r=$(this).data("keywords");var e=!0;if(r)if(n.aWantHighlightSearch){for(var i=0;i<t.length;i++)if(-1===r.indexOf(t[i])){$(this).removeClass("bnkSlotMatch"),e=!1;break}e&&$(this).addClass("bnkSlotMatch")}else{for(var i=0;i<t.length;i++)if(-1===r.indexOf(t[i])){$(this).hide(),e=!1;break}e&&$(this).show()}});else u.show(),n.aWantHighlightSearch?a.each(function(){$(this).removeClass("bnkSlotMatch")}):a.each(function(){$(this).show()});A.adjustAccountScrollbar()}));var d=$("<aside class='bnkButtons'></aside>").appendTo(s);$("<div class='bnkButtonReload bnkButton curClick' title='<dfn>Reload</dfn> this bank.<br />Only press this if the progress bar has frozen.'></div>").appendTo(d).click(function(){A.regenerateDish(i)});var p=!0;$("<div class='bnkButtonHelp bnkButton curClick' title='Show this bank&apos;s <dfn>help</dfn> message.'></div>").appendTo(d).click(function(){var e=n.aHelpMessage?$(n.aHelpMessage).html():"";p||I.isConsoleShown()===!1?(I.print("<div class='accModal cntComposition'>"+e+$("#accBankHelp").html()+"</div>",!0),U.convertExternalLink("#cslContent a")):I.clear(),p=!p});var h=0;$("<div class='bnkButtonEmpty bnkButton curToggle' title='Filter: item <dfn>slots</dfn>, empty slots, or any slot'></div>").appendTo(d).click(function(){if(0===h||1===h){var e=0===h;a.each(function(){$(this).data("count")>0?$(this).toggle(e):$(this).toggle(!e)}),$(this).addClass("bnkButtonFocused"),h++}else a.show(),$(this).removeClass("bnkButtonFocused"),h=0;A.adjustAccountScrollbar()});var m=!0;$("<div class='bnkButtonTrade bnkButton curToggle' title='Filter: <dfn>tradeable</dfn> items.'></div>").appendTo(d).click(function(){m?a.each(function(){$(this).data("price")?$(this).show():$(this).hide()}):a.show(),$(this).toggleClass("bnkButtonFocused"),m=!m,A.adjustAccountScrollbar()});var g=!1;$("<div class='bnkButtonTab bnkButton curToggle' title='Expand/<dfn>Collapse</dfn> all tabs.'></div>").appendTo(d).click(function(){g?r.slideDown("fast",function(){A.adjustAccountScrollbar()}):r.slideUp("fast",function(){A.adjustAccountScrollbar()}),o.each(function(){I.toggleToggleIcon($(this),g)}),$(this).toggleClass("bnkButtonFocused"),g=!g});var f=a.first().width();$("<div class='bnkButtonWideLess bnkButton curClick' title='<dfn>Decrease</dfn> bank width.'></div>").appendTo(d).click(function(){var t=4*f,n=e.width();n>t&&(e.css({width:n-f}),A.adjustAccountScrollbar())}),$("<div class='bnkButtonWideMore bnkButton curClick' title='<dfn>Increase</dfn> bank width.'></div>").appendTo(d).click(function(){var t=$("#accContent").width()-2*f,n=e.width();t>n&&(e.css({width:n+f}),A.adjustAccountScrollbar())}),c.css({width:c.width()-d.width()}),I.qTip.init(d.find(".bnkButton")),A.adjustAccountPanel()},initializeBankContextMenu:function(){I.styleContextMenu("#bnkContext"),$("#bnkContext").click(function(){$(this).hide()}),$("#bnkContextWiki").click(function(){U.openPrivateURL(U.getWikiLink(Q.Context.ItemName))}),$("#bnkContextWikiSearch").click(function(){U.openPrivateURL(U.getWikiSearchLink(Q.Context.ItemNameSearch))}),$("#bnkContextTrading").click(function(){U.openPrivateURL(U.getTradingItemLink(Q.Context.ItemID,Q.Context.ItemName))}),$("#bnkContextTradingSearch").click(function(){U.openPrivateURL(U.getTradingSearchLink(Q.Context.ItemName))}),$("#bnkContextChatlink").click(function(){}),I.initializeClipboard("#bnkContextChatlink")},showBankContextMenu:function(){$("#bnkContext").css({top:I.posY,left:I.posX}).show()}},E={Exchange:{COPPER_IN_SILVER:100,COPPER_IN_GOLD:1e4,SILVER_IN_GOLD:100,CENTS_IN_DOLLAR:100,GEM_PER_DOLLAR:.8,DOLLAR_PER_GEM:1.25,GEM_SAMPLE:100,COIN_SAMPLE:1e6,TAX_LIST:.05,TAX_SOLD:.1,TAX_TOTAL:.15,TAX_INVERSE:.85,GemInCoin:0,CoinInGem:0},cREFRESH_LIMIT:5e3,cSEARCH_LIMIT:750,cEXCHANGE_LIMIT:250,isTradingCalculatorsInitialized:!1,ItemsArray:[],RefreshTimeout:{},ProgressTimeout:{},ProgressWait:0,ProgressTick:0,SwapIndex:-1,CalculatorHistoryArray:new Array(64),CalcHistoryIndex:0,Payment:{coin:function(e){return E.formatCoinString(e,{aWantColor:!0,aWantShort:!0})},karma:function(e){return E.formatKarmaString(e,!0)},gem:function(e){return E.formatGemString(e,!0)},badge:function(e){return e.toLocaleString()+"<ins class='s16 s16_badge'></ins>"},token:function(e){return e.toLocaleString()+"<ins class='s16 s16_token'></ins>"},achievement:function(e){return(0===e?"":e.toLocaleString())+"<ins class='s16 s16_achievement'></ins>";
},monument:function(e){return e.toLocaleString()+"<ins class='s16 s16_monument'></ins>"},craft:function(){return"<ins class='s16 s16_craft'></ins>"},pvp:function(){return"<ins class='s16 s16_pvp'></ins>"},starting:function(){return"<ins class='s16 s16_starting'></ins>"}},parseCoinString:function(e){if(void 0===e||null===e)return 0;var t=e.split("."),n=t.length,i=0,a=0,r=0;return 0===n?0:(1===n&&(a=parseInt(t[0])),n>=2&&(i=parseInt(t[n-1]),a=parseInt(t[n-2])),2===n&&1===t[n-1].length&&(i*=T.cBASE_10),n>=3&&(r=parseInt(t[n-3])),isFinite(i)||(i=0),isFinite(a)||(a=0),isFinite(r)||(r=0),parseInt(i+a*E.Exchange.COPPER_IN_SILVER+r*E.Exchange.COPPER_IN_GOLD))},parseGemString:function(e){return void 0===e||null===e?0:isFinite(parseInt(e))?parseInt(e):0},parseMoneyString:function(e){if(void 0===e||null===e)return 0;var t=e.split("."),n=t.length,i=0,a=0;return 0===n?0:(1===n&&(a=parseInt(t[0])),n>=2&&(i=parseInt(t[n-1]),a=parseInt(t[n-2])),n>=2&&1===t[n-1].length?i*=T.cBASE_10:n>=2&&t[n-1].length>=2&&(i=parseInt(i.toString().substring(0,2))),isFinite(i)||(i=0),isFinite(a)||(a=0),parseInt(i+a*E.Exchange.CENTS_IN_DOLLAR))},formatCoinString:function(e,t){var n=void 0===e||isFinite(e)===!1?0:parseInt(e),i=$.extend({aWantColor:!1,aWantSpace:!1,aWantShort:!1},t),a=".",r="",o="",s="",c="",l="",u="";i.aWantColor&&(a="",r="<gold>",o="<silver>",s="<copper>",c="</gold><goldcoin></goldcoin>",l="</silver><silvercoin></silvercoin>",u="</copper><coppercoin></coppercoin>"),i.aWantSpace&&(a=" ");var d=Math.abs(~~(n/E.Exchange.COPPER_IN_GOLD)),p=Math.abs(~~(n/E.Exchange.SILVER_IN_GOLD)%E.Exchange.COPPER_IN_SILVER),h=Math.abs(n%E.Exchange.COPPER_IN_SILVER),m=d,g=p,f=h,C=0>n?"−":"";return!i.aWantColor&&d>0&&p<T.cBASE_10&&(g="0"+p),!i.aWantColor&&(p>0&&h<T.cBASE_10||h<T.cBASE_10)&&(f="0"+h),i.aWantShort&&((d>0||0===h&&n>0)&&(s="",f="",u=""),0===p&&(o="",g="",l="")),d>0?C+r+m+c+a+o+g+l+a+s+f+u:p>0?C+o+g+l+a+s+f+u:i.aWantColor?s+f+u:C+o+"0"+a+l+s+f+u},formatCoinStringColored:function(e){return E.formatCoinString(e,{aWantColor:!0})},formatMoneyString:function(e){if(void 0===e||isFinite(e)===!1)return"0.00";e=parseInt(e);var t=Math.abs(~~(e/E.Exchange.CENTS_IN_DOLLAR)),n=Math.abs(e%E.Exchange.CENTS_IN_DOLLAR),i=0>e?"−":"";return n<T.cBASE_10&&(n="0"+n),i+t+"."+n},formatCurrencyString:function(e,t,n){if(void 0===t||isFinite(t)===!1)return"0";t=parseInt(t);var i=e,a="",r="",o="<"+i+"unit></"+i+"unit>";return n&&(a="<"+i+">",r="</"+i+">"),a+t.toLocaleString()+r+o},formatKarmaString:function(e,t){return E.formatCurrencyString("karma",e,t)},formatLaurelString:function(e,t){return E.formatCurrencyString("laurel",e,t)},formatGemString:function(e,t){return E.formatCurrencyString("gem",e,t)},animateValue:function(e,t,n){t>n?e.css({color:"#ff2200"}).animate({color:"#ffeebb"},5e3):n>t?e.css({color:"#44dd44"}).animate({color:"#ffeebb"},5e3):e.css({"border-radius":32}).animate({"border-radius":4},1e3)},updateCoinInGem:function(){return $.getJSON(U.URL_API.GemPrice+E.Exchange.COIN_SAMPLE,function(e){void 0!==e.quantity&&(E.Exchange.CoinInGem=E.Exchange.COIN_SAMPLE/e.quantity)})},updateGemInCoin:function(){return $.getJSON(U.URL_API.CoinPrice+E.Exchange.GEM_SAMPLE,function(e){void 0!==e.quantity&&(E.Exchange.GemInCoin=E.Exchange.GEM_SAMPLE/e.quantity)})},deductTax:function(e){return Math.floor(e-e*E.Exchange.TAX_TOTAL)},convertGemToCoin:function(e){return E.formatCoinStringColored(Math.round(e*E.Exchange.CoinInGem))},convertGemToMoney:function(e){return E.formatMoneyString(Math.round(e*E.Exchange.DOLLAR_PER_GEM))},convertMoneyToGem:function(e){return Math.floor(e*E.Exchange.GEM_PER_DOLLAR)},processPrice:function(e,t){var n=void 0===t?1:t,i=e.buys.unit_price*n,a=e.sells.unit_price*n;return{pricebuy:i,pricesell:a,pricebuytaxed:E.deductTax(i),priceselltaxed:E.deductTax(a)}},calculateTrading:function(e){var t=E.parseCoinString(e.find(".trdBuy").val()),n=E.parseCoinString(e.find(".trdSell").val()),i=T.parseQuantity(e.find(".trdQuantity").val()),a=e.find(".trdCost"),r=e.find(".trdTax"),o=e.find(".trdRevenue"),s=e.find(".trdProfit"),c=e.find(".trdBreak"),l=e.find(".trdMargin"),u=(n-n*E.Exchange.TAX_TOTAL-t)*i,d=(n-n*E.Exchange.TAX_SOLD)*i,p=t*i,h=n*E.Exchange.TAX_LIST*i,m=n*E.Exchange.TAX_SOLD*i;a.val("−"+E.formatCoinString(Math.round(p))),r.val("−"+E.formatCoinString(Math.round(h))+" + −"+E.formatCoinString(Math.round(m))),c.val(E.formatCoinString(Math.round(t/E.Exchange.TAX_INVERSE))),o.val(E.formatCoinString(Math.round(d))),s.val(E.formatCoinString(Math.round(u))),l.val(U.convertRatioToPercent(d/(p+h)-1,2)),$([s,l]).each(function(){var e=Math.round(u);$(this).removeClass("trdZero trdGain trdLoss"),0===e?$(this).addClass("trdZero"):e>0?$(this).addClass("trdGain"):0>e&&$(this).addClass("trdLoss")})},updateTradingDetails:function(e){var t=e.find(".trdName").val(),n=e.find(".trdItem").val();if(isFinite(parseInt(n))!==!1&&0!==t.length){var i=e.find(".trdIcon");Q.getItem(n,function(t){Q.setRarityClass(e.find(".trdName"),t.rarity),e.attr("data-rarity",t.rarity),e.find(".trdLink").val(t.chat_link||""),i.attr("src",t.icon),i.unbind("click").click(function(){U.printJSON(t)}),Q.scanItem(t,{aElement:i,aCallback:function(t){e.data("istradeable",t.istradeable)}})})}},updateTradingPrices:function(e){var t=e.find(".trdName").val(),n=e.find(".trdItem").val();if(isFinite(parseInt(n))!==!1&&0!==t.length&&e.data("istradeable")!==!1){var i=0,a=0,r=0,o=0,s=e.find(".trdName"),c=e.find(".trdCurrentBuy"),l=e.find(".trdCurrentSell"),u=e.find(".trdNotifyBuyLow"),d=e.find(".trdNotifyBuyHigh"),p=e.find(".trdNotifySellLow"),h=e.find(".trdNotifySellHigh"),m=E.parseCoinString(u.val()),g=E.parseCoinString(d.val()),f=E.parseCoinString(p.val()),C=E.parseCoinString(h.val());$.ajax({dataType:"json",url:U.getAPIPrice(n),cache:!1,success:function(t){i=E.parseCoinString(e.find(".trdCurrentBuy").first().val()),a=E.parseCoinString(e.find(".trdCurrentSell").first().val()),void 0!==t.buys&&(r=parseInt(t.buys.unit_price)),void 0!==t.sells&&(o=parseInt(t.sells.unit_price)),c.val(E.formatCoinString(r)),l.val(E.formatCoinString(o)),X.getChecklistItem(X.Checklists.TradingOverwrite,U.getSubintegerFromHTMLID(e))===X.ChecklistEnum.Checked&&(e.find(".trdBuy").val(c.val()).trigger("input"),e.find(".trdSell").val(l.val()).trigger("input"))}}).done(function(){E.animateValue(c,i,r),E.animateValue(l,a,o),X.isChecked(X.Checklists.TradingNotify,e)&&(s.removeClass("trdMatched"),m>=r&&0!==m&&0!==r?(s.addClass("trdMatched"),u.addClass("trdMatched"),D.speak(D.getPhraseTitle("buy low")+" "+t)):u.removeClass("trdMatched"),r>=g&&0!==g&&0!==r?(s.addClass("trdMatched"),d.addClass("trdMatched"),D.speak(D.getPhraseTitle("buy high")+" "+t)):d.removeClass("trdMatched"),f>=o&&0!==f&&0!==o?(s.addClass("trdMatched"),p.addClass("trdMatched"),D.speak(D.getPhraseTitle("sell low")+" "+t)):p.removeClass("trdMatched"),o>=C&&0!==C&&0!==o?(s.addClass("trdMatched"),h.addClass("trdMatched"),D.speak(D.getPhraseTitle("sell high")+" "+t)):h.removeClass("trdMatched"))}).fail(function(){c.val(I.Symbol.Ellipsis),l.val(I.Symbol.Ellipsis)})}},updateAllTradingDetails:function(){$("#trdList .trdEntry").each(function(){E.updateTradingDetails($(this))})},updateAllTradingPrices:function(){$("#trdList .trdEntry").each(function(){E.updateTradingPrices($(this))})},clearCalculator:function(e){Q.setRarityClass(e.find(".trdName")),e.find(".trdIcon").attr("src",U.URL_IMG.Placeholder),e.find(".trdItem").val("").trigger("change"),e.find(".trdCurrentBuy").val(""),e.find(".trdCurrentSell").val(""),e.find(".trdLink").val(""),e.find(".trdResultsContainer").remove(),e.find(".trdNotifyBuyLow").val("").trigger("change"),e.find(".trdNotifyBuyHigh").val("").trigger("change"),e.find(".trdNotifySellLow").val("").trigger("change"),e.find(".trdNotifySellHigh").val("").trigger("change"),E.clearMatched(e)},clearMatched:function(e){e.find(".trdName").removeClass("trdMatched"),e.find(".trdNotifyBuyLow").removeClass("trdMatched"),e.find(".trdNotifyBuyHigh").removeClass("trdMatched"),e.find(".trdNotifySellLow").removeClass("trdMatched"),e.find(".trdNotifySellHigh").removeClass("trdMatched")},initializeTrading:function(){var e,t,n,i,a,r="",o=function(e){var t=$("<div class='trdResultsContainer jsRemovable'></div>").insertAfter(e.find(".trdName"));return $("<div class='trdResults cntPopup'>"+I.cThrobber+"</div>").appendTo(t)},s=function(e,t,n){I.removeThrobber(".trdResults");var i=$("<dfn class='"+Q.getRarityClass(e.rarity)+"' data-id='"+e.id+"'><img src='"+e.icon+"'>"+U.wrapSubstringHTML(e.name,t,"u")+"</dfn>").appendTo(n);i.click(function(){var e=$(this).parents(".trdResultsContainer"),t=e.parents(".trdEntry");t.find(".trdItem").val($(this).data("id")).trigger("change"),t.find(".trdName").val($(this).text()).trigger("change"),E.updateTradingDetails(t),E.updateTradingPrices(t),e.remove()}),Q.scanItem(e,{aElement:i})};for(e=0;e<O.Options.int_numTradingCalculators;e++)r="#trdEntry_"+e,$("#trdList").append("<div id='trdEntry_"+e+"' class='trdEntry'><div class='trdAccordion trdAccordionShut'><abbr><img class='trdIcon' src='"+U.URL_IMG.Placeholder+"' /></abbr><div class='trdResultsFocus'><input class='trdName' type='text' /></div><div class='trdButtons'><button class='trdSearch' tabindex='-1'>S</button><button class='trdWiki' tabindex='-1'>W</button><br /></div><div class='trdExpand'><abbr>$~O</abbr><input class='trdBuy' type='text' /><abbr>−$~</abbr><input class='trdCost trdOutput' type='text' tabindex='-1' /><br /><abbr>O~$</abbr><input class='trdSell' type='text' /><abbr>$=$</abbr><input class='trdBreak trdOutput' type='text' tabindex='-1' /><br /><abbr>×</abbr><input class='trdQuantity' type='text' /><abbr>−$%</abbr><input class='trdTax trdOutput' type='text' tabindex='-1' /><br /><abbr>+$</abbr><input class='trdProfit trdOutput' type='text' tabindex='-1' /><abbr>=$</abbr><input class='trdRevenue trdOutput' type='text' tabindex='-1' /><br /><abbr>+$%</abbr><input class='trdMargin trdOutput' type='text' tabindex='-1' /><abbr>[]</abbr><input class='trdLink trdOutput' type='text' tabindex='-1' /><input class='trdItem trdOutput' type='text' /><br /><abbr>$~!</abbr><input class='trdNotifyBuyHigh' type='text' /><input class='trdCurrentBuy trdOutput' type='text' tabindex='-1' /><input class='trdNotifyBuyLow' type='text' /><label title='<dfn>"+D.getWordCapital("overwrite")+"</dfn>: Replace your buy and sell prices with the current prices when refreshing.'><input class='trdOverwrite' type='checkbox' tabindex='-1' />"+I.Symbol.Filler+"</label><br /><abbr>!~$</abbr><input class='trdNotifySellHigh' type='text' /><input class='trdCurrentSell trdOutput' type='text' tabindex='-1' /><input class='trdNotifySellLow' type='text' /><label title='<dfn>"+D.getWordCapital("notify")+"</dfn>: Turn on sound notification for this item.'><input class='trdNotify' type='checkbox' tabindex='-1' />"+I.Symbol.Filler+"</label><br /><br /></div></div><div class='trdPreview'><input class='trdCurrentBuy trdOutput' type='text' tabindex='-1' /><input class='trdCurrentSell trdOutput' type='text' tabindex='-1' /><div class='btnSwap'><button class='btnSwapUp' tabindex='-1'></button><button class='btnSwapDown' tabindex='-1'></button></div></div></div>"),I.qTip.init($(r+" .trdOverwrite").parent()),I.qTip.init($(r+" .trdNotify").parent()),t=$(r+" .trdName"),n=$(r+" .trdBuy"),i=$(r+" .trdSell"),a=$(r+" .trdQuantity"),$(r+" input").click(function(){$(this).select()}),$(r+" .trdWiki").click(function(){var e=$(this).parents(".trdEntry").find(".trdName").val();U.openExternalURL(U.getWikiLink(e))}),$(r+" .trdSearch").click(function(){var e=$(this).parents(".trdEntry").find(".trdItem").val(),t=$(this).parents(".trdEntry").find(".trdName").val();0===e.length?U.openExternalURL(U.getTradingSearchLink(t)):U.openExternalURL(U.getTradingItemLink(e,t))}),$([n,i,a]).each(function(){$(this).on("input",function(){E.calculateTrading($(this).parent())})}),$(r+" .trdCurrentBuy, "+r+" .trdCurrentSell").each(function(){$(this).dblclick(function(){var e=E.parseCoinString($(this).val());0!==e&&($(this).prev().val(E.formatCoinString(e+1)).trigger("change"),$(this).next().val(E.formatCoinString(e-1)).trigger("change"),E.updateTradingPrices($(this).parents(".trdEntry")))})}),$(r+" .btnSwap").hover(function(){$(this).parents(".trdEntry").find(".trdName").addClass("trdHovered"),E.SwapIndex=U.getSubintegerFromHTMLID($(this).parents(".trdEntry"))},function(){$(".trdName").removeClass("trdHovered")}),$(r+" .btnSwapUp, "+r+" .btnSwapDown").each(function(){$(this).click(function(){var e=E.SwapIndex,t=$(this).hasClass("btnSwapUp")?!0:!1;if((!t||0!==e)&&!t!==$(".trdEntry").length-1){var n=t?e-1:e+1,i=$("#trdEntry_"+e),a=$("#trdEntry_"+n),r=[],o=[],s=0,c=0;i.find("input[type='text']").each(function(){r.push($(this).val())}),a.find("input[type='text']").each(function(){o.push($(this).val())}),i.find("input[type='text']").each(function(){$(this).val(o[s]).trigger("change"),s++}),a.find("input[type='text']").each(function(){$(this).val(r[c]).trigger("change"),c++});var l=i.find(".trdIcon").attr("src"),u=a.find(".trdIcon").attr("src");i.find(".trdIcon").attr("src",u),a.find(".trdIcon").attr("src",l);var d=i.attr("data-rarity"),p=a.attr("data-rarity");i.attr("data-rarity",p),a.attr("data-rarity",d),Q.setRarityClass(i.find(".trdName"),p),Q.setRarityClass(a.find(".trdName"),d),E.clearMatched(i),E.clearMatched(a),i.find(".trdName").removeClass("trdHovered"),a.find(".trdName").addClass("trdHovered"),E.SwapIndex=t?E.SwapIndex-1:E.SwapIndex+1}})}),$(t).on("input",$.throttle(E.cSEARCH_LIMIT,function(){var e,t=$(this).val(),n=U.escapeHTML(t),i=$(this).parents(".trdEntry");if(t.length<3)return void E.clearCalculator(i);if(t.length>=3&&O.isInteger(t))return i.find(".trdResultsContainer").remove(),e=o(i),void Q.getItem(t,function(n){s(n,t,e)}).fail(function(){I.write("No results found for Item ID: "+n+"."),i.find(".trdResultsContainer").remove()});var a,r;O.Options.bol_useMainTPSearch?(a=U.URL_API.ItemSearch+t,r="data_id"):(a=U.URL_API.ItemSearchFallback+t,r="item_id"),$.ajax({dataType:"json",url:a,timeout:5e3,success:function(a){i.find(".trdResultsContainer").remove();var c,l,u,d=O.Options.bol_useMainTPSearch?a.results:a;if(d&&d.length>0)for(e=o(i),c=0;c<d.length&&c<O.Options.int_numTradingResults;c++)u=d[c],l=parseInt(u[r]),Q.getItem(l,function(n){s(n,t,e)});else I.write("No results found for &quot;"+n+"&quot;.")}}).fail(function(){I.write("Error retrieving search results. Current search provider may be down.<br />Switching to alternate provider..."),$("#opt_bol_useMainTPSearch").trigger("click")})})).onEnterKey(function(){U.openExternalURL(U.getTradingSearchLink($(this).val()))}).onEscapeKey(function(){$(this).parents(".trdEntry").find(".trdResultsContainer").remove()}).click(function(){$(this).trigger("input")});r="#trdEntry_0",$(r+" .trdIcon").attr("src","img/ui/question.png"),$(r+" .trdName").val("Bifrost"),$(r+" .trdBuy").val("4500.37.68"),$(r+" .trdSell").val("550037.68"),$(r+" .trdQuantity").val("1"),$(r).css("margin-bottom","6px");var c=function(e,t,n){n=void 0===n?"":": "+n,$(r+" .trd"+e).attr("title","<dfn>"+D.getPhraseTitle(t)+"</dfn>"+n)};c("Name","name"),c("Buy","your buy"),c("Sell","your sell"),c("Quantity","quantity"),c("Cost","cost","Money needed to buy the items."),c("Break","breakpoint","Sell higher than this to make a profit."),c("Tax","tax","Pay 5% fee of sell price to list, and deduct 10% tax of sell price when sold."),c("Profit","profit","Gains after losses from buying and tax."),c("Margin","margin","Revenue over cost and fee."),c("Revenue","revenue","What you will receive at the trader."),c("Link","chatlink","Paste this in game chat to see the item."),c("Item","ID","API item number."),c("NotifyBuyLow","notify if current buy < this buy"),c("NotifyBuyHigh","notify if this buy < current buy"),c("NotifySellLow","notify if current sell < this sell"),c("NotifySellHigh","notify if this sell < current sell"),c("CurrentBuy","current buy","Double click to flank price."),c("CurrentSell","current sell","Double click to flank price."),I.qTip.init($(r+" input")),X.initializeTextlist(X.Textlists.TradingItem,$("#trdList .trdItem"),null,16),X.initializeTextlist(X.Textlists.TradingName,$("#trdList .trdName"),null,64),X.initializeTextlist(X.Textlists.TradingBuy,$("#trdList .trdBuy"),null,16),X.initializeTextlist(X.Textlists.TradingSell,$("#trdList .trdSell"),null,16),X.initializeTextlist(X.Textlists.TradingQuantity,$("#trdList .trdQuantity"),null,16),X.initializeTextlist(X.Textlists.NotifyBuyLow,$("#trdList .trdNotifyBuyLow"),null,16),X.initializeTextlist(X.Textlists.NotifyBuyHigh,$("#trdList .trdNotifyBuyHigh"),null,16),X.initializeTextlist(X.Textlists.NotifySellLow,$("#trdList .trdNotifySellLow"),null,16),X.initializeTextlist(X.Textlists.NotifySellHigh,$("#trdList .trdNotifySellHigh"),null,16),X.initializeCheckboxlist(X.Checklists.TradingOverwrite,$("#trdList .trdOverwrite"),X.ChecklistJob.CheckAll),X.initializeCheckboxlist(X.Checklists.TradingNotify,$("#trdList .trdNotify"),X.ChecklistJob.CheckAll),$("#trdList .trdSell").trigger("input"),E.updateAllTradingDetails(),$("#trdToggle").click(function(){$("#trdEntry_0 .trdBuy").is(":visible")?($(".trdAccordion").addClass("trdAccordionShut").removeClass("trdAccordionOpen"),$(".trdPreview").removeClass("cssHidden")):($(".trdAccordion").removeClass("trdAccordionShut").addClass("trdAccordionOpen"),$(".trdPreview").addClass("cssHidden"))}),$("#trdRefresh").click($.throttle(E.cREFRESH_LIMIT,function(){E.loopRefresh(!0)})),$("#trdPause").click(function(){E.cancelLoopRefresh()}),$("#trdMute").click(function(){D.resetSpeechQueue()}),$("#trdPrint").click(function(){I.clear(),I.print("ItemID,Name,Buy,Sell,Quantity,BuyLow,BuyHigh,SellLow,SellHigh");for(var e=X.Textlists.TradingItem.value.length,t="",n=0;e>n;n++)t+=U.escapeHTML(X.Textlists.TradingItem.value[n]+","+X.Textlists.TradingName.value[n]+","+X.Textlists.TradingBuy.value[n]+","+X.Textlists.TradingSell.value[n]+","+X.Textlists.TradingQuantity.value[n]+","+X.Textlists.NotifyBuyLow.value[n]+","+X.Textlists.NotifyBuyHigh.value[n]+","+X.Textlists.NotifySellLow.value[n]+","+X.Textlists.NotifySellHigh.value[n])+"<br />";I.print(t)})},updateCoinTo:function(e){var t=0,n=0,i=0,a=0,r=0,o=0,s=0,c=0,l=$("#trdExchange .trdCoinTo"),u=$("#trdExchange .trdCoinToGem"),d=$("#trdExchange .trdCoinToMoney"),p=$("#trdExchange .trdCoinToGemInverse"),h=$("#trdExchange .trdCoinToMoneyInverse"),m=E.parseCoinString(l.val());0===m?(u.val(""),d.val(""),p.val(""),h.val("")):($.getJSON(U.URL_API.GemPrice+m,function(e){void 0!==e.quantity&&(t=parseInt(u.val()),i=E.parseMoneyString(d.val()),n=parseInt(e.quantity),a=Math.round(n*E.Exchange.DOLLAR_PER_GEM),u.val(n),d.val(E.formatMoneyString(a)))}).always(function(){(void 0===e||e)&&(E.animateValue(u,t,n),E.animateValue(d,i,a)),0===n&&(u.val("0"),d.val("0"))}),E.updateGemInCoin().always(function(){0!==E.Exchange.GemInCoin&&(r=parseInt(p.val()),s=E.parseMoneyString(h.val()),o=Math.round(m*E.Exchange.GemInCoin),c=Math.round(o*E.Exchange.DOLLAR_PER_GEM),p.val(o),h.val(E.formatMoneyString(c)),(void 0===e||e)&&(E.animateValue(p,r,o),E.animateValue(h,s,c)))}))},updateGemTo:function(e){var t=0,n=0,i=0,a=0,r=0,o=0,s=$("#trdExchange .trdGemTo"),c=$("#trdExchange .trdGemToCoin"),l=$("#trdExchange .trdGemToMoney"),u=$("#trdExchange .trdGemToCoinInverse"),d=s.val();0===d||""===s.val()?(c.val(""),l.val("")):($.getJSON(U.URL_API.CoinPrice+d,function(e){void 0!==e.quantity&&(t=E.parseCoinString(c.val()),i=E.parseMoneyString(l.val()),n=parseInt(e.quantity),a=parseInt(d*E.Exchange.DOLLAR_PER_GEM),c.val(E.formatCoinString(n)),l.val(E.formatMoneyString(a)))}).always(function(){(void 0===e||e)&&(E.animateValue(c,t,n),E.animateValue(l,i,a)),0===n&&(c.val("0"),l.val("0"))}),E.updateCoinInGem().always(function(){0!==E.Exchange.CoinInGem&&(r=E.parseCoinString(u.val()),o=Math.round(d*E.Exchange.CoinInGem),u.val(E.formatCoinString(o)),(void 0===e||e)&&E.animateValue(u,r,o))}))},updateMoneyTo:function(e){var t=0,n=0,i=0,a=0,r=$("#trdExchange .trdMoneyTo"),o=$("#trdExchange .trdMoneyToGem"),s=$("#trdExchange .trdMoneyToCoin"),c=E.parseMoneyString(r.val()),l=c*E.Exchange.GEM_PER_DOLLAR;0===c?(o.val(""),s.val("")):$.getJSON(U.URL_API.CoinPrice+l,function(e){void 0!==e.quantity&&(t=parseInt(o.val()),i=E.parseCoinString(s.val()),n=l,a=parseInt(e.quantity),o.val(l),s.val(E.formatCoinString(a)))}).always(function(){(void 0===e||e)&&(E.animateValue(o,t,n),E.animateValue(s,i,a)),0===a&&(o.val("0"),s.val("0"))})},updateNotifyCoinTo:function(e){var t=0,n=0,i=$("#trdExchange .trdNotifyCoinTo"),a=$("#trdExchange .trdNotifyCoinToGem"),r=$("#trdExchange .trdNotifyCoinToGemHigh"),o=E.parseGemString(r.val()),s=E.parseCoinString(i.val());0===s?a.val(""):$.getJSON(U.URL_API.GemPrice+s,function(e){void 0!==e.quantity&&(t=parseInt(a.val()),n=parseInt(e.quantity),a.val(n))}).always(function(){(void 0===e||e)&&E.animateValue(a,t,n),0===n?a.val("0"):n>=o&&0!==o?(r.addClass("trdMatched"),D.speak(D.getPhraseTitle("buy gem high"))):r.removeClass("trdMatched")})},updateNotifyGemTo:function(e){var t=0,n=0,i=$("#trdExchange .trdNotifyGemTo"),a=$("#trdExchange .trdNotifyGemToCoin"),r=$("#trdExchange .trdNotifyGemToCoinHigh"),o=E.parseCoinString(r.val()),s=i.val();0===s?a.val(""):$.getJSON(U.URL_API.CoinPrice+s,function(e){void 0!==e.quantity&&(t=E.parseCoinString(a.val()),n=parseInt(e.quantity),a.val(E.formatCoinString(n)))}).always(function(){(void 0===e||e)&&E.animateValue(a,t,n),0===n?a.val("0"):n>=o&&0!==o?(r.addClass("trdMatched"),D.speak(D.getPhraseTitle("buy coin high"))):r.removeClass("trdMatched")})},updateAllExchange:function(){E.updateCoinTo(),E.updateGemTo(),E.updateMoneyTo(),E.updateNotifyCoinTo(),E.updateNotifyGemTo()},initializeExchange:function(){var e=$("#trdExchange .trdCoinTo"),t=$("#trdExchange .trdGemTo"),n=$("#trdExchange .trdMoneyTo"),i=$("#trdExchange .trdNotifyCoinTo"),a=$("#trdExchange .trdNotifyGemTo"),r=$("#trdExchange .trdNotifyCoinToGemHigh"),o=$("#trdExchange .trdNotifyGemToCoinHigh");e.val("200.."),t.val("4000"),n.val("50");var s=function(e,t){$("#trdExchange .trd"+e).attr("title","<dfn>"+D.getPhraseTitle(t)+"</dfn>")};s("CoinTo","your coin"),s("GemTo","your gem"),s("MoneyTo","your dollar"),s("CoinToGem","your coin to gem"),s("GemToCoin","your gem to coin"),s("MoneyToGem","your dollar to gem"),s("CoinToMoney","your coin to dollar"),s("GemToMoney","your gem to dollar"),s("MoneyToCoin","your dollar to coin"),s("CoinToGemInverse","gem to your coin"),s("GemToCoinInverse","coin to your gem"),s("CoinToMoneyInverse","dollar to your coin"),s("NotifyCoinTo","your coin"),s("NotifyGemTo","your gem"),s("NotifyCoinToGem","your coin to current gem"),s("NotifyGemToCoin","your gem to current coin"),s("NotifyCoinToGemHigh","notify if current gem > this gem"),s("NotifyGemToCoinHigh","notify if current coin > this coin"),I.qTip.init($("#trdExchange input")),$("#trdExchange input").click(function(){$(this).select()}),e.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateCoinTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateCoinTo()})),t.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateGemTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateGemTo()})),n.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateMoneyTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateMoneyTo()})),i.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateNotifyCoinTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateNotifyCoinTo()})),a.on("input",$.throttle(E.cEXCHANGE_LIMIT,function(){E.updateNotifyGemTo(!1)})).onEnterKey($.throttle(E.cEXCHANGE_LIMIT,function(){E.updateNotifyGemTo()})),X.initializeTextlist(X.Textlists.ExchangeUnit,$([e,t,n,i,a,r,o]),null,16),$(".trdProgress").data("width",$(".trdProgress").width()),E.isTradingCalculatorsInitialized=!0,E.loopRefresh()},cancelLoopRefresh:function(){window.clearTimeout(E.ProgressTimeout),window.clearTimeout(E.RefreshTimeout),$(".trdProgress").width($(".trdProgress").data("width"))},animateProgress:function(){var e=$(".trdProgress");E.ProgressTick<E.ProgressWait&&e.width(e.width()-e.data("width")/E.ProgressWait),E.ProgressTick-=1,E.ProgressTimeout=setTimeout(E.animateProgress,T.cMSECONDS_IN_SECOND)},loopRefresh:function(e){if(E.cancelLoopRefresh(),(e===!0||O.Options.bol_refreshPrices)&&(E.updateAllTradingPrices(),E.updateAllExchange(),O.Options.bol_refreshPrices)){var t=O.Options.int_secTradingRefresh*T.cMSECONDS_IN_SECOND;E.ProgressTick=O.Options.int_secTradingRefresh,E.ProgressWait=O.Options.int_secTradingRefresh,E.animateProgress(),E.RefreshTimeout=setTimeout(E.loopRefresh,t)}},initializeCalculator:function(){$("#trdCalculation .trdCalculator").onEnterKey(function(){E.doCalculation($(this))}).click(function(){$(this).select()}),$("#trdCalculation .trdCalcSubmit").click(function(){E.doCalculation($(this).prev())});for(var e in E.CalculatorHistoryArray)E.CalculatorHistoryArray[e]="";$("#trdCalculation .trdCalculator").onArrowUpKey(function(){if(0===E.CalcHistoryIndex){var e=U.stripToCalculation($(this).val());E.CalculatorHistoryArray[0]!==$(this).val().toString()&&(E.CalculatorHistoryArray.pop(),E.CalculatorHistoryArray.unshift(e))}E.CalcHistoryIndex+1<E.CalculatorHistoryArray.length&&(E.CalcHistoryIndex++,$(this).val(E.CalculatorHistoryArray[E.CalcHistoryIndex]))}),$("#trdCalculation .trdCalculator").onArrowDownKey(function(){E.CalcHistoryIndex-1>=0&&(E.CalcHistoryIndex--,$(this).val(E.CalculatorHistoryArray[E.CalcHistoryIndex]))})},doCalculation:function(pCalculator){var expression=U.stripToCalculation(pCalculator.val()),result="";try{result=eval(expression)}catch(e){}pCalculator.val(parseFloat(result)).select(),result.toString().length>0&&(E.CalculatorHistoryArray.pop(),E.CalculatorHistoryArray.unshift(expression),E.CalcHistoryIndex=0)}},D={Dictionary:{s_TEMPLATE:{de:"",es:"",fr:"",cs:"",it:"",pl:"",pt:"",ru:"",zh:""},s_y:{de:"j",es:"a",fr:"a",cs:"r",it:"a",pl:"r",pt:"a",ru:"г",zh:"年"},s_w:{de:"w",es:"s",fr:"s",cs:"t",it:"s",pl:"t",pt:"s",ru:"н",zh:"週"},s_d:{de:"t",es:"d",fr:"j",cs:"d",it:"g",pl:"d",pt:"d",ru:"д",zh:"日"},s_h:{de:"h",es:"h",fr:"h",cs:"h",it:"o",pl:"g",pt:"h",ru:"ч",zh:"時"},s_m:{de:"m",es:"m",fr:"m",cs:"m",it:"m",pl:"m",pt:"m",ru:"м",zh:"分"},s_s:{de:"s",es:"s",fr:"s",cs:"s",it:"s",pl:"s",pt:"s",ru:"с",zh:"秒"},s_hour:{de:"stunde",es:"hora",fr:"heure",cs:"hodina",it:"ora",pl:"godzinę",pt:"hora",ru:"час",zh:"時"},s_minute:{de:"minute",es:"minuto",fr:"minute",cs:"minuta",it:"minuto",pl:"minuta",pt:"minuto",ru:"минута",zh:"分"},s_second:{de:"sekunde",es:"segundo",fr:"seconde",cs:"sekunda",it:"secondo",pl:"sekund",pt:"segundo",ru:"секунду",zh:"秒"},s_hours:{de:"stunden",es:"horas",fr:"heures",cs:"hodin",it:"secondi",pl:"godzin",pt:"horas",ru:"часов",zh:"時"},s_minutes:{de:"minuten",es:"minutos",fr:"minutes",cs:"minut",it:"minuti",pl:"minut",pt:"minutos",ru:"минут",zh:"分"},s_seconds:{de:"sekunden",es:"segundos",fr:"secondes",cs:"sekund",it:"ore",pl:"sekund",pt:"segundos",ru:"секунд",zh:"秒"},s_half_an_hour:{de:"eine halbe stunde",es:"media hora",fr:"demi-heure",cs:"půl hodiny",it:"mezz&apos;ora",pl:"pół godziny",pt:"meia hora",ru:"полчаса",zh:"半小時"},s_account:{de:"account",es:"cuenta",fr:"compte",cs:"účet",it:"account",pl:"konto",pt:"conta",ru:"счёт",zh:"帳戶​​"},s_key:{de:"schlüssel",es:"tecla",fr:"clé",cs:"klávesa",it:"chiave",pl:"klawisz",pt:"chave",ru:"ключ",zh:"索引鍵"},s_timers:{de:"zeitgeber",es:"temporizadores",fr:"minuteurs",cs:"časovače",it:"timer",pl:"czasomierzy",pt:"temporizadores",ru:"таймеров",zh:"計時器"},s_tools:{de:"extras",es:"herramientas",fr:"outils",cs:"nástroje",it:"strumenti",pl:"narzędzia",pt:"ferramentas",ru:"инструменты",zh:"工具"},s_help:{de:"hilfe",es:"ayuda",fr:"assistance",cs:"pomoci",it:"guida",pl:"pomoc",pt:"ajuda",ru:"помощь",zh:"輔助"},s_options:{de:"optionen",es:"opciónes",fr:"options",cs:"možnosti",it:"opzioni",pl:"opcje",pt:"opções",ru:"параметры",zh:"選項"},s_arrival:{de:"ankunft",es:"llegada",fr:"arrivée",cs:"příjezd",it:"arrivo",pl:"przyjazd",pt:"chegada",ru:"прибытие",zh:"到來"},s_world:{de:"welt",es:"mundo",fr:"monde",cs:"svět",it:"mondo",pl:"świat",pt:"mundo",ru:"босс",zh:"世界"},s_boss:{de:"boss",es:"jefe",fr:"chef",cs:"boss",it:"boss",pl:"szef",pt:"chefe",ru:"мировой",zh:"頭目"},s_event:{de:"event",es:"evento",fr:"événement",cs:"událost",it:"evento",pl:"wydarzenie",pt:"evento",ru:"собы́тие",zh:"事件"},s_section:{de:"abschnitt",es:"sección",fr:"section",cs:"oddíl",it:"sezione",pl:"sekcja",pt:"seção",ru:"раздел",zh:"節"},s_map:{de:"karte",es:"mapa",fr:"carte",cs:"mapa",it:"mappa",pl:"mapa",pt:"mapa",ru:"ка́рта",zh:"地圖"},s_center:{de:"zentrum",es:"centro",fr:"centre",cs:"střed",it:"centro",pl:"środek",pt:"centro",ru:"центр",zh:"中心"},s_completion:{de:"abschluss",es:"finalización",fr:"progression",cs:"dokončení",it:"completamento",pl:"ukończenie",pt:"progressão",ru:"завершение",zh:"完成"},s_route:{de:"route",es:"ruta",fr:"route",cs:"trasa",it:"percorso",pl:"trasa",pt:"rota",ru:"маршру́т",zh:"路線"},s_pins:{de:"stecknadel",es:"alfileres",fr:"épingles",cs:"špendlík",it:"spilli",pl:"szpilka",pt:"alfinetes",ru:"була́вка",zh:"大頭針"},s_range:{de:"reichweite",es:"alcance",fr:"portée",cs:"dosah",it:"portata",pl:"zasięg",pt:"alcance",ru:"дальность",zh:"射程"},s_lock:{de:"sperre",es:"bloqueo",fr:"verrou",cs:"zámek",it:"blocco",pl:"zablokuj",pt:"bloqueio",ru:"блокировка",zh:"鎖定"},s_Vista:{de:"Aussichtspunkt",es:"Vista",fr:"Panorama",zh:"鳥瞰點"},s_Hero_Challenge:{de:"Heldenherausforderung",es:"Desafío de héroe",fr:"Défi de héros",zh:"技能點"},s_checklist:{de:"prüfliste",es:"lista de comprobación",fr:"liste de contrôle",cs:"kontrolní seznam",it:"elenco di controllo",pl:"lista kontrolna",pt:"lista de verificação",ru:"контрольный список",zh:"檢查清單"},s_subscription:{de:"abonnement",es:"suscripción",fr:"abonnement",cs:"předplatné",it:"sottoscrizione",pl:"abonament",pt:"assinatura",ru:"подписка",zh:"訂閱"},s_alarm:{de:"alarm",es:"alarma",fr:"alarme",cs:"alarmu",it:"allarme",pl:"alarmu",pt:"alarme",ru:"будильника",zh:"鬧鐘"},s_mode:{de:"modus",es:"modo",fr:"mode",cs:"režim",it:"modalità",pl:"tryb",pt:"modo",ru:"режим",zh:"方式"},s_chatlink:{de:"chatlink",es:"vínculo chat",fr:"lien chat",cs:"chat odkaz",it:"collegamento chat",pl:"czat łącze",pt:"link bate-papo",ru:"чат связь",zh:"連結聊天"},s_wvw:{de:"WvW",es:"McM",fr:"McM",cs:"SpS",it:"McM",pl:"SkS",pt:"McM",ru:"МпМ",zh:"世界戰場"},s_stopwatch:{de:"stoppuhr",es:"cronómetro",fr:"chronomètre",cs:"stopky",it:"cronografo",pl:"stoper",pt:"cronômetro",ru:"секундомер",zh:"碼錶"},s_is:{de:"ist",es:"es",fr:"est",cs:"je",it:"è",pl:"jest",pt:"é",ru:"является",zh:"是"},s_subscribe:{de:"abonnieren",es:"subscribir",fr:"abonner",cs:"předplatit si",it:"sottoscrivere",pl:"abonować",pt:"assinar",ru:"подписаться",zh:"訂閱"},s_will_start:{de:"wird starten",es:"se iniciará",fr:"débutera",cs:"začne",it:"inizierà",pl:"rozpocznie się",pt:"começará",ru:"начнется",zh:"開始"},s_click:{de:"klicken",es:"clic",fr:"cliquer",cs:"kliknout",it:"clic",pl:"klikać",pt:"clicar",ru:"щелкнуть",zh:"按一下"},s_view:{de:"anzeigen",es:"ver",fr:"afficher",cs:"zobrazit",it:"visualizzare",pl:"wyświetlać",pt:"exibir",ru:"представление",zh:"檢視"},s_load:{de:"laden",es:"cargar",fr:"charger",cs:"načíst",it:"caricare",pl:"załaduj",pt:"carregar",ru:"загрузить",zh:"載入"},s_save:{de:"speichern",es:"guardar",fr:"enregistrer",cs:"uložit",it:"salvare",pl:"zapisać",pt:"salvar",ru:"сохранить",zh:"儲存"},s_clear:{de:"löschen",es:"borrar",fr:"effacer",cs:"vymazat",it:"cancella",pl:"wyczyść",pt:"limpar",ru:"очистить",zh:"清除"},s_toggle:{de:"umschalten",es:"alternar",fr:"basculer",cs:"přepnout",it:"alterna",pl:"przełączanie",pt:"alternar",ru:"переключить",zh:"切換"},s_expand:{de:"erweiter",es:"expandir",fr:"développer",cs:"rozbalit",it:"espandere",pl:"rozwinąć",pt:"expandir",ru:"развернуть",zh:"展開"},s_collapse:{de:"verkleiner",es:"contraer",fr:"réduire",cs:"sbalit",it:"comprimere",pl:"zwinąć",pt:"recolher",ru:"свернуть",zh:"摺疊"},s_draw:{de:"zeichnen",es:"dibujar",fr:"dessiner",cs:"kreslit",it:"disegnare",pl:"rysować",pt:"desenhar",ru:"рисова́ть",zh:"画"},s_undo:{de:"rückgängig",es:"deshacer",fr:"annuler",cs:"zpět",it:"annullare",
pl:"cofnąć",pt:"desfazer",ru:"отменить",zh:"復原"},s_optimize:{de:"optimieren",es:"optimizar",fr:"optimiser",cs:"optimalizovat",it:"ottimizzare",pl:"optymalizować",pt:"otimizar",ru:"оптимизировать",zh:"最佳化"},s_search:{de:"suchen",es:"buscar",fr:"rechercher",cs:"vyhledat",it:"cerca",pl:"wyszukaj",pt:"pesquisar",ru:"поиск",zh:"搜尋"},s_ago:{de:"vor",es:"hace",fr:"il ya",cs:"před",it:"fa",pl:"temu",pt:"há",ru:"назад",zh:"前"},s_also:{de:"auch",es:"también",fr:"aussi",cs:"také",it:"anche",pl:"też",pt:"também",ru:"то́же",zh:"也"},s_checked:{de:"abgehakt",es:"visto",fr:"coché",cs:"odškrtnout",it:"controllato",pl:"zakończony",pt:"marcado",ru:"включен",zh:"勾掉"},s_current:{de:"aktuelle",es:"actual",fr:"actuel",cs:"současný",it:"corrente",pl:"bieżący",pt:"corrente",ru:"текущий",zh:"活期"},s_daily:{de:"täglich",es:"diaria",fr:"quotidien",cs:"denní",it:"giornaliero",pl:"dzienny",pt:"diário",ru:"ежедневно",zh:"每天"},s_next:{de:"nächste",es:"siguiente",fr:"prochain",cs:"příští",it:"seguente",pl:"następny",pt:"próximo",ru:"следующий",zh:"下一"},s_off:{de:"aus",es:"desactivado",fr:"désactivé",cs:"vypnuto",it:"disattivato",pl:"wyłączany",pt:"desativado",ru:"выключено",zh:"關"},s_predicted:{de:"vorhergesagt",es:"previsto",fr:"prédit",cs:"předpovídal",it:"previsto",pl:"przewiduje",pt:"predito",ru:"предсказанный",zh:"預測"},s_subscribed:{de:"abonniert",es:"suscrito",fr:"souscrit",cs:"odebírané",it:"sottoscritti",pl:"subskrypcji",pt:"assinado",ru:"подписан",zh:"訂閱"},s_then:{de:"dann",es:"luego",fr:"puis",cs:"pak",it:"poi",pl:"potem",pt:"então",ru:"затем",zh:"接著"},s_at:{de:"um",es:"a",fr:"à",cs:"v",it:"a",pl:"o",pt:"a",ru:"в",zh:"在"},s_and:{de:"und",es:"y",fr:"et",cs:"a",it:"e",pl:"i",pt:"e",ru:"и",zh:"和"},s_if:{de:"wenn",es:"si",fr:"si",cs:"jestliže",it:"se",pl:"jeśli",pt:"se",ru:"если",zh:"如果"},s_in:{de:"in",es:"en",fr:"en",cs:"za",it:"in",pl:"w",pt:"em",ru:"в",zh:"在"},s_to:{de:"zu",es:"a",fr:"contre",cs:"ku",it:"a",pl:"na",pt:"a",ru:"до",zh:"比"},s_Scheduled_Bosses:{de:"Geplant",es:"Programado",fr:"Planifié",cs:"Plánované",it:"Pianificata",pl:"Zaplanowane",pt:"Agendado",ru:"Запланирован",zh:"已排程"},s_Dry_Top:{de:"Trockenkuppe",es:"Cima Seca",fr:"Cimesèche",zh:"干涸高地"},s_Legacy_Bosses:{de:"Legacy",es:"Heredado",fr:"Hérité",cs:"Starší",it:"Legacy",pl:"Starsze",pt:"Herdado",ru:"Устаревший",zh:"舊版"},s_Orr_Temples:{de:"Tempel",es:"Templos",fr:"Temples",cs:"Chrámy",it:"Templi",pl:"Świątynie",pt:"Templos",ru:"Храмы",zh:"寺廟"},s_Full_Timetable:{de:"Zeitplan",es:"Horario",fr:"Horaire",cs:"Plán",it:"Programma",pl:"Harmonogram",pt:"Horário",ru:"Расписание",zh:"時間表"},s_Gem_Store_Promotions:{de:"Edelsteinshop Aktionen",es:"Promociones gemas",fr:"Promotions gemmes",cs:"Drahokam Prodejna Propagace",it:"Negozio gemma promozioni",pl:"Klejnot Sklep Promocje",pt:"Loja gema promoções",ru:"Самоцве́т Магази́н Продвижения",zh:"寶石商店促銷"},s_forum:{de:"forum",es:"foro",fr:"forum",cs:"fórum",it:"forum",pl:"forum",pt:"fórum",ru:"форум",zh:"論壇"},s_simple:{de:"einfach",es:"simple",fr:"simple",cs:"prostý",it:"semplice",pl:"prosty",pt:"simples",ru:"простой",zh:"簡單"},s_mobile:{de:"mobil",es:"móvil",fr:"mobile",cs:"mobilní",it:"mobile",pl:"mobilna",pt:"móvel",ru:"мобильный",zh:"行動"},s_tile:{de:"kacheln",es:"mosaico",fr:"mosaïque",cs:"dlaždice",it:"affianca",pl:"sąsiadująco",pt:"ladrilho",ru:"замостить",zh:"磚"},s_this:{de:"dieses",es:"esto",fr:"ce",cs:"toto",it:"questo",pl:"to",pt:"isto",ru:"это",zh:"這"},s_your:{de:"dein",es:"tu",fr:"ton",cs:"tvůj",it:"tuo",pl:"twój",pt:"teu",ru:"твой",zh:"你的"},s_name:{de:"namen",es:"nombre",fr:"nom",cs:"název",it:"nome",pl:"nazwa",pt:"nome",ru:"имя",zh:"名"},s_buy:{de:"kaufen",es:"comprar",fr:"acheter",cs:"koupit",it:"comprare",pl:"kupić",pt:"comprar",ru:"купить",zh:"買"},s_sell:{de:"verkaufen",es:"vender",fr:"vendre",cs:"prodat",it:"vendere",pl:"sprzedać",pt:"vender",ru:"продать",zh:"賣"},s_quantity:{de:"anzahl",es:"cantidad",fr:"quantité",cs:"množství",it:"quantità",pl:"ilość",pt:"quantidade",ru:"количество",zh:"量"},s_profit:{de:"gewinn",es:"beneficio",fr:"profit",cs:"zisk",it:"profitto",pl:"zysk",pt:"lucro",ru:"прибыль",zh:"利潤"},s_cost:{de:"kosten",es:"costo",fr:"coût",cs:"náklady",it:"costo",pl:"koszt",pt:"custo",ru:"стоимость",zh:"成本"},s_breakpoint:{de:"gewinnschwelle",es:"punto muerto",fr:"seuil de rentabilité",cs:"bod zvratu",it:"punto di pareggio",pl:"próg rentowności",pt:"ponto de equilíbrio",ru:"точка безубыточности",zh:"收支平衡點"},s_tax:{de:"steuer",es:"impuestos",fr:"impôt",cs:"daň",it:"fiscale",pl:"podatek",pt:"fiscal",ru:"налог",zh:"稅"},s_revenue:{de:"einnahmen",es:"ingresos",fr:"revenus",cs:"příjmy",it:"entrate",pl:"dochody",pt:"receita",ru:"доходов",zh:"收入"},s_margin:{de:"gewinnspanne",es:"margen",fr:"marge",cs:"marže",it:"margine",pl:"marża",pt:"margem",ru:"валовая",zh:"邊際"},s_low:{de:"niedrigen",es:"bajo",fr:"bas",cs:"nízký",it:"bassa",pl:"niski",pt:"baixa",ru:"низкая",zh:"低"},s_high:{de:"hohen",es:"alta",fr:"haut",cs:"vysoký",it:"alta",pl:"wysoki",pt:"alta",ru:"высокая",zh:"高"},s_notify:{de:"benachrichtigen",es:"notificar",fr:"notifier",cs:"oznámit",it:"notifica",pl:"powiadom",pt:"notificar",ru:"уведомить",zh:"通知"},s_overwrite:{de:"überschreiben",es:"sobrescribir",fr:"remplacer",cs:"přepsat",it:"sovrascrivi",pl:"zastąp",pt:"substituir",ru:"перезаписать",zh:"覆寫"},s_gem:{de:"edelsteine",es:"gema",fr:"gemme",cs:"klenot",it:"gemma",pl:"klejnot",pt:"gema",ru:"самоцвет",zh:"寶石"},s_coin:{de:"münze",es:"moneda",fr:"monnaie",cs:"mince",it:"moneta",pl:"moneta",pt:"moeda",ru:"монета",zh:"硬幣"},s_dollar:{de:"dollar",es:"dólar",fr:"dollar",cs:"dolar",it:"dollaro",pl:"polar",pt:"dólar",ru:"доллар",zh:"元"}},Codex:{s_TEMPLATE:{en:"",de:"",es:"",fr:""},s_Back:{en:"Back Item",de:"Rücken-Gegenstand",es:"Objeto para espalda",fr:"Objet de dos"},s_Consumable:{en:"Consumable",de:"Verbrauchsgegenstand",es:"Consumible",fr:"Consommable"},s_Container:{en:"Container",de:"Behälter",es:"Contenedor",fr:"Conteneur"},s_CraftingMaterial:{en:"Crafting Material",de:"Handwerksmaterial",es:"Material de artesanía",fr:"Matériau d&apos;artisanat"},s_Gizmo:{en:"Gizmo",de:"Dingsbums",es:"Aparato",fr:"Machin"},s_MiniPet:{en:"Miniature",de:"Miniatur",es:"Miniatura",fr:"Miniature"},s_Nourishment:{en:"Nourishment",de:"Verbrauchsstoff",es:"Consumible",fr:"Produit consommable"},s_Boost:{en:"Boost",de:"Verstärker",es:"Potenciador",fr:"Augmentation"},s_Trophy:{en:"Trophy",de:"Trophäe",es:"Trofeo",fr:"Trophée"},s_UpgradeComponent:{en:"Upgrade Component",de:"Aufwertung",es:"Componente de mejora",fr:"Composant d&apos;amélioration"},s_Junk:{en:"Junk",de:"Schrott",es:"Basura",fr:"Inutile"},s_Basic:{en:"Basic",de:"Einfach",es:"Básico",fr:"Simple"},s_Fine:{en:"Fine",de:"Edel",es:"Selecto",fr:"Raffiné"},s_Masterwork:{en:"Masterwork",de:"Meisterwerk",es:"Obra de arte",fr:"Chef-d&apos;œuvre"},s_Rare:{en:"Rare",de:"Selten",es:"Excepcional",fr:"Rare"},s_Exotic:{en:"Exotic",de:"Exotisch",es:"Exótico",fr:"Exotique"},s_Ascended:{en:"Ascended",de:"Aufgestiegen",es:"Ascendido",fr:"Élevé"},s_Legendary:{en:"Legendary",de:"Legendär",es:"Legendario",fr:"Légendaire"},s_Light:{en:"Light",de:"Leicht",es:"Ligero",fr:"Légèr"},s_Medium:{en:"Medium",de:"Mittel",es:"Medio",fr:"Intermédiaire"},s_Heavy:{en:"Heavy",de:"Schwer",es:"Pesado",fr:"Lourd"},s_Power:{en:"Power",de:"Kraft",es:"Potencia",fr:"Puissance"},s_Toughness:{en:"Toughness",de:"Zähigkeit",es:"Dureza",fr:"Robustesse"},s_Armor:{en:"Armor",de:"Rüstung",es:"Armadura",fr:"Armure"},s_Vitality:{en:"Vitality",de:"Vitalität",es:"Vitalidad",fr:"Vitalité"},s_Health:{en:"Health",de:"Lebenspunkte",es:"Salud",fr:"Santé"},s_Precision:{en:"Precision",de:"Präzision",es:"Precisión",fr:"Précision"},s_CriticalChance:{en:"Critical Chance",de:"Kritische Trefferchance",es:"Probabilidad de daño crítico",fr:"Chance de coup critique"},s_Ferocity:{en:"Ferocity",de:"Wildheit",es:"Ferocidad",fr:"Férocité"},s_CriticalDamage:{en:"Critical Damage",de:"Kritischer Schaden",es:"Daño crítico",fr:"Dégâts critiques"},s_ConditionDamage:{en:"Condition Damage",de:"Zustandsschaden",es:"Daño de condición",fr:"Dégâts par altération"},s_HealingPower:{en:"Healing Power",de:"Heilkraft",es:"Poder de curación",fr:"Guérison"},s_Expertise:{en:"Expertise",de:"Fachkenntnis",es:"Pericia",fr:"Expertise"},s_ConditionDuration:{en:"Condition Duration",de:"Zustandsdauer",es:"Duración de condición",fr:"Durée d&apos;altération"},s_Concentration:{en:"Concentration",de:"Konzentration",es:"Concentración",fr:"Concentration"},s_BoonDuration:{en:"Boon Duration",de:"Segensdauer",es:"Duración de bendición",fr:"Durée d&apos;avantage"},s_AgonyResistance:{en:"Agony Resistance",de:"Qual-Widerstand",es:"Resistencia a la agonía",fr:"Résistance à l&apos;agonie"},s_MagicFind:{en:"Magic Find",de:"Magisches Gespür",es:"Hallazgo mágico",fr:"Découverte de magie"},s_Axe:{en:"Axe",de:"Axt",es:"Hacha",fr:"Haches"},s_Dagger:{en:"Dagger",de:"Dolch",es:"Daga",fr:"Dague"},s_Mace:{en:"Mace",de:"Streitkolben",es:"Maza",fr:"Masse"},s_Pistol:{en:"Pistol",de:"Pistole",es:"Pistola",fr:"Pistolet"},s_Scepter:{en:"Scepter",de:"Zepter",es:"Cetro",fr:"Sceptre"},s_Sword:{en:"Sword",de:"Schwert",es:"Espada",fr:"Epée"},s_Focus:{en:"Focus",de:"Fokus",es:"Foco",fr:"Focus"},s_Shield:{en:"Shield",de:"Schild",es:"Escudo",fr:"Bouclier"},s_Torch:{en:"Torch",de:"Fackel",es:"Antorcha",fr:"Torche"},s_Warhorn:{en:"Warhorn",de:"Kriegshorn",es:"Cuerno de guerra",fr:"Cor de guerre"},s_Greatsword:{en:"Greatsword",de:"Großschwert",es:"Mandoble",fr:"Espadon"},s_Hammer:{en:"Hammer",de:"Hammer",es:"Martillo",fr:"Marteau"},s_LongBow:{en:"Longbow",de:"Langbogen",es:"Arco largo",fr:"Arc long"},s_Rifle:{en:"Rifle",de:"Gewehr",es:"Rifle",fr:"Fusil"},s_ShortBow:{en:"Shortbow",de:"Kurzbogen",es:"Arco corto",fr:"Arc court"},s_Staff:{en:"Staff",de:"Stab",es:"Báculo",fr:"Bâton"},s_Harpoon:{en:"Harpoon",de:"Speer",es:"Lanza",fr:"Lance"},s_Speargun:{en:"Speargun",de:"Harpunenschleuder",es:"Cañón de arpón",fr:"Fusil-harpon"},s_Trident:{en:"Trident",de:"Dreizack",es:"Tridente",fr:"Trident"},s_HelmAquatic:{en:"Head Armor",de:"Kopf-Rüstung",es:"Armadura de cabeza",fr:"Armure : Couvre-chef"},s_Helm:{en:"Head Armor",de:"Kopf-Rüstung",es:"Armadura de cabeza",fr:"Armure : Couvre-chef"},s_Shoulders:{en:"Shoulder Armor",de:"Schulter-Rüstung",es:"Armadura de hombros",fr:"Armure : Épaulières"},s_Coat:{en:"Chest Armor",de:"Brust-Rüstung",es:"Armadura pectoral",fr:"Armure : Cuirasse"},s_Gloves:{en:"Hand Armor",de:"Hand-Rüstung",es:"Armadura de mano",fr:"Armure : Gants"},s_Leggings:{en:"Leg Armor",de:"Bein-Rüstung",es:"Armadura de pierna",fr:"Armure : Jambières"},s_Boots:{en:"Foot Armor",de:"Fuß-Rüstung",es:"Armadura de pie",fr:"Armure : Bottes"},s_Accessory:{en:"Accessory",de:"Accessoire",es:"Accesorio",fr:"Accessoire"},s_Amulet:{en:"Amulet",de:"Amulett",es:"Amuleto",fr:"Amulette"},s_Ring:{en:"Ring",de:"Ring",es:"Anillo",fr:"Anneau"},s_Defense:{en:"Defense",de:"Verteidigung",es:"Defensa",fr:"Défense"},s_WeaponStrength:{en:"Weapon Strength",de:"Waffenstärke",es:"Fuerza del arma",fr:"Puissance d&apos;arme"},s_RequiredLevel:{en:"Required Level",de:"Erforderliche Stufe",es:"Nivel necesario",fr:"Niveau requis"},s_AccountBindOnUse:{en:"Account Bound on Use",de:"Accountgebunden bei Benutzung",es:"Vinculado a cuenta en uso",fr:"Lié au compte dès l&apos;utilisation"},s_AccountBound:{en:"Account Bound",de:"Accountgebunden",es:"Vinculado a cuenta",fr:"Lié au compte"},s_SoulBindOnUse:{en:"Soulbound on Use",de:"Seelengebunden bei Benutzung",es:"Ligado en uso",fr:"Lié à l&apos;âme dès l&apos;utilisation"},s_SoulbindOnAcquire:{en:"Soulbound",de:"Seelengebunden",es:"Ligado",fr:"Lié à l&apos;âme"},s_SoulboundToCharacter:{en:"Soulbound to another character",de:"An einen anderen Charakter seelengebunden",es:"Ligado a otro personaje",fr:"Lié à l&apos;âme d&apos;un autre personnage"},s_Unique:{en:"Unique",de:"Einzigartig",es:"Equipamiento único",fr:"Unique"},s_Transmuted:{en:"Transmuted",de:"Transmutiert",es:"Transmutado",fr:"Transmuté"},s_Defense_Infusion:{en:"Unused Defensive Infusion Slot",de:"Freier Infusionsplatz (Defensiv)",es:"Casilla de infusión defensiva sin utilizar",fr:"Emplacement d&apos;infusion inutilisé (Défensive)"},s_Offense_Infusion:{en:"Unused Offensive Infusion Slot",de:"Freier Infusionsplatz (Offensiv)",es:"Casilla de infusión ofensiva sin utilizar",fr:"Emplacement d&apos;infusion inutilisé (Offensive)"},s_Utility_Infusion:{en:"Unused Utility Infusion Slot",de:"Freier Infusionsplatz (Hilfe)",es:"Casilla de infusión apoyo sin utilizar",fr:"Emplacement d&apos;infusion inutilisé (Utilitaire)"},s_Agony_Infusion:{en:"Unused Agony Infusion Slot",de:"Freier Infusionsplatz (Qual)",es:"Casilla de infusión agonía sin utilizar",fr:"Emplacement d&apos;infusion inutilisé (Agonie)"},s_UnusedUpgradeSlot:{en:"Unused Upgrade Slot",de:"Freier Aufwertungsplatz",es:"Casilla para mejoras sin utilizar",fr:"Emplacement d&apos;amélioration inutilisé"},s_DoubleClickToSelectStats:{en:"Double-click to select stats.",de:"Doppelklicken, um Werte auszuwählen.",es:"Haz doble clic para seleccionar estadísticas.",fr:"Double-cliquez pour sélectionner les statistiques."},s_DoubleClickToConsume:{en:"Double-click to consume.",de:"Zum Benutzen doppelklicken.",es:"Haz doble clic para consumir.",fr:"Double-cliquez pour utiliser."},s_ExcessiveAlcohol:{en:"Excessive alcohol consumption will result in intoxication.",de:"Übermäßiger Alkoholkonsum führt zu Rauschzuständen.",es:"El consumo excesivo de alcohol provoca embriaguez.",fr:"Consommer trop d&apos;alcool entraîne une ivresse manifeste."},s_GainBasedPercentage:{en:"Gain {1} Based on a Percentage of {0}",de:"Erhaltener prozentualer Anteil von {0} auf {1}:",es:"Ganas {1} según tu porcentaje de {0}",fr:"Vous bénéficiez d'une augmentation de {1} de {0}%."}},getString:function(e){var t=O.Options.enu_Language;D.isLanguageFullySupported()===!1&&(t=O.OptionEnum.Language.Default);var n=D.Codex["s_"+e];if(n){var i=n[t];if(i)return i}return e},addDictionary:function(e){for(var t in e)D.Dictionary[t]=e[t]},getTranslation:function(e){if(D.isLanguageDefault())return e;var t,n=e;-1!==n.indexOf(" ")&&(n=n.replace(/ /g,"_"));var i=D.Dictionary["s_"+n];return i&&(t=i[O.Options.enu_Language])?t:e},getWord:function(e){return D.isLanguageDefault()?e:D.Dictionary["s_"+e][O.Options.enu_Language]},getWordCapital:function(e){return U.toFirstUpperCase(D.getTranslation(e))},getPhrase:function(e,t){void 0===t&&(t=U.CaseEnum.None);var n=e.split(" ");if(t===U.CaseEnum.Original)for(var i in n)n[i]=D.duplicateCase(n[i],D.getTranslation(n[i].toLowerCase()));else for(var i in n)n[i]=D.getTranslation(n[i]);var a=D.isLanguageLogographic()?n.join(""):n.join(" ");return t===U.CaseEnum.None||t===U.CaseEnum.Original?a:U.toCase(a,t)},getPhraseTitle:function(e){return D.getPhrase(e,U.CaseEnum.Every)},getPhraseOriginal:function(e){return O.Options.enu_Language!==O.OptionEnum.Language.Default?D.getPhrase(e,U.CaseEnum.Original):e},getModifiedWord:function(e,t,n){return D.getPhrase(D.orderModifier(e,t),n)},orderModifier:function(e,t){return D.isLanguageModifierFirst()?t+" "+e:e+" "+t},duplicateCase:function(e,t){var n=e.charAt(0);if(n===n.toLowerCase())return t;if(e.length>2&&t.length>2){var i=e.charAt(1);if(n===n.toUpperCase()&&i===i.toUpperCase())return t.toUpperCase()}return t.charAt(0).toUpperCase()+t.slice(1)},translateElements:function(){O.Options.enu_Language!==O.OptionEnum.Language.Default&&($(".jsTranslate").each(function(){$(this).text(D.getPhraseOriginal($(this).text())).removeClass("jsTranslate")}),$(".jsTranslateCompound").each(function(){$(this).text(D.getTranslation($(this).text())).removeClass("jsTranslateCompound")}))},translateAfter:function(){O.Options.enu_Language!==O.OptionEnum.Language.Default&&($("#paneMenu kbd").each(function(){$(this).attr("title","<dfn>"+D.getPhraseOriginal($(this).find(".jsTranslate").text())+"</dfn>"),I.qTip.init($(this))}),$(".mapHUDButton").each(function(){var e=$(this).attr("title");if(void 0!==e){var t=$("<div>"+e+"</div>"),n=D.getPhraseOriginal(t.find("dfn").text());t.find("dfn").remove(),$(this).attr("title","<dfn>"+n+"</dfn>"+t.html())}}),D.translateElements()),I.qTip.init(".mapHUDButton")},isLanguageFullySupported:function(){return O.Options.enu_Language===O.OptionEnum.Language.English||O.Options.enu_Language===O.OptionEnum.Language.German||O.Options.enu_Language===O.OptionEnum.Language.Spanish||O.Options.enu_Language===O.OptionEnum.Language.French?!0:!1},isLanguageDefault:function(){return O.Options.enu_Language===O.OptionEnum.Language.Default},getFullySupportedLanguage:function(){return D.isLanguageFullySupported()?O.Options.enu_Language:O.OptionEnum.Language.Default},getPartiallySupportedLanguage:function(){return D.isLanguageFullySupported()||O.Options.enu_Language===O.OptionEnum.Language.Mandarin?O.Options.enu_Language:O.OptionEnum.Language.Default},getNameKey:function(){return"name_"+D.getFullySupportedLanguage()},getURLKey:function(){return"url_"+D.getFullySupportedLanguage()},getObjectName:function(e){return void 0!==e["name_"+O.Options.enu_Language]?e["name_"+O.Options.enu_Language]:D.getObjectDefaultName(e)},getObjectNick:function(e){return void 0!==e["nick_"+O.Options.enu_Language]?e["nick_"+O.Options.enu_Language]:D.getObjectDefaultNick(e)},getObjectDefaultName:function(e){return e["name_"+O.OptionEnum.Language.Default]},getObjectDefaultNick:function(e){return e["nick_"+O.OptionEnum.Language.Default]},getObjectURL:function(e){return e["url_"+D.getFullySupportedLanguage()]},isLanguageSecondary:function(){return O.Options.enu_Language===O.OptionEnum.Language.German||O.Options.enu_Language===O.OptionEnum.Language.Spanish||O.Options.enu_Language===O.OptionEnum.Language.French?!0:!1},isLanguageModifierFirst:function(){return O.Options.enu_Language===O.OptionEnum.Language.French||O.Options.enu_Language===O.OptionEnum.Language.Spanish||O.Options.enu_Language===O.OptionEnum.Language.Italian||O.Options.enu_Language===O.OptionEnum.Language.Portuguese||O.Options.enu_Language===O.OptionEnum.Language.Mandarin?!1:!0},isLanguageLogographic:function(){return O.Options.enu_Language===O.OptionEnum.Language.Mandarin?!0:!1},getChainTitle:function(e){return D.isLanguageDefault()?e.title:D.getObjectName(e)},getChainAlias:function(e){return D.isLanguageDefault()?e.alias:D.getChainTitle(e)},speechWait:0,speak:function(e,t){var n=(O.Options.int_setVolume/T.cPERCENT_100).toFixed(2);try{if(I.isSpeechSynthesisEnabled&&I.ModeCurrent!==I.ModeEnum.Overlay){var i=new SpeechSynthesisUtterance(e);return i.voice=window.speechSynthesis.getVoices().filter(function(e){return e.name===O.VoiceCode[O.Options.enu_Language]})[0],i.volume=n,i.rate=.8,void window.speechSynthesis.speak(i)}}catch(a){I.isSpeechSynthesisEnabled=!1}var r=function(e){var t=document.getElementById("jsTTSAudio");t.src=U.URL_API.TextToSpeech+"&vol="+n+"&t="+e,t.volume=O.Options.int_setVolume/T.cPERCENT_100,t.load(),t.play()};if(void 0===t){var o=D.isLanguageLogographic()?4:12;t=1+Math.round(e.length/o)}var s=t*T.cMSECONDS_IN_SECOND;0===D.speechWait?(D.speechWait+=s,r(e),setTimeout(function(){D.speechWait-=s},s)):(D.speechWait+=s,setTimeout(function(){D.speechWait>0&&(r(e),D.speechWait-=s)},D.speechWait-s));var c=30;D.resetSpeechQueue(c)},isSpeaking:function(){return 0===D.speechWait?!1:!0},stopSpeech:function(){I.isSpeechSynthesisEnabled?window.speechSynthesis.cancel():document.getElementById("jsTTSAudio").src=""},resetSpeechQueue:function(e){void 0===e&&(e=0),D.speechWait>e*T.cMSECONDS_IN_SECOND&&(D.speechWait=0,D.stopSpeech())},getSpeechWord:function(e,t){return t?D.getModifiedWord(e,t):D.getPhrase(e)},getSpeechInitials:function(e,t){var n=e.charAt(e.length-1);if(n===n.toLowerCase())return e;t&&(e=e.replace(/ /g,"")),e=e.toUpperCase();for(var i="",a="",r=0;r<e.length;r++)a=e.charAt(r),i+=" "===a?a:a+" ";return i},getPluralTime:function(e,t){return e>1&&(t+="s")," "+D.getWord("in")+" "+e+" "+D.getWord(t)},getChainPronunciation:function(e){return D.isLanguageDefault()||I.BrowserCurrent!==I.BrowserEnum.Chrome?C.Chains[e.nexus].pronunciation:D.getChainTitle(e)}},C={Chains:GW2T_CHAIN_DATA,ChainAssociation:{},UnscheduledChainsLength:GW2T_CHAIN_ADD_LENGTH,DryTop:{},cIndexSynonym:"nexus",ChainToday:null,ChainTomorrow:null,ChainDummy:{alias:"dummy"},CurrentChainSD:{},NextChainSD1:{},NextChainSD2:{},NextChainSD3:{},NextChainSD4:{},CurrentChainHC:{},NextChainHC1:{},NextChainHC2:{},NextChainHC3:{},NextChainHC4:{},NextChainLS1:{},NextChainLS2:{},NextChainsMS1:[],NextChainsMS2:[],CurrentChains:[],CurrentChainsSD:[],PreviousChains1:[],PreviousChains2:[],NextChains1:[],cEventTitleCharLimit:44,cEventNameWidth:320,TempleChains:[],LegacyChains:[],UnscheduledChains:[],ScheduledChains:[],RegularChains:[],MiscellaneousChains:[],DryTopChains:[],LivingStoryChains:[],ChainSeriesEnum:{Temple:0,Legacy:1,ScheduledCutoff:2,Standard:2,Hardcore:3,WorldBossCuttoff:3,Miscellaneous:4,DryTop:5,LivingStory:6},EventPrimacyEnum:{Optional:0,Normal:1,Primary:2,Boss:3},isUnscheduledChainsLoaded:!1,isDryTopGenerated:!1,isDryTopIconsShown:!1,isTimetableGenerated:!1,getChainByAlias:function(e){return C.Chains[C.ChainAssociation[e.toLowerCase()]]},getChainRegion:function(e){return e&&e.zone?M.getZoneRegion(e.zone):null},isChainToday:function(e){return C.ChainToday&&e.nexus===C.ChainToday.nexus?!0:!1},refreshChainDailyIcon:function(){for(var e=0;e<T.cNUM_TIMEFRAMES_IN_HOUR;e++)C.isChainToday(C.CurrentChainsSD[e])?K["WpChain"+e].addClass("clkWaypointDaily"):K["WpChain"+e].removeClass("clkWaypointDaily");$(".chnDaily").hide(),C.ChainToday&&$(".chnDaily_"+C.ChainToday.nexus).show(),C.updateTimetable()},isChainScheduled:function(e){return e.series>=C.ChainSeriesEnum.ScheduledCutoff?!0:!1},isChainWorldBoss:function(e){return e.series<=C.ChainSeriesEnum.WorldBossCuttoff?!0:!1},isChainRegular:function(e){return e.series===C.ChainSeriesEnum.Standard||e.series===C.ChainSeriesEnum.Hardcore||e.series===C.ChainSeriesEnum.Miscellaneous||e.series===C.ChainSeriesEnum.LivingStory?!0:!1},parseChainAlias:function(e){return-1!==e.indexOf("XXX")?e.split("XXX")[0]:e},getEventStepNumber:function(e){if(1===e.length)return e;var t,n="";for(t=0;t<e.length;t++){if(!isFinite(e.charAt(t)))return n;n+=e.charAt(t)}return n},initializeChain:function(e){var t,n,i,a="",r=D.getObjectName(e);for(t in e.events)e.events[t].step=parseInt(C.getEventStepNumber(e.events[t].num))-1;if(e.isSorted=!1,e.primaryEvents=[],e.scheduleKeys=[],void 0!==e.waypoint&&(a="<input class='chnWaypoint' type='text' value='"+e.waypoint+" "+r+"' />  ("+e.level+")<a"+U.convertExternalAnchor(U.getYouTubeLink(D.getObjectDefaultName(e)))+"><ins class='s16 s16_youtube' title='Recommended level. Click for YouTube videos.'></ins></a> "),void 0!==e.reward)for(t in e.reward)a+=e.reward[t]+"<ins class='s16 s16_"+t+"' title='"+t+"'></ins> ";$(e.htmllist).append("<div id='chnBar_"+e.nexus+"' class='chnBar'><div class='chnTitle'><img id='chnIcon_"+e.nexus+"' src='img/chain/"+C.parseChainAlias(e.alias).toLowerCase()+I.cPNG+"' /><kbd id='chnCheck_"+e.nexus+"' class='chnCheck'></kbd><h1 id='chnTitle_"+e.nexus+"'>"+r+"</h1><time id='chnTime_"+e.nexus+"' class='chnTimeFutureFar'></time><aside><img class='chnDaily chnDaily_"+e.nexus+"' src='img/ui/daily.png' /></aside></div><div id='chnDetails_"+e.nexus+"' class='chnDetails'><ol id='chnEvents_"+e.nexus+"' class='chnEvents'></ol><div class='chnDetailsExtra'>"+a+"<kbd id='chnDelete_"+e.nexus+"' title='Permanently hide this event chain (can undo in ▼ icon above).'></kbd></div></div></div>");var o=function(e,t){var n=t,i="&lt;br /&gt;",a=function(e){return"&lt;dfn&gt;"+e+"&lt;/dfn&gt;"},r="";r=e.series===C.ChainSeriesEnum.DryTop?a("Event Number: ")+n.num+i+a("Start Time: ")+n.lim+i+i+"&amp;quot;"+D.getObjectName(n).replace(/["']/g,"")+"&amp;quot;":a("Event Number: ")+n.num+i+a("If Success Go To: ")+n.sGotoNum+i+a("If Failure Go To: ")+n.fGotoNum+i+a("If Success Wait: ")+n.sInterim+i+a("If Failure Wait: ")+n.fInterim+i+a("Time Limit: ")+n.lim+i+a("Avg to Complete: ")+n.avg+i+a("Min to Complete: ")+n.min+i+a("Max to Complete: ")+n.max+i+i+"&amp;quot;"+D.getObjectName(n).replace(/["']/g,"")+"&amp;quot;";var o="",s=C.cEventTitleCharLimit,c=function(){o="chnSubstep",s=C.cEventTitleCharLimit-4},l=C.getEventStepNumber(n.num);if(l.length!==n.num.length){var u=n.num.slice(l.length);-1!==n.num.indexOf(".")?c():2===n.num.length?-1===u.indexOf("A")&&-1===u.indexOf("a")&&c():-1===u.indexOf("A1")&&-1===u.indexOf("a1")&&c()}$("#chnEvents_"+e.nexus).append("<li id='chnEvent_"+e.nexus+"_"+n.num+"' class='chnStep_"+e.nexus+"_"+n.step+" "+o+"'><ins class='evt_"+n.icon+"' title='"+r+"'></ins><span>"+U.truncateString(D.getObjectName(n),s,"..")+"</span></li>")};for(t in e.events)if(i=e.events[t],i.primacy===C.EventPrimacyEnum.Primary)e.primaryEvents.push(i);else if(i.primacy===C.EventPrimacyEnum.Boss){e.primaryEvents.push(i),e.primaryEvents[0].minSum=0,e.primaryEvents[0].avgSum=0,e.primaryEvents[0].minavgSum=0;break}for(t=1;t<e.primaryEvents.length;t++){var s=T.parseEventTime(e.primaryEvents[t-1].sInterim[0]);e.primaryEvents[t].minSum=T.parseEventTime(e.primaryEvents[t-1].min)+s+e.primaryEvents[t-1].minSum,e.primaryEvents[t].avgSum=T.parseEventTime(e.primaryEvents[t-1].avg)+s+e.primaryEvents[t-1].avgSum,e.primaryEvents[t].minavgSum=e.primaryEvents[t].minSum+~~(Math.abs(e.primaryEvents[t].avgSum-e.primaryEvents[t].minSum)/2)}if(t--,e.minFinish=e.primaryEvents[t].minSum+T.parseEventTime(e.primaryEvents[t].min),e.avgFinish=e.primaryEvents[t].avgSum+T.parseEventTime(e.primaryEvents[t].avg),e.minavgFinish=e.minFinish+~~(Math.abs(e.avgFinish-e.minFinish)/2),n=0,C.isChainScheduled(e)){for(t in e.events)if(e.events[t].primacy!==C.EventPrimacyEnum.Optional&&(C.getEventStepNumber(e.events[t].num)!==C.getEventStepNumber(e.primaryEvents[n].num)&&n++,o(e,e.events[t])),e.events[t].primacy===C.EventPrimacyEnum.Boss)break}else for(t in e.events)o(e,e.events[t]);I.ModeCurrent!==I.ModeEnum.Tile&&($("#chnTitle_"+e.nexus).click(function(){$(this).parent().next().slideToggle(100)}),$("#chnDetails_"+e.nexus).hide()),D.isLanguageDefault()&&I.isMapEnabled&&$("#chnBar_"+e.nexus).hover(function(){$("#chnTitle_"+e.nexus).text(D.getChainTitle(e))},function(){$("#chnTitle_"+e.nexus).text(D.getObjectName(e))}),$("#chnDetails_"+e.nexus+" .chnWaypoint").click(function(){$(this).select()}),I.qTip.init($("#chnDetails_"+e.nexus+" ins")),I.qTip.init($("#chnDetails_"+e.nexus+" kbd")),X.initializeChainChecklist(e)},initializeScheduledChains:function(){for(var e,t=C.Chains.length,n=0;t>n;n++){switch(e=C.Chains[n],e.nexus=n,C.ChainAssociation[e.alias.toLowerCase()]=e.nexus,e.series){case C.ChainSeriesEnum.Standard:e.htmllist="#sectionChains_Scheduled",C.RegularChains.push(e),C.ScheduledChains.push(e);break;case C.ChainSeriesEnum.Hardcore:e.htmllist="#sectionChains_Scheduled",C.RegularChains.push(e),C.ScheduledChains.push(e);break;case C.ChainSeriesEnum.DryTop:e.htmllist="#sectionChains_Drytop",C.DryTopChains.push(e),C.ScheduledChains.push(e);break;case C.ChainSeriesEnum.Miscellaneous:e.htmllist="#sectionChains_Scheduled",C.MiscellaneousChains.push(e),C.ScheduledChains.push(e);break;case C.ChainSeriesEnum.LivingStory:if(!B.isStoryEnabled)continue;e.htmllist=I.isProgramEmbedded||I.ModeCurrent!==I.ModeEnum.Website&&I.ModeCurrent!==I.ModeEnum.Overlay?"#sectionChains_Scheduled":"#dsbStory",C.LivingStoryChains.push(e),C.ScheduledChains.push(e),T.insertChainToSchedule(e)}C.initializeChain(e)}},initializeUnscheduledChains:function(){C.isUnscheduledChainsLoaded===!1&&$.getScript(U.URL_DATA.Unscheduled).done(function(){if(!C.isUnscheduledChainsLoaded){for(var e=GW2T_CHAIN_UNSCHEDULED,t=C.Chains.length,n=0;n<e.length;n++)C.Chains.push(e[n]);for(var i,a=C.Chains.length,n=t;a>n;n++){switch(i=C.Chains[n],i.nexus=n,i.series){case C.ChainSeriesEnum.Temple:i.htmllist="#sectionChains_Temple",C.TempleChains.push(i),C.UnscheduledChains.push(i);break;case C.ChainSeriesEnum.Legacy:i.htmllist="#sectionChains_Legacy",C.LegacyChains.push(i),C.UnscheduledChains.push(i)}C.initializeChain(i),P.drawChainPaths(i)}C.isUnscheduledChainsLoaded=!0}})},isChainCurrent:function(e){for(var t in C.CurrentChains)if(e.nexus===C.CurrentChains[t].nexus)return!0;return!1},isChainUnchecked:function(e){return X.getChainChecklistState(e)===X.ChecklistEnum.Unchecked?!0:!1},isChainSubscribed:function(e){return X.getChecklistItem(X.Checklists.ChainSubscription,e.nexus)===X.ChecklistEnum.Checked?!0:!1},updateChainsTimeHTML:function(){var e,t,n,i,a="<dfn>"+D.getPhraseTitle("click to <br/> subscribe")+"</dfn><br />";for(e in C.ScheduledChains){t=C.ScheduledChains[e];var r,o="";if(t.series!==C.ChainSeriesEnum.DryTop){for(var s in t.scheduleKeys)r=0===parseInt(s)?a:" <br /> ",o=o+r+T.getTimeFormatted({aWantSeconds:!1,aCustomTimeInSeconds:T.convertScheduleKeyToLocalSeconds(t.scheduleKeys[s])});$("#chnTime_"+t.nexus).prop("title",o)}C.isChainCurrent(t)||(n=T.getTimeFormatted({aWantLetters:!0,aWantSeconds:!1,aCustomTimeInSeconds:T.getSecondsUntilChainStarts(t)}),i=T.getTimeFormatted({aWantLetters:!1,aWantSeconds:!1,aCustomTimeInSeconds:T.convertScheduleKeyToLocalSeconds(t.scheduleKeys[0])}),$("#chnTime_"+t.nexus).html(n+"<br /><sup>"+i+"</sup>"))}I.qTip.init(".chnTitle time")},updateCurrentChainTimeHTML:function(e){var t=T.getCurrentTimeframeElapsedTime(),n=e.countdownToFinish-t,i=n,a=I.Symbol.ArrowUp+" ";if(e.series===C.ChainSeriesEnum.DryTop&&C.isDryTopGenerated){var r=T.getDryTopMinute(),o=T.getDryTopMinute(1);i=T.getTimeFormatted({aReference:T.ReferenceEnum.UTC,aWant24:!0,aWantHours:!1}),$("#chnTime_"+e.nexus).text("(:"+r+") "+i),C.isDryTopIconsShown&&$("#mapDryTopTimer").html("<var style='color:"+T.getCurrentDryTopColor()+"'>:"+r+"</var> "+i+" <var style='color:"+T.getCurrentDryTopColor(1)+"'>:"+o+"</var>")}else 0>=n&&(i=T.cSECONDS_IN_TIMEFRAME-t,a=I.Symbol.ArrowDown+" "),$("#chnTime_"+e.nexus).text(a+T.getTimeFormatted({aWantLetters:!0,aCustomTimeInSeconds:i}))},initializeTimetableHTML:function(){if(C.isTimetableGenerated!==!1){$("#sectionChains_Timetable").empty();var e,t,n,i,a;for(e in T.Schedule){n=T.getScheduleSlotChainsByKey(e);for(t in n){if(i=n[t],i.series!==C.ChainSeriesEnum.Standard&&i.series!==C.ChainSeriesEnum.Hardcore&&i.series!==C.ChainSeriesEnum.Miscellaneous)break;a=T.getTimeFormatted({aWantSeconds:!1,aCustomTimeInSeconds:T.convertScheduleKeyToLocalSeconds(e)}),$("#sectionChains_Timetable").append("<div class='chnSlot chnSlotTime_"+e+" chnSlot_"+i.nexus+"' data-"+C.cIndexSynonym+"='"+i.nexus+"' data-timeframe='"+e+"'><div class='chnTitle'><img src='img/chain/"+C.parseChainAlias(i.alias).toLowerCase()+I.cPNG+"' /><kbd class='chnCheck'></kbd><h1>"+D.getObjectName(i)+"</h1><time>"+a+"</time><aside><img class='chnDaily chnDaily_"+i.nexus+"' src='img/ui/daily.png' /></aside></div></div>")}}for(var e in C.RegularChains){i=C.RegularChains[e];var r=$(".chnSlot_"+i.nexus),o=r.find(".chnCheck"),s=r.find("time");X.reapplyChainBarState(i.nexus,r,o,s)}$(".chnTitle h1").hover(function(){$(".chnSlot_"+$(this).parent().parent().data(C.cIndexSynonym)).addClass("chnBarHover")},function(){$(".chnSlot").removeClass("chnBarHover")}),$(".chnSlot .chnCheck").click(function(){$("#chnCheck_"+C.Chains[$(this).parent().parent().data(C.cIndexSynonym)].nexus).trigger("click")}),$(".chnSlot time").click(function(){$("#chnTime_"+C.Chains[$(this).parent().parent().data(C.cIndexSynonym)].nexus).trigger("click")}),$(".chnSlotTime_0").addClass("chnBarReset"),C.refreshChainDailyIcon()}},updateTimetable:function(){if(C.isTimetableGenerated!==!1){var e=T.getTimeframeKey(-1),t=T.getTimeframeKey(),n=T.getTimeframeKey(1);$(".chnSlotTime_"+e).removeClass("chnBarCurrent"),$(".chnSlotTime_"+t).addClass("chnBarCurrent"),$(".chnSlotTime_"+e+" .chnTitle h1").removeClass("chnTitleCurrent"),$(".chnSlotTime_"+t+" .chnTitle h1").removeClass("chnTitleFuture").addClass("chnTitleCurrent"),$(".chnSlotTime_"+n+" .chnTitle h1").addClass("chnTitleFuture");var i=T.getCurrentTimeframe();$(".chnSlot").each(function(){return T.convertScheduleKeyToUTCMinutes($(this).data("timeframe"))<i?void $(this).appendTo("#sectionChains_Timetable"):!1}),C.ChainToday&&$("#sectionChains_Timetable .chnDaily_"+C.ChainToday.nexus).each(function(){T.convertScheduleKeyToUTCMinutes($(this).closest(".chnSlot").data("timeframe"))<i&&$(this).hide();
})}},sortChainsListHTML:function(){for(var e,t,n=0,i=C.ScheduledChains.length,a=0,r=0;i>n;){e=T.getTimeframeChains(a);for(r in e){if(n>=i)break;t=e[r],t.isSorted===!1&&($("#chnBar_"+t.nexus).appendTo(t.htmllist),t.isSorted=!0,t.scheduleKeyImmediate=T.getTimeframeKey(a),n++)}a++}for(a in C.ScheduledChains){t=C.ScheduledChains[a],t.isSorted=!1;for(r in t.scheduleKeys)if(t.scheduleKeys[r]===t.scheduleKeyImmediate){t.scheduleKeys=t.scheduleKeys.slice(r,t.scheduleKeys.length).concat(t.scheduleKeys.slice(0,r));break}}C.updateChainsTimeHTML();for(a in C.CurrentChains)t=C.CurrentChains[a],$("#chnBar_"+t.nexus).addClass("chnBarCurrent"),C.isChainUnchecked(t)&&O.Options.bol_expandWB&&I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+t.nexus).show("fast",function(){I.updateScrollbar()}),$("#chnBar_"+t.nexus+" h1").first().removeClass("chnTitleFuture chnTitleFutureFar").addClass("chnTitleCurrent"),$("#chnBar_"+t.nexus+" time").first().removeClass("chnTimeFuture chnTimeFutureFar").addClass("chnTimeCurrent");for(a in C.PreviousChains1)t=C.PreviousChains1[a],$("#chnBar_"+t.nexus).removeClass("chnBarCurrent").addClass("chnBarPrevious"),O.Options.bol_collapseChains&&I.ModeCurrent!==I.ModeEnum.Tile&&$("#chnDetails_"+t.nexus).hide(),$("#chnBar_"+t.nexus+" h1").first().removeClass("chnTitleCurrent").addClass("chnTitleFutureFar"),$("#chnBar_"+t.nexus+" time").first().removeClass("chnTimeCurrent").addClass("chnTimeFutureFar");for(a in C.PreviousChains2)t=C.PreviousChains2[a],$("#chnBar_"+t.nexus).removeClass("chnBarPrevious");for(a in C.NextChains1)t=C.NextChains1[a],$("#chnBar_"+t.nexus+" h1").first().removeClass("chnTitleFutureFar").addClass("chnTitleFuture"),$("#chnBar_"+t.nexus+" time").first().removeClass("chnTimeFutureFar").addClass("chnTimeFuture")},queueEventsHighlight:function(e){var t,n,i=e,a=T.getCurrentTimeframeElapsedTime(),r=!1;if(a>0){for(t in i.primaryEvents)if(n=C.getSumBasedOnOptions(i,t),n>=a&&t>0){C.highlightEvents(i,parseInt(t-1)),r=!0;break}r===!1&&(n=C.getSumBasedOnOptions(i,-1),n>=a?C.highlightEvents(i,t):C.highlightEvents(i,-1))}for(t in i.primaryEvents)n=C.getSumBasedOnOptions(i,t),n>=a&&(n-=a,setTimeout(function(e,t){return function(){C.highlightEvents(e,t)}}(i,parseInt(t)),n*T.cMSECONDS_IN_SECOND));n=C.getSumBasedOnOptions(i,-1),n>=a&&(n-=a,setTimeout(function(e){return function(){C.highlightEvents(e,-1)}}(i),n*T.cMSECONDS_IN_SECOND))},highlightEvents:function(e,t){var n,i,a=500,r=C.cEventNameWidth,o=e.primaryEvents.length-1,s=C.isChainRegular(e);if(e.series===C.ChainSeriesEnum.DryTop&&C.isDryTopGenerated&&(P.LayerArray.DryTopActive=null,P.LayerArray.DryTopActive=[],C.isDryTopIconsShown))for(n in e.events)i=e.events[n],M.toggleLayer(i.eventicon,!1),M.toggleLayer(i.eventring,!1);if(t>-1){for(e.CurrentPrimaryEvent=e.primaryEvents[t],n=0;t>n;n++)$(".chnStep_"+e.nexus+"_"+n).removeClass("chnEventCurrent");if($(".chnStep_"+e.nexus+"_"+(t-1)).css({opacity:1}).animate({opacity:.5},a,function(){e.series===C.ChainSeriesEnum.DryTop&&$(this).hide()}),$(".chnStep_"+e.nexus+"_"+t).each(function(){$(this).removeClass("chnEventFuture").addClass("chnEventCurrent").show().css({width:0,opacity:.5}).animate({width:r,opacity:1},a).css({width:"auto"}),e.series===C.ChainSeriesEnum.DryTop&&C.isDryTopGenerated&&(i=e.events[$(this).attr("data-eventindex")],I.isMapEnabled&&(P.LayerArray.DryTopActive.push(i.eventicon),P.LayerArray.DryTopActive.push(i.eventring),C.isDryTopIconsShown&&M.toggleLayerArray(P.LayerArray.DryTopActive,!0)))}),t<e.primaryEvents.length)for(n=t+1;n<e.primaryEvents.length;n++)$(".chnStep_"+e.nexus+"_"+n).show().removeClass("chnEventCurrent").addClass("chnEventFuture");O.Options.bol_tourPrediction&&I.ModeCurrent!==I.ModeEnum.Overlay&&I.PageCurrent===I.PageEnum.Chains&&M.isMapAJAXDone&&C.isChainUnchecked(e)&&s&&C.isDryTopIconsShown===!1&&$("#chnEvent_"+e.nexus+"_"+e.CurrentPrimaryEvent.num).trigger("click"),t===o&&O.Options.bol_alertArrival&&s&&(O.Options.int_setAlarm===O.IntEnum.Alarm.Checklist&&C.isChainUnchecked(e)||O.Options.int_setAlarm===O.IntEnum.Alarm.Subscription&&C.isChainSubscribed(e)&&C.isChainUnchecked(e))&&D.speak(D.getChainPronunciation(e)+" "+D.getSpeechWord("arrival predicted"))}else{if(e.CurrentPrimaryEvent=e.primaryEvents[o],$("#chnEvents_"+e.nexus+" li").show().removeClass("chnEventCurrent"),$(".chnStep_"+e.nexus+"_"+o).css({opacity:1}).animate({opacity:.5},a),O.Options.int_setAlarm===O.IntEnum.Alarm.Checklist&&O.Options.bol_alertAtEnd&&I.isProgramLoaded&&e.nexus===C.CurrentChainSD.nexus&&s){var c=", "+D.getSpeechWord("checked"),l="",u="",d=O.objToBool(C.NextChainSD1),p=O.objToBool(C.NextChainHC1),h=D.getSpeechWord("next "+D.orderModifier("boss","world")+" is")+" ";C.NextChainSD1&&!C.isChainUnchecked(C.NextChainSD1)&&(l=c),C.NextChainHC1&&!C.isChainUnchecked(C.NextChainHC1)&&(u=c),O.Options.bol_alertChecked===!1&&(l.length>0&&(d=!1),u.length>0&&(p=!1)),d&&p?(D.speak(h+D.getChainPronunciation(C.NextChainSD1)+l,5),D.speak(D.getSpeechWord("also")+", "+D.getChainPronunciation(C.NextChainHC1)+u,3)):d?D.speak(h+D.getChainPronunciation(C.NextChainSD1)+l,5):p&&D.speak(h+D.getChainPronunciation(C.NextChainHC1)+u,5),(d||p)&&D.speak(T.getTimeTillChainFormatted(C.NextChainSD1,"speech"),3)}O.Options.int_setAlarm===O.IntEnum.Alarm.Subscription&&O.Options.bol_alertUnsubscribe&&I.isProgramLoaded&&C.isChainWorldBoss(e)&&C.isChainSubscribed(e)&&$("#chnTime_"+e.nexus).trigger("click")}},getSumBasedOnOptions:function(e,t){if(C.isChainToday(e))return t>-1?e.primaryEvents[t].minSum:(e.countdownToFinish=e.minFinish,e.minFinish);var n=T.getTimeSinceMidnight(T.ReferenceEnum.Local,T.UnitEnum.Hours);if(t>-1){switch(O.Options.int_setPredictor){case O.IntEnum.Predictor.Auto:if(n>=12&&18>n)return e.primaryEvents[t].minSum;if(n>=18)return e.primaryEvents[t].minavgSum;if(n>=0&&6>n)return e.primaryEvents[t].avgSum;if(n>=6&&12>n)return e.primaryEvents[t].minavgSum;break;case O.IntEnum.Predictor.Min:return e.primaryEvents[t].minSum;case O.IntEnum.Predictor.MinAvg:return e.primaryEvents[t].minavgSum;case O.IntEnum.Predictor.Avg:return e.primaryEvents[t].avgSum}return e.primaryEvents[t].minavgSum}switch(O.Options.int_setPredictor){case O.IntEnum.Predictor.Auto:if(n>=12&&18>n)return e.countdownToFinish=e.minFinish,e.minFinish;if(n>=18)return e.countdownToFinish=e.minavgFinish,e.minavgFinish;if(n>=0&&6>n)return e.countdownToFinish=e.avgFinish,e.avgFinish;if(n>=6&&12>n)return e.countdownToFinish=e.minavgFinish,e.minavgFinish;break;case O.IntEnum.Predictor.Min:return e.countdownToFinish=e.minFinish,e.minFinish;case O.IntEnum.Predictor.MinAvg:return e.countdownToFinish=e.minavgFinish,e.minavgFinish;case O.IntEnum.Predictor.Avg:return e.countdownToFinish=e.avgFinish,e.avgFinish}return e.countdownToFinish=e.minavgFinish,e.minavgFinish}},M={MapEnum:"map",OptionSuffix:"",Zones:GW2T_ZONE_DATA,ZoneAssociation:GW2T_ZONE_ASSOCIATION,Regions:GW2T_REGION_DATA,Submaps:GW2T_SUBMAP_DATA,Weapons:GW2T_RANGE_DATA,cInitialZone:"lion",Map:{},Floors:[],ZoneCurrent:{},numPins:0,cICON_SIZE_STANDARD:32,cRING_SIZE_MAX:256,isMapInitialized:!1,isFloorShown:!0,isMouseOnHUD:!1,isUserDragging:!1,isZoneLocked:!1,isMapAJAXDone:!1,isAPIRetrieved_MAPFLOOR:!1,isItineraryRetrieved:!1,isMappingIconsGenerated:!1,isEventIconsGenerated:!1,ContextLatLng:null,cMAP_NUMFLOORS:4,cMAP_BOUND:32768,cMAP_CENTER:[16384,16384],cMAP_CENTER_INITIAL:[-1024,1024],cMAP_MOUSEMOVE_RATE:100,cInertiaThreshold:100,cZoomFactor:2,ZoomEnum:{Adaptive:-2,Same:-1,Min:0,Overview:3,Default:3,Space:3,Sky:5,Bird:6,Ground:7,Max:7},cZIndexRaise:999999,cZIndexBury:-999999,cCIRCLE_RIGHT_DEGREE:90,cCIRCLE_HALF_DEGREE:180,cCIRCLE_FULL_DEGREE:360,cRADIAN_TO_DEGREE:180/Math.PI,cUNITS_TO_POINTS:1/24,cPOINTS_TO_UNITS:24,cUNITS_TO_METERS:.0254,cMETERS_TO_UNITS:1/.0254,cUNITS_PER_SECOND:386,GPSPreviousZoneID:"",GPSPreviousCoord:[],GPSPreviousAngleCharacter:0,GPSPreviousAngleCamera:0,Layer:{Overview:new L.layerGroup,Pin:new L.layerGroup,PersonalPin:new L.layerGroup,PersonalPath:new L.layerGroup,WeaponIcon:new L.layerGroup,WeaponCircle:new L.layerGroup},Pin:{Program:{},Event:{},Over:{},Character:{},Camera:{}},MappingEnum:{Sector:0,Waypoint:1,Landmark:2,Vista:3,Challenge:4,Heart:5,EventIcon:6,EventRing:7},APIPOIEnum:{Sector:"sectors",Waypoint:"waypoint",Landmark:"landmark",Vista:"vista",Challenge:"skill_challenges",Heart:"tasks"},initializeMap:function(){var e=this,t="#"+this.MapEnum,n=O.Options["int_setInitialZoom"+P.SuffixCurrent];this.Map=L.map(this.MapEnum+"Pane",{minZoom:this.ZoomEnum.Min,maxZoom:this.ZoomEnum.Max,inertiaThreshold:this.cInertiaThreshold,doubleClickZoom:!1,touchZoom:!1,zoomControl:I.isTouchEnabled,attributionControl:!1,crs:L.CRS.Simple}).setView(this.cMAP_CENTER_INITIAL,n),this.Map.touchZoom.disable(),this.Map.tap&&this.Map.tap.disable();var i;for(var a in this.Zones)i=this.Zones[a],i.center=this.computeZoneCenter(a),i.nick=a,i.Layers={Path:new L.layerGroup,Waypoint:new L.layerGroup,Landmark:new L.layerGroup,Vista:new L.layerGroup,Challenge:new L.layerGroup,Heart:new L.layerGroup,Sector:new L.layerGroup,EventIcon:new L.layerGroup,EventRing:new L.layerGroup},e.MapEnum===P.MapEnum.Tyria&&P.LayerArray.ChainPath.push(i.Layers.Path);this.ZoneCurrent=this.Zones[this.cInitialZone];var r;switch(this.MapEnum){case P.MapEnum.Tyria:r=1,this.createPins(),P.populateMap(M),P.drawZoneBorders(),P.drawZoneGateways(),C.ScheduledChains.forEach(P.drawChainPaths);break;case P.MapEnum.Mists:r=2,L.tileLayer(U.URL_API.TilesMists,{continuousWorld:!0}).addTo(W.Map),this.createPins(),P.populateMap(W)}for(var a=0;a<this.cMAP_NUMFLOORS;a++)this.Floors.push(L.tileLayer("https://tiles.guildwars2.com/"+r+"/"+a+"/{z}/{x}/{y}.jpg",{continuousWorld:!0}));I.isTouchEnabled||this.bindMapClicks(),$(t+"CoordinatesCopy").onEnterKey(function(){var t=$(this).val();U.interpretCommand(t,e,e.ZoomEnum.Ground,e.Pin.Program)}),$(t+"GPSButton").click(function(){P.updateCharacter(1)}).dblclick(function(){e.Map.getZoom()!==e.ZoomEnum.Ground?e.Map.setZoom(e.ZoomEnum.Ground):e.Map.setZoom(e.ZoomEnum.Default)}),$(t+"DisplayButton").click(function(){I.isTouchEnabled===!1&&$("#opt_bol_showPanel").trigger("click")}),$(t+"ExpandButton").click(function(){$("#opt_bol_showPanel").trigger("click")}),$(t+"CompassButton").one("mouseenter",e.bindZoneList(e)).click(function(){e.goToDefault()}).dblclick(function(){e.Map.setZoom(e.Map.getZoom()-1)}),this.isMapInitialized=!0},createPins:function(){if(I.isMapEnabled){var e=this;this.Pin.Program=this.createPin("img/map/pin_blue.png"),this.Pin.Event=this.createPin("img/map/pin_green.png"),this.Pin.Over=this.createPin("img/map/pin_over.png",[128,128]),this.Pin.Character=this.createPin("img/map/pin_character.png",[40,40]),this.Pin.Camera=this.createPin("img/map/pin_camera.png",[256,256],{clickable:!1}),this.Layer.Pin.eachLayer(function(t){e.bindMarkerCoordBehavior(t,"click"),e.bindMarkerZoomBehavior(t,"contextmenu"),t.on("dblclick",function(){e.movePin(this)})}),this.Pin.Character.on("contextmenu",function(){e.movePin(this),e.movePin(e.Pin.Camera)}),this.toggleLayer(this.Layer.Pin,!1)}},bindMapClicks:function(){var e=this,t="#"+e.MapEnum;switch(this.toggleCoordinatesBar(),$(t+"CoordinatesToggle").click(function(){$("#opt_bol_showCoordinatesBar").trigger("click")}),this.Map.on("click",function(t){if(!e.isMouseOnHUD){var n=e.convertLCtoGC(t.latlng);e.outputCoordinatesCopy(P.formatCoord(n))}}),this.Map.on("dblclick",function(t){e.isMouseOnHUD||(e.saveBackupPins(),e.createPersonalPin(t.latlng,!0,!0))}),this.Map.on("contextmenu",function(n){e.ContextLatLng=n.latlng,$(t+"Context").css({top:I.posY,left:I.posX}).show()}),$(t+"Context").click(function(){$(this).hide()}),$(t+"ContextCenter").click(function(){e.goToDefault()}),$(t+"ContextRange").one("mouseenter",function(){e.initializeWeaponPlacer(e)}),$(t+"ContextPins").one("mouseenter",function(){e.initializePinStorage(e)}),$(t+"ContextUndoPins").click(function(){e.loadBackupPins()}),$(t+"ContextClearPins").click(function(){e.clearPersonalPins()}),$(t+"ContextChatlinkPins").click(function(){e.isPersonalPinsLaid()&&P.printClosestWaypoints()}),$(t+"ContextOptimizePins").click(function(){e.isPersonalPinsLaid()&&e.optimizePersonalPath()}),$(t+"ContextToggleFloor").click(function(){e.toggleFloor()}),$(t+"ContextToggleLock").click(function(){e.toggleZoneLock()}),$(t+"ContextToggleCompletion").click(function(){$("#opt_bol_showWorldCompletion"+e.OptionSuffix).trigger("click")}),e.MapEnum){case P.MapEnum.Tyria:$(t+"ContextToggleHUD").click(function(){$(t+"HUDBoxes").toggle()}),$(t+"ContextDrawCompletion").click(function(){P.drawCompletionRoute()});break;case P.MapEnum.Mists:}},toggleCoordinatesBar:function(){$(".mapCoordinatesBar input").toggle(O.Options.bol_showCoordinatesBar)},outputCoordinatesCopy:function(e){var t="#"+this.MapEnum;$(t+"CoordinatesCopy").val(e).select()},outputCoordinatesName:function(e){var t="#"+this.MapEnum;$(t+"CoordinatesName").val(e)},bindMapVisualChanges:function(){var e=this,t="#"+e.MapEnum;$(t+"HUDPane").hover(function(){e.isMouseOnHUD=!0},function(){e.isMouseOnHUD=!1}),$(t+"Context").hover(function(){e.isMouseOnHUD=!0},function(){e.isMouseOnHUD=!1}),this.Map.on("dragstart",function(){e.isUserDragging=!0}),this.Map.on("dragend",function(){e.isUserDragging=!1}),this.Map.on("mousemove",$.throttle(e.cMAP_MOUSEMOVE_RATE,function(t){e.isMouseOnHUD||e.isUserDragging||e.showCurrentZone(e.convertLCtoGC(t.latlng))})),this.Map.on("zoomend",function(t){e.adjustZoomMapping(),e.MapEnum===P.MapEnum.Tyria&&P.adjustZoomDryTop()})},changeFloor:function(e){for(var t=0;t<this.Floors.length;t++)this.Map.removeLayer(this.Floors[t]);this.Floors[e].addTo(this.Map)},toggleFloor:function(){var e="#"+this.MapEnum,t=$(e+"Pane");if(this.isFloorShown=!this.isFloorShown,t.toggleClass("mapPaneBackground",this.isFloorShown),this.isFloorShown)M.changeFloor(O.Options.int_setFloor);else for(var n=0;n<this.Floors.length;n++)this.Map.removeLayer(this.Floors[n])},toggleZoneLock:function(){this.isZoneLocked=!this.isZoneLocked,this.isZoneLocked?I.write("Map locked to zone: "+D.getObjectName(this.ZoneCurrent)):I.write("Map zoning unlocked.")},refreshMap:function(){this.isMapInitialized&&(this.Map.invalidateSize(),this.refreshView())},isZoneValid:function(e){return void 0===this.ZoneAssociation[e]?!1:!0},getZoneFromID:function(e){return this.Zones[this.ZoneAssociation[e]]},getZoneName:function(e){var t;if("string"==typeof e&&this.Zones[e])t=this.Zones[e];else{if("object"!=typeof e)return"nozonename";t=e}return D.getObjectName(t)},getZoneNick:function(e){return this.ZoneAssociation[e.id]},getZoneRegion:function(e){var t=this.Zones[e.toLowerCase()];return t?t.region:null},getZoneFromCoord:function(e){for(var t in this.Zones)if(e[0]>=this.Zones[t].continent_rect[0][0]&&e[1]>=this.Zones[t].continent_rect[0][1]&&e[0]<=this.Zones[t].continent_rect[1][0]&&e[1]<=this.Zones[t].continent_rect[1][1])return this.Zones[t];return null},showCurrentZone:function(e){var t=this,n=t.MapEnum;if(document.getElementById(n+"CoordinatesMouse").value=e[0]+", "+e[1],!(e[0]>=this.ZoneCurrent.continent_rect[0][0]&&e[1]>=this.ZoneCurrent.continent_rect[0][1]&&e[0]<=this.ZoneCurrent.continent_rect[1][0]&&e[1]<=this.ZoneCurrent.continent_rect[1][1]||this.isZoneLocked===!0)){var i,a="",r=this.getZoneFromCoord(e);if(null!==r){i=this.Zones[this.ZoneCurrent.nick];for(var o in i.Layers)this.Map.removeLayer(i.Layers[o]);switch(this.ZoneCurrent=r,a=this.getZoneName(this.ZoneCurrent),document.getElementById(n+"CoordinatesName").value=a,t.MapEnum){case P.MapEnum.Tyria:O.Options.bol_showChainPaths&&I.PageCurrent!==I.PageEnum.Map&&this.ZoneCurrent.Layers.Path.addTo(this.Map),O.Options.bol_displayWaypoints&&this.ZoneCurrent.Layers.Waypoint.addTo(this.Map),O.Options.bol_displayPOIs&&this.ZoneCurrent.Layers.Landmark.addTo(this.Map),O.Options.bol_displayVistas&&this.ZoneCurrent.Layers.Vista.addTo(this.Map),O.Options.bol_displayChallenges&&this.ZoneCurrent.Layers.Challenge.addTo(this.Map),O.Options.bol_displayHearts&&this.ZoneCurrent.Layers.Heart.addTo(this.Map),O.Options.bol_displaySectors&&this.ZoneCurrent.Layers.Sector.addTo(this.Map),O.Options.bol_displayEvents&&(this.ZoneCurrent.Layers.EventIcon.addTo(this.Map),this.ZoneCurrent.Layers.EventRing.addTo(this.Map));break;case P.MapEnum.Mists:O.Options.bol_displayWaypointsWvW&&this.ZoneCurrent.Layers.Waypoint.addTo(this.Map),O.Options.bol_displayPOIsWvW&&this.ZoneCurrent.Layers.Landmark.addTo(this.Map),O.Options.bol_displayVistasWvW&&this.ZoneCurrent.Layers.Vista.addTo(this.Map),O.Options.bol_displayChallengesWvW&&this.ZoneCurrent.Layers.Challenge.addTo(this.Map),O.Options.bol_displaySectorsWvW&&this.ZoneCurrent.Layers.Sector.addTo(this.Map)}I.qTip.init(".leaflet-marker-icon"),this.adjustZoomMapping()}}},refreshCurrentZone:function(){var e=this.ZoneCurrent.center;switch(this.MapEnum){case P.MapEnum.Tyria:this.showCurrentZone(this.getZoneCenter("verdant")),this.showCurrentZone(this.getZoneCenter("auric"));break;case P.MapEnum.Mists:this.showCurrentZone(this.getZoneCenter("edge")),this.showCurrentZone(this.getZoneCenter("eternal"))}this.showCurrentZone(e)},computeZoneCenter:function(e){var t=this.Zones[e].continent_rect,n=t[0][0]+~~((t[1][0]-t[0][0])/2),i=t[0][1]+~~((t[1][1]-t[0][1])/2);return[n,i]},getZoneCenter:function(e){return this.Zones[e]?this.Zones[e].center:[0,0]},getEventCenter:function(e){var t=this.getZoneFromID(e.map_id),n=e.location.center;return this.convertEventCoord(n,t)},scaleDimension:function(e,t){return t=t||this.Map.getZoom(),parseInt(e/Math.pow(this.cZoomFactor,this.ZoomEnum.Max-t))},invertZoomLevel:function(e){return this.ZoomEnum.Max-e},adjustZoomMapping:function(){var e,t,n,i=this,a=this.Map.getZoom(),r=this.invertZoomLevel(a),o={waypoint:[40,32,26,20,16,12,0,0],landmark:[32,24,16,12,0,0,0,0],eventicon:[32,24,16,12,0,0,0,0],eventring:[256,128,64,32,0,0,0,0],sectorfont:[28,20,16,0,0,0,0,0],sectoropacity:[.9,.6,.3,0,0,0,0,0],objicon:[38,38,38,38,32,24,16,0],objtimerfont:[18,17,16,15,14,13,12,0],objinfofont:[14,13,12,11,10,9,0,0],objumbrella:[96,96,96,96,64,32,24,0],spawnfont:[28,24,20,16,12,8,0,0],spawnopacity:[.9,.9,.8,.7,.6,.5,0,0],wallweight:[10,8,6,4,2,0,0,0]},s=function(e){return o[e][r]},c=s("waypoint"),l=s("landmark"),u=s("eventicon"),d=s("eventring"),p=s("sectorfont"),h=s("sectoropacity"),m=s("objicon"),g=s("objtimerfont"),f=s("objinfofont"),C=s("objumbrella"),v=s("spawnfont"),T=s("spawnopacity"),b=s("wallweight");switch(this.MapEnum){case P.MapEnum.Tyria:O.Options.bol_displayEvents&&(this.ZoneCurrent.Layers.EventIcon.eachLayer(function(e){i.resizeMarkerIcon(e,u),e._icon&&(e._icon.style.zIndex=M.cZIndexRaise)}),this.ZoneCurrent.Layers.EventRing.eachLayer(function(e){i.resizeMarkerIcon(e,d),e._icon&&(e._icon.style.zIndex=M.cZIndexBury)})),t=O.Options.bol_showZoneOverview,e=O.Options.bol_showWorldCompletion,n=O.Options.bol_displaySectors;break;case P.MapEnum.Mists:$(".objIcon").css({width:m,height:m}),$(".objProgressBar").css({width:m}),$(".objTimer").css({fontSize:g}),$(".objInfo").css({fontSize:f}),$(".objUmbrella").css({width:C,height:C}),t=O.Options.bol_showZoneOverviewWvW,e=O.Options.bol_showWorldCompletionWvW,n=O.Options.bol_displaySectorsWvW,this.Layer.SpawnLabel.eachLayer(function(e){e._icon.style.fontSize=v+"px",e._icon.style.opacity=T,e._icon.style.zIndex=i.cZIndexBury+1,e._icon.style.display="table"}),this.Layer.Secondaries.eachLayer(function(e){i.resizeMarkerIcon(e,l)}),this.Layer.Destructible.eachLayer(function(e){e.setStyle({weight:b})})}this.Layer.WeaponCircle.eachLayer(function(e){e.setRadius(i.getZoomedDistance(e.options.trueradius))}),e&&t&&a===this.ZoomEnum.Overview?(this.toggleLayer(this.Layer.Overview,!0),this.Layer.Overview.eachLayer(function(e){e._icon.style.display="table"})):this.toggleLayer(this.Layer.Overview,!1),this.ZoneCurrent.Layers.Waypoint.eachLayer(function(e){i.resizeMarkerIcon(e,c)}),this.ZoneCurrent.Layers.Landmark.eachLayer(function(e){i.resizeMarkerIcon(e,l),e._icon&&(e._icon.style.opacity=a<i.ZoomEnum.Max?.6:.8)}),this.ZoneCurrent.Layers.Vista.eachLayer(function(e){i.resizeMarkerIcon(e,l)}),this.ZoneCurrent.Layers.Challenge.eachLayer(function(e){i.resizeMarkerIcon(e,l)}),this.ZoneCurrent.Layers.Heart.eachLayer(function(e){i.resizeMarkerIcon(e,l)}),this.ZoneCurrent.Layers.Sector.eachLayer(function(e){e._icon&&(e._icon.style.fontSize=p+"px",e._icon.style.opacity=h,e._icon.style.zIndex=i.cZIndexBury+1,n&&(e._icon.style.display="table"))}),P.updateCharacter(-1)},getZoomedDistance:function(e){return e/Math.pow(2,this.ZoomEnum.Max-this.Map.getZoom())},createStandardIcon:function(e){return L.icon({iconUrl:e,iconSize:[32,32],iconAnchor:[16,16]})},createPin:function(e,t,n){void 0===t&&(t=[32,32]);var i={icon:L.icon({iconUrl:e,iconSize:t,iconAnchor:[t[0]/2,t[1]/2]}),draggable:!0};if(void 0!==n)for(var a in n)i[a]=n[a];var r=L.marker(this.convertGCtoLC([0,0]),i);return this.Layer.Pin.addLayer(r),r},initializePinStorage:function(e){var t=e,n=function(e){var n=O.Utilities["StoredPins"+t.OptionSuffix];n.value=new Array(e);var i=n.key;try{n.value=JSON.parse(localStorage[i])}catch(a){}},i=function(e){var n=O.Utilities["StoredPins"+t.OptionSuffix],i=t.getPersonalCoords();i.length>0?(n.value[e]=i,localStorage[n.key]=JSON.stringify(n.value)):t.isPersonalPinsLaid()},a=function(e){var n=O.Utilities["StoredPins"+t.OptionSuffix];t.redrawPersonalPath(n.value[e])},r="#"+t.MapEnum,o=8,s=D.getWordCapital("load"),c=D.getWordCapital("save");n(o);for(var l=0;o>l;l++)$(r+"ContextLoadPins").append("<li data-index='"+l+"'>"+s+" #"+(l+1)+"</li>"),$(r+"ContextSavePins").append("<li data-index='"+l+"'>"+c+" #"+(l+1)+"</li>");$(r+"ContextLoadPins li").click(function(){a($(this).attr("data-index"))}),$(r+"ContextSavePins li").click(function(){i($(this).attr("data-index"))})},saveBackupPins:function(){var e=O.Utilities["BackupPins"+this.OptionSuffix];localStorage[e.key]=JSON.stringify(this.getPersonalCoords())},loadBackupPins:function(){var e=O.Utilities["BackupPins"+this.OptionSuffix];try{e.value=JSON.parse(localStorage[e.key])}catch(t){}this.redrawPersonalPath(e.value,null)},createPersonalPin:function(e,t){var n=this,i=0===this.numPins?"img/map/pin_red.png":"img/map/pin_white.png",a=L.marker(e,{icon:L.icon({iconUrl:i,iconSize:[32,32],iconAnchor:[16,16]}),draggable:!0,opacity:.9});this.toggleLayer(a,!0),this.Layer.PersonalPin.addLayer(a),this.numPins++,t&&this.drawPersonalPath(),this.bindMarkerCoordBehavior(a,"click"),a.on("click",function(){void 0===this.options.isMarked||this.options.isMarked===!1?(this.options.isMarked=!0,this.setOpacity(.3)):(this.options.isMarked=!1,this.setOpacity(1))}),a.on("dblclick",function(){n.toggleLayer(this,!1),n.Layer.PersonalPin.removeLayer(this),n.drawPersonalPath(),n.numPins--}),a.on("contextmenu",function(e){n.Map.getZoom()===n.ZoomEnum.Max?(n.GPSPreviousCoord.length>0?n.movePin(this,n.GPSPreviousCoord):n.movePin(this,n.Map.getCenter()),n.drawPersonalPath()):n.Map.setView(e.latlng,n.ZoomEnum.Max)}),a.on("dragend",function(){n.drawPersonalPath()})},insertPersonalPin:function(e,t){var n=[],i=0;this.Layer.PersonalPin.eachLayer(function(a){n.push(a.getLatLng()),i===e&&n.push(t),i++}),this.clearPersonalPins();for(i in n)this.createPersonalPin(n[i]);this.drawPersonalPath()},clearPersonalPins:function(){var e=this;this.Layer.PersonalPin.eachLayer(function(t){e.toggleLayer(t,!1)}),this.Layer.PersonalPin.clearLayers(),this.drawPersonalPath(),this.numPins=0},drawPersonalPath:function(){var e=this;if(O.Options.bol_showPersonalPaths){var t,n=[],i=[],a=0,r=U.stripToColorString(O.Options.str_colorPersonalPath);if(this.Layer.PersonalPin.eachLayer(function(e){n.push(e.getLatLng()),i.push(P.getLayerId(e)),a++}),a>1){this.Layer.PersonalPath.clearLayers();for(var o=0;a-1>o;o++)t=L.polyline([n[o],n[o+1]],{color:r,opacity:.4,precede:o}),t.on("click",function(){e.outputCoordinatesCopy(e.getPersonalString()),e.outputPinsRange()}),t.on("dblclick",function(t){e.saveBackupPins(),e.insertPersonalPin(this.options.precede,t.latlng)}),this.Layer.PersonalPath.addLayer(t);this.toggleLayer(this.Layer.PersonalPath,!0),e.outputPinsRange()}else this.toggleLayer(this.Layer.PersonalPath,!1),this.Layer.PersonalPath.clearLayers()}else this.toggleLayer(this.Layer.PersonalPath,!1),this.Layer.PersonalPath.clearLayers()},parsePersonalPath:function(e){var t=this.parseCoordinatesMulti(e);return null!==t?(this.redrawPersonalPath(t),!0):!1},redrawPersonalPath:function(e,t){if(void 0!==e&&null!==e&&e.length>0){this.clearPersonalPins();for(var n in e)this.createPersonalPin(this.convertGCtoLC(e[n]));this.drawPersonalPath(),null!==t&&(void 0===t?this.goToArguments(e[0]):this.goToArguments(t))}else I.write("Path unavailable for this.")},outputPinsRange:function(){for(var e=0,t=this.Layer.PersonalPin.getLayers(),n=t.length-1,i=0;n>i;i++)e+=P.getDistanceBetweenCoords(this.convertLCtoGC(t[i].getLatLng()),this.convertLCtoGC(t[i+1].getLatLng()));var a=~~(e*this.cPOINTS_TO_UNITS),r=T.formatTimeLetter(Math.ceil(a/this.cUNITS_PER_SECOND),!0);this.outputCoordinatesName(a+" "+D.getWord("range")+" ("+r+")")},isPersonalPinsLaid:function(){return 0===this.Layer.PersonalPin.getLayers().length?(I.write("No personal pins to work with. Double click on the map to lay pins."),!1):!0},optimizePersonalPath:function(e){this.redrawPersonalPath(P.getGreedyPath(this.getPersonalCoords(),e))},drawRandom:function(e){var t=parseInt(e);if(!(0===t||t>1e3||this.numPins>1e3||void 0===t)){for(var n,i,a=0;t>a;a++)n=T.getRandomIntRange(0,this.cMAP_BOUND),i=T.getRandomIntRange(0,this.cMAP_BOUND),this.createPersonalPin(this.convertGCtoLC([n,i]));this.drawPersonalPath()}},getPersonalCoords:function(){var e=this,t=[];return this.Layer.PersonalPin.eachLayer(function(n){t.push(e.convertLCtoGC(n.getLatLng()))}),t},getPersonalString:function(){return JSON.stringify(this.getPersonalCoords())},getClosestLocation:function(e,t){var n,i=this,a=Number.POSITIVE_INFINITY,r=null;return t.eachLayer(function(t){n=P.getDistanceBetweenCoords(e,i.convertLCtoGC(t.getLatLng())),a>n&&(a=n,r=t)}),r},initializeWeaponPlacer:function(e){var t=e,n="#"+t.MapEnum,i=5,a=2e4,r=32,o=8192,s=$(n+"ContextRangeList");I.preventMapPropagation(s);var c=0;for(var l in t.Weapons){var u=t.Weapons[l];if(u.isPlaceable!==!1){c++;var d=$("<img src='img/wvw/range/"+u.image+I.cPNG+"' />"),p=void 0!==u.tooltip?u.tooltip:D.getWordCapital("range")+" "+u.range;d.attr("title",p),s.append(d),c%i===0&&s.append("<br />"),function(e){d.click(function(){t.createWeapon(e,t.ContextLatLng)})}(u)}}var h=$("<img src='img/wvw/range/custom.png' title='<dfn>Lay a custom weapon on the map</dfn><br />using the range and color specified below.' />").click(function(){var e={id:"custom",image:"custom",range:parseInt($(n+"RangeCustomRange").val()),color:U.stripToColorString($(n+"RangeCustomColor").val())};t.createWeapon(e,t.ContextLatLng)});s.append(h);var m=$("<img src='img/ui/default.png' title='<dfn>Delete all weapons on the map.</dfn><br />After laying a weapon on the map:<br />Drag it to move it.<br />Right click to center it.<br />Double click to delete it.' />").click(function(){t.clearWeapons()});s.append(m),s.append("<br /><span id='"+t.MapEnum+"RangeCustom' class='mapRangeCustom'><input id='"+t.MapEnum+"RangeCustomRange' type='number' value='1200' min='0' max='"+a+"' step='100' style='width:64px' class='cssInputText' /><input id='"+t.MapEnum+"RangeCustomColor' type='text' value='#ffffff' maxlength='"+r+"' style='width:96px' class='cssInputText' /></span>"),$(n+"RangeCustomRange, "+n+"RangeCustomColor").onEnterKey(function(){h.trigger("click")});var g=$("<img src='img/ui/export.png' title='<dfn>(Export) Prints in data format the weapons</dfn> currently placed on the map.<br />The outputted text can be copied to share your weapons placement.' />").click(function(){t.isWeaponsLaid()&&I.print(U.escapeHTML(JSON.stringify(t.serializeWeapons())),!0)}),f=$("<img src='img/ui/import.png' id='"+t.MapEnum+"RangeImportButton' title='<dfn>(Import) Reads data from the text input box</dfn> on the right.<br />Weapons will be reconstructed from these pasted text data.' />").click(function(){var e=$(n+"RangeImportText").val();try{var i=JSON.parse(e);Array.isArray(i)&&t.redrawWeapons(i)}catch(a){I.write("Invalid data string for importing weapons.")}}),C=$("<input id='"+t.MapEnum+"RangeImportText' type='text' value='' maxlength='"+o+"' style='width:96px' class='cssInputText' />").onEnterKey(function(){$(n+"RangeImportButton").trigger("click")});s.append(g).append(f).append(C),s.find("input").click(function(e){e.stopPropagation()}),$("#wvwContextDrawWeapons").click(function(){W.redrawDefaultWeapons()}),I.qTip.init(".mapContextRangeList img"),t.initializeWeaponStorage()},initializeWeaponStorage:function(){var e=this,t=function(t){var n=O.Utilities["StoredWeapons"+e.OptionSuffix];n.value=new Array(t);var i=n.key;try{n.value=JSON.parse(localStorage[i])}catch(a){}},n=function(t){var n=O.Utilities["StoredWeapons"+e.OptionSuffix],i=e.serializeWeapons();i.length>0?(n.value[t]=i,localStorage[n.key]=JSON.stringify(n.value)):e.isWeaponsLaid()},i=function(t){var n=O.Utilities["StoredWeapons"+e.OptionSuffix];e.redrawWeapons(n.value[t])},a="#"+e.MapEnum,r=8,o=D.getWordCapital("load"),s=D.getWordCapital("save");t(r);for(var c=0;r>c;c++)$(a+"ContextLoadWeapons").append("<li data-index='"+c+"'>"+o+" #"+(c+1)+"</li>"),$(a+"ContextSaveWeapons").append("<li data-index='"+c+"'>"+s+" #"+(c+1)+"</li>");$(a+"ContextLoadWeapons li").click(function(){i($(this).attr("data-index"))}),$(a+"ContextSaveWeapons li").click(function(){n($(this).attr("data-index"))})},serializeWeapons:function(){var e=this,t=[];return e.Layer.WeaponCircle.eachLayer(function(n){var i={id:n.options.weaponid,coord:e.convertLCtoGC(n.getLatLng())};"custom"===n.options.weaponid&&(i.color=n.options.color.toLowerCase(),i.range=parseInt(n.options.weaponrange)),t.push(i)}),t},redrawWeapons:function(e,t){if(void 0!==e&&null!==e&&e.length>0){this.clearWeapons();for(var n in e){var i=e[n],a=void 0!==t?[i.coord[0]+t[0],i.coord[1]+t[1]]:i.coord,r=null;"custom"===i.id&&void 0!==i.range&&void 0!==i.color&&void 0!==i.coord?r={id:i.id,image:"custom",coord:a,range:parseInt(i.range),color:U.stripToColorString(i.color)}:void 0!==this.Weapons[i.id]&&(r=this.Weapons[i.id]),null!==r?this.createWeapon(r,this.convertGCtoLC(a)):I.write("Failed parsing a weapon.")}}else I.write("Arsenal unavailable for this.")},redrawDefaultWeapons:function(){var e=W.Metadata.PlacementAssociation[W.ZoneCurrent.nick],t=W.Metadata.Offsets[W.ZoneCurrent.nick];if(void 0!==t){var n=W.Placement[e].Siege;W.redrawWeapons(n,t)}},isWeaponsLaid:function(){return 0===this.Layer.WeaponIcon.getLayers().length?(I.write("No weapons to work with. Lay weapons from the map's &quot;Range&quot; context menu."),!1):!0},createWeapon:function(e,t){var n=this,i=e.range*M.cUNITS_TO_POINTS,a=this.getZoomedDistance(i),r=L.circleMarker(t,{clickable:!1,weaponid:e.id,weaponrange:e.range,trueradius:i,radius:a,color:e.color,weight:2,opacity:e.opacity||.8,fillOpacity:e.fillOpacity||.1});this.Layer.WeaponCircle.addLayer(r),this.toggleLayer(r);var o=L.marker(t,{circle:r,icon:L.icon({className:"mapWeapon",iconUrl:"img/wvw/range/"+e.image+I.cPNG,iconSize:[24,24],iconAnchor:[12,12]}),draggable:!0,opacity:.9});n.bindMarkerCoordBehavior(o,"click"),o.on("drag",function(){this.options.circle.setLatLng(this.getLatLng())}),o.on("dblclick",function(){n.removeWeapon(this)}),o.on("contextmenu",function(){n.GPSPreviousCoord.length>0?n.movePin(this,n.GPSPreviousCoord):n.movePin(this,n.Map.getCenter()),this.options.circle.setLatLng(this.getLatLng())}),this.Layer.WeaponIcon.addLayer(o),this.toggleLayer(o)},removeWeapon:function(e){this.toggleLayer(e.options.circle,!1),this.Layer.WeaponCircle.removeLayer(e.options.circle),this.toggleLayer(e,!1),this.Layer.WeaponIcon.removeLayer(e)},clearWeapons:function(){var e=this;this.Layer.WeaponIcon.eachLayer(function(t){e.removeWeapon(t)}),this.Layer.WeaponCircle.clearLayers(),this.Layer.WeaponIcon.clearLayers()},resizeMarkerIcon:function(e,t){void 0===t&&(t=this.cICON_SIZE_STANDARD),e.setIcon(new L.icon({iconUrl:e.options.icon.options.iconUrl,iconSize:[t,t],iconAnchor:[t/2,t/2]
}))},toggleLayer:function(e,t){e&&(void 0===t&&(t=!this.Map.hasLayer(e)),t?e.addTo(this.Map):this.Map.removeLayer(e))},toggleLayerArray:function(e,t){for(var n in e)this.toggleLayer(e[n],t)},toggleSubmap:function(e,t){var n=this.Submaps[e];void 0===n.ImageOverlay?(n.ImageOverlay=L.imageOverlay(n.img,this.convertGCtoLCMulti(n.bounds)),this.toggleSubmap(e,t)):(void 0===t&&(t=!this.Map.hasLayer(n.ImageOverlay)),t?n.ImageOverlay.addTo(this.Map).bringToBack():this.Map.removeLayer(n.ImageOverlay))},toggleSubmapArray:function(e,t){for(var n in e)this.toggleSubmap(e[n],t)},movePin:function(e,t){void 0===t?this.toggleLayer(e,!1):(this.toggleLayer(e,!0),Array.isArray(t)?e.setLatLng(this.convertGCtoLC(t)):e.setLatLng(t),e._icon.style.zIndex=this.cZIndexRaise)},goToView:function(e,t,n){void 0!==n&&this.movePin(n,e),void 0===t?t=this.ZoomEnum.Ground:t===this.ZoomEnum.Same?t=this.Map.getZoom():t===this.ZoomEnum.Adaptive?t=this.getAdaptiveZoom():"object"==typeof t&&void 0!==t.offset&&(t=this.getAdaptiveZoom(t.offset)),this.Map.setView(this.convertGCtoLC(e),t),this.showCurrentZone(e)},refreshView:function(e){var t=e?this.convertGCtoLC(e):this.Map.getCenter();this.Map.setView(M.cMAP_CENTER_INITIAL,this.Map.getZoom()),this.Map.setView(t,this.Map.getZoom())},goToZone:function(e,t){var n=this.getZoneCenter(e);this.showCurrentZone(n),this.goToView(n,t)},getAdaptiveZoom:function(e){void 0===e&&(e=0);var t,n=$(window).width();return t=n>=I.ScreenWidth.Huge?this.ZoomEnum.Default+1:n>=I.ScreenWidth.Large?this.ZoomEnum.Default:n>=I.ScreenWidth.Medium?this.ZoomEnum.Default-1:this.ZoomEnum.Default-2,t+e},goToDefault:function(e){void 0===e&&(e=this.getAdaptiveZoom()),this.Map.setView(this.convertGCtoLC(this.cMAP_CENTER),e)},goToArguments:function(e,t,n){var i,a,r=[];if(e)if(r=this.parseCoordinates(e),2===r.length)isFinite(r[0])&&isFinite(r[1])&&this.goToView(r,t,n);else if(r.length>=3){if(isFinite(r[0])&&isFinite(r[1])&&isFinite(r[2])){var o=this.invertZoomLevel(r[2]);this.goToView([r[0],r[1]],o,n)}}else if(a=e.toLowerCase(),"default"===a)this.goToDefault();else for(i in this.Zones)if(-1!==a.indexOf(i)){this.goToView(this.getZoneCenter(i),this.ZoomEnum.Sky);break}},convertGCtoLC:function(e){return this.Map.unproject(e,this.Map.getMaxZoom())},convertGCtoLCMulti:function(e,t){t=t||0;var n,i=[];for(n=t;n<e.length;n++)i.push(this.convertGCtoLC(e[n]));return i},convertGCtoLCDual:function(e){return[this.convertGCtoLC(e[0]),this.convertGCtoLC(e[1])]},convertLCtoGC:function(e){var t=this.Map.project(e,this.ZoomEnum.Max);return[Math.round(t.x),Math.round(t.y)]},convertLCtoGCMulti:function(e){for(var t=[],n=0;n<e.length;n++)t.push(this.convertLCtoGC(e[n]));return t},convertEventCoord:function(e,t){var n=t.continent_rect,i=t.map_rect;return"988"===t.id&&(n=t.continent_rect_actual),[~~(n[0][0]+(n[1][0]-n[0][0])*(e[0]-i[0][0])/(i[1][0]-i[0][0])),~~(n[0][1]+(n[1][1]-n[0][1])*(1-(e[1]-i[0][1])/(i[1][1]-i[0][1])))]},convertGPSCoord:function(e,t){var n=this.getZoneFromID(t),i=new Array(3);return i[0]=e[0]*this.cMETERS_TO_UNITS,i[1]=e[2]*this.cMETERS_TO_UNITS,i[2]=e[1]*this.cMETERS_TO_UNITS,this.convertEventCoord(i,n)},convertGPSAngle:function(e){return Math.atan2(e[2],e[0])*this.cRADIAN_TO_DEGREE},parseCoordinates:function(e){var t=e.toString().replace(/[^\d,-.]/g,"");return t.split(",")},parseCoordinatesMulti:function(e){var t,n=13,i=e.replace(/\s/g,""),a=[],r=[];if(i.length>=n&&"["===i.charAt(0)&&"["===i.charAt(1)&&"]"===i.charAt(i.length-1)&&"]"===i.charAt(i.length-2)){i=i.substring(2,i.length-2),a=i.split("],[");for(var o in a)t=a[o].split(","),2===t.length&&(t[0]=Math.round(t[0]),t[1]=Math.round(t[1]),r.push(t));return r}return null},convertLatLngs:function(e){if(Array.isArray(e)){var t=this.convertLCtoGCMulti(e);P.printCoordinates(t)}},getElementCoordinates:function(e){var t=e.attr("data-coord");return this.Zones[t]?this.getZoneCenter(t):this.parseCoordinates(t)},bindMapLinks:function(e,t){if(I.isMapEnabled!==!1){var n=this;$(e+" dfn").each(function(){$(this).text("["+$(this).text()+"]"),n.bindMapLinkBehavior($(this),t,n.Pin.Program)})}},bindMapLinkBehavior:function(e,t,n){if(I.isMapEnabled!==!1&&void 0!==e&&null!==e){var i=this;e.click(function(){var e=$(this).attr("data-coord");U.interpretCommand(e,i,t,n)}),e.dblclick(function(){var e=i.getElementCoordinates($(this));e.length>1&&(i.Map.getZoom()===i.ZoomEnum.Max?i.goToView(e,i.ZoomEnum.Default,n):i.Map.zoomIn())}),e.mouseover(function(){var e=i.getElementCoordinates($(this));e.length>1&&i.movePin(i.Pin.Over,e)}),e.mouseout(function(){i.movePin(i.Pin.Over)})}},bindOverviewBehavior:function(e,t){var n=this;e.on(t,function(t){n.goToZone(e.options.mappingzone,n.ZoomEnum.Sky)})},bindMarkerZoomBehavior:function(e,t,n){var i=this;void 0===n&&(n=i.ZoomEnum.Default),e.on(t,function(e){if(i.Map.getZoom()===i.ZoomEnum.Max){var t=i.Map.getCenter();~~t.lat===~~e.latlng.lat&&~~t.lng===~~e.latlng.lng?i.Map.setZoom(n):i.Map.setView(e.latlng,i.Map.getZoom())}else i.Map.setView(e.latlng,i.ZoomEnum.Max)})},bindMarkerCoordBehavior:function(e,t){var n=this;e.on(t,function(){var e=n.convertLCtoGC(this.getLatLng());n.outputCoordinatesCopy(P.formatCoord(e))})},bindMarkerWikiBehavior:function(e,t){e.on(t,function(e){var t=this.options.wiki;t.indexOf(".")===t.length-1&&(t=t.slice(0,-1)),U.openExternalURL(U.getWikiLink(t))})},bindZoneList:function(e){var t=e,n="#"+t.MapEnum;$(n+"ZoneList li").each(function(){var e=$(this).attr("data-zone");$(this).text(t.getZoneName(e)),$(this).attr("data-coord",t.getZoneCenter(e).toString()),t.bindMapLinkBehavior($(this),{offset:1})}),$(n+"ZoneList h2").each(function(){var e=$(this).attr("data-region");$(this).text(D.getObjectName(t.Regions[e]))})}},P={SuffixCurrent:"",WebsiteCurrentMap:"map",GPSCurrentMap:null,MapEnum:{Tyria:"map",Mists:"wvw"},Layer:{ZoneBorder:new L.layerGroup,ZoneGateway:new L.layerGroup,DryTopNicks:new L.layerGroup,Chest:new L.layerGroup},NodeArray:{JP:[]},LayerArray:{ChainPath:[],Resource:[],JP:[],Guild_Bounty:[],Guild_Trek:[],Guild_Challenge:[],Guild_Rush:[],Guild_Puzzle:[],DryTopIcons:[],DryTopRings:[],DryTopActive:[]},Events:{},DryTopTimer:{},Resources:{},JPs:{},Chests:{},Collectibles:{},Guild:{},GPSTimeout:{},initializeMap:function(){I.isMapEnabled&&M.initializeMap()},populateMap:function(e){if(I.isMapEnabled){var t,n=e,i=O.Options["bol_showWorldCompletion"+n.OptionSuffix];switch(n.MapEnum){case P.MapEnum.Tyria:t=U.URL_API.MapFloorTyria;break;case P.MapEnum.Mists:if(t=U.URL_API.MapFloorMists,i===!1)return}$.getJSON(t,function(e){var t,a,r,o,s,c,l,u,d,p,h,m,g=D.getTranslation("Vista"),f=D.getTranslation("Hero Challenge");for(a in e.regions){r=e.regions[a];for(o in r.maps)if(n.ZoneAssociation[o]){s=r.maps[o],l=n.getZoneFromID(o);var C=0,v=0,T=0,b=0,y=0;for(u=s.points_of_interest.length,t=0;u>t;t++){switch(c=s.points_of_interest[t],c.type){case n.APIPOIEnum.Waypoint:v++,p=U.URL_IMG.Waypoint,h="mapWp",m=c.name;break;case n.APIPOIEnum.Landmark:if(i===!1)continue;T++,p=U.URL_IMG.Landmark,h="mapPoi",m=c.name;break;case n.APIPOIEnum.Vista:if(i===!1)continue;y++,p=U.URL_IMG.Vista,h="mapPoi",m=g;break;default:continue}switch(d=L.marker(n.convertGCtoLC(c.coord),{title:"<span class='"+h+"'>"+m+"</span>",markername:c.name,icon:L.icon({iconUrl:p,iconSize:[16,16],iconAnchor:[8,8]}),id:c.poi_id}),c.type){case n.APIPOIEnum.Waypoint:d.on("mouseout",function(){try{this._icon.src=U.URL_IMG.Waypoint}catch(e){}}),d.on("mouseover",function(){this._icon.src=U.URL_IMG.WaypointOver}),l.Layers.Waypoint.addLayer(d);break;case n.APIPOIEnum.Landmark:d.on("mouseout",function(){try{this._icon.src=U.URL_IMG.Landmark}catch(e){}}),d.on("mouseover",function(){this._icon.src=U.URL_IMG.LandmarkOver}),l.Layers.Landmark.addLayer(d);break;case n.APIPOIEnum.Vista:l.Layers.Vista.addLayer(d)}c.type===n.APIPOIEnum.Waypoint||c.type===n.APIPOIEnum.Landmark?(d.on("click",function(){n.outputCoordinatesCopy(U.getChatlinkFromPoiID(this.options.id)),n.outputCoordinatesName(this.options.markername)}),d.on("dblclick",function(e){U.openExternalURL(U.getWikiLanguageLink(this.options.markername))}),n.bindMarkerZoomBehavior(d,"contextmenu",n.ZoomEnum.Sky)):(n.bindMarkerZoomBehavior(d,"click",n.ZoomEnum.Sky),n.bindMarkerZoomBehavior(d,"contextmenu",n.ZoomEnum.Sky))}if(i){for(u=s.skill_challenges.length,b=u,t=0;u>t;t++)c=s.skill_challenges[t],d=L.marker(n.convertGCtoLC(c.coord),{title:"<span class='mapPoi'>"+f+"</span>",icon:L.icon({iconUrl:U.URL_IMG.Challenge,iconSize:[16,16],iconAnchor:[8,8]})}),n.bindMarkerZoomBehavior(d,"click",n.ZoomEnum.Sky),n.bindMarkerZoomBehavior(d,"contextmenu",n.ZoomEnum.Sky),l.Layers.Challenge.addLayer(d);for(u=s.tasks.length,C=u,t=0;u>t;t++)c=s.tasks[t],d=L.marker(n.convertGCtoLC(c.coord),{title:"<span class='mapPoi'>"+c.objective+" ("+c.level+")</span>",wiki:c.objective,icon:L.icon({iconUrl:U.URL_IMG.Heart,iconSize:[16,16],iconAnchor:[8,8]})}),M.bindMarkerWikiBehavior(d,"click"),M.bindMarkerZoomBehavior(d,"contextmenu",n.ZoomEnum.Sky),l.Layers.Heart.addLayer(d);for(u=s.sectors.length,t=0;u>t;t++)c=s.sectors[t],d=L.marker(n.convertGCtoLC(c.coord),{clickable:!1,icon:L.divIcon({className:"mapSec",html:"<span class='mapSecIn'>"+c.name+"</span>",iconSize:[512,64],iconAnchor:[256,32]})}),l.Layers.Sector.addLayer(d);n.isMappingIconsGenerated=!0}i&&(d=L.marker(n.convertGCtoLC(l.center),{mappingzone:l.nick,riseOnHover:!0,icon:L.divIcon({className:"mapOverview",html:"<span class='mapOverviewIn'><var class='mapOverviewName'>"+D.getObjectName(l)+"</var>"+(s.min_level>0?"<var class='mapOverviewLevel'>"+(80===s.min_level?s.max_level:s.min_level+" - "+s.max_level)+"</var>":"")+(C>0?"<img src='img/map/heart.png' />"+C+" ":"")+(v>0?"<img src='img/map/waypoint.png' />"+v+" ":"")+(T>0?"<img src='img/map/landmark.png' />"+T+" ":"")+(b>0?"<img src='img/map/challenge.png' />"+b+" ":"")+(y>0?"<img src='img/map/vista.png' />"+y:"")+"</span>",iconSize:[256,64],iconAnchor:[128,32]})}),n.bindOverviewBehavior(d,"click"),n.bindOverviewBehavior(d,"contextmenu"),n.Layer.Overview.addLayer(d),n.toggleLayer(n.Layer.Overview,!0))}}}).done(function(){n.isAPIRetrieved_MAPFLOOR=!0,n.MapEnum===P.MapEnum.Tyria&&O.Options.bol_displayEvents===!1&&P.donePopulation()}).fail(function(){I.ModeCurrent===I.ModeEnum.Website&&I.write("Guild Wars 2 API server is unreachable.<br />Reasons could be:<br />- The ArenaNet server is down for maintenance.<br />- Your browser is too old (if IE then need 11+).<br />- Your computer's time is out of sync.<br />- This website's code encountered a bug.<br />Map features will be limited.<br />",20)}).always(function(){switch(n.MapEnum){case P.MapEnum.Tyria:O.Options.bol_displayEvents===!0?P.populateEvents():P.finishPopulation();break;case P.MapEnum.Mists:W.finishPopulation()}})}},populateEvents:function(){var e=function(e){for(var t=["scarlet","molten all","aetherblade","queen's cha","mordrem inv","offshoot","vigil eng","haunted","guild","subdue","hero cha"],n=0;n<t.length;n++)if(-1!==e.indexOf(t[n]))return!0;return!1},t=function(e){return-1!==e.indexOf("free")?"release":-1!==e.indexOf("rescue")?"release":-1!==e.indexOf("capture")?"flag":-1!==e.indexOf("retake")?"flag":-1!==e.indexOf("reclaim")?"flag":-1!==e.indexOf("liberate")?"flag":-1!==e.indexOf("protect")?"shield":-1!==e.indexOf("defend")?"shield":-1!==e.indexOf("escort")?"shield":-1!==e.indexOf("kill")?"boss":-1!==e.indexOf("slay")?"boss":-1!==e.indexOf("defeat")?"boss":-1!==e.indexOf("collect")?"collect":-1!==e.indexOf("help")?"star":-1!==e.indexOf("destroy")?"cog":-1!==e.indexOf("gather")?"collect":-1!==e.indexOf("bring")?"collect":-1!==e.indexOf("recover")?"collect":-1!==e.indexOf("return")?"collect":-1!==e.indexOf("retrieve")?"collect":-1!==e.indexOf("salvage")?"collect":-1!==e.indexOf("burglar")?"fist":"swords"},n=function(e){var t=e.location.radius;switch(e.location.type){case"sphere":return 2e3>t?"img/ring/c_s.png":"img/ring/c_m.png";case"cylinder":return"img/ring/e_m_h.png";case"poly":return"img/ring/e_l_h.png"}return"img/ring/c_m.png"},i=function(e){var t;for(t in e.events)P.Events[t]={},P.Events[t].name=e.events[t].name},a=function(a){$.getJSON(U.URL_API.EventDetails,function(r){var o,s,c,l,u,d,p;i(a||r);for(o in r.events)s=r.events[o],c=s.name.toLowerCase(),l=void 0!==P.Events[o]?P.Events[o].name:s.name,p=M.getZoneFromID(s.map_id),void 0===p||e(c)||50===s.map_id||(d=M.convertGCtoLC(M.getEventCenter(s)),u=L.marker(d,{clickable:!1,icon:L.icon({iconUrl:n(s),iconSize:[256,256],iconAnchor:[128,128]})}),p.Layers.EventRing.addLayer(u),u=L.marker(d,{title:"<span class='mapPoi'>"+l+" ("+s.level+")</span>",wiki:s.name,icon:L.icon({iconUrl:"img/event/"+t(c)+I.cPNG,iconSize:[48,48],iconAnchor:[24,24]})}),M.bindMarkerWikiBehavior(u,"click"),M.bindMarkerZoomBehavior(u,"contextmenu"),p.Layers.EventIcon.addLayer(u));M.isEventIconsGenerated=!0}).done(function(){P.donePopulation()}).always(function(){P.finishPopulation()})};D.isLanguageDefault()?a():$.getJSON(U.URL_API.EventDetails+U.URL_API.LangKey,function(e){a(e)}).fail(function(){P.finishPopulation()})},donePopulation:function(){P.wantZoomToFirstEvent()&&(M.showCurrentZone(M.getZoneCenter(M.cInitialZone)),$("#chnEvent_"+C.CurrentChainSD.nexus+"_"+C.CurrentChainSD.CurrentPrimaryEvent.num).trigger("click"))},finishPopulation:function(){M.isMapAJAXDone=!0,M.bindMapVisualChanges(),M.adjustZoomMapping(),P.adjustZoomDryTop();var e=U.Args[U.KeyEnum.Go],t=U.Args[U.KeyEnum.Draw];void 0!==e&&(M.goToArguments(e,M.ZoomEnum.Ground,M.Pin.Program),U.Args[U.KeyEnum.Go]=null),void 0!==t&&M.parsePersonalPath(t),I.ModeCurrent===I.ModeEnum.Overlay&&P.tickGPS()},wantZoomToFirstEvent:function(){return I.isMapEnabled&&O.Options.bol_tourPrediction&&I.ModeCurrent!==I.ModeEnum.Overlay&&I.PageCurrent===I.PageEnum.Chains&&void 0===U.Args[U.KeyEnum.Go]?!0:!1},createNodeArray:function(e){for(var t=new Array(e),n=0;e>n;n++)t[n]={oMarker:null,oPath:null};return t},toggleNode:function(e,t,n){e[t]&&(M.toggleLayer(e[t].oMarker,n),M.toggleLayer(e[t].oPath,n))},toggleNodeArray:function(e,t){for(var n=0;n<e.length;n++)M.toggleLayer(e[n].oMarker,t),M.toggleLayer(e[n].oPath,t)},getLayerId:function(e){return e._leaflet_id},getLayerGroup:function(e){return e._layers},sortCoordinates:function(e,t){var n;for(var i in e)n=e[i],n[0]=Math.round(n[0]),n[1]=Math.round(n[1]);if(e.sort(function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}),!t)return e;for(var i in e)this.printNumberedCoordinates(e[i],i)},roundCoordinates:function(e){var t;for(var n in e)t=e[n],t[0]=Math.round(t[0]),t[1]=Math.round(t[1]);this.printCoordinates(e)},printNeedles:function(e){for(var t in e)this.printNumberedCoordinates(e[t].c,t)},printNodes:function(e,t){for(var n=0;n<e.length;n++){var i=t?"n: "+(n+1)+", ":"";I.print("{"+i+"c: ["+e[n][0]+", "+e[n][1]+"]},")}},printNumberedCoordinates:function(e,t){I.print("{n: "+(parseInt(t)+1)+", c: ["+e[0]+", "+e[1]+"]},")},formatCoord:function(e){return"["+e[0]+", "+e[1]+"]"},compileCoordinates:function(e){for(var t="",n=0;n<e.length;n++)t+=null===e[n]?"null,":"["+e[n][0]+","+e[n][1]+"],";return t=t.substring(0,t.length-1),"["+t+"]"},printCoordinates:function(e){I.print(this.compileCoordinates(e),!0)},printClosestWaypoints:function(){var e,t,n,i,a=12,r=500,o="",s=[""],c=[0,0],l=0;if(M.Layer.PersonalPin.eachLayer(function(a){t=M.convertLCtoGC(a.getLatLng()),n=M.getZoneFromCoord(t),null!==n&&(i=M.getClosestLocation(t,n.Layers.Waypoint),e="",null!==i&&(e=U.getChatlinkFromPoiID(i.options.id),l=P.getDistanceBetweenCoords(t,c),s[s.length-1]!==e&&l>r&&s.push(e),c=t))}),s.shift(),s.length>0){for(var u=Math.ceil(s.length/a),d=0,o="<div id='jsWaypointLinks'>Copy the codes below and<br />paste them in game chat to <br />follow the route:<br />",p=0;u>p;p++){o+="<input type='text'  class='cssInputText' value='";for(var h=a*p;a*(p+1)>h&&!(d>=s.length);h++)o+=" "+(h+1)+"-&gt;"+s[h],d++;o+="' /> Message "+(p+1)+"<br />"}o+="</div>",I.print(o,!0),$("#jsWaypointLinks .cssInputText").click(function(){$(this).select()})}else I.write("Pins must first be placed and be inside zones in order to create chatlinks.");return d},getDistanceBetweenCoords:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},getUnitsBetweenCoords:function(e,t){return~~(P.getDistanceBetweenCoords(e,t)*M.cPOINTS_TO_UNITS)},getGreedyPath:function(e,t){var n=e;if(void 0!==t){var i=n[0];n[0]=n[t],n[t]=i}for(var a=n[0],r=0,o=n.length,s=0;o>s;s++){for(var c=Number.POSITIVE_INFINITY,l=s;o>l;l++){var u=P.getDistanceBetweenCoords(a,n[l]);c>=u&&(r=l,c=u)}a=n[r],n[r]=n[s],n[s]=a}return n},drawDirectedPath:function(e,t,n){void 0===t&&(t=!0);var i=M.convertGCtoLCMulti(e),a=new L.layerGroup,r=8,o=t?0:r-1;n=n||"lime";for(var s=0;s<i.length-1;s++)a.addLayer(L.polyline([i[s],i[s+1]],{color:n,weight:2*(o+2)})),o=t?o+1:o-1,t&&o>=r?o=0:!t&&0>o&&(o=r-1);return a},drawSpots:function(e,t){var n,i=M.convertGCtoLCMulti(e),a=new L.layerGroup,r={radius:10,color:"lime",weight:4};if(void 0!==t)for(var o in t)r[o]=t[o];for(var o in i)n=L.circleMarker(i[o],r),M.bindMarkerZoomBehavior(n,"click"),a.addLayer(n);return a},drawCompletionRoute:function(){M.isItineraryRetrieved?M.redrawPersonalPath(M.ZoneCurrent.path):$.getScript(U.URL_DATA.Itinerary).done(function(){for(var e in GW2T_COMPLETION_DATA)M.Zones[e].path=GW2T_COMPLETION_DATA[e].path;M.isItineraryRetrieved=!0,P.drawCompletionRoute()})},printZoneEvents:function(){M.isEventIconsGenerated?M.ZoneCurrent.Layers.EventIcon.eachLayer(function(e){I.print("<input type='text' class='cssInputText' value='["+M.convertLCtoGC(e.getLatLng())+"]' /> "+e.options.task)}):I.write("Event icons have not been generated.")},drawZoneBorders:function(){if(O.Options.bol_showZoneBorders&&0===P.Layer.ZoneBorder.getLayers().length)for(var e in M.Zones){var t=M.Zones[e];P.Layer.ZoneBorder.addLayer(L.rectangle(M.convertGCtoLCMulti(t.continent_rect),{fill:!1,color:M.Regions[t.region].color,weight:2,clickable:!1}))}M.toggleLayer(P.Layer.ZoneBorder,O.Options.bol_showZoneBorders)},drawZoneGateways:function(){if(O.Options.bol_showZoneGateways&&0===P.Layer.ZoneGateway.getLayers().length){var e,t,n=GW2T_GATEWAY_CONNECTION.interzones,i=GW2T_GATEWAY_CONNECTION.intergates,a=GW2T_GATEWAY_CONNECTION.launchpads,r=function(e,t,n,i){i=void 0===i?null:i;var a=L.marker(M.convertGCtoLC(e),{icon:L.icon({iconUrl:t,iconSize:[32,32],iconAnchor:[16,16]}),opacity:n||.6,title:i});return M.bindMarkerZoomBehavior(a,"click"),M.bindMarkerZoomBehavior(a,"contextmenu"),a};for(var o in n)for(var s in n[o])e=r(n[o][s],"img/map/gateway_zone.png"),P.Layer.ZoneGateway.addLayer(e);for(var o in i){for(var s in i[o])e=r(i[o][s],"img/map/gateway_gate.png"),P.Layer.ZoneGateway.addLayer(e);t=L.polyline(M.convertGCtoLCDual(i[o]),{color:"purple",opacity:.2}),P.Layer.ZoneGateway.addLayer(t)}for(var o in a){var c="<div class='mapLoc'><img src='"+a[o].i+"' /></div>";e=r(a[o].c[0],"img/map/launchpad.png",1,c),P.Layer.ZoneGateway.addLayer(e),t=L.polyline(M.convertGCtoLCDual(a[o].c),{color:"gold",opacity:.2}),P.Layer.ZoneGateway.addLayer(t)}I.qTip.init(".leaflet-marker-icon")}M.toggleLayer(P.Layer.ZoneGateway,O.Options.bol_showZoneGateways)},drawChainPaths:function(e){if(I.isMapEnabled!==!1){var t,n,i,a,r,o;if(C.isChainWorldBoss(e))for(t=0;t<e.primaryEvents.length;t++){switch(i=e.primaryEvents[t],t){case 0:a="red";break;case 1:a="orange";break;case 2:a="yellow";break;case 3:a="lime";break;case 4:a="cyan";break;case 5:a="blue";break;case 6:a="violet";break;case 7:a="purple";break;default:a="white"}r=M.convertGCtoLCMulti(i.path,1),o=L.polyline(r,{color:a}),M.Zones[e.zone].Layers.Path.addLayer(o)}var s;for(t in e.events)n=e.events[t],s=n.num,-1!==s.indexOf(".")&&(s=s.replace(".","\\.")),$("#chnEvent_"+e.nexus+"_"+s).each(function(){var e=n.path[0];$(this).attr("data-coord",e[0]+","+e[1]),$(this).attr("data-eventindex",t),I.ModeCurrent!==I.ModeEnum.Mobile&&M.bindMapLinkBehavior($(this),M.ZoomEnum.Ground,M.Pin.Event)})}},generateDryTop:function(){$.getScript(U.URL_DATA.DryTop).done(function(){C.DryTop=GW2T_DRYTOP_EVENTS;var e,t,n,i,a;if(I.isMapEnabled){for(e in C.DryTop)i=C.DryTop[e],a=L.marker(M.convertGCtoLC(i.coord),{clickable:!1,icon:L.divIcon({className:"mapNick",html:"<span class='mapNickIn'>"+D.getObjectName(i)+"<br /><ins style='color:"+i.color+"'>"+i.time+"</ins></span>",iconSize:[512,64],iconAnchor:[256,32]})}),P.Layer.DryTopNicks.addLayer(a);M.toggleLayer(P.Layer.DryTopNicks,!0),P.DryTopTimer=L.marker(M.convertGCtoLC(M.getZoneCenter("dry")),{clickable:!1,icon:L.divIcon({className:"mapNick",html:"<div class='mapNickIn' id='mapDryTopInfo'><span id='mapDryTopTimer'></span><br /><input id='mapDryTopClip0' type='text' /> <input id='mapDryTopClip1' type='text' /></div>",iconSize:[512,64],iconAnchor:[256,32]})}),M.toggleLayer(P.DryTopTimer,!0);for(e in C.DryTopChains){n=C.DryTopChains[e];for(t in n.events)i=n.events[t],i.eventring=L.marker(M.convertGCtoLC(i.path[0]),{zIndexOffset:M.cZIndexBury,clickable:!1,icon:L.icon({iconUrl:"img/ring/"+i.ring+I.cPNG,iconSize:[32,32],iconAnchor:[16,16]})}),i.eventicon=L.marker(M.convertGCtoLC(i.path[0]),{title:"<span class='mapEvent'>"+D.getObjectName(i)+"</span>",wiki:D.getObjectName(i),icon:L.icon({iconUrl:"img/event/"+i.icon+I.cPNG,iconSize:[16,16],iconAnchor:[8,8]})}),M.bindMarkerWikiBehavior(i.eventicon,"click"),M.bindMarkerZoomBehavior(i.eventicon,"contextmenu"),$("#chnEvent_"+n.nexus+"_"+i.num).hasClass("chnEventCurrent")&&(P.LayerArray.DryTopActive.push(i.eventicon),P.LayerArray.DryTopActive.push(i.eventring),M.toggleLayer(i.eventring,!0),M.toggleLayer(i.eventicon,!0)),P.LayerArray.DryTopRings.push(i.eventring),P.LayerArray.DryTopIcons.push(i.eventicon)}I.qTip.init(".leaflet-marker-icon")}C.isDryTopGenerated=!0,T.initializeDryTopStrings(),P.toggleDryTopIcons(!0)})},toggleDryTopIcons:function(e){C.isDryTopGenerated&&I.isMapEnabled&&(C.isDryTopIconsShown=e,M.toggleLayer(P.Layer.DryTopNicks,e),M.toggleLayer(P.DryTopTimer,e),e?(M.toggleLayerArray(P.LayerArray.DryTopActive,e),P.adjustZoomDryTop(),I.qTip.init($("#mapDryTopClip0, #mapDryTopClip1").click(function(){$(this).select()}).hover(function(){M.isMouseOnHUD=!0},function(){M.isMouseOnHUD=!1}))):(M.toggleLayerArray(P.LayerArray.DryTopIcons,e),M.toggleLayerArray(P.LayerArray.DryTopRings,e))),K.updateDryTopClipboard()},adjustZoomDryTop:function(){if(C.isDryTopIconsShown){var e,t,n,i,a,r,o=M.Map.getZoom();switch(o){case 7:n=32,a=20,r=.9;break;case 6:n=28,a=16,r=.8;break;case 5:n=24,a=12,r=.6;break;case 4:n=20,a=0,r=0;break;case 3:n=16,a=0,r=0;break;default:n=0,a=0,r=0}i=M.scaleDimension(M.cRING_SIZE_MAX);for(e in P.LayerArray.DryTopIcons)t=P.LayerArray.DryTopIcons[e],M.resizeMarkerIcon(t,n),t=P.LayerArray.DryTopRings[e],M.resizeMarkerIcon(t,i);P.Layer.DryTopNicks.eachLayer(function(e){e._icon&&(e._icon.style.fontSize=a+"px",e._icon.style.opacity=r,e._icon.style.zIndex=M.cZIndexBury+1,e._icon.style.display="table")}),P.DryTopTimer._icon.style.fontSize=2*a+"px",P.DryTopTimer._icon.style.opacity=r,P.DryTopTimer._icon.style.zIndex=M.cZIndexRaise+1,P.DryTopTimer._icon.style.display="table"}},switchMapCheck:function(){if(void 0!==GPSIdentityJSON&&null!==GPSIdentityJSON){var e=P.GPSCurrentMap,t=GPSIdentityJSON.map_id,n="#"+P.WebsiteCurrentMap;void 0!==M.ZoneAssociation[t]?P.GPSCurrentMap=P.MapEnum.Tyria:void 0!==W.ZoneAssociation[t]&&(P.GPSCurrentMap=P.MapEnum.Mists),P.GPSCurrentMap!==e&&P.GPSCurrentMap!==P.WebsiteCurrentMap&&$(n+"SwitchButton").trigger("click")}},updateCharacter:function(e){var t,n=O.Options["int_setFollow"+P.SuffixCurrent],i=O.Options["bol_displayCharacter"+P.SuffixCurrent];switch(P.WebsiteCurrentMap){case P.MapEnum.Tyria:t=M;break;case P.MapEnum.Mists:t=W}if(void 0!==GPSPositionArray&&null!==GPSPositionArray&&3===GPSPositionArray.length&&!t.isUserDragging&&void 0!==GPSIdentityJSON&&null!==GPSIdentityJSON){var a=GPSIdentityJSON.map_id;if(t.isZoneValid(a)===!1)return t.movePin(t.Pin.Character),void t.movePin(t.Pin.Camera);var r=t.convertGPSCoord(GPSPositionArray,a);if(!(r[0]>t.cMAP_BOUND||r[0]<=0||r[1]>t.cMAP_BOUND||r[1]<=0)){var o;if(n===O.IntEnum.Follow.Character&&t.GPSPreviousCoord[0]!==r[0]&&t.GPSPreviousCoord[1]!==r[1]||e>=0?(t.Map.setView(t.convertGCtoLC(r),t.Map.getZoom()),t.showCurrentZone(r),t.GPSPreviousCoord=r,e=-1):n===O.IntEnum.Follow.Zone&&t.GPSPreviousZoneID!==a&&t.ZoneAssociation[a]&&(o=t.getZoneCenter(t.ZoneAssociation[a]),t.refreshView(o),t.showCurrentZone(o),t.GPSPreviousZoneID=a,e=-1),i){var s=-t.convertGPSAngle(GPSDirectionArray),c=-t.convertGPSAngle(GPSCameraArray);if(t.GPSPreviousAngleCharacter!==s||t.GPSPreviousAngleCamera!==c||0>=e){t.movePin(t.Pin.Character,r),t.movePin(t.Pin.Camera,r),t.Pin.Camera._icon.style.zIndex=t.cZIndexBury;var l=t.Pin.Character._icon.style.transform.toString(),u=t.Pin.Camera._icon.style.transform.toString();-1===l.indexOf("rotate")&&(t.Pin.Character._icon.style.transform=l+" rotate("+s+"deg)"),-1===u.indexOf("rotate")&&(t.Pin.Camera._icon.style.transform=u+" rotate("+c+"deg)"),t.GPSPreviousAngleCharacter=s,t.GPSPreviousAngleCamera=c}}}}},tickGPS:function(){(O.Options["int_setFollow"+P.SuffixCurrent]||O.Options["bol_displayCharacter"+P.SuffixCurrent])&&(P.updateCharacter(),window.clearTimeout(P.GPSTimeout),P.GPSTimeout=setTimeout(function(){P.tickGPS()},O.Options.int_msecGPSRefresh))}},G={generateAndInitializeDailies:function(){var e=new Date,t=function(){$("#dlyCalendar div:first").addClass("dlyCurrent").next().addClass("dlyNext"),$("#dlyCalendar .dlyEvent").each(function(){M.bindMapLinkBehavior($(this),M.ZoomEnum.Sky)}),I.bindPseudoCheckbox("#dlyCalendar ins"),I.qTip.init("#dlyCalendar ins")};$("#dlyHeader, #dlyCalendar, #dlyActivity").empty(),I.removeThrobber("#dlyContainer"),$("#dlyHeader").html(e.toLocaleString(window.navigator.language,{year:"numeric",month:"numeric",day:"numeric",weekday:"long"}));var n=T.Daily.Activity,i=n.Schedule[e.getUTCDay()],a=D.getObjectName(n.Activities[i]);$("#dlyActivity").html("<h2><img src='img/daily/activities/"+i+I.cPNG+"' /> <a"+U.convertExternalAnchor(U.getWikiLanguageLink(a))+">"+a+"</a> <ins class='dly dly_pve_activity'></ins></h2>"),$("#dlyCalendar").after(I.cThrobber),T.getDaily().done(function(){G.insertDailyDay(T.DailyToday,e),T.getDaily({aWantGetTomorrow:!0}).done(function(){I.removeThrobber("#dlyContainer"),G.insertDailyDay(T.DailyTomorrow,T.addDaysToDate(e,1)),t()})}).fail(function(){I.write("Unable to retrieve daily API.")}),$.getJSON(U.URL_API.Fractal,function(e){var t=T.Daily.Fractal,n=T.DailyAssociation[e.achievements[0]],i=T.DailyAssociation[e.achievements[1]];void 0!==n&&void 0!==i&&($("#dlyHeader").append(" <ins class='dly dly_pve_fractal'></ins><a title='"+D.getObjectName(t.Scale)+"' "+U.convertExternalAnchor(D.getObjectURL(t))+">"+n+"+"+i+"</a>"),I.qTip.init("#dlyHeader a"))}).fail(function(){I.write("Unable to retrieve daily fractal API.")})},insertDailyDay:function(e,t){var n,i,a,r,o,s,c,l="",u="",d="",p="",h="",m="",g="",f="</ins>",v="",b="</ins>",y="";switch(n=e.pve,i=e.pvp,a=e.wvw,r=n[0].split(" "),o=n[1].split(" "),p="<ins class='dlyRegion dly_region_"+r[1].toLowerCase()+"'>","Vista"===o[0]&&(h="<ins class='dlyRegion dly_region_"+o[1].toLowerCase()+"'>",v="</ins>"),m="<ins class='dlyRegion dly_region_"+M.getZoneRegion(n[2])+"'>",null!==n[3]&&C.getChainByAlias(n[3])&&(u="dly_pve_boss",g="<ins class='dlyRegion dly_region_"+C.getChainRegion(C.getChainByAlias(n[3]))+"'>",y="</ins>",d="<em><img src='img/chain/"+n[3].toLowerCase()+I.cPNG+"' /></em>"),s=i[2].split(" "),c=i[3].split(" "),t.getUTCDay()){case T.DayEnum.Sunday:l="dlySunday";break;case T.DayEnum.Saturday:l="dlySaturday"}var S=p+"<ins class='dly_pve_"+r[0].toLowerCase()+"' title='"+n[0]+"'></ins>"+f,_=h+"<ins class='dly_pve_"+o[0].toLowerCase()+"' title='"+n[1]+"'></ins>"+v,k=m+"<ins class='dly_pve_event dlyEvent curZoom' title='"+n[2]+" Events'data-coord='"+n[2].toLowerCase()+"'></ins>"+b,E=g+"<ins class='"+u+"' title='"+n[3]+"'></ins>"+y,P="<ins class='dly_pvp_"+i[0].toLowerCase()+"' title='"+i[0]+"'></ins>",L="<ins class='dly_pvp_"+i[1].toLowerCase()+"' title='"+i[1]+"'></ins>",w="<ins class='dly_pvp_profession_"+s[0].toLowerCase()+"_0' title='"+i[2]+"'><ins class='dly_pvp_profession_"+s[1].toLowerCase()+"_1'></ins></ins>",A="<ins class='dly_pvp_profession_"+c[0].toLowerCase()+"_0' title='"+i[3]+"'><ins class='dly_pvp_profession_"+c[1].toLowerCase()+"_1'></ins></ins>",O="<ins class='dly_wvw_"+a[0].toLowerCase()+"' title='"+a[0]+"'></ins>",D="<ins class='dly_wvw_"+a[1].toLowerCase()+"' title='"+a[1]+"'></ins>",x="<ins class='dly_wvw_"+a[2].toLowerCase()+"' title='"+a[2]+"'></ins>",N="<ins class='dly_wvw_"+a[3].toLowerCase()+"' title='"+a[3]+"'></ins>";$("#dlyCalendar").append("<div><aside></aside>"+d+"<var class='"+l+"'>"+t.getUTCDate()+"</var><span><ins class='dly_daily_pve'></ins>"+S+_+k+E+"</span><span><ins class='dly_daily_pvp'></ins>"+P+L+w+A+"</span><span><ins class='dly_daily_wvw'></ins>"+O+D+x+N+"</span></div>")},generateAndInitializeResources:function(){var e=.3,t=function(e){return X.getChecklistItem(X.Checklists["Resource"+e.options.grade],e.options.index)},n=function(e,t){X.setChecklistItem(X.Checklists["Resource"+e.options.grade],e.options.index,t)},i=function(){for(var n in P.LayerArray.Resource)P.LayerArray.Resource[n].eachLayer(function(n){n instanceof L.Marker&&t(n)===X.ChecklistEnum.Checked&&n.setOpacity(e)})},a=function(i){M.bindMarkerZoomBehavior(i,"contextmenu"),M.bindMarkerCoordBehavior(i,"dblclick"),i.on("click",function(){t(i)===X.ChecklistEnum.Checked?(n(i,X.ChecklistEnum.Unchecked),this.setOpacity(1)):(n(i,X.ChecklistEnum.Checked),this.setOpacity(e))})},r=function(){for(var e in P.Resources){var t=P.Resources[e].item;null!==t&&!function(e){$.ajax({dataType:"json",url:U.getAPIPrice(t),cache:!1,success:function(t){var n=E.processPrice(t).priceselltaxed;$("#nodPrice_"+e).html(E.formatCoinStringColored(n)),P.Resources[e].price=n}})}(e)}},o=function(e,t){return GW2T_RESOURCE_YIELD[e.type][t]},s=function(){var e,t,n,r,s,c,l=0;for(e in P.Resources){n=P.Resources[e],P.Resources[e].price=0;var u=e.toLowerCase();if(void 0!==n.riches&&n.riches.length>0){r=new L.layerGroup;for(t in n.riches)s=L.marker(M.convertGCtoLC(n.riches[t].c),{grade:"Rich",name:e,quantity:o(n,"Rich"),index:l,coord:n.riches[t].c,icon:L.divIcon({className:"nodRich",html:"<img src='img/node/"+u+I.cPNG+"' />",iconSize:[32,32],iconAnchor:[16,16]}),isNode:!0}),a(s),r.addLayer(s),void 0!==n.riches[t].p&&(c=L.polyline(M.convertGCtoLCMulti(n.riches[t].p),{color:"white",dashArray:"5,10",opacity:.3}),r.addLayer(c)),l++;M.toggleLayer(r),P.Layer["Resource_Rich_"+e]=r,P.LayerArray.Resource.push(r)}}X.initializeChecklist(X.Checklists.ResourceRich,l),i()},c=function(){var e,t,n,r,s,c=0,l=0;for(e in P.Resources){n=P.Resources[e],P.Resources[e].price=0;var u=e.toLowerCase();if(void 0!==n.regulars&&n.regulars.length>0){r=new L.layerGroup;for(t in n.regulars)s=L.marker(M.convertGCtoLC(n.regulars[t].c),{grade:"Regular",name:e,quantity:o(n,"Regular"),index:c,coord:n.regulars[t].c,icon:L.divIcon({className:"nodRegular",html:"<img src='img/node/"+u+I.cPNG+"' />",iconSize:[24,24],iconAnchor:[12,12]}),isNode:!0}),a(s),r.addLayer(s),c++;M.toggleLayer(r),P.Layer["Resource_Regular_"+e]=r,P.LayerArray.Resource.push(r)}if(void 0!==n.hotspots){r=new L.layerGroup;for(t in n.hotspots)s=L.marker(M.convertGCtoLC(n.hotspots[t].c),{grade:"Hotspot",name:e,quantity:o(n,"Hotspot"),index:l,coord:n.hotspots[t].c,icon:L.divIcon({className:"nodHotspot",html:"<img src='img/node/"+u+I.cPNG+"' />",iconSize:[24,24],iconAnchor:[12,12]}),isNode:!0}),a(s),r.addLayer(s),l++;M.toggleLayer(r),P.Layer["Resource_Hotspot_"+e]=r,P.LayerArray.Resource.push(r)}}X.initializeChecklist(X.Checklists.ResourceRegular,c),X.initializeChecklist(X.Checklists.ResourceHotspot,l),i()};$.getScript(U.URL_DATA.Resource).done(function(){var e,n;P.Resources=GW2T_RESOURCE_DATA,s();for(e in P.Resources)n=P.Resources[e],$("#nodResource_"+n.type).append("<label><input id='nod_"+e+"' type='checkbox' checked='checked' /> <img src='img/node/"+e.toLowerCase()+I.cPNG+"' /> <abbr>"+D.getObjectName(n)+"</abbr><var id='nodPrice_"+e+"'></var></label>");for(e in P.Resources)$("#nod_"+e).change(function(){var e=U.getSubstringFromHTMLID($(this)),t=$(this).prop("checked"),n=$("#nodShowPossible").prop("checked");
M.toggleLayer(P.Layer["Resource_Rich_"+e],t),M.toggleLayer(P.Layer["Resource_Regular_"+e],t&&n),M.toggleLayer(P.Layer["Resource_Hotspot_"+e],t&&n)});$("#mapToggle_Resource").data("checked",!0).click(function(){var t=I.toggleButtonState($(this));for(e in P.Resources)$("#nod_"+e).prop("checked",t).trigger("change")}),$("#nodRoute").click(function(){M.clearPersonalPins();var e,n,i=0,a=[],r=Number.POSITIVE_INFINITY,o=$("#nod_int_coinWaypointAverage").val(),s=$("#nod_int_secNodeVisitAverage").val(),c=0,l=0,u=0;M.Map.eachLayer(function(o){o instanceof L.Marker&&o.options.isNode&&t(o)===X.ChecklistEnum.Unchecked&&(u+=P.Resources[o.options.name].price*o.options.quantity,a.push(o.options.coord),e=a[i][0],r>e&&(r=e,n=i),i++)});var d=a.length;if(d>0){M.redrawPersonalPath(P.getGreedyPath(a,n),"default"),c=P.printClosestWaypoints()*o,l=d*s;var p="Gather Profit: <span class='cssRight'>"+E.formatCoinStringColored(u)+"</span><br />Waypoint Cost: <span class='cssRight'>"+E.formatCoinStringColored(c)+"</span><br /></br >Net Profit: <span class='cssRight'>"+E.formatCoinStringColored(u-c)+"</span><br /><br />Nodes to Visit: <span class='cssRight'>"+d+"</span><br />Estimated Time: <span class='cssRight'>"+T.getTimeFormatted({aCustomTimeInSeconds:l,aWantLetters:!0})+"</span>";I.print(p)}}),$("#nodToggle_ResourceMetal").click(function(){$("#nodResource_Metal input").trigger("click")}),$("#nodToggle_ResourcePlant").click(function(){$("#nodResource_Plant input").trigger("click")}),$("#nodToggle_ResourceWood").click(function(){$("#nodResource_Wood input").trigger("click")}),$("#nodShowPossible").one("click",function(){c()}),$("#nodShowPossible").change(function(){var e=$(this).prop("checked");for(var t in P.Resources){var n=$("#nod_"+t).prop("checked");M.toggleLayer(P.Layer["Resource_Regular_"+t],n&&e),M.toggleLayer(P.Layer["Resource_Hotspot_"+t],n&&e)}}).trigger("change"),$("#nodUncheck").click(function(){for(var e in P.LayerArray.Resource)P.LayerArray.Resource[e].eachLayer(function(e){e instanceof L.Marker&&e.setOpacity(1)});X.clearChecklist(X.Checklists.ResourceRich),X.clearChecklist(X.Checklists.ResourceRegular),X.clearChecklist(X.Checklists.ResourceHotspot)}),$("#nodRefresh").click(function(){r(),I.write("Prices refreshed.")}),r()})},generateAndInitializeJPs:function(){var e,t=function(t,n){var i=t.oMarker,a=i.options.difficulty,r=n?"jpzDifficulty0":"jpzDifficulty"+a;i.setIcon(new L.icon({className:r,iconUrl:"img/map/"+e[a].toLowerCase()+".png",iconSize:[32,32],iconAnchor:[16,16]}))};$.getScript(U.URL_DATA.JP).done(function(){e=GW2T_JP_DATA.Type,P.JPs=GW2T_JP_DATA.JP,X.Checklists.JP.length=O.getObjectLength(P.JPs),P.NodeArray.JP=P.createNodeArray(X.Checklists.JP.length);var n,i,a;for(var r in P.JPs){n=P.JPs[r],i=L.marker(M.convertGCtoLC(n.coord),{id:n.id,difficulty:n.difficulty,title:"<div class='mapLoc'><dfn>"+e[n.difficulty]+":</dfn> "+D.getObjectName(n)+"<img src='"+n.img+"' /></div>"}),P.NodeArray.JP[n.id].oMarker=i,t(P.NodeArray.JP[n.id]),n.path&&(a=L.polyline(M.convertGCtoLCMulti(n.path),{color:"white",dashArray:"5,10",opacity:.3}),P.NodeArray.JP[n.id].oPath=a);var o=D.getObjectName(n);$("<aside class='jpzItem'><dt id='jpz_"+n.id+"' data-coord='"+n.coord+"'>"+o+"</dt><label><input type='checkbox' id='jpzCheck_"+n.id+"' /></label>&nbsp;<cite><a href='"+U.getYouTubeLink(o)+"'>[Y]</a> <a href='"+U.getWikiLanguageLink(o)+"'>[W]</a></cite><dd>"+n.description+"</dd></aside>").data("keywords",o.toLowerCase()).appendTo("#jpzList_"+n.difficulty);var s=$("#jpz_"+n.id);s.attr("title","<div class='mapLoc'><img src='"+n.img+"' /></div>"),M.bindMapLinkBehavior(s,M.ZoomEnum.Same)}P.toggleNodeArray(P.NodeArray.JP,!0),M.bindMapLinks(".jpzList"),U.convertExternalLink(".jpzList a"),I.qTip.init(".jpzList dt"),$("#jpzToggleJP").change(function(){var e=$(this).prop("checked");if(P.toggleNodeArray(P.NodeArray.JP,e),e)for(var n=0;n<P.NodeArray.JP.length;n++){var i=P.NodeArray.JP[n],e=X.getChecklistItem(X.Checklists.JP,n);e===X.ChecklistEnum.Unchecked?t(i):t(i,!0)}}),$("#mapToggle_JP").data("checked",!0).click(function(){var e=I.toggleButtonState($(this));$("#jpzToggleJP").prop("checked",e).trigger("change"),$("#jpzToggleChest").prop("checked")&&$("#jpzToggleChest").prop("checked",e).trigger("change")}),I.qTip.init(".leaflet-marker-icon"),X.initializeChecklist(X.Checklists.JP,X.Checklists.JP.length);for(var c=function(){var e=X.countChecklist(X.Checklists.JP,X.ChecklistEnum.Checked),t=X.Checklists.JP.length;$("#jpzCounter").text(e+"/"+t)},r=0;r<X.Checklists.JP.length;r++)$("#jpzCheck_"+r).each(function(){var e=X.getChecklistItem(X.Checklists.JP,r,O.TypeEnum.isBoolean);$(this).prop("checked",e),e===!1?$(this).parent().prev().removeClass("jpzListNameChecked"):($(this).parent().prev().addClass("jpzListNameChecked"),t(P.NodeArray.JP[r],!0))}).change(function(){var e=X.getCheckboxEnumState($(this)),n=U.getSubintegerFromHTMLID($(this));e===X.ChecklistEnum.Unchecked?($(this).parent().prev().removeClass("jpzListNameChecked"),t(P.NodeArray.JP[n])):($(this).parent().prev().addClass("jpzListNameChecked"),t(P.NodeArray.JP[n],!0)),X.setChecklistItem(X.Checklists.JP,n,e),c()}).parent().hover(function(){$(this).prev().css({"text-decoration":"underline"}).trigger("mouseenter")},function(){$(this).prev().css({"text-decoration":"none"}).trigger("mouseleave")}),function(e){var t=P.NodeArray.JP[e].oMarker;t.on("click",function(){$("#jpzCheck_"+e).trigger("click"),I.scrollToElement("#jpz_"+this.options.id,{aContainer:"#plateMap"})}),M.bindMarkerZoomBehavior(t,"contextmenu")}(r);$("#jpzUncheckJP").click(function(){for(r=0;r<X.Checklists.JP.length;r++)$("#jpzCheck_"+r).prop("checked",!1).parent().prev().removeClass("jpzListNameChecked"),t(P.NodeArray.JP[r]);X.clearChecklist(X.Checklists.JP),c()}),I.bindSearchBar("#jpzSearch",".jpzItem"),c(),G.generateAndInitializeChests()})},generateAndInitializeChests:function(){P.Chests=GW2T_JP_DATA.Chest;var e=P.Chests.Basic.length+P.Chests.Splendid.length;X.initializeChecklist(X.Checklists.Chest,e);var t,n,i=0,a=.3,r=function(e){return X.getChecklistItem(X.Checklists.Chest,e.options.index)},o=function(e,t){X.setChecklistItem(X.Checklists.Chest,e.options.index,t)},s=function(){P.Layer.Chest.eachLayer(function(e){r(e)===X.ChecklistEnum.Checked?e.setOpacity(a):e.setOpacity(1)})},c=function(e,t,n){var i=null;e.t&&(i=e.t);var s=L.marker(M.convertGCtoLC(e.c),{index:n,icon:L.divIcon({className:"mapChest"+t,html:"<img src='img/map/chest.png' />",iconSize:[32,32],iconAnchor:[16,16]}),title:i});s.on("click",function(){r(this)===X.ChecklistEnum.Checked?(o(this,X.ChecklistEnum.Unchecked),this.setOpacity(1)):(o(this,X.ChecklistEnum.Checked),this.setOpacity(a))}),M.bindMarkerZoomBehavior(s,"contextmenu"),P.Layer.Chest.addLayer(s)};for(t in P.Chests)for(n in P.Chests[t])c(P.Chests[t][n],t,i),i++;$("#jpzToggleChest").change(function(){M.toggleLayer(P.Layer.Chest,$(this).prop("checked")),s()}),$("#jpzUncheckChest").click(function(){X.clearChecklist(X.Checklists.Chest),s()})},generateCollectiblesUI:function(){$.getScript(U.URL_DATA.Collectible).done(function(){P.Collectibles=GW2T_COLLECTIBLE_DATA;var e,t,n,i;for(e in P.Collectibles)t=P.Collectibles[e],n=D.getObjectName(t),i=D.getObjectDefaultName(t),$("#cltList").append("<div><label style='color:"+t.color+"'><ins class='clt_"+e.toLowerCase()+"'></ins><input id='ned_"+e+"' type='checkbox' /> "+n+"</label><span><cite><a href='"+U.getYouTubeLink(i)+"'>[Y]</a>&nbsp;<a href='"+t.wiki+"'>[W]</a>&nbsp;<a href='"+t.credit+"'>[C]</a>&nbsp;&nbsp;-&nbsp;&nbsp;</cite><a id='nedUncheck_"+e+"'>Reset</a></span></div>"),$("#ned_"+e).one("click",function(){var e=U.getSubstringFromHTMLID($(this));G.generateCollectibles(e),M.goToArguments(P.Collectibles[e].view)}),I.ArticleCurrent&&I.ArticleCurrent.toLowerCase()===X.Collectibles[e].urlkey&&($("#ned_"+e).trigger("click"),I.ArticleCurrent=null);U.convertExternalLink("#cltList cite a"),$("#mapToggle_Collectible").data("checked",!1).data("hideonly",!0).click(function(){for(e in P.Collectibles)$("#ned_"+e).prop("checked")&&$("#ned_"+e).trigger("click")}),I.scrollToElement("#headerMap_Collectible",{aContainer:"#plateMap"})})},generateCollectibles:function(e){var t,n,i,a,r,o,s,c,l,u,d=U.Args[X.Collectibles[e].urlkey],p=P.Collectibles[e],h=D.getObjectName(p),m="img/collectible/"+e.toLowerCase()+"/",g=function(e,t){if(p.iconsize){var n=p.ringsize||16;e.setIcon(new L.divIcon({className:"mapNeedle"+t,html:"<span class='mapNeedleIcon' style='color:"+p.color+";background-image: url("+e.options.needleLabel+");background-size: "+p.iconsize+"px'></span>",iconSize:[n,n],iconAnchor:[n/2,n/2]}))}else e.setIcon(new L.divIcon({className:"mapNeedle"+t+" mapNeedleExtreme"+e.options.needleExtreme,html:"<span style='color:"+p.color+"'>"+e.options.needleLabel+"</span>",iconSize:[16,16],iconAnchor:[8,8]}));t===X.ChecklistEnum.Found?e.setOpacity(.2):e.setOpacity(1)},f=function(t,n){var i=L.marker(M.convertGCtoLC(t),n);g(i,s),i.on("click",function(e){var t=X.trackChecklistItem(X.Collectibles[this.options.needleType],this.options.needleIndex),n=this;p.iscushion?P.LayerArray[this.options.needleType].forEach(function(e){e.options.needleIndex===n.options.needleIndex&&g(e,t)}):g(this,t);var i=X.getCheckedIndexes(X.Collectibles[this.options.needleType]);0===i.length?U.updateQueryString():U.updateAddressBar("?"+this.options.needleKey+"="+i)}),M.bindMarkerZoomBehavior(i,"contextmenu"),P.LayerArray[e].push(i)};for(X.Collectibles[e].length=P.Collectibles[e].needles.length,X.initializeChecklist(X.Collectibles[e],X.Collectibles[e].length,d),P.LayerArray[e]=[],P.Layer[e]=new L.layerGroup,t=0;t<p.needles.length;t++)if(i=t+1,r=p.needles[t],s=X.getChecklistItem(X.Collectibles[e],t),u="<div class='mapLoc'><dfn>"+h+":</dfn> #"+i+(p.iscushion?"<br />"+r.p:""),r.i?u+="<img src='"+r.i+"' />":r.t&&(u+="<br /><span class='mapTip'>"+r.t+"</span>"),u+="</div>",a=0===t||t===p.needles.length-1?0:void 0===r.e?"":r.e,o={needleExtreme:a,needleIndex:t,needleType:e,needleKey:X.Collectibles[e].urlkey,needleLabel:p.iconsize?m+r.p.replace(/ /g,"").toLowerCase()+I.cPNG:void 0===r.l?i:r.l,title:u},p.iscushion)for(n=0;n<r.c.length;n++)f(r.c[n],o);else f(r.c,o),t<p.needles.length-1&&(l=2===r.e?"5,15":"1",c=L.polyline(M.convertGCtoLCDual([r.c,p.needles[t+1].c]),{color:"lime",dashArray:l,opacity:.5}),P.Layer[e].addLayer(c));M.toggleLayerArray(P.LayerArray[e],!0),M.toggleLayer(P.Layer[e],!0),$("#ned_"+e).change(function(){var t=$(this).prop("checked"),n=U.getSubstringFromHTMLID($(this));M.toggleLayerArray(P.LayerArray[n],t),M.toggleLayer(P.Layer[n],t),t&&(M.goToArguments(P.Collectibles[n].view),I.qTip.init(".leaflet-marker-icon")),"RangerPets"===e&&G.generatePetsList(p.needles,t)}),$("#nedUncheck_"+e).click(function(){var e=U.getSubstringFromHTMLID($(this)),t=P.LayerArray[e];for(var n in t)g(t[n],X.ChecklistEnum.Unfound);X.clearChecklist(X.Collectibles[e]),U.updateQueryString()})},generatePetsList:function(e,t){var n="RangerPets",i=$("#cltSublist"+n),a=i.find(".cltSublistContainer");if(i.toggle(t),$(".cltPetIcon").removeClass("cltPetIconFocused"),a.is(":empty")===!1)return void I.scrollToElement(i,{aContainer:"#plateMap"});for(var r,o,s,c,l,u,d,p,h=D.getWord("s"),m=0;m<e.length;m++){r=e[m],c=r.p,p="img/collectible/rangerpets/"+c.replace(/ /g,"").toLowerCase()+I.cPNG;var g="<div class='cltPetSkill'><span class='cltPetIcon curToggle' title='"+c+"' style='background-image:url("+p+")'><var class='cltPetIconBackground'>"+I.Symbol.Filler+"</var></span><aside class='cltPetFacts'>";for(var f in r.s)o=r.s[f],Array.isArray(o)?(d="("+o[1]+h+")",u=o[0]>1?"<var class='cltPetStack'>"+o[0]+"</var>"+d:d):u=o,g+="<span class='cltPetFact'><img class='cltPetFactIcon' src='img/fact/"+f+I.cPNG+"' /><var class='cltPetFactText'>"+u+"</var></span>";g+="</aside></div>",s=$(g).appendTo(a),function(e,t){s.find(".cltPetIcon").click(function(){var t=$(this).hasClass("cltPetIconFocused");if($(".cltPetIcon").removeClass("cltPetIconFocused"),t)M.toggleLayerArray(P.LayerArray[n],!0);else{for(var i=0;i<P.LayerArray[n].length;i++)l=P.LayerArray[n][i],l.options.needleIndex===e?M.toggleLayer(l,!0):M.toggleLayer(l,!1);$(this).addClass("cltPetIconFocused")}}).dblclick(function(){U.openExternalURL(U.getWikiLink("Juvenile "+t))})}(m,c)}I.qTip.init(a.find(".cltPetIcon")),setTimeout(function(){I.scrollToElement(i,{aContainer:"#plateMap"})},200)},generateGuildUI:function(){var e=function(e){M.toggleLayerArray(P.LayerArray["Guild_"+e],!1),$("#gldBook_"+e+" dfn").each(function(){I.toggleHighlight($(this),!1)}),void 0!==P.Guild[e].usedSubmaps&&M.toggleSubmapArray(P.Guild[e].usedSubmaps,!1)},t=function(e){U.convertExternalLink("#gldBook_"+e+" a"),I.qTip.init("#gldBook_"+e+" dfn"),$("#gldBook_"+e+" .cssWaypoint").each(function(){I.initializeClipboard($(this)[0])})};$.getScript(U.URL_DATA.Guild).done(function(){P.Guild=GW2T_GUILD_DATA;var n;for(n in P.Guild){var i=P.Guild[n],a=D.getObjectName(i);$("#gldButtons").append("<div><button class='gldButton curToggle btnTab' id='gldButton_"+n+"' style='background-size:cover; background-image:url(img/guild/"+n.toLowerCase()+I.cPNG+")' title='<dfn>"+a+"</dfn><br />gw2timer.com/guild/"+n.toLowerCase()+"'></button><a class='cssButton' href='"+U.getYouTubeLink(a)+"'>Y</a>&nbsp;<a class='cssButton' href='"+D.getObjectURL(i)+"'>W</a></div>"),$("#gldBooks").append("<div class='gldBook' id='gldBook_"+n+"'></div>")}if($(".gldBook").hide(),I.qTip.init("#gldButtons button"),U.convertExternalLink("#gldButtons a"),$(".gldButton").click(function(){$(".gldButton").removeClass("btnFocused");var t=U.getSubstringFromHTMLID($(this)),n=!0;$("#gldBook_"+t).is(":visible")&&(e(t),n=!1),$(".gldBook").hide(),n&&($(this).addClass("btnFocused"),$("#gldBook_"+t).show()),I.updateScrollbar()}),$("#mapToggle_Guild").data("hideonly",!0).click(function(){$(".gldButton").removeClass("btnFocused").each(function(){e(U.getSubstringFromHTMLID($(this))),$(".gldBook").hide(),I.updateScrollbar()}),M.movePin(M.Pin.Program)}),$("#gldButton_Bounty").one("click",function(){O.sortObjects(P.Guild.Bounty.data);for(var e in P.Guild.Bounty.data){var n=P.Guild.Bounty.data[e],i=D.getObjectDefaultName(n),a=D.getObjectName(n);$("#gldBook_Bounty").append("<div><img class='cssWaypoint jsClip' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Bounty)+": "+a+"' src='img/ui/placeholder.png' /> <dfn id='gldBounty_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+a+"</dfn> <a href='"+U.getYouTubeLink(i)+"'>[Y]</a> <a href='"+U.getWikiLink(i)+"'>[W]</a></div>");var r=new L.layerGroup;if(void 0!==n.paths)for(var o in n.paths)r.addLayer(P.drawDirectedPath(n.paths[o]));void 0!==n.spawn&&r.addLayer(P.drawSpots(n.spawn)),P.LayerArray.Guild_Bounty.push(r);var s=$("#gldBounty_"+e);s.attr("title","<div class='mapLoc'><img src='"+n.img+"' /></div>").click(function(){I.toggleHighlight($(this)),M.toggleLayer(P.LayerArray.Guild_Bounty[U.getSubintegerFromHTMLID($(this))])}),M.bindMapLinkBehavior(s,M.invertZoomLevel(n.coord[2]))}t("Bounty")}),$("#gldButton_Trek").one("click",function(){O.sortObjects(P.Guild.Trek.data);for(var e in P.Guild.Trek.data){var n=P.Guild.Trek.data[e],i=D.getObjectName(n);$("#gldBook_Trek").append("<div><img class='cssWaypoint' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Trek)+": "+i+"' src='img/ui/placeholder.png' /> <dfn id='gldTrek_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+i+"</dfn></div>");var a=new L.layerGroup;a.addLayer(L.polyline(M.convertGCtoLCMulti(n.path),{color:"gold"})),P.LayerArray.Guild_Trek.push(a);var r=$("#gldTrek_"+e);r.attr("title","<div class='mapLoc'><img src='"+n.img+"' /></div>").click(function(){I.toggleHighlight($(this)),M.toggleLayer(P.LayerArray.Guild_Trek[U.getSubintegerFromHTMLID($(this))])}),M.bindMapLinkBehavior(r,M.ZoomEnum.Ground,M.Pin.Program)}t("Trek")}),$("#gldButton_Challenge").one("click",function(){P.Guild.Challenge.usedSubmaps=[],O.sortObjects(P.Guild.Challenge.data);for(var e in P.Guild.Challenge.data){var n=P.Guild.Challenge.data[e],i=D.getObjectDefaultName(n),a=D.getObjectName(n);$("#gldBook_Challenge").append("<div><img class='cssWaypoint' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Challenge)+": "+a+"' src='img/ui/placeholder.png' /> <dfn id='gldChallenge_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+a+" - "+n.limit+"</dfn> <a href='"+U.getYouTubeLink(i)+"'>[Y]</a> <a href='"+U.getWikiLink(i)+"'>[W]</a></div>"),void 0!==n.submap&&(M.toggleSubmap(n.submap,!1),P.Guild.Challenge.usedSubmaps.push(n.submap));var r=new L.layerGroup;r.addLayer(L.polyline(M.convertGCtoLCMulti(n.path),{color:"gold"})),r.addLayer(P.drawSpots(n.spawn,{color:"gold"})),P.LayerArray.Guild_Challenge.push(r);var o=$("#gldChallenge_"+e);o.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=P.Guild.Challenge.data[e].submap,n=I.toggleHighlight($(this));void 0!==t&&M.toggleSubmap(t,n),M.toggleLayer(P.LayerArray.Guild_Challenge[e])}),M.bindMapLinkBehavior(o,M.ZoomEnum.Ground,M.Pin.Program)}t("Challenge")}),$("#gldButton_Rush").one("click",function(){P.Guild.Rush.usedSubmaps=[],O.sortObjects(P.Guild.Rush.data);for(var e in P.Guild.Rush.data){var n=P.Guild.Rush.data[e],i=D.getObjectDefaultName(n),a=D.getObjectName(n);$("#gldBook_Rush").append("<div><img class='cssWaypoint' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Rush)+": "+a+"' src='img/ui/placeholder.png' /> <dfn id='gldRush_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+a+"</dfn> <a href='"+U.getYouTubeLink(i)+"'>[Y]</a> <a href='"+U.getWikiLink(i)+"'>[W]</a></div>"),void 0!==n.submap&&(M.toggleSubmap(n.submap,!1),P.Guild.Rush.usedSubmaps.push(n.submap));var r=new L.layerGroup;r.addLayer(L.polyline(M.convertGCtoLCMulti(n.path),{color:"gold"})),r.addLayer(L.polyline(M.convertGCtoLCMulti(n.track),{color:"lime",dashArray:"5,10"})),r.addLayer(L.marker(M.convertGCtoLC(n.finish),{icon:M.createStandardIcon("img/map/chest.png")})),void 0!==n.traps0&&r.addLayer(P.drawSpots(n.traps0,{radius:5,color:"red",weight:1,opacity:1})),void 0!==n.traps1&&r.addLayer(P.drawSpots(n.traps1,{radius:10,color:"red",weight:1,opacity:1})),r.addLayer(P.drawSpots(n.flags,{radius:2,color:"gold",weight:2,opacity:1})),P.LayerArray.Guild_Rush.push(r);var o=$("#gldRush_"+e);o.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=P.Guild.Rush.data[e].submap,n=I.toggleHighlight($(this));void 0!==t&&M.toggleSubmap(t,n),M.toggleLayer(P.LayerArray.Guild_Rush[e])}),M.bindMapLinkBehavior(o,M.ZoomEnum.Ground,M.Pin.Program)}t("Rush")}),$("#gldButton_Puzzle").one("click",function(){P.Guild.Puzzle.usedSubmaps=[],O.sortObjects(P.Guild.Puzzle.data);for(var e in P.Guild.Puzzle.data){var n=P.Guild.Puzzle.data[e],i=D.getObjectDefaultName(n),a=D.getObjectName(n);$("#gldBook_Puzzle").append("<div><img class='cssWaypoint' "+I.cClipboardAttribute+"='"+n.wp+" "+D.getObjectName(P.Guild.Puzzle)+": "+a+"' src='img/ui/placeholder.png' /> <dfn id='gldPuzzle_"+e+"' data-coord='["+n.coord[0]+","+n.coord[1]+"]'>"+a+" - "+n.limit+"</dfn> <a href='"+U.getYouTubeLink(i)+"'>[Y]</a> <a href='"+U.getWikiLink(i)+"'>[W]</a></div>"),void 0!==n.submap&&(M.toggleSubmap(n.submap,!1),P.Guild.Puzzle.usedSubmaps.push(n.submap));var r=new L.layerGroup;r.addLayer(P.drawSpots(n.interactions,{color:"gold"})),r.addLayer(L.marker(M.convertGCtoLC(n.finish),{icon:M.createStandardIcon("img/map/chest.png")})),P.LayerArray.Guild_Puzzle.push(r);var o=$("#gldPuzzle_"+e);o.click(function(){var e=U.getSubintegerFromHTMLID($(this)),t=P.Guild.Puzzle.data[e].submap,n=I.toggleHighlight($(this));void 0!==t&&M.toggleSubmap(t,n),M.toggleLayer(P.LayerArray.Guild_Puzzle[e])}),M.bindMapLinkBehavior(o,M.ZoomEnum.Ground,M.Pin.Program)}t("Puzzle")}),I.ArticleCurrent)for(n in P.Guild)if(I.ArticleCurrent.toLowerCase()===n.toLowerCase()){$("#gldButton_"+n).trigger("click"),I.ArticleCurrent=null;break}})}},W={MapEnum:"wvw",OptionSuffix:"WvW",ZoneAssociation:GW2T_LAND_ASSOCIATION,cInitialZone:"eternal",cMAP_BOUND:16384,cMAP_CENTER:[10750,12414],cMAP_CENTER_INITIAL:[-193.96875,167.96875],cMAP_CENTER_ACTUAL:[8192,8192],ZoomEnum:{Adaptive:-2,Same:-1,Min:0,Overview:2,Default:3,Space:3,Sky:4,Bird:5,Ground:6,Max:6},Layer:{Overview:new L.layerGroup,Pin:new L.layerGroup,PersonalPin:new L.layerGroup,PersonalPath:new L.layerGroup,WeaponIcon:new L.layerGroup,WeaponCircle:new L.layerGroup,Destructible:new L.layerGroup,Secondaries:new L.layerGroup,Objective:new L.layerGroup,SpawnLabel:new L.layerGroup},LayerArray:{},Pin:{Program:{},Event:{},Over:{},Character:{},Camera:{}},LocaleThreshold:{Range:99,Americas:1e3,Europe:2e3,France:2100,Germany:2200,Spain:2300},LocaleEnum:{Americas:"Americas",Europe:"Europe"},LocaleCurrent:null,BorderlandsCurrent:null,BorderlandsEnum:{Alpine:"Alpine",Desert:"Desert"},isWvWLoaded:!1,Metadata:{},Servers:{},Matches:null,MatchupCurrent:null,Guilds:{},Objectives:{},ObjectiveTimeout:{},Weapons:{},Placement:{},MapType:{},LandEnum:{},ObjectiveEnum:{},OwnerEnum:{},MatchupIDCurrent:null,isObjectiveTickEnabled:!1,isObjectiveTimerTickEnabled:!1,isAPIFailed:!1,isFallbackEnabled:!1,numFailedAPICalls:0,cOWNERS_PER_TIER:3,cSECONDS_IMMUNITY:300,cMSECONDS_IMMUNITY:3e5,cMSECONDS_RESET_GRACE:9e5,MatchStartTimeMS:null,MatchFinishTimeMS:null,MatchFinishTimeISO:null,secTillWvWReset:null,numSiegeSupply:0,initializeWvW:function(){$.extend(W,$.extend({},M,W)),W.Zones=GW2T_LAND_DATA,W.Regions=GW2T_REALM_DATA,W.Servers=GW2T_SERVER_DATA,W.Objectives=GW2T_OBJECTIVE_DATA,W.Weapons=GW2T_WEAPON_DATA,W.Placement=GW2T_PLACEMENT_DATA,W.Metadata=GW2T_WVW_METADATA,W.MapType=W.Metadata.MapType,W.LandEnum=W.Metadata.LandEnum,W.ObjectiveEnum=W.Metadata.ObjectiveEnum,W.OwnerEnum=W.Metadata.OwnerEnum,W.initializeMap(),W.populateWvW(),W.initializeLeaderboard(),W.initializeLog(),W.reinitializeServerChange(),W.generateServerList(),I.styleContextMenu("#wvwContext"),U.convertExternalLink("#wvwHelpLinks a"),$("#wvwToolsButton").one("mouseenter",W.initializeSupplyCalculator),W.isWvWLoaded=!0,U.openSectionFromURL({aButton:"#lboRegion",aSection:"Leaderboard"})},populateWvW:function(){W.BorderlandsCurrent=W.BorderlandsEnum.Desert;var e,t;for(var n in W.Objectives)e=W.Objectives[n],t=L.marker(this.convertGCtoLC(e.coord),{clickable:!0,riseOnHover:!0,icon:L.divIcon({className:"",html:"<div id='obj_"+e.id+"' class='objContainer'><span class='objUmbrellaContainer'><span class='objUmbrellaOuter'><span id='objUmbrella_"+e.id+"' class='objUmbrella'></span></span></span><time id='objTimer_"+e.id+"' class='objTimer'></time><span class='objProgressContainer'><span id='objProgressBar_"+e.id+"' class='objProgressBar'><var id='objProgress_"+e.id+"' class='objProgress'></var></span></span><span class='objIconContainer'><img id='objIcon_"+e.id+"' class='objIcon' data-src='img/wvw/objectives/"+e.type.toLowerCase()+"_' src='img/ui/placeholder.png'/></span><span class='objInfo'><cite id='objClaim_"+e.id+"' class='objClaim'></cite> <cite id='objAge_"+e.id+"' class='objAge'></cite></span></div>",iconSize:[38,38],iconAnchor:[19,19]})}),this.bindMarkerZoomBehavior(t,"contextmenu"),e.Marker=t,this.Layer.Objective.addLayer(t);this.toggleLayer(this.Layer.Objective,!0);var i=W.Metadata.SpawnLabels;for(var n in i){var a=i[n];for(var r in a){var o=a[r];t=L.marker(this.convertGCtoLC(o),{clickable:!1,icon:L.divIcon({className:"mapSec",html:"<span class='mapSecIn wvwSpawnLabel wvwColor"+r+"' data-owner='"+r+"'></span>",iconSize:[512,64],iconAnchor:[256,32]})}),this.Layer.SpawnLabel.addLayer(t)}}this.toggleLayer(this.Layer.SpawnLabel,!0),W.toggleObjectiveLabels(),O.Options.bol_showWorldCompletionWvW===!1&&W.finishPopulation()},finishPopulation:function(){W.toggleSecondaries(),W.toggleWalls(),W.bindMapVisualChanges(),W.adjustZoomMapping(),I.ModeCurrent===I.ModeEnum.Overlay&&P.tickGPS()},toggleSecondaries:function(e){if(O.Options.bol_showSecondaries&&0===W.Layer.Secondaries.getLayers().length){var t=function(e,t,n){if(void 0!==e)for(var i in e){var a=W.Metadata.Offsets[n],r=e[i],o=L.marker(W.convertGCtoLC([r[0]+a[0],r[1]+a[1]]),{clickable:!1,icon:L.icon({iconUrl:"img/wvw/secondaries/"+t+I.cPNG,iconSize:[32,32],iconAnchor:[16,16]}),opacity:.9});W.Layer.Secondaries.addLayer(o)}};for(var n in W.Placement){var i=W.Placement[n];for(var a in i.ZoneNicks){var r=i.ZoneNicks[a];t(i.ShrineEarth,"shrine_earth",r),t(i.ShrineFire,"shrine_fire",r),t(i.ShrineAir,"shrine_air",r),t(i.Sentry,"sentry",r),t(i.Depot,"depot",r)}}e&&W.adjustZoomMapping()}W.toggleLayer(W.Layer.Secondaries,O.Options.bol_showSecondaries)},toggleWalls:function(e){var t="coral",n="orange",i="yellow";if(O.Options.bol_showDestructibles&&0===W.Layer.Destructible.getLayers().length){var a=function(e,t,n){var i=W.Metadata.Offsets[n];for(var a in e){var r=e[a],o=[r[0][0]+i[0],r[0][1]+i[1]],s=[r[1][0]+i[0],r[1][1]+i[1]],c=L.polyline(W.convertGCtoLCDual([o,s]),{clickable:!1,color:t,opacity:.8,weight:10,lineCap:"butt"});W.Layer.Destructible.addLayer(c)}};for(var r in W.Placement){var o=W.Placement[r];for(var s in o.ZoneNicks){var c=o.ZoneNicks[s];a(o.Barricade,t,c),a(o.Wall,n,c),a(o.Gate,i,c)}}e&&W.adjustZoomMapping()}W.toggleLayer(W.Layer.Destructible,O.Options.bol_showDestructibles)},toggleObjectiveLabels:function(){$(".objInfo, .wvwSpawnLabel").toggle(O.Options.bol_showObjectiveLabels)},getName:function(e){return D.getObjectName(W.Metadata[e])},getNick:function(e){return D.getObjectNick(W.Metadata[e])},formatMatchup:function(e){var t,n,i,a,r=0,o=W.Metadata.Alliances.length,s=W.Metadata.Alliances,c=new Array(o),l=new Array(o),u=new Array(o),d=new Array(o),p=new Array(o),h=new Array(o),m={};if(m.id=r,e.wvw_match_id){r=e.wvw_match_id;for(var g=0;o>g;g++)t=s[g],i=e[t+"_world_id"],c[g]=new Array,c[g].push(W.Servers[i]);m.worlds=W.convertWorlds(e)}else{r=e.id;for(var f=e.all_worlds,g=0;o>g;g++){t=s[g],a=f[t],c[g]=new Array;for(var C=0;C<a.length;C++)c[g].push(W.Servers[a[C]])}m.worlds=e.worlds}for(var g=0;o>g;g++){t=s[g],n=U.toFirstUpperCase(t),l[g]=new Array,u[g]=new Array,d[g]=new Array,p[g]=new Array,h[g]=D.getObjectName(W.Metadata[n]);for(var C=0;C<c[g].length;C++){var v=c[g][C];v.owner=n;var T=U.escapeHTML(D.getObjectName(v));l[g]+=T,u[g]+=T,d[g]+="<a href='/?page=WvW&enu_Server="+v.id+"'>"+T+"</a>",p[g]+=D.getObjectNick(v),c[g].length>1&&C<c[g].length-1&&(l[g]+=" &amp; ",u[g]+="<br />",d[g]+=" &amp; ",p[g]+=" "),v.id===O.Options.enu_Server&&(m.ownercurrent=n)}}for(var g=0;o>g;g++)t=s[g],m[t]={servers:c[g],namestr:l[g],namelinestr:u[g],namelinkstr:d[g],nickstr:p[g],color:h[g]};return m},getAllianceFromOwner:function(e){return W.MatchupCurrent[e.toLowerCase()]},getBorderlandsString:function(e,t){var n,i,a=t||{},r="string"==typeof e?W.Servers[W.MatchupCurrent.worlds[e]]:e,o=e.map_type;if(void 0!==o){var s=W.MapType[o];if("center"===s)return W.getNick("Center");r=W.Servers[W.MatchupCurrent.worlds[s]]}return n=a.aWantServerNick?D.getObjectNick(r):D.getObjectName(r),i=a.aWantBorderlandsNick?W.getNick("Borderlands"):W.getName("Borderlands"),a.aWantPronoun&&r.owner===W.MatchupCurrent.ownercurrent?W.getName("Our")+" "+i:D.orderModifier(i,n)},getObjectiveNick:function(e,t){if(void 0!==e.direction){var n=t?W.getName(e.direction):W.getNick(e.direction),i=W.getName(e.type);return n+" "+i}return void 0!==e.alias?W.getName(e.alias):D.getObjectNick(e)},getObjectiveTypeValue:function(e){return W.Metadata.ObjectiveType[e].Value.each},getTotalPPTPossible:function(){return W.Metadata.ObjectiveType.Total.Value.all},getMatchupTier:function(e){var t=W.isFallbackEnabled?"match_id":"id";return parseInt(e[t].split("-")[1])},generateServerList:function(){var e=[];for(var t in W.Servers)e.push(W.Servers[t]);O.sortObjects(e);var n,i,a=$("#wvwServerList");for(var t in e)n=e[t],i=n.id===O.Options.enu_Server?"selected":"",a.append("<option value='"+n.id+"' "+i+">"+D.getObjectName(n)+"</option>");a.change(function(){var e=$(this).val();O.Options.enu_Server=e,localStorage.enu_Server=O.Options.enu_Server,U.updateQueryString("enu_Server="+e),W.reinitializeServerChange()}),I.preventMapPropagation(a),I.blinkElement(a,5e3,250)},initializeLeaderboard:function(){$("#lboToggle").click(function(){$("#opt_bol_showLeaderboard").trigger("click")}),$("#lboCondense").click(function(){$("#opt_bol_condenseLeaderboard").trigger("click")}),$("#lboRegion").click(function(){W.toggleRegionLeaderboard()}),$("#lboOpaque").click(function(){$("#opt_bol_opaqueLeaderboard").trigger("click")}),W.toggleLeaderboard(),W.opaqueLeaderboard(),W.toggleLeaderboardWidth(),I.initializeScrollbar("#lboOther")},toggleRegionLeaderboard:function(){var e=$("#lboOther");if(e.is(":empty")===!1||null===W.LocaleCurrent)return void e.animate({height:0},"fast",function(){e.empty().css({height:"auto"})});var t=W.Metadata.MatchIDs[W.LocaleCurrent];for(var n in t){var i=t[n],a=W.isFallbackEnabled?U.URL_API.MatchFallback+i:U.URL_API.Matches+i,r="lboOther_"+i;i!==W.MatchupIDCurrent&&(e.append("<div id='"+r+"'></div>"),function(e){$.getJSON(a,function(t){var n=W.formatMatchup(t);W.insertScoreboard(t,n,$("#"+e)),W.readjustLeaderboard(),I.updateScrollbar("#lboOther")})}(r,i))}},insertScoreboard:function(e,t,n){var i=function(e){return W.isFallbackEnabled?{red:e[0],blue:e[1],green:e[2]}:e};t=t||W.MatchupCurrent;var a,r,o,s,c,l,u,d,p=W.Metadata.Owners.length,h=W.getMatchupTier(e),m=i(e.scores),g={},f=!0;for(var C in W.Metadata.Owners){var v=W.Metadata.Owners[C];g[v]={},g[v].Total=0,g[v][W.LandEnum.RedHome]=0,g[v][W.LandEnum.BlueHome]=0,g[v][W.LandEnum.GreenHome]=0,g[v][W.LandEnum.Center]=0;for(var b in W.Metadata.Owners)g[v][W.LandEnum.Center+W.Metadata.Owners[b]]=0}for(var C in e.maps){a=e.maps[C],s=W.Metadata.LandPrefix[a.type];for(var b in a.objectives)o=a.objectives[b],c=W.isFallbackEnabled?s+o.id:o.id,r=W.Objectives[c],v=o.owner,l=r.map_type,u=W.getObjectiveTypeValue(r.type),d=r.nativeowner,v!==W.OwnerEnum.Neutral&&(g[v].Total+=u,g[v][l]+=u,l===W.LandEnum.Center&&(g[v][W.LandEnum.Center+d]+=u))}var y;void 0===n?(y=$("#lboCurrent"),y.empty(),(I.ModeCurrent===I.ModeEnum.Overlay||I.isProgramEmbedded)&&(f=!1)):y=n;for(var S="<section>",C=0;p>C;C++){var v=W.Metadata.Owners[C],_=v.toLowerCase(),k=(h-1)*W.cOWNERS_PER_TIER+(C+1),E=(t.worlds[_],f?"<aside class='lboRank'>"+k+".</aside><aside class='lboName'>&nbsp;"+t[_].namelinkstr+"</aside>":""),M=m[_],P=T.getMinMax(m).max,L=m[_]/P*T.cPERCENT_100,w=g[v].Total,A=w/W.getTotalPPTPossible()*T.cPERCENT_100,x="";if(void 0!==e.kills&&W.isFallbackEnabled===!1){var N=void 0!==e.kills?e.kills[_]:"",R=void 0!==e.deaths?e.deaths[_]:"",B=T.parseRatio(N/R,3),H=T.parseRatio(N/(N+R))*T.cPERCENT_100;x="<aside class='lboKD' title='<dfn>Kills to Deaths ratio:</dfn> "+B+"'><var class='lboKills'>"+N.toLocaleString()+"</var><samp><s style='width:"+H+"%'><mark></mark></s></samp><var class='lboDeaths'>"+R.toLocaleString()+"</var></aside>"}for(var z=[],G=[],F=[],b=0;p>b;b++){var j=W.Metadata.Owners[b],K=j.toLowerCase();if(j!==v){var X=g[v][j+"Home"]+g[v][W.LandEnum.Center+j];z.push(X);var Z=M-m[K];G.push(Z);var q=W.Servers[t.worlds[K]];F.push(U.escapeHTML(D.getObjectName(q)))}}var V,Y,J=z[0]+z[1],Q="";J>0?(V=Math.round(z[0]/J*T.cPERCENT_100),Y=Math.round(z[1]/J*T.cPERCENT_100)):(V=0,Y=0,Q="lboFocusZero");var ee,te;for(var b in e.maps){var a=e.maps[b],ne=i(a.scores);switch(a.type){case W.Metadata.Opposites[v][0]+"Home":ee=ne[_];break;case W.Metadata.Opposites[v][1]+"Home":te=ne[_]}}var ie,ae,re=ee+te,oe="";re>0?(ie=Math.round(ee/re*T.cPERCENT_100),ae=Math.round(te/re*T.cPERCENT_100)):(ie=0,ae=0,oe="lboFocusZero"),S+="<article class='lboServer lboServer"+v+"'>"+E+"<aside class='lboScore' title='<dfn>"+G[0]+" points</dfn> away from "+F[0]+"<br /><dfn>"+G[1]+" points</dfn> away from "+F[1]+"'><var>"+M.toLocaleString()+"</var><samp><s style='width:"+L+"%'></s></samp></aside><aside class='lboPPT' title='<dfn>Points-Per-Tick (PPT)</dfn>'><samp><s style='width:"+A+"%'></s></samp><var>+"+w+"</var></aside><aside class='lboLand' title='<dfn>PPT per borderlands</dfn>'><var class='lboPPTGreen'>+"+g[v][W.LandEnum.GreenHome]+"</var><var class='lboPPTBlue'>+"+g[v][W.LandEnum.BlueHome]+"</var><var class='lboPPTRed'>+"+g[v][W.LandEnum.RedHome]+"</var><var class='lboPPTCenter'>+"+g[v][W.LandEnum.Center]+"</var></aside><aside class='lboFocus lboFocus"+v+"' title='<dfn>Server Focus (PPT Now)</dfn><br /><dfn>"+z[0]+" PPT</dfn> earnable from "+F[0]+" native objectives<br /><dfn>"+z[1]+" PPT</dfn> earnable from "+F[1]+" native objectives'><var class='lboFocusA'>"+V+"%</var><samp class='"+Q+"'><s style='width:"+V+"%'><mark></mark></s></samp><var class='lboFocusB'>"+Y+"%</var></aside>"+x+"<aside class='lboFocus lboFocus"+v+"' title='<dfn>Server Focus (Points Matchup)</dfn><br /><dfn>"+ee+" points</dfn> earned from "+F[0]+" Borderlands<br /><dfn>"+te+" points</dfn> earned from "+F[1]+" Borderlands'><var class='lboFocusA'>"+ie+"%</var><samp class='"+oe+"'><s style='width:"+ie+"%'><mark></mark></s></samp><var class='lboFocusB'>"+ae+"%</var></aside></article>";
}S+="</section>",y.append(S),I.qTip.init(y.find("aside")),O.Options.bol_condenseLeaderboard&&W.toggleLeaderboardWidth()},toggleLeaderboard:function(){O.Options.bol_showLeaderboard?(W.updateObjectives(),$("#lboCurrent, #lboOther").show("fast",function(){$("#lboContainer").css({padding:"8px"})}),$(".lboExtra").show()):($("#lboCurrent, #lboOther").hide("fast",function(){$("#lboContainer").css({padding:0})}),$(".lboExtra").hide())},opaqueLeaderboard:function(){var e=O.Options.bol_opaqueLeaderboard?"rgba(0, 0, 0, 0.8)":"rgba(0, 0, 0, 0.2)";$("#lboContainer").css({background:e})},toggleLeaderboardWidth:function(e){var t=!O.Options.bol_condenseLeaderboard,n=$(".lboRank, .lboName, .lboFocus");e?t?n.show("fast"):n.hide("fast"):n.toggle(t)},readjustLeaderboard:function(){$("#lboOther").css({maxHeight:$(window).height()-2*$("#lboCurrent").height()})},initializeLog:function(){$("#wvwLogContainer").show(),$("#logWindow").data("oldHeight",$("#logWindow").height()),$("#logToggle").click(function(){$("#opt_bol_showLog").trigger("click")}),$("#logExpand").click(function(){$("#opt_bol_maximizeLog").trigger("click")}),$("#logOpaque").click(function(){$("#opt_bol_opaqueLog").trigger("click")}),W.toggleLog(),W.opaqueLog(),W.toggleLogHeight(),I.initializeScrollbar("#logWindow");for(var e in W.MapType)!function(e){$("#opt_bol_log"+e).change(function(){O.Options["bol_log"+e]?$(".logEntry"+e).show("fast",function(){I.updateScrollbar("#logWindow")}):$(".logEntry"+e).hide("fast",function(){I.updateScrollbar("#logWindow")})}).parent().dblclick(function(){$("#logFilters input:checkbox").each(function(){X.setCheckboxEnumState($(this),X.ChecklistEnum.Unchecked)}),X.setCheckboxEnumState($("#opt_bol_log"+e),X.ChecklistEnum.Checked)})}(e);var t=W.getName("Borderlands");$("#opt_bol_narrateRedHome").next().html(D.orderModifier(t,W.getName("Red"))),$("#opt_bol_narrateBlueHome").next().html(D.orderModifier(t,W.getName("Blue"))),$("#opt_bol_narrateGreenHome").next().html(D.orderModifier(t,W.getName("Green"))),$("#opt_bol_narrateCenter").next().html(W.getName("Center")),$("#opt_bol_narrateCamp").next().html(W.getName("Camp")),$("#opt_bol_narrateTower").next().html(W.getName("Tower")),$("#opt_bol_narrateKeep").next().html(W.getName("Keep")),$("#opt_bol_narrateCastle").next().html(W.getName("Castle")),$("#opt_bol_narrateClaimed").next().html(W.getName("Claimed")),I.preventMapPropagation(O.mimicInput("#logNarrateVolume","int_setVolume")),$("#logTime").click(function(){$("#opt_bol_use24Hour").trigger("click"),$("#logWindow li time").each(function(){var e=T.getTimeFormatted({aCustomTimeInDate:new Date($(this).attr("data-time"))});$(this).html(e)})})},toggleLog:function(){O.Options.bol_showLog?$("#wvwLog, .logExtra").show("fast"):$("#wvwLog, .logExtra").hide("fast")},opaqueLog:function(){var e=O.Options.bol_opaqueLog?"rgba(0, 0, 0, 0.8)":"rgba(0, 0, 0, 0.1)";$("#wvwLog").css({background:e})},toggleLogHeight:function(){var e=$("#logWindow"),t=$(window).height(),n=e.data("oldHeight"),i=t-(n+$("#logOptions").height());O.Options.bol_maximizeLog?e.show().animate({height:i},200,function(){I.updateScrollbar(e),O.Options.bol_maximizeLog=!0}):e.show().animate({height:n},200,function(){I.updateScrollbar(e),O.Options.bol_maximizeLog=!1})},readjustLog:function(){$("#wvwLog").height()>$(window).height()&&$("#logExpand").trigger("click").trigger("click")},addLogEntry:function(e,t,n,i){e=e||"",t=t||"";var a="";void 0===n?(a=T.getTimeFormatted(),n=(new Date).toISOString()):a=T.getTimeFormatted({aCustomTimeInDate:new Date(n)});var r=$("<li class='logEntry "+t+"'><time data-time='"+n+"'>"+a+"</time><span>"+e+"</span></li>").prependTo("#logWindow");if(this.bindMapLinkBehavior(r.find("dfn")),i===!1)r.hide();else{var o=r.width();r.css({width:0}).animate({width:o},400,function(){$(this).removeAttr("style")})}var s=$(".logEntry");s.length>O.Options.int_numLogEntries&&s.last().remove(),I.updateScrollbar("#logWindow")},addLogEntryObjective:function(e,t){var n,i="<img src='img/wvw/objectives/"+(e.type+"_"+e.prevowner).toLowerCase()+I.cPNG+"' />",a="<img src='img/wvw/objectives/"+(e.type+"_"+e.owner).toLowerCase()+I.cPNG+"' />",r=W.getObjectiveNick(e,!1);t?(i=a,a="<cite>["+e.tag+"]</cite>",n=e.claimed_at):n=e.last_flipped;var o=i+" ⇒ "+a+" <dfn data-coord='"+e.coord+"'>"+r+"</dfn>",s=e.map_type,c="logEntry"+s;t||(e.prevownerhtml=o);var l=!0;(s===W.LandEnum.RedHome&&O.Options.bol_logRedHome===!1||s===W.LandEnum.BlueHome&&O.Options.bol_logGreenHome===!1||s===W.LandEnum.GreenHome&&O.Options.bol_logBlueHome===!1||s===W.LandEnum.Center&&O.Options.bol_logCenter===!1)&&(l=!1),W.addLogEntry(o,c,n,l),O.Options.bol_logNarrate&&W.narrateLog(e,t)},narrateLog:function(e,t){var n=e.map_type,i=e.type;if(!(t&&O.Options.bol_narrateClaimed===!1||n===W.LandEnum.RedHome&&O.Options.bol_narrateRedHome===!1||n===W.LandEnum.BlueHome&&O.Options.bol_narrateBlueHome===!1||n===W.LandEnum.GreenHome&&O.Options.bol_narrateGreenHome===!1||n===W.LandEnum.Center&&O.Options.bol_narrateCenter===!1||i===W.ObjectiveEnum.Camp&&O.Options.bol_narrateCamp===!1||i===W.ObjectiveEnum.Tower&&O.Options.bol_narrateTower===!1||i===W.ObjectiveEnum.Keep&&O.Options.bol_narrateKeep===!1||i===W.ObjectiveEnum.Castle&&O.Options.bol_narrateCastle===!1)){var a,r=W.getObjectiveNick(e,!0);a=t?D.getSpeechInitials(e.tag):e.owner===W.MatchupCurrent.ownercurrent?W.getName("Us"):W.getAllianceFromOwner(e.owner).color;var o,s=$("#logNarrateLand input:checked").length>1?W.getBorderlandsString(e,{aWantPronoun:!0})+". ":"";o=t?W.getName("Claimed"):e.owner===e.nativeowner?W.getName("Retaken"):W.getName("Captured");var c=s+r,l=o+" "+a;D.speak(c),D.speak(l)}},initializeSupplyCalculator:function(){var e=function(e,t){var n=e.html();if(n=""===n?0:parseInt(n),!(0>t&&0===n)){var i=0>t?-1:1;W.numSiegeSupply+=t,$("#splNeed").html(W.numSiegeSupply);var a=n+i;0===a?(e.removeClass("splAdded"),a=""):e.addClass("splAdded"),e.html(a)}};I.preventMapPropagation("#wvwSupply");for(var t in W.Metadata.Blueprints)for(var n in W.Weapons)if("field"===W.Weapons[n].type){var i=W.Metadata.Blueprints[t],a=$("<ins class='spl spl_"+i.toLowerCase()+"_"+n+"'></ins>"),r=W.Weapons[n].supply[t];$("#splBlueprints"+i).append(a),function(t){a.click(function(){e($(this),t),$("#splHave").trigger("input")}),a.contextmenu(function(){return e($(this),-1*t),$("#splHave").trigger("input"),!1})}(r)}$("#splReset").click(function(){$("#splBlueprints ins").html("").removeClass("splAdded"),$("#splNeed").html("0"),W.numSiegeSupply=0,$("#splHave").trigger("input")}),$("#splHave").click(function(){$(this).select()}).on("input",function(){var e=T.parseQuantity($(this).val(),0)-W.numSiegeSupply,t=$("#splRemain").html(e);I.colorizeValue(t,e)})},updateParticipants:function(){null!==W.MatchupCurrent&&($("#opt_bol_logRedHome").next().html(W.MatchupCurrent.red.namestr),$("#opt_bol_logBlueHome").next().html(W.MatchupCurrent.blue.namestr),$("#opt_bol_logGreenHome").next().html(W.MatchupCurrent.green.namestr),$("#opt_bol_logCenter").next().html(W.getName("Center")),$("#wvwZoneLinkRed").html(W.MatchupCurrent.red.namestr),$("#wvwZoneLinkBlue").html(W.MatchupCurrent.blue.namestr),$("#wvwZoneLinkGreen").html(W.MatchupCurrent.green.namestr),W.addLogEntry($("#wvwHelpLinks").html()+"<br /><br />"),W.addLogEntry(W.MatchupCurrent.green.nickstr+" : "+W.MatchupCurrent.blue.nickstr+" : "+W.MatchupCurrent.red.nickstr),$(".wvwSpawnLabel").each(function(){var e=$(this).attr("data-owner").toLowerCase(),t=W.MatchupCurrent[e].namelinestr;$(this).html(t)}))},reinitializeServerChange:function(e){for(var t in W.Objectives){var n=W.Objectives[t];n.isImmune=!1,n.owner=null,n.last_flipped=null,n.last_flipped_msec=null,n.claimed_by="none",n.claimed_at=null}W.LocaleCurrent=O.Options.enu_Server>=W.LocaleThreshold.Europe?W.LocaleEnum.Europe:W.LocaleEnum.Americas,W.MatchupIDCurrent=null,W.MatchStartTimeMS=null,W.MatchFinishTimeMS=null,W.MatchFinishTimeISO=null,W.MatchupCurrent=null,$(".objUmbrellaContainer").hide(),$(".objTimer").empty(),$(".objProgressBar").hide(),$("#lboCurrent").empty().append(I.cThrobber),$("#lboOther").empty(),e!==!1&&$("#logWindow").empty(),W.toggleObjectiveTick(!1),W.toggleObjectiveTick(!0)},updateObjectives:function(){var e=3,t=(new Date).getTime(),n=function(){W.numFailedAPICalls=0,W.isAPIFailed=!1,W.isFallbackEnabled=!1,I.write("WvW data connection reestablished at "+T.getTimeFormatted())};W.isFallbackEnabled&&W.updateObjectivesFallback(),$.ajax({dataType:"json",url:U.URL_API.Match+O.Options.enu_Server,cache:!1,success:function(e){if(W.isFallbackEnabled)return n(),void W.reinitializeServerChange(!1);W.MatchFinishTimeISO!==e.end_time&&(W.MatchFinishTimeISO=e.end_time,W.MatchStartTimeMS=new Date(e.start_time).getTime(),W.MatchFinishTimeMS=new Date(e.end_time).getTime(),W.secTillWvWReset=~~((W.MatchFinishTimeMS-t)/T.cMSECONDS_IN_SECOND),W.MatchupIDCurrent=e.id,W.MatchupCurrent=W.formatMatchup(e),W.updateParticipants()),O.Options.bol_showLeaderboard&&W.insertScoreboard(e);var i,a,r,o=0,s=12,c=!1,l=t<W.MatchStartTimeMS+W.cMSECONDS_RESET_GRACE;for(var u in e.maps){i=e.maps[u];for(var d in i.objectives)if(r=i.objectives[d],a=W.Objectives[r.id],a.last_flipped!==r.last_flipped&&(null!==a.last_flipped&&o++,a.last_flipped=r.last_flipped,a.last_flipped_msec=new Date(r.last_flipped).getTime(),a.prevowner=a.owner,a.owner=r.owner,W.updateObjectiveIcon(a),W.updateObjectiveAge(a),W.updateObjectiveTooltip(a),t-a.last_flipped_msec<W.cMSECONDS_IMMUNITY&&a.owner!==W.OwnerEnum.Neutral&&!l&&(W.Objectives[a.id].isImmune=!0,$("#objProgressBar_"+a.id).show().find("var").css({width:"0%"}).animate({width:"100%"},800))),a.claimed_by!==r.claimed_by&&(a.prevclaimed_by=a.claimed_by,a.claimed_by=r.claimed_by,a.claimed_at=r.claimed_at,W.updateObjectiveClaim(a)),o>s){c=!0;break}if(o>s){c=!0;break}}c&&(D.stopSpeech(),W.reinitializeServerChange(!1),W.addLogEntry("Restarted due to API error."),I.write("Too many objectives updated. ArenaNet API servers may be having problems.")),W.isAPIFailed&&n()}}).fail(function(){if(W.isFallbackEnabled===!1)if(W.numFailedAPICalls++,W.numFailedAPICalls>e)W.isFallbackEnabled=!0,W.updateObjectives(),I.print("Too many failed API retrievals. Switched to backup API server.");else if(W.isAPIFailed===!1){W.isAPIFailed=!0;var t=null!==W.secTillWvWReset&&W.secTillWvWReset<10*T.cSECONDS_IN_MINUTE?"WvW reset is happening soon.":"The map will refresh automatically when ArenaNet servers are back online.";I.print("Unable to retrieve WvW data during "+T.getTimeFormatted()+". Please wait...<br />"+t)}})},convertWorlds:function(e){return{red:e.red_world_id,blue:e.blue_world_id,green:e.green_world_id}},updateObjectivesFallback:function(){var e=new Date,t=e.toISOString(),n=e.getTime();null===W.MatchupIDCurrent||null===W.Matches?$.ajax({dataType:"json",url:U.URL_API.MatchesFallback,cache:!1,success:function(e){if(W.isFallbackEnabled!==!1){W.Matches={};for(var t in e.wvw_matches){var i=e.wvw_matches[t],a=parseInt(O.Options.enu_Server);W.Matches[i.wvw_match_id]=W.convertWorlds(i),(i.red_world_id===a||i.blue_world_id===a||i.green_world_id===a)&&(W.MatchupIDCurrent=i.wvw_match_id,W.MatchStartTimeMS=new Date(e.start_time).getTime(),W.MatchFinishTimeMS=new Date(e.end_time).getTime(),W.secTillWvWReset=~~((W.MatchFinishTimeMS-n)/T.cMSECONDS_IN_SECOND),W.MatchupCurrent=W.formatMatchup(W.Matches[W.MatchupIDCurrent]),W.updateParticipants(),W.updateObjectivesFallback())}}}}):$.ajax({dataType:"json",url:U.URL_API.MatchFallback+W.MatchupIDCurrent,cache:!1,success:function(e){if(W.isFallbackEnabled!==!1){var i,a,r,o,s=new Date(n-W.cMSECONDS_IMMUNITY),c=new Date(n-O.Options.int_secWvWRefresh*T.cMSECONDS_IN_SECOND);for(var l in e.maps){i=e.maps[l],o=W.Metadata.LandPrefix[i.type];for(var u in i.objectives){r=i.objectives[u],a=W.Objectives[o+r.id];var d=null===a.owner?s:c;a.owner!==r.owner&&(a.last_flipped=d.toISOString(),a.last_flipped_msec=d.getTime(),a.prevowner=a.owner,a.owner=r.owner,W.updateObjectiveIcon(a),W.updateObjectiveAge(a),W.updateObjectiveTooltip(a),n-a.last_flipped_msec<W.cMSECONDS_IMMUNITY&&a.owner!==W.OwnerEnum.Neutral&&(W.Objectives[a.id].isImmune=!0,$("#objProgressBar_"+a.id).show().find("var").css({width:"0%"}).animate({width:"100%"},800))),a.claimed_by!==r.owner_guild&&(a.prevclaimed_by=a.claimed_by,a.claimed_by=r.owner_guild,a.claimed_at=t,W.updateObjectiveClaim(a))}}O.Options.bol_showLeaderboard&&W.insertScoreboard(e)}}})},updateObjectiveIcon:function(e){var t=2e3,n=$("#objUmbrella_"+e.id),i=$("#objIcon_"+e.id),a=i.css("width");if(null!==e.prevowner&&e.owner!==W.OwnerEnum.Neutral){var r=W.Metadata[e.prevowner].color,o=W.Metadata[e.owner].color;n.parent().parent().show(),n.css({borderColor:r,boxShadow:"0px 0px 10px "+r}),I.bloatElement(n,1e3,100),function(e,n,r){i.css({width:a}).animate({width:0},t,function(){n.css({borderColor:r,boxShadow:"0px 0px 10px "+r}),$(this).attr("src",$(this).attr("data-src")+e.toLowerCase()+I.cPNG).animate({width:a},t,function(){n.parent().parent().hide(),W.adjustZoomMapping()})})}(e.owner,n,o),W.addLogEntryObjective(e)}else i.attr("src",i.attr("data-src")+e.owner.toLowerCase()+I.cPNG)},updateObjectiveTimers:function(){var e,t,n,i,a=(new Date).getTime(),r=3e4;for(var o in W.Objectives)e=W.Objectives[o],e.isImmune&&(t=a-e.last_flipped_msec,n=W.cMSECONDS_IMMUNITY-t,i=n/W.cMSECONDS_IMMUNITY*T.cPERCENT_100,n>0&&t+r>0?(document.getElementById("objTimer_"+e.id).innerHTML=T.formatTimeColon(n),document.getElementById("objProgress_"+e.id).style.width=i+"%"):0>=t+r?T.isTimeOutOfSync===!1&&(W.addLogEntry("Negative time detected. Your computer's time may be <a"+U.convertExternalAnchor("https://www.google.com/search?q=synchronize+time")+">out of sync!</a>"),T.isTimeOutOfSync=!0):($("#objTimer_"+e.id).html(""),$("#objProgressBar_"+e.id).css({opacity:1}).animate({opacity:0},2e3,function(){$(this).css({opacity:1}).hide()}),$("#objIcon_"+e.id).css({opacity:0}).animate({opacity:1},2e3),e.isImmune=!1,W.updateObjectiveAge(e)))},updateObjectiveAge:function(e){var t=(new Date).getTime()-e.last_flipped_msec;$("#objAge_"+e.id).html(T.getShorthandTime(t))},updateAllObjectiveAge:function(){for(var e in W.Objectives)W.updateObjectiveAge(W.Objectives[e])},updateObjectiveClaim:function(e){var t=e.claimed_by,n=function(){var n=W.Guilds[t];e.guild_name=n.guild_name,e.tag=n.tag,W.updateObjectiveTooltip(e);var i=$("#objClaim_"+e.id),a=i.css("color");i.html("["+e.tag+"]"),"none"!==e.prevclaimed_by&&(I.blinkElement(i,2e3,200),i.css({color:"#ffffff"}).animate({color:a},4e3),W.addLogEntryObjective(e,!0))};null===t||void 0===t?(e.guild_name=null,e.tag=null,W.updateObjectiveTooltip(e),$("#objClaim_"+e.id).empty()):void 0!==W.Guilds[t]?n():$.getJSON(U.URL_API.GuildDetails+t,function(e){W.Guilds[t]=e,n()})},updateObjectiveTooltip:function(e){var t=e,n=$("#objIcon_"+t.id),i="";null!==t.claimed_by&&(i="<aside><dfn>Claim:</dfn> "+new Date(t.claimed_at).toLocaleString()+"</aside><aside><dfn>Guild:</dfn> "+U.escapeHTML(t.guild_name+" ["+t.tag+"]")+"</aside><aside class='cssCenter'><img class='objTooltipBanner' src='"+U.getGuildBannerURL(t.guild_name)+"' /></aside>");var a="<div class='objTooltip'><aside><dfn class='objTooltipName'>"+D.getObjectName(t)+"</dfn></aside><aside><dfn>Owner:</dfn> "+new Date(t.last_flipped).toLocaleString()+"</aside>"+(e.prevownerhtml?"<aside class='cssCenter'>"+e.prevownerhtml+"</aside>":"")+i+"</div>";I.qTip.init(n.attr("title",a))},toggleObjectiveTick:function(e){e?(W.isObjectiveTickEnabled=e,W.tickObjectives(),W.isObjectiveTimerTickEnabled=e):(window.clearTimeout(W.ObjectiveTimeout),W.isObjectiveTickEnabled=e,W.isObjectiveTimerTickEnabled=e)},tickObjectives:function(){W.isObjectiveTickEnabled&&(W.updateObjectives(),window.clearTimeout(W.ObjectiveTimeout),W.ObjectiveTimeout=setTimeout(function(){W.tickObjectives()},O.Options.int_secWvWRefresh*T.cMSECONDS_IN_SECOND))}},T={Daily:GW2T_DAILY_DATA,DailyAssociation:GW2T_DAILY_ASSOCIATION,DailyToday:null,DailyTomorrow:null,Schedule:{},DryTopSets:{},DryTopCodes:{},DST_IN_EFFECT:0,SECONDS_TILL_DAILY:0,SECONDS_TILL_WEEKLY:0,TIMESTAMP_UNIX_SECONDS:0,cUTC_OFFSET_USER:0,cUTC_OFFSET_SERVER:-8,cUTC_OFFSET_HAWAII:-10,cUTC_OFFSET_EASTERN:-4,cMSECONDS_IN_SECOND:1e3,cMSECONDS_IN_MINUTE:6e4,cMSECONDS_IN_DAY:864e5,cSECONDS_IN_MINUTE:60,cSECONDS_IN_HOUR:3600,cSECONDS_IN_DAY:86400,cSECONDS_IN_WEEK:604800,cSECONDS_IN_YEAR:31536e3,cMINUTES_IN_HOUR:60,cMINUTES_IN_2_HOURS:120,cMINUTES_IN_DAY:1440,cHOURS_IN_MERIDIEM:12,cHOURS_IN_DAY:24,cDAYS_IN_WEEK:7,cDAYS_IN_YEAR:365,cSECONDS_IN_TIMEFRAME:900,cMINUTES_IN_TIMEFRAME:15,cMINUTES_IN_MINIFRAME:5,cNUM_TIMEFRAMES_IN_HOUR:4,cSECS_MARK_0:0,cSECS_MARK_1:900,cSECS_MARK_2:1800,cSECS_MARK_3:2700,cSECS_MARK_4:3599,cBASE_10:10,cPERCENT_100:100,cWEEKLY_RESET_SECONDS:113400,cDAYTIME_DAY_MINUTES:80,cDAYTIME_NIGHT_MINUTES:40,cDAYTIME_DAY_START:25,cDAYTIME_NIGHT_START:45,ReferenceEnum:{UTC:0,Local:1,Server:2},UnitEnum:{Milliseconds:0,Seconds:1,Minutes:2,Hours:3},DayEnum:{Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},isTimeOutOfSync:!1,secondsTillResetWeekly:-1,isChecklistCountdownsStarted:!1,getCurrentDryTopEvents:function(e){return T.DryTopCodes[T.getDryTopMinute(e)].chat+I.siteTagCurrent},getCurrentDryTopColor:function(e){return T.DryTopCodes[T.getDryTopMinute(e)].color},getDryTopMinute:function(e){e=e||0;var t=new Date,n=t.getUTCMinutes(),i=~~(n/T.cMINUTES_IN_MINIFRAME)*T.cMINUTES_IN_MINIFRAME+e*T.cMINUTES_IN_MINIFRAME;return i=T.wrapInteger(i,T.cMINUTES_IN_HOUR),i<T.cBASE_10&&(i="0"+i),i},initializeDryTopStrings:function(){var e=function(e){var t=T.DryTopSets[e],n="";for(var i in t)n+=D.getObjectName(t[i])+"@"+t[i].wp+" ";return n.trim()};T.DryTopSets=GW2T_DRYTOP_SETS,T.DryTopCodes=GW2T_DRYTOP_CODES;for(var t in T.DryTopCodes)T.DryTopCodes[t].chat+=e(T.DryTopCodes[t].set);K.updateDryTopClipboard(),$("#itemDryTopClip").show()},initializeScheduleSlot:function(e){void 0===T.Schedule[e]&&(T.Schedule[e]={SchedTime:e,SchedChains:[]})},insertChainToSchedule:function(e){var t=0,n=e.timing;if(Array.isArray(n))for(var i in n)t=T.parseChainTime(n[i]),T.initializeScheduleSlot(t),T.Schedule[t].SchedChains.push(e);else for(t=n.hourInitial*T.cMINUTES_IN_HOUR+n.minuteOffset;t<T.cMINUTES_IN_DAY;t+=n.hourMultiplier*T.cMINUTES_IN_HOUR)T.initializeScheduleSlot(t),T.Schedule[t].SchedChains.push(e)},initializeSchedule:function(){var e,t,n,i;B.Story.isEnabled&&T.isTimely(B.Story,new Date)&&(B.isStoryEnabled=!0),X.initializeChecklist(X.Checklists.Chain,C.Chains.length+C.UnscheduledChainsLength),X.initializeChecklist(X.Checklists.ChainSubscription,C.Chains.length+C.UnscheduledChainsLength),C.initializeScheduledChains(),I.initializeChainsUI(),$("#sectionChains_Scheduled .chnBar h1, #sectionChains_Drytop .chnBar h1, #dsbStory .chnBar h1").addClass("chnTitleFutureFar");for(e in C.ScheduledChains)T.insertChainToSchedule(C.ScheduledChains[e]);for(e in T.Schedule){i=T.Schedule[e];for(t in C.ScheduledChains)for(n in i.SchedChains)if(C.ScheduledChains[t].nexus===i.SchedChains[n].nexus){C.ScheduledChains[t].scheduleKeys.push(e);break}}C.CurrentChainSD=T.getStandardChain()},getScheduleSlotTime:function(e){return T.Schedule[e].SchedTime},getScheduleSlotChainsByKey:function(e){return T.Schedule[e].SchedChains},getCurrentTimeframe:function(){var e=T.getTimeSinceMidnight(T.ReferenceEnum.UTC,T.UnitEnum.Minutes);return e-e%T.cMINUTES_IN_TIMEFRAME},getTimeframe:function(e){e=e||0;var t=T.getCurrentTimeframe()+e*T.cMINUTES_IN_TIMEFRAME;return T.wrapInteger(t,T.cMINUTES_IN_DAY)},getTimeframeChains:function(e){return T.Schedule[T.getTimeframe(e)].SchedChains},getTimeframeChainBySeries:function(e,t){var n=T.getTimeframeChains(e);for(var i in n)if(n[i].series===t)return n[i];return null},getTimeframeChainsBySeries:function(e,t){var n=T.getTimeframeChains(e),i=[];for(var a in n)n[a].series===t&&i.push(n[a]);return i},getStandardChain:function(e){return T.getTimeframeChainBySeries(e,C.ChainSeriesEnum.Standard)},getHardcoreChain:function(e){return T.getTimeframeChainBySeries(e,C.ChainSeriesEnum.Hardcore)},getLivingStoryChain:function(e){return T.getTimeframeChainBySeries(e,C.ChainSeriesEnum.LivingStory)},getMiscellaneousChains:function(e){return T.getTimeframeChainsBySeries(e,C.ChainSeriesEnum.Miscellaneous)},getTimeframeKey:function(e){return T.getTimeframe(e).toString()},convertScheduleKeyToLocalSeconds:function(e){var t=T.getScheduleSlotTime(e)*T.cSECONDS_IN_MINUTE-(new Date).getTimezoneOffset()*T.cSECONDS_IN_MINUTE;return T.wrapInteger(t,T.cSECONDS_IN_DAY)},convertScheduleKeyToUTCMinutes:function(e){return parseInt(e)},getCurrentTimeframeElapsedTime:function(e){var t=new Date,n=t.getUTCMinutes(),i=t.getUTCSeconds();return e===T.UnitEnum.Minutes?n%T.cMINUTES_IN_TIMEFRAME:n%T.cMINUTES_IN_TIMEFRAME*T.cSECONDS_IN_MINUTE+i},getSecondsUntilChainStarts:function(e){var t=T.convertScheduleKeyToLocalSeconds(e.scheduleKeys[0]),n=T.getTimeSinceMidnight(T.ReferenceEnum.Local,T.UnitEnum.Seconds),i=T.cSECONDS_IN_TIMEFRAME*T.cNUM_TIMEFRAMES_IN_HOUR;return t>=T.cSECONDS_IN_DAY-i&&i>=n?T.cSECONDS_IN_DAY-t+n:n>=T.cSECONDS_IN_DAY-i&&i>=t?T.cSECONDS_IN_DAY-n+t:t-n},getTimeTillChainFormatted:function(e,t){var n=T.getSecondsUntilChainStarts(e),i=~~(n/T.cSECONDS_IN_MINUTE)%T.cSECONDS_IN_MINUTE,a=~~(n/T.cSECONDS_IN_HOUR),r=D.getTranslation("m"),o=D.getTranslation("h");return"speech"===t&&(r=" "+D.getSpeechWord("minute"),o=" "+D.getSpeechWord("hour"),Math.abs(i)>1&&(r=" "+D.getSpeechWord("minutes")),Math.abs(a)>1&&(o=" "+D.getSpeechWord("hours")),0===a&&30===Math.abs(i)&&(i=D.getTranslation("half an hour"),r="",o="")),o+=" ",i+=r,Math.abs(n)>=T.cSECONDS_IN_HOUR?a+=o:a="",0>n?" "+a+i+" "+D.getTranslation("ago"):" "+D.getTranslation("in")+" "+a+i},getRandomIntRange:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getMinMax:function(e,t){var n,i=!(void 0===t),a=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=null,s=null;for(var c in e)n=i?e[c][t]:e[c],a>n&&(a=n,o=c),n>r&&(r=n,s=c);return{min:a,max:r,minkey:o,maxkey:s}},wrapInteger:function(e,t){var n=e;return n%=t,0>n&&(n=t+n),n},stepFunction:function(e,t,n,i,a){var r=~~(e/i)*a+t;return r>n?n:r},parseQuantity:function(e,t){void 0===t&&(t=1);var n=parseInt(e);return isFinite(n)||(n=t),n},parseRatio:function(e,t){return 0===e||isNaN(e)?0:1===e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY?1:void 0!==t?e.toFixed(t):e},parseEventTime:function(e){var t=[];return-1!==e.indexOf("~")?(t=e.split("~"),T.parseEventTime(t[0])+~~(T.parseEventTime(t[1])/2)):"*"===e?0:-1===e.indexOf(":")?parseInt(e,T.cBASE_10):(t=e.split(":"),2===t.length?parseInt(t[0],T.cBASE_10)*T.cSECONDS_IN_MINUTE+parseInt(t[1],T.cBASE_10):3===t.length?parseInt(t[0])*T.cSECONDS_IN_HOUR+parseInt(t[1],T.cBASE_10)*T.cSECONDS_IN_MINUTE+parseInt(t[2],T.cBASE_10):NaN)},parseChainTime:function(e){var t=e.split(":");return parseInt(t[0],T.cBASE_10)*T.cMINUTES_IN_HOUR+parseInt(t[1],T.cBASE_10)},checkDST:function(){Date.prototype.stdTimezoneOffset=function(){var e=new Date(this.getFullYear(),0,1),t=new Date(this.getFullYear(),6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())},Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};var e=new Date;T.DST_IN_EFFECT=e.dst()&&O.Options.bol_detectDST?1:0},getTimeFormatted:function(e){var t,n,i,a=$.extend({aReference:T.ReferenceEnum.Local,aWant24:O.Options.bol_use24Hour,aWantSeconds:!0,aWantHours:!0,aWantLetters:!1},e),r=void 0===a.aCustomTimeInDate?new Date:a.aCustomTimeInDate;if(void 0===a.aCustomTimeInSeconds)switch(a.aReference){case T.ReferenceEnum.Local:t=r.getSeconds(),n=r.getMinutes(),i=r.getHours();break;case T.ReferenceEnum.Server:t=r.getSeconds(),n=r.getMinutes(),i=r.getUTCHours()+T.cUTC_OFFSET_SERVER+T.DST_IN_EFFECT,i=T.wrapInteger(i,T.cHOURS_IN_DAY);break;case T.ReferenceEnum.UTC:t=r.getUTCSeconds(),n=r.getUTCMinutes(),i=r.getUTCHours()}else a.aCustomTimeInSeconds=T.wrapInteger(a.aCustomTimeInSeconds,T.cSECONDS_IN_DAY),t=a.aCustomTimeInSeconds%T.cSECONDS_IN_MINUTE,n=~~(a.aCustomTimeInSeconds/T.cSECONDS_IN_MINUTE)%T.cMINUTES_IN_HOUR,i=~~(a.aCustomTimeInSeconds/T.cSECONDS_IN_HOUR);var o="";if(o=a.aWantSeconds?a.aWantLetters?0===i&&0===n?t+D.getWord("s"):n+D.getWord("m")+" "+t+D.getWord("s"):a.aWantHours===!1?n+":"+(t<T.cBASE_10?"0"+t:t):(n<T.cBASE_10?"0"+n:n)+":"+(t<T.cBASE_10?"0"+t:t):a.aWantLetters?n+D.getWord("m"):n<T.cBASE_10?"0"+n:n,a.aWantLetters)return 0===i||a.aWantHours===!1?o:i+D.getWord("h")+" "+o;if(a.aWant24)return a.aWantHours===!1?o:(i<T.cBASE_10?"0"+i:i)+":"+o;var s=" AM";return i>=T.cHOURS_IN_MERIDIEM?(i>T.cHOURS_IN_MERIDIEM&&(i%=T.cHOURS_IN_MERIDIEM),s=" PM"):0===i&&(i=T.cHOURS_IN_MERIDIEM),i+":"+o+s},getShorthandTime:function(e){var t=~~(e/T.cMSECONDS_IN_SECOND);return t<T.cSECONDS_IN_MINUTE?0+D.getWord("m"):t<T.cSECONDS_IN_HOUR?~~(t/T.cSECONDS_IN_MINUTE)%T.cMINUTES_IN_HOUR+D.getWord("m"):(t/T.cSECONDS_IN_HOUR).toFixed(1)+D.getWord("h")},formatTimeColon:function(e,t){var n,i,a,r,o=~~(e/T.cMSECONDS_IN_SECOND),s="",c="",l="",u="",d="",p="";if(0>o&&(o=-1*o,p="−"),o>=T.cSECONDS_IN_DAY&&(n=~~(o/T.cSECONDS_IN_DAY),s=n+"::"),o>=T.cSECONDS_IN_HOUR&&(i=~~(o/T.cSECONDS_IN_HOUR)%T.cHOURS_IN_DAY,c=i+":",""!==s&&i<T.cBASE_10&&(c="0"+c)),o>=T.cSECONDS_IN_MINUTE?(a=~~(o/T.cSECONDS_IN_MINUTE)%T.cMINUTES_IN_HOUR,l=a+":",""!==c&&a<T.cBASE_10&&(l="0"+l)):l="0:",r=o%T.cSECONDS_IN_MINUTE,u=r.toString(),r<T.cBASE_10&&(u="0"+u),t){var h=~~(e%T.cMSECONDS_IN_SECOND/T.cBASE_10);d="."+h,h<T.cBASE_10&&(d=".0"+h)}return p+s+c+l+u+d},formatTimeLetter:function(e,t){var n,i,a,r,o,s=e,c="",l="",u="",d="",p="",h="";return 0>s&&(s=-1*s,h="−"),s<T.cSECONDS_IN_YEAR?(s>=T.cSECONDS_IN_WEEK&&(n=~~(s/T.cSECONDS_IN_WEEK),c=n+D.getWord("w")+" "),s>=T.cSECONDS_IN_DAY&&(i=~~(s/T.cSECONDS_IN_DAY)%T.cDAYS_IN_WEEK,l=i+D.getWord("d")+" ")):(s>=T.cSECONDS_IN_YEAR&&(n=~~(s/T.cSECONDS_IN_YEAR),c=n+D.getWord("y")+" "),s>=T.cSECONDS_IN_DAY&&(i=~~(s/T.cSECONDS_IN_DAY)%T.cDAYS_IN_YEAR,l=i+D.getWord("d")+" ")),s<T.cSECONDS_IN_YEAR&&(s>=T.cSECONDS_IN_HOUR&&(a=~~(s/T.cSECONDS_IN_HOUR)%T.cHOURS_IN_DAY,u=a+D.getWord("h")+" "),s>=T.cSECONDS_IN_MINUTE&&(r=~~(s/T.cSECONDS_IN_MINUTE)%T.cMINUTES_IN_HOUR,d=r+D.getWord("m")+" "),t&&(o=s%T.cSECONDS_IN_MINUTE,p=o.toString()+D.getWord("s"))),h+c+l+u+d+p},formatMinutes:function(e){return T.formatTimeLetter(e*T.cSECONDS_IN_MINUTE)},formatTooltipTime:function(e,t){var n=e,i=t?" ":"",a=[T.cSECONDS_IN_MINUTE,T.cSECONDS_IN_HOUR,T.cSECONDS_IN_DAY,T.cSECONDS_IN_YEAR],r=["m","h","d"];if(n<T.cSECONDS_IN_MINUTE)return n+i+D.getWord("s");for(var o=0;o<r.length;o++)if(n<a[o+1])return~~(n/a[o])+i+D.getWord(r[o]);return""},formatTooltipTimeMS:function(e,t){return T.formatTooltipTime(~~(e/T.cMSECONDS_IN_SECOND),t)},isTimely:function(e,t,n){var i=void 0===n?e.Finish:new Date(e.Finish.getTime()+n*T.cMSECONDS_IN_SECOND);return t>=e.Start&&i>=t?!0:!1},isDaylight:function(){var e=new Date,t=e.getUTCHours(),n=e.getUTCMinutes();if(t%2===0){if(n>=T.cDAYTIME_DAY_START)return!0}else if(n<T.cDAYTIME_NIGHT_START)return!0;return!1},getDayPeriodRemaining:function(){var e=new Date,t=e.getUTCHours(),n=e.getUTCMinutes(),i="";return i=t%2===0?n>=T.cDAYTIME_DAY_START?T.cDAYTIME_DAY_START+T.cDAYTIME_DAY_MINUTES-n:T.cDAYTIME_DAY_START-n:n<T.cDAYTIME_NIGHT_START?T.cDAYTIME_NIGHT_START-n:T.cDAYTIME_NIGHT_START+T.cDAYTIME_NIGHT_MINUTES-n,i+D.getWord("m")},getUTCMidnight:function(){return(new Date).setUTCHours(0,0,0,0)},getTimeSinceMidnight:function(e,t){t=t||T.UnitEnum.Seconds,e=e||T.ReferenceEnum.UTC;var n=new Date,i=n.getUTCHours(),a=n.getUTCMinutes(),r=n.getUTCSeconds();switch(e){case T.ReferenceEnum.UTC:break;case T.ReferenceEnum.Server:i=i+T.cUTC_OFFSET_SERVER+T.DST_IN_EFFECT;break;case T.ReferenceEnum.Local:i=n.getHours(),a=n.getMinutes(),r=n.getSeconds()}return i=T.wrapInteger(i,T.cHOURS_IN_DAY),t===T.UnitEnum.Hours?i:t===T.UnitEnum.Minutes?i*T.cMINUTES_IN_HOUR+a:i*T.cSECONDS_IN_HOUR+a*T.cSECONDS_IN_MINUTE+r},getSecondsSinceWeekstart:function(e){return(new Date).getUTCDay()*T.cSECONDS_IN_DAY+e},getUNIXSeconds:function(){return~~((new Date).getTime()/T.cMSECONDS_IN_SECOND)},addDaysToDate:function(e,t){var n=new Date(e);return n.setDate(e.getDate()+t),n},getCurrentBihourlyMinutesUTC:function(){var e=new Date;return e.getUTCHours()%2*T.cMINUTES_IN_HOUR+e.getUTCMinutes()},getCurrentBihourlyTimestampLocal:function(e){var t=new Date,n=t.getUTCHours(),i=n%2===0?n:n-1,a=i*T.cMINUTES_IN_HOUR-t.getTimezoneOffset();return a=T.wrapInteger(a,T.cMINUTES_IN_DAY),T.getTimeFormatted({aCustomTimeInSeconds:(a+e)*T.cSECONDS_IN_MINUTE,aWantSeconds:!1})},getSecondsTillWeektime:function(e,t){var n=T.getSecondsSinceWeekstart(t);return n>e?T.cSECONDS_IN_WEEK-n+e:e-n},updateChecklistCountdowns:function(){$("#chlCountdownToDaily").text(T.formatTimeLetter(T.SECONDS_TILL_DAILY,!0)),$("#chlCountdownToWeekly").text(T.formatTimeLetter(T.SECONDS_TILL_WEEKLY,!0))},convertDailyObject:function(e){for(var t={},n=T.DailyAssociation,i=e.pve.length-1;i>=0;i--)e.pve[i].level.max<I.cLevelMax&&e.pve.splice(i,1);var a="unknown";return t.pve=[n[e.pve[0].id]||a,n[e.pve[1].id]||a,n[e.pve[2].id]||a,n[e.pve[3].id]||a],t.pvp=[n[e.pvp[0].id]||a,n[e.pvp[1].id]||a,n[e.pvp[2].id]||a,n[e.pvp[3].id]||a],t.wvw=[n[e.wvw[0].id]||a,n[e.wvw[1].id]||a,n[e.wvw[2].id]||a,n[e.wvw[3].id]||a],t},extractDailyChain:function(e){var t=e.pve[3];return t=void 0!==t&&null!==t?t.toLowerCase():null,null!==t&&void 0!==C.ChainAssociation[t]?C.getChainByAlias(t):null},getDaily:function(e){var t=e||{},n=3,i=t.aWantGetTomorrow||t.aWantSetTomorrow?U.URL_API.Tomorrow:U.URL_API.Daily;return $.getJSON(i,function(e){if(t.aWantGetTomorrow)T.DailyTomorrow=T.convertDailyObject(e),C.ChainTomorrow=T.extractDailyChain(T.DailyTomorrow);else{T.DailyToday=T.convertDailyObject(e);var i,a=T.extractDailyChain(T.DailyToday),r=T.getTimeSinceMidnight(T.ReferenceEnum.UTC,T.UnitEnum.Minutes);if(null!==a)if(i=T.convertScheduleKeyToUTCMinutes(a.scheduleKeys[0]),t.aWantSetTomorrow)C.ChainToday=a;else{if(null!==C.ChainToday&&t.aIsReset){var o=C.ChainToday.alias;if(C.ChainToday=null,C.refreshChainDailyIcon(),a.alias===o)return void setTimeout(function(){T.getDaily({aIsReset:!0})},n*T.cMSECONDS_IN_MINUTE)}i+T.cMINUTES_IN_TIMEFRAME>=r?C.ChainToday=a:T.getDaily({aWantSetTomorrow:!0})}else C.ChainToday=null;if(C.ChainToday&&(C.refreshChainDailyIcon(),t.aIsReset===!0)){if(O.isServerReset){var s=15,c="";T.DailyToday.pve&&"Forger"===T.DailyToday.pve[1]&&(c+="<br />"+U.convertExternalString(B.Announcement.Messages.Forger),s+=10);var l=D.getModifiedWord("boss","daily",U.CaseEnum.Sentence)+" "+D.getObjectName(C.ChainToday)+" "+D.getTranslation("will start")+" "+D.getTranslation("at")+" "+T.getTimeFormatted({aWantSeconds:!1,aCustomTimeInSeconds:T.convertScheduleKeyToLocalSeconds(C.ChainToday.scheduleKeys[0])})+" "+D.getTranslation("in")+" "+T.getTimeFormatted({aWantLetters:!0,aWantSeconds:!1,aCustomTimeInSeconds:T.getSecondsUntilChainStarts(C.ChainToday)});I.greet(l+c,s)}if(O.Options.bol_alertAutosubscribe&&O.Options.int_setAlarm===O.IntEnum.Alarm.Subscription){var u=$("#chnTime_"+C.ChainToday.nexus);u.hasClass("chnTimeSubscribed")||u.trigger("click")}}}})}},B={Announcement:GW2T_DASHBOARD_DATA.Announcement,Countdown:GW2T_DASHBOARD_DATA.Countdown,Story:GW2T_DASHBOARD_DATA.Story,Sale:GW2T_DASHBOARD_DATA.Sale,Vendor:GW2T_DASHBOARD_DATA.Vendor,isDashboardEnabled:!0,isAnnouncementEnabled:!1,isCountdownEnabled:!1,isCountdownTickEnabled:!1,isStoryEnabled:!1,isSaleEnabled:!1,isVendorEnabled:!1,Timeline:GW2T_TIMELINE,isTimelineEnabled:!0,isTimelineGenerated:!1,initializeDashboard:function(){for(var e=new Date,t=0;t<B.Countdown.Events.length;t++)if(B.Countdown.Events[t].Finish&&e<B.Countdown.Events[t].Finish){B.isCountdownEnabled=!0;break}if(B.Announcement.content.length>0&&T.isTimely(B.Announcement,e)&&(U.convertExternalLink($("#dsbAnnouncement").html(B.Announcement.content).find("a")),M.bindMapLinks("#dsbAnnouncement"),B.isAnnouncementEnabled=!0),B.Sale.Items.length>0&&T.isTimely(B.Sale,e)&&(B.isSaleEnabled=!0),T.isTimely(B.Vendor,e,T.cSECONDS_IN_DAY)&&(B.isVendorEnabled=!0),B.isCountdownEnabled===!1&&B.isAnnouncementEnabled===!1&&B.isSaleEnabled===!1&&B.isVendorEnabled===!1||B.isDashboardEnabled===!1||I.isMapEnabled===!1||O.Options.bol_showDashboard===!1)return void(B.isDashboardEnabled=!1);
if(B.toggleDashboard(!0),B.isCountdownTickEnabled=!0,$("#dsbToggle").click(function(){$("#dsbContainer").toggle("fast")}),B.isCountdownEnabled){for(var n,i,a,r=D.getNameKey(),o=D.getURLKey(),t=0;t<B.Countdown.Events.length;t++)n=B.Countdown.Events[t],n.isTimely=!0,n.StartStamp=n.Start.toLocaleString(),n.FinishStamp=n.Finish.toLocaleString(),i=void 0===n.name?n[r]:n.name,a=void 0===n.official?n[o]:U.getGW2OfficialLink(n.official),a=void 0===a?n.url:a,-1!==a.indexOf(I.cSiteURL)?n.Anchor="<a href='"+a+"'>"+i+"</a>":n.Anchor="<a"+U.convertExternalAnchor(a)+">"+i+"</a>",$("#dsbCountdown").append("<div id='dsbCountdown_"+t+"' class='dsbCountdownEntry'><code>"+I.Symbol.Block+"</code>"+n.Anchor+" <time id='dsbCountdownTime_"+t+"'></time> <abbr></abbr> <var></var></div>");I.qTip.init("#dsbCountdown"),B.refreshDashboard(e)}if(B.isStoryEnabled&&($("#dsbStory").before("<div id='dsbStoryTitle'>"+D.getObjectName(B.Story)+"</div>").show(),I.initializeScrollbar("#dsbStory")),B.isSaleEnabled){var s=T.getMinMax(B.Sale.Items,"price"),c=s.min===s.max?s.max:s.min+"-"+s.max;$("#dsbSale").append("<div><kbd id='dsbSaleHeader' class='curToggle'><img id='dsbSaleSymbol' src='img/ui/placeholder.png' /> <u>"+B.Sale.Items.length+" "+D.getTranslation("Gem Store Promotions")+"</u> (<span class='dsbSalePriceCurrent'>"+c+"<ins class='s16 s16_gem'></ins></span>)<img id='dsbSaleToggleIcon' src='img/ui/toggle.png' /></kbd>⇓@ "+B.Sale.Finish.toLocaleString()+"</div><div id='dsbSaleTable' class='jsScrollable'></div>");for(var l,u=!1,d=0,p=0,t=0;t<B.Sale.Items.length;t++)l=B.Sale.Items[t],0===l.col?d++:p++,l.discount&&(u=!0);p>d?(B.Sale.Padding.col=0,B.Sale.Items.unshift(B.Sale.Padding)):d>p&&(B.Sale.Padding.col=1,B.Sale.Items.unshift(B.Sale.Padding)),$("#dsbSaleSymbol").attr("src","img/ui/"+(u?"gemstore_special":"gemstore")+I.cPNG),$("#dsbSaleHeader").click(function(){B.generateDashboardSale()}),I.toggleToggleIcon("#dsbSaleToggleIcon",B.Sale.isPreshown),B.Sale.isPreshown===!0&&B.generateDashboardSale()}B.isVendorEnabled&&B.generateDashboardVendorHeader()},generateDashboardSale:function(){var e=function(e,t){return"<span class='dsbSalePercent'>"+U.convertRatioToPercent(-1*(1-e/t),0)+"</span> "},t=function(t,n,i){var a=void 0===i?n:i;return e(t,n)+"<span class='dsbSalePriceOld'>"+a+"</span> "},n=200,i=$("#dsbSaleTable");i.is(":empty")===!1?(I.toggleToggleIcon("#dsbSaleToggleIcon",!1),i.animate({height:0},n,function(){$(this).css({height:"auto"}).empty()})):(i.append(I.cThrobber),E.updateCoinInGem().always(function(){if(I.toggleToggleIcon("#dsbSaleToggleIcon",!0),i.empty(),B.Sale.note.length>0&&i.append("<div>Note: "+B.Sale.note+"</div>"),i.append("<div id='dsbSaleCol0'></div><div id='dsbSaleCol1'></div>"),0!==E.Exchange.CoinInGem)for(var a="<ins class='s16 s16_gem'></ins>",r=0;r<B.Sale.Items.length;r++){var o=B.Sale.Items[r],s=U.getWikiSearchLink(o.name),c=U.getYouTubeLink(o.name),l=void 0!==o.col?o.col:parseInt(r)%2,u=null;u=O.isInteger(o.discount)?o.discount:u,u=Array.isArray(o.discount)&&o.discount[0].length>2?o.discount[0][2]:u;var d=null!==u?t(o.price,u):"",p="";if(o.discount&&Array.isArray(o.discount)){p+="<span class='dsbDiscount'>";for(var h=0;h<o.discount.length;h++){var m=o.discount[h],g=Math.ceil(m[1]/m[0]),f=m.length>2?t(g,o.discount[0][2],m[2]):e(g,o.discount[0][1]),C=m[0]>1?"/"+m[0]+" = "+Math.ceil(m[1]/m[0])+a:"";p+=f+"<span class='dsbSalePriceCurrent'>"+m[1]+a+C+"</span> ≈ "+E.convertGemToCoin(m[1])+"<br />"}p+="</span>"}var v=o.id?"data-sale='"+o.id+"'":"",T=o.img?o.img:"img/ui/placeholder.png";$("#dsbSaleCol"+l).append("<div class='dsbSaleEntry'><a"+U.convertExternalAnchor(s)+"><img class='dsbSaleIcon' "+v+" src='"+T+"' /></a> <span class='dsbSaleVideo'><a"+U.convertExternalAnchor(c)+"'><ins class='s16 s16_youtube'></ins></a></span> "+d+"<span class='dsbSalePriceCurrent'>"+o.price+a+"</span><span class='dsbSalePriceCoin'> ≈ "+E.convertGemToCoin(o.price)+"</span><span class='dsbSalePriceMoney'> = "+E.convertGemToMoney(o.price)+"<ins class='s16 s16_money'></ins></span>"+p+"</div>")}var b=i.height();i.css({height:0}).animate({height:b},n,function(){$(this).css({height:"auto"}),I.initializeScrollbar("#dsbSaleTable"),I.updateScrollbar("#dsbSaleTable")}),$(".dsbSaleIcon").each(function(){$(this).attr("data-sale")&&!function(e){Q.getItem(e.attr("data-sale"),function(t){e.attr("src",t.icon),Q.scanItem(t,{aElement:e})})}($(this))})}))},generateDashboardVendorHeader:function(){var e=B.getDashboardVendorWeekday(),t=D.getObjectName(B.Vendor),n="";for(var i in B.Vendor.Codes)n+=i+"@"+B.Vendor.Codes[i][e]+" ";n+="- "+t,$("#dsbVendor").empty().append("<div><kbd id='dsbVendorHeader' class='curToggle' title='<dfn>Updated:</dfn> "+B.Vendor.Start.toLocaleString(window.navigator.language,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",weekday:"long"})+"'><img src='img/map/vendor_karma.png' /> <u>"+t+"</u><img id='dsbVendorToggleIcon' src='img/ui/toggle.png' /></kbd><a"+U.convertExternalAnchor("http://wiki.guildwars2.com/wiki/Pact_Supply_Network_Agent")+"title='Items restock at daily reset.<br />Vendors relocate 8 hours after that.<br />Limit 1 purchase per vendor.'>Info</a> <u class='curZoom' id='dsbVendorDraw'>"+D.getPhrase("draw route",U.CaseEnum.Sentence)+"</u>&nbsp;<input id='dsbVendorCodes' class='cssInputText' type='text' value='"+n+"' /> </div><div id='dsbVendorTable' class='jsScrollable'></div>"),I.preventMapPropagation("#dsbVendorCodes").click(function(){$(this).select()}),$("#dsbVendorHeader").click(function(){B.generateDashboardVendor()}),$("#dsbVendorDraw").click(function(){if($(this).data("hasDrawn")!==!0){var t=[];for(var n in B.Vendor.Coords){var i=B.Vendor.Coords[n][e];void 0!==i&&t.push(i)}M.redrawPersonalPath(P.getGreedyPath(t),"default"),$(this).data("hasDrawn",!0)}else M.clearPersonalPins(),$(this).data("hasDrawn",!1)}),I.toggleToggleIcon("#dsbVendorToggleIcon",B.Sale.isPreshown)},generateDashboardVendor:function(){var e=200,t=B.getDashboardVendorWeekday(),n=$("#dsbVendorTable"),i=O.getObjectLength(B.Vendor.Offers),a=function(){$(".dsbVendorItem").each(function(){M.bindMapLinkBehavior($(this))});var t=n.height();n.css({height:0}).animate({height:t},e,function(){$(this).css({height:"auto"}),I.initializeScrollbar("#dsbVendorTable"),I.updateScrollbar("#dsbVendorTable")}),T.isTimely(B.Vendor,new Date)===!1&&$("#dsbVendorTable").prepend("Note: These items have expired."),I.removeThrobber(n)};if(n.is(":empty")===!1)I.toggleToggleIcon("#dsbVendorToggleIcon",!1),n.animate({height:0},e,function(){$(this).css({height:"auto"}).empty()});else{I.toggleToggleIcon("#dsbVendorToggleIcon",!0),n.empty(),n.append(I.cThrobber);for(var r in B.Vendor.Offers)!function(e){var r=B.Vendor.Offers[e];Q.getItem(r.id,function(o){var s=D.isLanguageDefault()?o.name:r.id;n.append("<div class='dsbVendorEntry'><a"+U.convertExternalAnchor(U.getWikiSearchLink(s))+"><img id='dsbVendorIcon_"+e+"' class='dsbVendorIcon' src='img/ui/placeholder.png' /></a> <span id='dsbVendorItem_"+e+"' class='dsbVendorItem curZoom "+Q.getRarityClass(o.rarity)+"' data-coord='"+B.Vendor.Coords[e][t]+"'>"+o.name+"</span> <span class='dsbVendorPriceKarma'>"+E.formatKarmaString(r.price)+"</span><span class='dsbVendorPriceCoin' id='dsbVendorPriceCoin_"+e+"'></span></div>"),$.getJSON(U.getAPIPrice(r.id),function(t){$("#dsbVendorPriceCoin_"+e).html(" ≈ "+E.formatCoinStringColored(E.processPrice(t).priceselltaxed))}).fail(function(){$("#dsbVendorPriceCoin_"+e).html(" = "+E.formatCoinStringColored(0))}),M.bindMapLinkBehavior($("#dsbVendorItem_"+e),M.ZoomEnum.Ground,M.Pin.Program);var c=B.Vendor.Products[r.id]||r.id;Q.getItem(c,function(t){var n=$("#dsbVendorIcon_"+e);n.attr("src",t.icon),Q.scanItem(t,{aElement:n})}),$(".dsbVendorEntry").length===i&&a()}).fail(function(){n.empty(),I.print("Unable to retrieve item: <a"+U.convertExternalAnchor(U.getWikiSearchLink(r.id))+">"+r.id+"</a>. ArenaNet API servers may be down.")})}(r)}},getDashboardVendorWeekday:function(){var e=new Date,t=e.getUTCDay(),n=e.getUTCHours();return n<B.Vendor.resetHour?T.wrapInteger(t-1,T.cDAYS_IN_WEEK):t},updateDashboardCountdown:function(e){for(var t=0;t<B.Countdown.Events.length;t++){var n=B.Countdown.Events[t];if(n.isTimely){var i=T.formatTimeLetter(~~((n.DesiredTime.getTime()-e.getTime())/T.cMSECONDS_IN_SECOND),!0);document.getElementById("dsbCountdownTime_"+t).innerHTML=i}}},refreshDashboard:function(e){var t=e.getUTCHours(),n=e.getUTCMinutes();for(var i in B.Countdown.Events){var a=B.Countdown.Events[i];if(a.isTimely){var r,o,s,c=$("#dsbCountdown_"+i);e<a.Start?(a.DesiredTime=a.Start,r="dsbCountdownDormant",o=I.Symbol.ArrowUp+"@",s=a.StartStamp):e<a.Finish?(a.DesiredTime=a.Finish,r="dsbCountdownActive",o=I.Symbol.ArrowDown+"@",s=a.FinishStamp):(a.isTimely=!1,c.remove()),a.isTimely&&(c.find("code").removeClass().addClass(r),c.find("abbr").text(o),c.find("var").text(s))}}T.isTimely(B.Story,e)===!1&&(B.isStoryEnabled=!1,$("#dsbStory").hide()),T.isTimely(B.Sale,e)===!1&&(B.isSaleEnabled=!1,$("#dsbSale").hide()),T.isTimely(B.Vendor,e)&&t===B.Vendor.resetHour&&0===n&&B.generateDashboardVendorHeader()},toggleDashboard:function(e){void 0===e&&(e=!$("#itemDashboard").is(":visible")),O.Options.bol_showDashboard&&B.isDashboardEnabled&&(e?$("#itemDashboard").show().css({opacity:0}).animate({opacity:1},200):$("#itemDashboard").hide())},generateTimeline:function(){B.isTimelineGenerated=!0,$("#itemTimeline").show();var e=$("#tmlContainer").append("<div class='tmlLine curToggle' id='tmlLegend'></div>");B.updateTimelineLegend(),$("#tmlLegend").click(function(){$("#opt_bol_use24Hour").trigger("click")});for(var t in B.Timeline){var n=B.Timeline[t],i=void 0===n.zone?D.getObjectName(n):U.escapeHTML(M.getZoneName(n.zone)),a=$("<div class='tmlLine' title='<dfn>"+i+"</dfn>'></div>").appendTo(e);for(var r in n.Segments){var o=n.Segments[r],s="";switch(o.primacy){case C.EventPrimacyEnum.Normal:s=I.Symbol.Ellipsis;break;case C.EventPrimacyEnum.Boss:s=I.Symbol.Star+" "}var c=0===parseInt(r)?"<b class='tmlLineName'>"+i+"</b>":"";o.duration=T.parseChainTime(o.duration),o.time=T.parseChainTime(o.time);var l=o.duration/T.cMINUTES_IN_2_HOURS*T.cPERCENT_100;a.append("<div class='tmlSegment' style='width:"+l+"%' data-start='"+o.time+"' data-finish='"+(o.time+o.duration)+"'><div class='tmlSegmentContent'>"+c+"<span class='tmlSegmentName'>"+s+D.getObjectName(o)+"</span><span class='tmlSegmentCountdown'></span></div></div>")}}$("#tmlToggle").click(function(){$("#tmlContainer").toggle("fast")}),$("#tmlDelete").click(function(){$("#opt_bol_showTimeline").prop("checked",!1).trigger("change"),B.toggleTimeline(!1),B.isTimelineEnabled=!1}),$("#tmlOpaque").click(function(){$("#opt_bol_opaqueTimeline").trigger("click")}),I.qTip.init(".tmlLine"),B.updateTimelineSegments(),B.updateTimelineIndicator()},updateTimelineIndicator:function(){if(B.isTimelineGenerated){var e=T.getCurrentBihourlyMinutesUTC(),t=e/T.cMINUTES_IN_2_HOURS*T.cPERCENT_100;$("#tmlIndicator").css({left:t+"%"}),$(".tmlLineName").css({left:t+"%"}),$(".tmlSegment").each(function(){var t=$(this).find(".tmlSegmentCountdown");$(this).hasClass("tmlSegmentActive")?t.html(I.Symbol.ArrowUp+T.formatMinutes($(this).data("finish")-e)):t.html(I.Symbol.ArrowDown+T.formatMinutes(T.wrapInteger($(this).data("start")-e,T.cMINUTES_IN_2_HOURS)))})}},updateTimelineSegments:function(){if(B.isTimelineGenerated){var e=T.getCurrentBihourlyMinutesUTC();if($(".tmlSegment").each(function(){e>=$(this).data("start")&&e<$(this).data("finish")?$(this).hasClass("tmlSegmentActive")||($(this).css({opacity:0}).animate({opacity:1},1e3),$(this).addClass("tmlSegmentActive")):$(this).removeClass("tmlSegmentActive")}),0===e)B.updateTimelineLegend();else{var t=e-T.cMINUTES_IN_MINIFRAME;$("#tmlSegmentTimestamp_"+t).html(T.getCurrentBihourlyTimestampLocal(t+T.cMINUTES_IN_2_HOURS)).addClass("tmlSegmentTimestampFutureFar").parent().css({opacity:0}).animate({opacity:1},1e3)}}},updateTimelineLegend:function(){if(B.isTimelineGenerated)for(var e,t,n=T.getCurrentBihourlyMinutesUTC(),i=$("#tmlLegend").empty(),a=T.cMINUTES_IN_2_HOURS/T.cMINUTES_IN_MINIFRAME,r=a/2,o=0;a>o;o++){var s=T.cPERCENT_100/a,c=0===o||o===r?"tmlSegmentTimestampHour":"",l="";e=T.cMINUTES_IN_MINIFRAME*o,e<n-T.cMINUTES_IN_MINIFRAME?(t=T.getCurrentBihourlyTimestampLocal(e+T.cMINUTES_IN_2_HOURS),l="tmlSegmentTimestampFutureFar"):t=T.getCurrentBihourlyTimestampLocal(e),i.append("<div class='tmlSegment' style='width:"+s+"%'><div class='tmlSegmentContent'><span id='tmlSegmentTimestamp_"+e+"' class='tmlSegmentTimestamp "+c+" "+l+"'>"+t+"</span></div></div>")}},toggleTimeline:function(e){void 0===e&&(e=!$("#itemTimeline").is(":visible")),O.Options.bol_showTimeline&&B.isTimelineEnabled?e?$("#itemTimeline").show().css({opacity:0}).animate({opacity:1},200):$("#itemTimeline").hide():O.Options.bol_showTimeline===!1&&$("#itemTimeline").hide()}},K={tickerFrequency:250,tickerSecondPrevious:null,stopwatchFrequency:50,awakeTimestampPrevious:0,awakeTimestampTolerance:5,currentFrameOffsetMinutes:0,currentPredictionColor:"",currentDaytimeSymbol:"",iconOpacityChecked:.4,iconOpacitySpeed:200,oldQuadrantAngle:0,cDEGREES_IN_CIRCLE:360,cDEGREES_IN_QUADRANT:90,paneSizePrevious:0,handSecond:{},handMinute:{},handHour:{},clockBackground:{},clockCircumference:{},timeProgress0:{},timeProgress1:{},timeDaylight:{},timeLocal:{},timeDaytime:{},timeSimple:{},timeMap:{},timeWvW:{},timeLog:{},countdownWvW:{},timestampUTC:{},timestampLocal:{},timestampServer:{},timestampReset:{},stopwatchUp:{},stopwatchDown:{},WpChain0:{},WpChain1:{},WpChain2:{},WpChain3:{},IconSD0:{},IconSD1:{},IconSD2:{},IconSD3:{},IconHC0:{},IconHC1:{},IconHC2:{},IconHC3:{},IconsStandard:[],IconsHardcore:[],lsClipboards:[],TickerTimeout:{},StopwatchTimeout:{},StopwatchTimestamp:0,StopwatchTimesleep:0,isStopwatchPaused:!1,StopwatchTimerStart:0,StopwatchTimerFinish:0,initializeClock:function(){K.handSecond=$("#clkSecondHand")[0],K.handMinute=$("#clkMinuteHand")[0],K.handHour=$("#clkHourHand")[0],K.clockBackground=$("#paneClockBackground")[0],K.clockCircumference=$("#clkCircumference")[0],K.timeProgress0=$("#chnProgress0")[0],K.timeProgress1=$("#chnProgress1")[0],K.timeLocal=$("#itemTimeLocalActual")[0],K.timeDaytime=$("#itemTimeDayTime")[0],K.timeSimple=$("#itemSimpleTime")[0],K.timeMap=$("#mapTime")[0],K.timeWvW=$("#wvwTime")[0],K.timeLog=$("#logTime")[0],K.countdownWvW=$("#lboCountdown")[0],K.timestampUTC=$("#optTimestampUTC")[0],K.timestampLocal=$("#optTimestampLocalReset")[0],K.timestampServer=$("#optTimestampServerReset")[0],K.timestampReset=$("#optTimeTillReset")[0],K.stopwatchUp=$("#watUp")[0],K.stopwatchDown=$("#watDown")[0],B.initializeDashboard(),K.updateTimeFrame(new Date),T.getDaily(),K.updateDaytimeIcon(),K.tickFrequent(),K.updateDigitalClockMinutely(),K.initializeClipboard(),$("#itemTimeLocalActual").click(function(){$("#opt_bol_use24Hour").trigger("click")}),$("#clkToggle").click(function(){O.Options.int_setClock!==O.IntEnum.Clock.None?(K.paneSizePrevious=O.Options.int_setClock,X.setFieldsetState("int_setClock",O.IntEnum.Clock.None)):X.setFieldsetState("int_setClock",K.paneSizePrevious)})},setClock:function(){var e=200,t=0;switch(O.Options.int_setClock){case O.IntEnum.Clock.Compact:$("#paneClock").show(),$("#itemTimeLocal, #itemTimeDaytime, #itemLanguage, #itemSocial").show(),I.bulkAnimate([{s:"#clock",p:{top:"0px",left:"70px",width:"220px",height:"220px"}},{s:"#paneClockFace",p:{width:"360px",height:"360px",top:"-70px",left:"0px"}},{s:"#paneClockIcons .iconSD",p:{"border-radius":"32px"}},{s:"#paneClockIcons .iconHC",p:{"border-radius":"24px"}},{s:"#clkIconSD0",p:{top:"4px",left:"290px"}},{s:"#clkIconSD1",p:{top:"148px",left:"290px"}},{s:"#clkIconSD2",p:{top:"148px",left:"4px"}},{s:"#clkIconSD3",p:{top:"4px",left:"4px"}},{s:"#clkIconHC0",p:{top:"52px",left:"306px"}},{s:"#clkIconHC1",p:{top:"132px",left:"306px"}},{s:"#clkIconHC2",p:{top:"132px",left:"20px"}},{s:"#clkIconHC3",p:{top:"52px",left:"20px"}},{s:"#clkWaypoint0",p:{top:"24px",left:"274px"}},{s:"#clkWaypoint1",p:{top:"164px",left:"274px"}},{s:"#clkWaypoint2",p:{top:"164px",left:"52px"}},{s:"#clkWaypoint3",p:{top:"24px",left:"52px"}}],e),$("#paneClockIcons .iconHC").css({width:"32px",height:"32px"}),$("#itemTimeLocal").css({width:"100%",right:"auto",bottom:"90px","text-align":"center",color:"#eee",opacity:.5}),$("#itemTimeDaytime").css({width:"100%",top:"90px",bottom:"auto",left:"auto","text-align":"center",color:"#eee",opacity:.5}),$("#itemLanguage").css({bottom:"72px",left:"10px"}),$("#itemSocial").css({bottom:"100px",right:"10px"}),t=I.cPANE_CLOCK_HEIGHT_COMPACT;break;case O.IntEnum.Clock.Full:$("#paneClock").show(),$("#itemTimeLocal, #itemTimeDaytime, #itemLanguage, #itemSocial").show(),I.bulkAnimate([{s:"#clock",p:{top:"70px",left:"70px",width:"220px",height:"220px"}},{s:"#paneClockFace",p:{width:"360px",height:"360px",top:"0px",left:"0px"}},{s:"#paneClockIcons .iconSD",p:{"border-radius":"12px"}},{s:"#paneClockIcons .iconHC",p:{"border-radius":"12px"}},{s:"#clkIconSD0",p:{top:"4px",left:"148px"}},{s:"#clkIconSD1",p:{top:"148px",left:"290px"}},{s:"#clkIconSD2",p:{top:"290px",left:"148px"}},{s:"#clkIconSD3",p:{top:"148px",left:"4px"}},{s:"#clkIconHC0",p:{top:"12px",left:"212px"}},{s:"#clkIconHC1",p:{top:"212px",left:"298px"}},{s:"#clkIconHC2",p:{top:"298px",left:"100px"}},{s:"#clkIconHC3",p:{top:"100px",left:"12px"}},{s:"#clkWaypoint0",p:{top:"52px",left:"164px"}},{s:"#clkWaypoint1",p:{top:"164px",left:"274px"}},{s:"#clkWaypoint2",p:{top:"274px",left:"164px"}},{s:"#clkWaypoint3",p:{top:"164px",left:"52px"}}],e),$("#paneClockIcons .iconHC").css({width:"48px",height:"48px"}),$("#itemTimeLocal").css({width:"auto",right:"10px",bottom:"10px","text-align":"left",color:"#bbcc77",opacity:1}),$("#itemTimeDaytime").css({width:"auto",top:"auto",bottom:"10px",left:"10px","text-align":"left",color:"#bbcc77",opacity:1}),$("#itemLanguage").css({bottom:"0px",left:"10px"}),$("#itemSocial").css({bottom:"28px",right:"10px"}),t=I.cPANE_CLOCK_HEIGHT;break;case O.IntEnum.Clock.Bar:$("#paneClock").show(),$("#itemTimeLocal, #itemTimeDaytime, #itemLanguage, #itemSocial").hide(),I.bulkAnimate([{s:"#clock",p:{top:"0px",left:"0px",width:"85px",height:"85px"}},{s:"#paneClockFace",p:{width:"132px",height:"132px",top:"-24px",left:"-24px"}},{s:"#paneClockIcons .iconSD",p:{"border-radius":"32px"}},{s:"#paneClockIcons .iconHC",p:{"border-radius":"24px"}},{s:"#clkIconSD0",p:{top:"0px",left:"82px"}},{s:"#clkIconSD1",p:{top:"0px",left:"152px"}},{s:"#clkIconSD2",p:{top:"0px",left:"222px"}},{s:"#clkIconSD3",p:{top:"0px",left:"292px"}},{s:"#clkIconHC0",p:{top:"48px",left:"98px"}},{s:"#clkIconHC1",p:{top:"48px",left:"168px"}},{s:"#clkIconHC2",p:{top:"48px",left:"238px"}},{s:"#clkIconHC3",p:{top:"48px",left:"308px"}},{s:"#clkWaypoint0",p:{top:"-8px",left:"98px"}},{s:"#clkWaypoint1",p:{top:"-8px",left:"168px"}},{s:"#clkWaypoint2",p:{top:"-8px",left:"238px"}},{s:"#clkWaypoint3",p:{top:"-8px",left:"308px"}}],e),$("#paneClockIcons .iconHC").css({width:"32px",height:"32px"}),t=I.cPANE_CLOCK_HEIGHT_BAR;break;case O.IntEnum.Clock.None:$("#paneMenu").animate({top:0},e),$("#paneContent").animate({top:I.cPANE_MENU_HEIGHT,"min-height":I.cPANEL_HEIGHT_MIN-I.cPANE_MENU_HEIGHT+"px"},e,function(){$("#paneClock").hide()})}switch(I.CLOCK_AND_MENU_HEIGHT=t+I.cPANE_MENU_HEIGHT,O.Options.int_setClock!==O.IntEnum.Clock.None&&($("#paneMenu").animate({top:t},e),$("#paneClock, #paneClockWall, #paneClockBackground, #paneClockIcons, #paneClockCanvas").animate({height:t},e),$("#paneContent").animate({top:t+I.cPANE_MENU_HEIGHT,"min-height":I.cPANEL_HEIGHT_MIN-(t+I.cPANE_MENU_HEIGHT)+"px"},e)),I.ModeCurrent){case I.ModeEnum.Overlay:$("#itemSocial").hide()}},setMarkerAngle:function(e,t){$(e).attr("transform","rotate("+t/10+", 50, 50)")},rotateClockElement:function(e,t){e.setAttribute("transform","rotate("+t+", 50, 50)")},reapplyFilters:function(){if(I.BrowserCurrent===I.BrowserEnum.Firefox){var e=$("#clkCircumference"),t=$("#clkHands"),n="url(#clkFilterShadowOuter)",i="url(#clkGradientCircumference)",a="url(#clkFilterShadowHand)";e.removeAttr("filter").attr("filter",n),e.css("stroke",i),t.removeAttr("filter").attr("filter",a)}},initializeClockItems:function(){K.IconsStandard=null,K.IconsHardcore=null,K.IconsStandard=new Array(K.IconSD0,K.IconSD1,K.IconSD2,K.IconSD3),K.IconsHardcore=new Array(K.IconHC0,K.IconHC1,K.IconHC2,K.IconHC3);var e,t,n="click",i="dblclick";for(I.ModeCurrent===I.ModeEnum.Website&&I.isProgramEmbedded===!1&&(n="dblclick",i="click"),e=0;e<T.cNUM_TIMEFRAMES_IN_HOUR;e++)$([K.IconsStandard[e],K.IconsHardcore[e]]).each(function(){$(this).unbind(i).on(i,function(){var e=C.Chains[$(this).data(C.cIndexSynonym)].primaryEvents;t=e[e.length-1].path[0],M.goToView(t,M.ZoomEnum.Ground,M.Pin.Event)}).unbind(n).on(n,function(){$("#chnCheck_"+C.Chains[$(this).data(C.cIndexSynonym)].nexus).trigger("click")})})},checkoffChainIcon:function(e){var t,n,i,a=C.Chains[e];if(a.series===C.ChainSeriesEnum.Standard||a.series===C.ChainSeriesEnum.Hardcore)for(t=0;t<T.cNUM_TIMEFRAMES_IN_HOUR;t++){switch(a.series){case C.ChainSeriesEnum.Standard:n=T.getStandardChain(t),i=K.IconsStandard[t];break;case C.ChainSeriesEnum.Hardcore:n=T.getHardcoreChain(t),i=K.IconsHardcore[t]}n&&e===n.nexus&&(X.getChainChecklistState(n)!==X.ChecklistEnum.Unchecked?i.css({opacity:1}).animate({opacity:K.iconOpacityChecked},K.iconOpacitySpeed):i.css({opacity:K.iconOpacityChecked}).animate({opacity:1},K.iconOpacitySpeed))}},colorPrediction:function(e){e!==K.currentPredictionColor&&(K.currentPredictionColor=e,K.handMinute.style.stroke=e,K.timeProgress0.style.background="linear-gradient(to right, black 0%, "+e+" 100%)")},tickFrequent:function(){var e=new Date,t=e.getSeconds();return K.tickerSecondPrevious===t?void(K.TickerTimeout=setTimeout(K.tickFrequent,K.tickerFrequency)):(K.tickerSecondPrevious=t,void K.tickSecond(e))},tickSecond:function(e){var t=T.getTimeFormatted(),n=e.getSeconds(),i=T.getTimeSinceMidnight();T.TIMESTAMP_UNIX_SECONDS=T.getUNIXSeconds(),T.SECONDS_TILL_DAILY=T.cSECONDS_IN_DAY-i,T.SECONDS_TILL_WEEKLY=T.getSecondsTillWeektime(T.cWEEKLY_RESET_SECONDS,i);var a=e.getMinutes(),r=e.getHours()%T.cHOURS_IN_MERIDIEM,o=60*a+n,s=6*n,c=6*a+n/10,l=30*r+a/60*30;K.rotateClockElement(K.clockCircumference,c),K.rotateClockElement(K.handSecond,s),K.rotateClockElement(K.handMinute,c),K.rotateClockElement(K.handHour,l);var u=1-(a%T.cMINUTES_IN_TIMEFRAME*60+n)/T.cSECONDS_IN_TIMEFRAME,d=T.cPERCENT_100*u;if(K.timeProgress0.style.width=d+"%",K.timeProgress1.style.width=100-d+"%",a%T.cMINUTES_IN_TIMEFRAME===0&&0===n)0===O.Options.int_setDimming&&I.ModeCurrent!==I.ModeEnum.Simple&&$(K.clockBackground).fadeTo(800,1),$(K.timeProgress0).css({width:"0%"}).animate({width:"100%"},800),$(K.timeProgress1).css({width:"100%"}).animate({width:"0%"},800),K.updateTimeFrame(e);else{var p=T.TIMESTAMP_UNIX_SECONDS;K.awakeTimestampPrevious<p-K.awakeTimestampTolerance&&K.updateTimeFrame(e),K.awakeTimestampPrevious=p,0===O.Options.int_setDimming&&I.ModeCurrent!==I.ModeEnum.Simple&&(K.clockBackground.style.opacity=u)}switch(C.CurrentChains.forEach(C.updateCurrentChainTimeHTML),0===n&&(a%T.cMINUTES_IN_MINIFRAME===0&&(K.updateDaytimeIcon(),K.updateDryTopClipboard(),B.updateTimelineSegments(),B.isDashboardEnabled&&B.refreshDashboard(e)),K.updateDigitalClockMinutely(),B.updateTimelineIndicator(),C.updateChainsTimeHTML(),K.updateWaypointsClipboard(),O.Options.int_setAlarm===O.IntEnum.Alarm.Subscription&&(K.doSubscribedSpeech(O.Options.int_alertSubscribedFirst),K.doSubscribedSpeech(O.Options.int_alertSubscribedSecond))),I.ModeCurrent){case I.ModeEnum.Simple:K.timeSimple.innerHTML=T.getTimeFormatted({aWant24:!0,aWantHours:!1,aWantLetters:!0,aCustomTimeInSeconds:T.cSECONDS_IN_TIMEFRAME-T.getCurrentTimeframeElapsedTime()});break;case I.ModeEnum.Overlay:P.switchMapCheck()}K.timeLocal.innerHTML=t,K.timestampUTC.innerHTML=T.TIMESTAMP_UNIX_SECONDS,K.timestampLocal.innerHTML=O.Utilities.timestampDaily.value,K.timestampServer.innerHTML=T.TIMESTAMP_UNIX_SECONDS+T.SECONDS_TILL_DAILY,K.timestampReset.innerHTML=T.getTimeFormatted({aCustomTimeInSeconds:T.SECONDS_TILL_DAILY,aWant24:!0}),o>=K.currentFrameOffsetMinutes&&o<K.currentFrameOffsetMinutes+C.CurrentChainSD.minFinish?K.colorPrediction("lime"):o>=K.currentFrameOffsetMinutes+C.CurrentChainSD.minFinish&&o<K.currentFrameOffsetMinutes+C.CurrentChainSD.avgFinish?K.colorPrediction("orange"):o>=K.currentFrameOffsetMinutes+C.CurrentChainSD.avgFinish&&K.colorPrediction("red"),T.isChecklistCountdownsStarted&&T.updateChecklistCountdowns(),B.isCountdownTickEnabled&&B.updateDashboardCountdown(e),0!==K.StopwatchTimerStart&&K.tickStopwatchDown(),W.isObjectiveTimerTickEnabled&&(K.timeLog.innerHTML=t,W.updateObjectiveTimers(),null!==W.MatchFinishTimeMS&&(K.countdownWvW.innerHTML=T.formatTimeLetter(W.secTillWvWReset--,!0)),0===n&&W.updateAllObjectiveAge()),K.TickerTimeout=setTimeout(K.tickFrequent,K.tickerFrequency)},doSubscribedSpeech:function(e){if(e>0){var t=T.cMINUTES_IN_TIMEFRAME-T.getCurrentTimeframeElapsedTime(T.UnitEnum.Minutes),n=C.NextChainSD1,i=C.NextChainHC1,a=C.NextChainLS1,r=!1,o=!1,s=!1,c=!1,l="",u="";if(e>T.cMINUTES_IN_TIMEFRAME&&(n=C.NextChainSD2,i=C.NextChainHC2,a=C.NextChainLS2,t+=T.cMINUTES_IN_TIMEFRAME),e===t){var d=" "+D.getSpeechWord("and")+" ",p=" "+D.getSpeechWord("will start")+D.getPluralTime(t,"minute");l=D.getSpeechWord(D.orderModifier(D.orderModifier("boss","world"),"subscribed"))+" ",r=O.objToBool(n)&&C.isChainSubscribed(n)&&C.isChainUnchecked(n),o=O.objToBool(i)&&C.isChainSubscribed(i)&&C.isChainUnchecked(i),s=O.objToBool(a)&&C.isChainSubscribed(a)&&C.isChainUnchecked(a),(r||o)&&(r&&o?l+=D.getChainPronunciation(n)+d+D.getChainPronunciation(i):r?l+=D.getChainPronunciation(n):o&&(l+=D.getChainPronunciation(i)),D.speak(l),D.speak(p));var h,m=e>T.cMINUTES_IN_TIMEFRAME?C.NextChainsMS2:C.NextChainsMS1;if(m.length>0){u=D.getSpeechWord("event","subscribed")+" ";for(var g=0;g<m.length;g++)h=m[g],O.objToBool(h)&&C.isChainSubscribed(h)&&C.isChainUnchecked(h)&&(u+=D.getChainPronunciation(h),g+1<m.length&&m.length>1&&(u+=d),c=!0);c&&(u+=p,D.speak(u))}B.isStoryEnabled&&s&&(D.speak(D.getSpeechWord("event","subscribed")+" "+D.getChainPronunciation(a)),D.speak(p))}}},updateTimeFrame:function(e){if(O.checkResetTimestamps(e),C.CurrentChainSD=T.getStandardChain(),C.NextChainSD1=T.getStandardChain(1),C.NextChainSD2=T.getStandardChain(2),C.NextChainSD3=T.getStandardChain(3),C.NextChainSD4=T.getStandardChain(4),C.CurrentChainsSD=[C.CurrentChainSD,C.NextChainSD1,C.NextChainSD2,C.NextChainSD3],C.CurrentChainHC=T.getHardcoreChain(),C.NextChainHC1=T.getHardcoreChain(1),C.NextChainHC2=T.getHardcoreChain(2),C.NextChainHC3=T.getHardcoreChain(3),C.NextChainHC4=T.getHardcoreChain(4),B.isStoryEnabled&&(C.NextChainLS1=T.getLivingStoryChain(1),C.NextChainLS2=T.getLivingStoryChain(2)),C.NextChainsMS1=T.getMiscellaneousChains(1),C.NextChainsMS2=T.getMiscellaneousChains(2),C.PreviousChains2=T.getTimeframeChains(-2),C.PreviousChains1=T.getTimeframeChains(-1),C.CurrentChains=T.getTimeframeChains(),C.NextChains1=T.getTimeframeChains(1),C.sortChainsListHTML(),C.CurrentChains.forEach(C.queueEventsHighlight),I.ModeCurrent===I.ModeEnum.Simple&&($("#itemSimpleCurrentSD").text(D.getObjectName(C.CurrentChainSD)),$("#itemSimpleNextSD").text(D.getObjectName(C.NextChainSD1)),$("#itemSimpleCurrentHC").text(""),$("#itemSimpleNextHC").text(""),C.CurrentChainHC||C.NextChainHC1?($("#itemSimpleHC").show(),C.CurrentChainHC&&$("#itemSimpleCurrentHC").text(D.getObjectName(C.CurrentChainHC)),C.NextChainHC1&&$("#itemSimpleNextHC").text(D.getObjectName(C.NextChainHC1))):$("#itemSimpleHC").hide()),O.Options.int_setAlarm===O.IntEnum.Alarm.Checklist&&O.Options.bol_alertAtEnd){var t=", "+D.getSpeechWord("checked"),n="",i="",a="",r="",o=O.objToBool(C.CurrentChainSD),s=O.objToBool(C.CurrentChainHC),c=O.objToBool(C.NextChainSD1),l=O.objToBool(C.NextChainHC1),u=D.getSpeechWord("world boss","current")+" "+D.getSpeechWord("is")+" ";C.CurrentChainSD&&!C.isChainUnchecked(C.CurrentChainSD)&&(n=t),C.CurrentChainHC&&!C.isChainUnchecked(C.CurrentChainHC)&&(a=t),C.NextChainSD1&&!C.isChainUnchecked(C.NextChainSD1)&&(i=t),C.NextChainHC1&&!C.isChainUnchecked(C.NextChainHC1)&&(r=t),O.Options.bol_alertChecked===!1&&(n.length>0&&(o=!1),a.length>0&&(s=!1),i.length>0&&(c=!1),r.length>0&&(l=!1)),o&&s?(D.speak(u+D.getChainPronunciation(C.CurrentChainSD)+n,5),D.speak(D.getSpeechWord("and")+", "+D.getChainPronunciation(C.CurrentChainHC)+a,4)):o?D.speak(u+D.getChainPronunciation(C.CurrentChainSD)+n,5):s&&D.speak(u+D.getChainPronunciation(C.CurrentChainHC)+a,5),(o||s)&&(c&&l?(D.speak(D.getSpeechWord("then")+", "+D.getChainPronunciation(C.NextChainSD1)+i,4),D.speak(D.getSpeechWord("and")+", "+D.getChainPronunciation(C.NextChainHC1)+r,4)):c?D.speak(D.getSpeechWord("then")+", "+D.getChainPronunciation(C.NextChainSD1)+i,4):l&&D.speak(D.getSpeechWord("then")+", "+D.getChainPronunciation(C.NextChainHC1)+r,4))}var d=e.getSeconds(),p=e.getMinutes(),h=60*p+d;$("#clkMarkers line").each(function(){$(this).attr("stroke","black")}),$("#paneClockIcons .iconSD").removeClass("clkIconCurrent clkIconNext"),$("#paneClockIcons .iconHC").removeClass("clkIconCurrent clkIconNext");var m=function(e,t,n,i,a,r,o,s,c,l,u,d,p,h){$([K.IconSD0,K.IconHC0]).each(function(){$(this).addClass("clkIconCurrent")}),$([K.IconSD1,K.IconHC1]).each(function(){$(this).addClass("clkIconNext")}),K.setMarkerAngle(t,C.CurrentChainSD.minFinish+u),K.setMarkerAngle(n,C.CurrentChainSD.avgFinish+u),K.setMarkerAngle(a,C.NextChainSD1.minFinish+d),K.setMarkerAngle(r,C.NextChainSD1.avgFinish+d),K.setMarkerAngle(o,C.NextChainSD2.minFinish+p),K.setMarkerAngle(s,C.NextChainSD2.avgFinish+p),K.setMarkerAngle(c,C.NextChainSD3.minFinish+h),K.setMarkerAngle(l,C.NextChainSD3.avgFinish+h);var m=function(e,t){e?(t.show(),t.attr("src","img/chain/"+e.alias.toLowerCase()+I.cPNG),t.data(C.cIndexSynonym,e.nexus),I.ModeCurrent===I.ModeEnum.Simple&&(t.attr("title",D.getObjectName(e)),I.qTip.init(t)),X.getChainChecklistState(e)!==X.ChecklistEnum.Unchecked?t.css({opacity:K.iconOpacityChecked}):t.css({opacity:1})):t.hide()};m(C.CurrentChainSD,K.IconSD0),m(C.NextChainSD1,K.IconSD1),m(C.NextChainSD2,K.IconSD2),m(C.NextChainSD3,K.IconSD3),m(C.CurrentChainHC,K.IconHC0),m(C.NextChainHC1,K.IconHC1),m(C.NextChainHC2,K.IconHC2),m(C.NextChainHC3,K.IconHC3),$(e).attr("stroke","lime"),$(t).attr("stroke","orange"),$(n).attr("stroke","red"),$(i).attr("stroke","green")},g=function(e){var t,n,i,a;switch(e){case T.cSECS_MARK_0:t="0",n="1",i="2",a="3";break;case T.cSECS_MARK_1:t="1",n="2",i="3",a="0";break;case T.cSECS_MARK_2:t="2",n="3",i="0",a="1";break;case T.cSECS_MARK_3:t="3",n="0",i="1",a="2"}K.currentFrameOffsetMinutes=e,K.WpChain0=$("#clkWaypoint"+t),K.IconSD0=$("#clkIconSD"+t),K.WpChain1=$("#clkWaypoint"+n),K.IconSD1=$("#clkIconSD"+n),K.WpChain2=$("#clkWaypoint"+i),K.IconSD2=$("#clkIconSD"+i),K.WpChain3=$("#clkWaypoint"+a),K.IconSD3=$("#clkIconSD"+a),K.IconHC0=$("#clkIconHC"+t),K.IconHC1=$("#clkIconHC"+n),K.IconHC2=$("#clkIconHC"+i),K.IconHC3=$("#clkIconHC"+a),C.refreshChainDailyIcon(),m($("#clkMarker"+t),$("#clkMarker"+t+"A"),$("#clkMarker"+t+"B"),$("#clkMarker"+n),$("#clkMarker"+n+"A"),$("#clkMarker"+n+"B"),$("#clkMarker"+i+"A"),$("#clkMarker"+i+"B"),$("#clkMarker"+a+"A"),$("#clkMarker"+a+"B"),T["cSECS_MARK_"+t],T["cSECS_MARK_"+n],T["cSECS_MARK_"+i],T["cSECS_MARK_"+a]);var r=document.getElementById("clkQuadrant"),o=parseInt(t)*K.cDEGREES_IN_QUADRANT;0===o&&0!==K.oldQuadrantAngle&&(o=K.cDEGREES_IN_CIRCLE),$({angle:K.oldQuadrantAngle}).animate({angle:o},{duration:600,step:function(){K.rotateClockElement(r,this.angle)},done:function(){K.rotateClockElement(r,o)}}),o===K.cDEGREES_IN_CIRCLE&&(o=0),K.oldQuadrantAngle=o};h>=T.cSECS_MARK_0&&h<T.cSECS_MARK_1?g(T.cSECS_MARK_0):h>=T.cSECS_MARK_1&&h<T.cSECS_MARK_2?g(T.cSECS_MARK_1):h>=T.cSECS_MARK_2&&h<T.cSECS_MARK_3?g(T.cSECS_MARK_2):h>=T.cSECS_MARK_3&&h<=T.cSECS_MARK_4&&g(T.cSECS_MARK_3),K.updateWaypointsClipboard(),K.updateDryTopClipboard(),K.initializeClockItems()},initializeClipboard:function(){for(var e=0;e<T.cNUM_TIMEFRAMES_IN_HOUR;e++)I.initializeClipboard("#clkWaypoint"+e);
if(C.DryTopChains.length>0)for(var e=0;2>e;e++)I.initializeClipboard("#chnDryTopWaypoint"+e)},updateDaytimeIcon:function(){var e=T.isDaylight()?I.Symbol.Day:I.Symbol.Night;K.currentDaytimeSymbol=e,$("#itemTimeDayIcon").text(e)},updateDigitalClockMinutely:function(){var e=T.getDayPeriodRemaining();K.timeDaytime.innerHTML=e;var t=T.getTimeFormatted({aWantSeconds:!1})+" "+K.currentDaytimeSymbol+e;K.timeMap.innerHTML=t,K.timeWvW.innerHTML=t,K.timeLocal.title=(new Date).toLocaleString()+"<br /><dfn>Anet:</dfn> "+T.getTimeFormatted({aReference:T.ReferenceEnum.Server,aWantSeconds:!1})+"<br /><dfn>UTC:</dfn> "+T.getTimeFormatted({aReference:T.ReferenceEnum.UTC,aWantSeconds:!1,aWant24:!0})+"<br /><dfn>Daily:</dfn> "+T.formatTimeLetter(T.SECONDS_TILL_DAILY,!1)+"<br /><dfn>Weekly:</dfn> "+T.formatTimeLetter(T.SECONDS_TILL_WEEKLY,!1),I.qTip.init(K.timeLocal)},updateWaypointsClipboard:function(){var e=function(e,t,n,i,a){var r="",o=C.getChainByAlias("triplewurm");r+=t.waypoint+" "+D.getChainAlias(t),n&&n.nexus!==o.nexus?n.nexus!==o.nexus&&(r+=" "+D.getTranslation("and")+" "+n.waypoint+" "+D.getChainAlias(n)+T.getTimeTillChainFormatted(n)):r+=T.getTimeTillChainFormatted(t),r+=", "+D.getTranslation("then")+" "+i.waypoint+" "+D.getChainAlias(i),a&&a.nexus!==o.nexus?a.nexus!==o.nexus&&(r+=" "+D.getTranslation("and")+" "+a.waypoint+" "+D.getChainAlias(a)+T.getTimeTillChainFormatted(a)):r+=T.getTimeTillChainFormatted(i),r+=I.siteTagCurrent,I.updateClipboard(e,r)};e(K.WpChain0,C.CurrentChainSD,C.CurrentChainHC,C.NextChainSD1,C.NextChainHC1),e(K.WpChain1,C.NextChainSD1,C.NextChainHC1,C.NextChainSD2,C.NextChainHC2),e(K.WpChain2,C.NextChainSD2,C.NextChainHC2,C.NextChainSD3,C.NextChainHC3),e(K.WpChain3,C.NextChainSD3,C.NextChainHC3,C.NextChainSD4,C.NextChainHC4)},updateDryTopClipboard:function(){if(C.isDryTopGenerated){var e=T.getCurrentDryTopEvents(),t=T.getCurrentDryTopEvents(1);I.updateClipboard("#chnDryTopWaypoint0",e),I.updateClipboard("#chnDryTopWaypoint1",t),C.isDryTopIconsShown&&($("#mapDryTopClip0").val(e),$("#mapDryTopClip1").val(t))}},initializeStopwatch:function(){$("#watToggle").click(function(){$("#itemStopwatch").toggle("fast")}),$("#watStart").click(function(){$("#watToggle").show(),$("#itemStopwatch").show().css("font-size",O.Options.int_sizeStopwatchFont);var e=(new Date).getTime();0===K.StopwatchTimestamp?(K.StopwatchTimestamp=(new Date).getTime(),K.tickStopwatchUp()):K.isStopwatchPaused?(K.isStopwatchPaused=!1,K.StopwatchTimestamp=K.StopwatchTimestamp+(e-K.StopwatchTimesleep),K.tickStopwatchUp()):(window.clearTimeout(K.StopwatchTimeout),K.StopwatchTimesleep=e,K.isStopwatchPaused=!0)}),$("#watStop").click(function(){0===K.StopwatchTimerStart&&$("#watToggle").hide(),window.clearTimeout(K.StopwatchTimeout),K.isStopwatchPaused=!1,K.StopwatchTimestamp=0,K.stopwatchUp.innerHTML=""}),$("#watLap").click(function(){0!==K.StopwatchTimestamp?I.print(K.stopwatchUp.innerHTML):I.write("Stopwatch must be running to lap time.")}),$("#watTimerStart").click(function(){$("#watToggle").show(),$("#itemStopwatch").show().css("font-size",O.Options.int_sizeStopwatchFont),K.StopwatchTimerStart=(new Date).getTime(),K.StopwatchTimerFinish=K.StopwatchTimerStart+O.Options.int_minStopwatchAlert*T.cMSECONDS_IN_MINUTE,K.tickStopwatchDown()}),$("#watTimerStop").click(function(){0===K.StopwatchTimestamp&&$("#watToggle").hide(),K.StopwatchTimerStart=0,K.stopwatchDown.innerHTML=""}),$("#chnOptionsStopwatchDown input").click(function(){$(this).select()})},tickStopwatchUp:function(){var e=(new Date).getTime()-K.StopwatchTimestamp;K.stopwatchUp.innerHTML=T.formatTimeColon(e,!0),K.StopwatchTimeout=setTimeout(function(){K.tickStopwatchUp()},K.stopwatchFrequency)},tickStopwatchDown:function(){var e=K.StopwatchTimerFinish-(new Date).getTime();if(e>0)K.stopwatchDown.innerHTML=T.formatTimeLetter(~~(e/T.cMSECONDS_IN_SECOND),!0);else{$("#watTimerStop").trigger("click");var t=O.Options.str_textStopwatchAlert;D.speak(t)}},refreshFestival:function(){var e=144,t=document.getElementById("paneClockCanvas"),n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);for(var i,a,r=0;e>r;r++)i=T.getRandomIntRange(0,t.width),a=T.getRandomIntRange(0,t.height),n.fillStyle="rgba(255,255,255,255)",n.fillRect(i,a,1,1)}},I={cSiteName:"GW2Timer.com",cSiteURL:"http://gw2timer.com/",cImageHost:"http://i.imgur.com/",cGameName:"Guild Wars 2",cGameNick:"GW2",cLevelMax:80,cAJAXGlobalTimeout:3e4,cPNG:".png",cThrobber:"<div class='itemThrobber'><em></em></div>",cConsoleCommandPrefix:"/",cChatcodePrefix:"[&",cChatcodeSuffix:"]",cTextDelimiterChar:"|",cTextDelimiterRegex:/[|]/g,cClipboardAttribute:"data-clipboard-text",cClipboardSuccessText:"Chat link copied to clipboard :)<br />",cTooltipAttribute:"data-tip",consoleTimeout:{},siteTagDefault:" - gw2timer.com",siteTagCurrent:" - gw2timer.com",Symbol:{Filler:"&zwnj;",ArrowUp:"⇑",ArrowDown:"⇓",TriUp:"▲",TriDown:"▼",TriRight:"►",TriLeft:"◄",Block:"■",Star:"☆",Ellipsis:"…",Day:"☀",Night:"☽",Expand:"[+]",Collapse:"[−]",Help:"[?]"},cOUT_OF_VIEW:-9999,cPANEL_WIDTH:360,cPANEL_HEIGHT_MIN:220,cPANE_CLOCK_HEIGHT:360,cPANE_CLOCK_HEIGHT_COMPACT:220,cPANE_CLOCK_HEIGHT_BAR:85,cPANE_MENU_HEIGHT:48,cTOOLTIP_MOUSEMOVE_MS:20,cTOOLTIP_NUM_RERENDER:8,cTOOLTIP_OFFSET_ADD_X:0,cTOOLTIP_OFFSET_ADD_Y:56,cTOOLTIP_OVERFLOW_ADD_X:16,cTOOLTIP_OVERFLOW_ADD_Y:38,cTOOLTIP_PADDING_ADD_Y:12,CLOCK_AND_MENU_HEIGHT:0,posX:0,posY:0,Scrl:{Anchor:{},Interval:{},Container:{},isOn:!1,posX:0,posY:0},isProgramLoaded:!1,isProgramEmbedded:!1,isMapEnabled:!0,isTouchEnabled:!1,isCustomScrollEnabled:!0,isSpeechSynthesisEnabled:!1,ModeCurrent:null,ModeEnum:{Website:"Website",Mobile:"Mobile",Simple:"Simple",Tile:"Tile",Overlay:"Overlay"},cPagePrefix:"#plate",cMenuPrefix:"#menu",PageInitial:"",PageCurrent:"",PagePrevious:"",PageEnum:{Chains:"Chains",Map:"Map",Help:"Help",Options:"Options"},SpecialPageEnum:{Account:"Account",WvW:"WvW",DryTop:"DryTop"},SectionEnum:{Chains:{Scheduled:"Scheduled",DryTop:"DryTop",Legacy:"Legacy",Temple:"Temple",Timetable:"Timetable"},Map:{Daily:"Daily",Resource:"Resource",JP:"JP",Collectible:"Collectible",Guild:"Guild",TP:"TP",Notepad:"Notepad",Personal:"Personal"},Help:{FAQ:"FAQ",About:"About",Embed:"Embed",Schedules:"Schedules",Legacies:"Legacies",Temples:"Temples",Dungeons:"Dungeons"},Account:{Manager:"Manager",Bank:"Bank",Materials:"Materials",Wardrobe:"Wardrobe",Minis:"Minis",Dyes:"Dyes",Characters:"Characters",Hero:"Hero",Equipment:"Equipment",Inventory:"Inventory",Crafting:"Crafting",Trading:"Trading",PVP:"PVP",Guilds:"Guilds",Achievements:"Achievements"}},SectionCurrent:{},ArticleCurrent:null,contentCurrentPlate:"",isContentLoaded_Map:!1,isContentLoaded_Help:!1,isSectionLoaded_Daily:!1,cHeaderPrefix:"#header",BrowserCurrent:-1,BrowserEnum:{Unknown:-1,IE:0,Opera:1,Firefox:2,Chrome:3},ClickEnum:{Left:1,Middle:2,Right:3},ScreenWidth:{Huge:2560,Large:1024,Medium:640},cSMALL_DEVICE_WIDTH:800,cSMALL_DEVICE_HEIGHT:600,cBIG_DISPLAY_HEIGHT:1200,initializeFirst:function(){D.stopSpeech(),window!==window.top&&(I.isProgramEmbedded=!0),I.isTouchEnabled="undefined"!=typeof window.ontouchstart,U.enforceURLArgumentsFirst(),I.enforceProgramMode(),U.updateLanguageLinks(),T.checkDST(),T.cUTC_OFFSET_USER=-((new Date).getTimezoneOffset()/T.cMINUTES_IN_HOUR),T.cUTC_OFFSET_USER<=T.cUTC_OFFSET_EASTERN&&T.cUTC_OFFSET_USER>=T.cUTC_OFFSET_HAWAII&&(O.Options.bol_use24Hour=!1);var e=T.getUNIXSeconds();O.initializeTimestamp(O.Utilities.timestampDaily),O.initializeTimestamp(O.Utilities.timestampWeekly),K.awakeTimestampPrevious=e,screen.height>=800?O.Options.int_setInitialZoomWvW=3:screen.height>=480?O.Options.int_setInitialZoomWvW=4:O.Options.int_setInitialZoomWvW=5;var t=navigator.userAgent;-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident")?I.BrowserCurrent=I.BrowserEnum.IE:-1!==t.indexOf("Chrome")?I.BrowserCurrent=I.BrowserEnum.Chrome:-1!==t.indexOf("Firefox")?I.BrowserCurrent=I.BrowserEnum.Firefox:-1!==t.indexOf("Opera")&&(I.BrowserCurrent=I.BrowserEnum.Opera);try{window.speechSynthesis&&(I.isSpeechSynthesisEnabled=!0,window.speechSynthesis.onvoiceschanged=function(){window.speechSynthesis.getVoices()})}catch(n){}$.ajaxSetup({timeout:I.cAJAXGlobalTimeout}),$("#plateMap, #plateWvW, #plateHelp").each(function(){$(this).append(I.cThrobber)}),I.Scrl.Anchor=$("#itemAutoscroll"),I.qTip.start(),I.PageCurrent=I.PageEnum.Chains},initializeLast:function(){I.initializeTooltip(),I.bindHelpButtons("#plateOptions"),I.bindWindowResize(),I.initializeUIForMenu(),I.initializeUIForHUD(),I.styleContextMenu("#mapContext"),$("#mapSwitchButton").one("click",function(){I.loadStylesheet("wvw"),I.loadImg("#wvwHUDPane .mapHUDButton"),$("#lboCurrent").append(I.cThrobber);var e=setInterval(function(){"absolute"===$("#wvwLeaderboard").css("position")&&(window.clearInterval(e),$.getScript(U.URL_DATA.WvW).done(function(){W.initializeWvW()}))},100)}).click(function(){I.toggleMap(P.MapEnum.Mists)}),$("#wvwSwitchButton").click(function(){I.toggleMap(P.MapEnum.Tyria)}),$("#mapAccountButton, #wvwAccountButton").one("click",function(){A.isAccountInitialized===!1&&(I.loadStylesheet("account"),$("#panelAccount").load(U.getPageSrc("account"),function(){$.getScript(U.URL_DATA.Account).done(function(){A.initializeAccount()})}))}).click(function(){I.toggleAccount()}),U.enforceURLArgumentsLast(),I.PageCurrent===I.PageEnum.Chains&&U.openSectionFromURL(),$("#itemWarning").remove(),$("#cslClose").click(function(){I.clear()}),$("#cslSelect").click(function(){I.selectText("#cslContent")}),$("#cslToggle").click(function(){$("#cslContent").toggle("fast")}),$(".mapHUDContainer").one("mouseenter",function(){$(this).find("img").each(function(){$(this).attr("src",$(this).attr("data-src"))})}),$("#chnOptions").one("mouseenter",function(){I.loadImg($(this)),K.initializeStopwatch(),$("#optAlarmSpeaker").click(function(){D.speak(D.getWord("alarm"))}),$("#optMute").click(function(){D.stopSpeech()})}),U.convertExternalLink(".linkExternal"),I.BrowserCurrent!==I.BrowserEnum.IE&&$("head").append("<style>.leaflet-clickable{cursor: url('img/cursor/pointer.cur'), pointer;}</style>"),$(document).mouseup(function(e){$(".jsRemovable, .jsHidable").each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||($(this).hasClass("jsHidable")&&$(this).hide(),$(this).hasClass("jsRemovable")&&$(this).remove())})}),I.isCustomScrollEnabled&&$(document).on("ps-scroll-y",function(){I.clearAutoscroll()}),$("#itemLanguage").hover(function(){$("#paneClock").css("z-index",3)},function(){$("#paneClock").css("z-index",1)}),I.isMapEnabled&&I.initializeScrollbar("#cslContent, #plateChains, #plateOptions"),O.cleanLocalStorage(),O.enforceProgramVersion(),D.translateAfter(),P.wantZoomToFirstEvent()?$("#chnEvent_"+C.CurrentChainSD.nexus+"_"+C.CurrentChainSD.CurrentPrimaryEvent.num).trigger("click"):I.isMapEnabled&&M.goToDefault(O.Options.int_setInitialZoom),I.isMapEnabled&&("wvw"===I.PageInitial?$("#wvwSwitchButton").one("click",function(){M.changeFloor(O.Options.int_setFloor)}):M.changeFloor(O.Options.int_setFloor)),I.isProgramLoaded=!0},initializeChainsUI:function(){$("#plateChains header").click(function(){var e=U.getSubstringFromHTMLID($(this));$(this).next().slideToggle("fast",function(){if($(this).is(":visible")){I.updateScrollbar();var t=$(I.cPagePrefix+I.PageEnum.Chains),n=$(this).prev();n.find("kbd").html(I.Symbol.Collapse),I.scrollToElement(n,{aContainer:t,aSpeed:"fast"}),"sectionChains_Drytop"===$(this).attr("id")?(I.isMapEnabled&&(M.goToZone("dry",M.ZoomEnum.Bird),P.toggleDryTopIcons(!0)),I.PageCurrent=I.SpecialPageEnum.DryTop,U.updateTitle(I.SpecialPageEnum.DryTop),$("#mapHUDBoxes").hide()):I.SectionCurrent[I.PageEnum.Chains]=e===I.SectionEnum.Chains.Scheduled?"":e}else I.updateScrollbar(),$(this).prev().find("kbd").html(I.Symbol.Expand),"sectionChains_Drytop"===$(this).attr("id")&&(I.PageCurrent=I.PageEnum.Chains,P.toggleDryTopIcons(!1),$("#mapHUDBoxes").show()),I.SectionCurrent[I.PageEnum.Chains]="";U.updateQueryString()})}),$("#plateChains header:not(:first)").each(function(){$(this).next().toggle(0),$(this).find("kbd").html(I.Symbol.Expand)}),$("#plateChains header:first").each(function(){$(this).find("kbd").html(I.Symbol.Collapse)}),I.ModeCurrent!==I.ModeEnum.Tile?$("#headerChains_Drytop").one("click",function(){P.generateDryTop()}):$("#headerChains_Drytop").hide(),$("#headerChains_Legacy").one("click",function(){C.initializeUnscheduledChains(C.LegacyChains),I.readjustTile()}),$("#headerChains_Temple").one("click",function(){C.initializeUnscheduledChains(C.TempleChains),I.readjustTile()}),$("#chnToggle").click(function(){$("#opt_bol_expandWB").trigger("click")}),$("#headerChains_Timetable").one("click",function(){C.isTimetableGenerated=!0,C.initializeTimetableHTML(),I.readjustTile()}),I.readjustTile()},write:function(e,t,n){$("#itemConsole").show();var i=$("#cslContent").show(),a=18;e=void 0===e?"undefinedstring":null===e?"nullstring":e.toString(),void 0===n&&(n=!1),n===!0&&i.empty(),isFinite(t)===!1&&(t=3+parseInt(e.length/a)),i.append(e+"<br />"),I.updateScrollbar(i),window.clearTimeout(I.consoleTimeout),0!==t&&(I.consoleTimeout=setTimeout(function(){i.css({opacity:1}).animate({opacity:0},600,function(){$(this).empty().css({opacity:1}),$("#itemConsole").hide()})},t*T.cMSECONDS_IN_SECOND))},greet:function(e,t,n){I.isProgramEmbedded===!1&&"wvw"!==I.PageInitial&&I.write(e,t,n)},print:function(e,t){window.clearTimeout(I.consoleTimeout);var n=document.getElementById("itemConsole"),i=document.getElementById("cslContent");n.style.display="block",t&&(i.innerHTML=""),i.insertAdjacentHTML("beforeend",e+"<br />")},clear:function(){window.clearTimeout(I.consoleTimeout),$("#itemConsole").hide(),$("#cslContent").empty()},log:function(e,t){I.print(e,t)},isConsoleShown:function(){return $("#itemConsole").is(":visible")},selectText:function(e){var t=document.querySelector(e),n=window.getSelection(),i=document.createRange();i.selectNodeContents(t),n.removeAllRanges(),n.addRange(i)},scrollToElement:function(e,t){var n=t||{};switch(e=$(e),I.ModeCurrent){case I.ModeEnum.Mobile:$("body").scrollTop(e.offset().top);break;case I.ModeEnum.Tile:$("#windowMain").animate({scrollTop:e.offset().top-$("#windowMain").offset().top+$("#windowMain").scrollTop()},n.aSpeed||0);break;default:n.aContainer?(n.aContainer=$(n.aContainer),n.aContainer.animate({scrollTop:e.offset().top-n.aContainer.offset().top+n.aContainer.scrollTop()+(n.aOffset||0)},n.aSpeed||0)):e.scrollTop(0)}},removeThrobber:function(e){$(e).find(".itemThrobber").remove()},bulkAnimate:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];$(i.s).animate(i.p,{duration:t,queue:!1})}},toggleToggleIcon:function(e,t){t?$(e).animate({rotation:0},200):$(e).animate({rotation:-90},200)},bloatElement:function(e,t,n){var i=parseInt(t/n);i=i%2===0?i:i+1;for(var a=!0,r=0;i>r;r++)a?$(e).hide(n):$(e).show(n),a=!a},blinkElement:function(e,t,n){var i=parseInt(t/n);i=i%2===0?i:i+1;var a=!0,r=1,o=$(e),s=setInterval(function(){a?o.css({visibility:"hidden"}):o.css({visibility:"visibile"}),a=!a,r===i&&clearInterval(s),r++},n)},colorizeValue:function(e,t,n){var i=$(e);i.removeClass("cssLimitEqual cssLimitWithin cssLimitExceed");var a;return a=void 0===n?t>0?"cssLimitWithin":0>t?"cssLimitExceed":"cssLimitEqual":n>=t?"cssLimitWithin":"cssLimitExceed",i.addClass(a),i},toggleHighlight:function(e,t){return void 0===t?e.hasClass("cssHighlight")?(e.removeClass("cssHighlight"),!1):(e.addClass("cssHighlight"),!0):t?(e.addClass("cssHighlight"),!0):(e.removeClass("cssHighlight"),!1)},suspendElement:function(e,t){void 0===t||t===!0?$(e).addClass("jsSuspended"):$(e).removeClass("jsSuspended")},styleContextMenu:function(e){$(e).addClass("jsHidable").find("li").each(function(){if($(this).hasClass("jsIgnore")===!1){if($(this).hasClass("itemContextSubmenu")===!1)O.Options.enu_Language!==O.OptionEnum.Language.Default&&$(this).text(D.getPhraseOriginal($(this).text()));else{var e=$(this).find("> span");e.html(D.getPhraseOriginal(e.text())).append(" <kbd>"+I.Symbol.TriRight+"</kbd>")}$(this).prepend("<ins class='s16 s16_bullet'></ins> ")}})},bindSearchBar:function(e,t,n){var i=$(e),a=$(t),r=$("<div class='cntSearchFiller'>"+D.getWordCapital("search")+"...</div>").appendTo(i),o=$("<input id='jpzSearch' class='cntSearch' type='text' />").appendTo(i);o.on("input",$.throttle(Q.cSEARCH_LIMIT,function(){var e=$(this).val().toLowerCase(),t=[],n="";e.length>0?(r.hide(),t=e.split(" "),a.each(function(){n=$(this).data("keywords");var e=!0;if(n){for(var i=0;i<t.length;i++)if(-1===n.indexOf(t[i])){$(this).hide(),e=!1;break}e&&$(this).show()}})):(r.show(),a.each(function(){$(this).show()}))}))},preventMapPropagation:function(e){return $(e).each(function(){var e=L.DomUtil.get($(this)[0]);L.Browser.touch?L.DomEvent.on(e,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(e),L.DomEvent.on(e,"mousewheel",L.DomEvent.stopPropagation),L.DomEvent.on(e,"contextmenu",L.DomEvent.stopPropagation))})},initializeClipboard:function(e,t){var n=new Clipboard(e);return n.on("success",function(e){I.write(I.cClipboardSuccessText+e.text,5)}),t&&I.updateClipboard(e,t),n},updateClipboard:function(e,t){$(e).attr(I.cClipboardAttribute,t)},initializeScrollbar:function(e){if(I.isCustomScrollEnabled)try{var t=$(e),n=1;switch(I.BrowserCurrent){case I.BrowserEnum.Opera:n=5;break;case I.BrowserEnum.Firefox:n=3}t.perfectScrollbar({wheelSpeed:n,suppressScrollX:!0}),I.bindAutoscroll(t)}catch(i){}},updateScrollbar:function(e){if(I.isCustomScrollEnabled)if(I.isMapEnabled)try{void 0===e?($("#plateMap").perfectScrollbar("update"),$("#plateChains").perfectScrollbar("update"),$("#plateHelp").perfectScrollbar("update"),$("#plateOptions").perfectScrollbar("update")):$(e).perfectScrollbar("update")}catch(t){}else $("#windowMain").perfectScrollbar("update")},bindAutoscroll:function(e){e.mousedown(function(e){e.which===I.ClickEnum.Middle?(clearInterval(I.Scrl.Interval),I.Scrl.isOn?I.clearAutoscroll():(I.Scrl.isOn=!0,I.Scrl.Anchor.css({top:I.posY,left:I.posX,backgroundImage:"url('img/cursor/autoscroll.png')"}).show(),I.Scrl.posX=I.posX,I.Scrl.posY=I.posY,I.Scrl.Container=$(this),I.tickAutoscroll())):(e.which===I.ClickEnum.Left||e.which===I.ClickEnum.Right)&&I.Scrl.isOn&&I.clearAutoscroll()})},clearAutoscroll:function(){clearInterval(I.Scrl.Interval),I.Scrl.isOn=!1,I.Scrl.Anchor.hide()},tickAutoscroll:function(){I.Scrl.isOn&&(I.Scrl.Interval=setInterval(function(){var e=5,t=720,n=I.posY-I.Scrl.posY,i=32,a=32,r=0>n?-1:1;n=Math.abs(n);var o=Math.pow(2,(n+i)/a);o>t&&(o=t),n>e&&I.Scrl.Container.scrollTop(I.Scrl.Container.scrollTop()+r*o)},50))},generateSectionMenu:function(e){if(!($(e+" header.jsSection").length<=0)){var t=e.substring(I.cPagePrefix.length,e.length),n="menuBeam_"+t,i=$("<div class='menuBeamContainer'></div>").prependTo(e),a=$("<div class='menuBeam' id='"+n+"'></div>").prependTo(i);$(e+" header.jsSection").each(function(){var n=$(this),i=$(this).children("var").first(),r=i.data(O.Options.enu_Language)||n.text();i.text(r),n.next().hide(),n.wrapInner("<span></span>"),n.append("<sup>"+I.Symbol.Expand+"</sup>"),n.click(function(){var n=!1,i=U.getSubstringFromHTMLID($(this));$(e+" .menuBeamIcon").removeClass("menuBeamIconActive"),$(this).next().is(":visible")?($(this).children("sup").text(I.Symbol.Expand),I.displaySectionMarkers(i,!1),I.SectionCurrent[t]="",$(e+" header.jsSection").show(),$(e+" header.cntHeader").show()):(n=!0,$(this).children("sup").text(I.Symbol.Collapse),$(e+" .menuBeamIcon[data-section='"+i+"']").addClass("menuBeamIconActive"),I.displaySectionMarkers(i,!0),I.SectionCurrent[t]=i,$(this).data("beamclicked")===!0&&($(e+" header.jsSection").not(this).hide(),$(e+" header.cntHeader").hide(),$(this).removeData("beamclicked")),$(this).hasClass("jsMapDefault")&&M.goToDefault()),U.updateQueryString(),$(this).data("donotanimate")!==!0?I.ModeCurrent===I.ModeEnum.Website?$(this).next().toggle("fast",function(){I.updateScrollbar(e)}):($(this).next().toggle(),I.updateScrollbar(e)):$(this).next().toggle(),$(this).removeData("donotanimate"),n&&I.scrollToElement($(this),{aContainer:e,aSpeed:"fast"})}),n.one("click",function(){I.loadImg($(this).next())}),$("<div class='curClick jsSectionDone'><img src='img/ui/close.png' />"+r+"</div>").appendTo(n.next()).click(function(){$(this).parent().prev().trigger("click")});var o=U.getSubstringFromHTMLID(n),s=n.find("img:eq(0)").attr("src");(I.isMapEnabled||n.hasClass("mapOnly")===!1)&&$("<img class='menuBeamIcon' data-section='"+o+"' src='"+s+"' title='&lt;dfn&gt;"+D.getWordCapital("section")+": &lt;/dfn&gt;"+r+"' />").appendTo(a).click(function(){$(e+" header.jsSection").each(function(){$(this).next().is(":visible")&&$(this).attr("id")!==n.attr("id")&&($(this).data("donotanimate",!0),$(this).trigger("click"))}),n.data("beamclicked",!0),n.trigger("click")})}),$("<img class='menuBeamIcon menuBeamIconCollapse' src='img/ui/exit.png' title='&lt;dfn&gt;"+D.getPhraseTitle("collapse section")+"&lt;/dfn&gt;' />").prependTo(a).click(function(){$(e+" header.jsSection").each(function(){$(this).next().is(":visible")&&$(this).trigger("click")}),$(e+" .menuBeamIcon").removeClass("menuBeamIconActive")}),I.qTip.init(e+" .menuBeamIcon")}},displaySectionMarkers:function(e,t){var n,i,a=$("#mapToggle_"+e);a.length&&(n=a.data("checked"),i=a.data("hideonly"),i?t||a.trigger("click"):t?n||(a.trigger("click"),a.data("checked",!0)):n&&(a.trigger("click"),a.data("checked",!1)))},loadStylesheet:function(e){e!==I.ModeEnum.Website&&$("head").append("<link rel='stylesheet' type='text/css' href='style/"+e.toLowerCase()+".css' />")},loadImg:function(e){var t="string"==typeof e?$(e):e.find("img");t.each(function(){$(this).attr("data-src")&&($(this)[0].src=$(this).data("src"))})},bindHelpButtons:function(e){$(e+" .jsHelpCollapsible").each(function(){$(this).text("[?+]").attr("title","<dfn>More Info</dfn>"),$(this).next().hide(),$(this).click(function(){$(this).next().toggle(),$(this).next().is(":visible")?$(this).text("[?-]"):$(this).text("[?+]")})}),$(e+" .jsHelpTooltip").each(function(){var e="<dfn>Info:</dfn> "+$(this).attr("title");$(this).text(I.Symbol.Help).attr("title",e)}),I.qTip.init(e+" .jsHelpCollapsible"),I.qTip.init(e+" .jsHelpTooltip")},toggleButtonState:function(e){var t=!e.data("checked");return e.data("checked",t),t},bindPseudoCheckbox:function(e,t){void 0===t&&(t=.3),$(e).click(function(){$(this).data("checked")!==!0?($(this).css({opacity:t}),$(this).data("checked",!0)):($(this).css({opacity:1}),$(this).data("checked",!1))})},initializeUIForMenu:function(){!function(){var e=200,t=.5;$("#paneMenu").hover(function(){$("#paneMenu kbd").each(function(){$(this).is(":hover")||$(this).animate({opacity:t},e)})},function(){$("#paneMenu kbd").finish().each(function(){$(this).animate({opacity:1},e)})}),$("#paneMenu kbd").hover(function(){$(this).animate({opacity:1},e)},function(){$(this).animate({opacity:t},e)}).mousedown(function(){$(this).finish().css({opacity:t})}).mouseup(function(){$(this).finish().css({opacity:1})})}(),$("#paneMenu kbd").each(function(){$(this).click(function(){var e=$(this).attr("id");switch(I.PageCurrent=e.substring(I.cMenuPrefix.length-1,e.length),I.contentCurrentPlate=I.cPagePrefix+I.PageCurrent,P.WebsiteCurrentMap===P.MapEnum.Mists&&(I.PagePrevious=I.PageCurrent),I.PageCurrent){case I.PageEnum.Chains:O.Options.bol_hideHUD&&$("#mapHUDBoxes").show();break;case I.PageEnum.Map:I.isMapEnabled&&M.movePin(M.Pin.Event)}$("#paneContent article").hide(),I.PageCurrent!==I.PageEnum.Chains&&O.Options.bol_hideHUD&&$("#mapHUDBoxes").hide(),I.ModeCurrent===I.ModeEnum.Website&&($(I.contentCurrentPlate+" .cntHeader").css({opacity:0}).animate({opacity:1},400),$(I.contentCurrentPlate).animate({width:"show"},200)),$(I.contentCurrentPlate).show(),U.updateQueryString(),I.isMapEnabled&&M.toggleLayer(M.ZoneCurrent.Layers.Path,I.PageCurrent!==I.PageEnum.Map&&O.Options.bol_showChainPaths)})}),$("#menuMap").one("click",I.loadMapPlate),$("#menuHelp").one("click",I.loadHelpPlate)},toggleMap:function(e){switch(e){case P.MapEnum.Tyria:$("#wvwPane").hide(),$("#mapPane").show(),M.refreshMap(),I.PageCurrent=I.PagePrevious,I.PagePrevious=I.SpecialPageEnum.WvW,P.WebsiteCurrentMap=P.MapEnum.Tyria,P.SuffixCurrent=M.OptionSuffix;break;case P.MapEnum.Mists:$("#mapPane").hide(),$("#wvwPane").show(),W.isMapInitialized&&W.refreshMap(),I.PagePrevious=I.PageCurrent,I.PageCurrent=I.SpecialPageEnum.WvW,P.WebsiteCurrentMap=P.MapEnum.Mists,P.SuffixCurrent=W.OptionSuffix}U.updateQueryString()},toggleAccount:function(){var e=$("#panelAccount"),t=$("#accContent");e.is(":visible")?(t.hide(),e.css({width:"100%"}).animate({width:0},"fast",function(){if($(this).hide(),I.isMapEnabled&&O.Options.bol_showMap)switch($("#panelMap").show(),P.WebsiteCurrentMap){case P.MapEnum.Tyria:$("#mapPane").show(),M.refreshMap();break;case P.MapEnum.Mists:$("#wvwPane").show(),W.isMapInitialized&&W.refreshMap()}}),I.PageCurrent=I.PagePrevious,I.PagePrevious=I.SpecialPageEnum.Account):(e.show().css({width:0}).animate({width:"100%"},"fast",function(){t.show(),A.adjustAccountPanel()}),I.PagePrevious=I.PageCurrent,I.PageCurrent=I.SpecialPageEnum.Account,$("#panelMap").hide()),U.updateQueryString()},bindAfterAJAXContent:function(e){var t=I.cPagePrefix+e;I.generateSectionMenu(t),I.isMapEnabled&&I.initializeScrollbar(t),I.bindHelpButtons(t),M.bindMapLinks(t),U.convertExternalLink(t+" a"),I.qTip.init("button"),U.openSectionFromURL(),D.translateElements()},loadMapPlate:function(){I.loadStylesheet("features"),$("#plateMap").load(U.getPageSrc("map"),function(){I.bindAfterAJAXContent(I.PageEnum.Map),I.ModeCurrent===I.ModeEnum.Mobile&&$(".mapOnly").remove(),$("#headerMap_Daily").one("click",function(){G.generateAndInitializeDailies(),I.isSectionLoaded_Daily=!0}),$("#headerMap_Resource").one("click",function(){G.generateAndInitializeResources()}),$("#headerMap_JP").one("click",function(){G.generateAndInitializeJPs()}),$("#headerMap_Personal").one("click",function(){X.initializePersonalChecklist()}),$("#headerMap_TP").one("click",function(){E.initializeCalculator(),E.initializeTrading(),E.initializeExchange()}),$("#headerMap_Notepad").one("click",function(){X.initializeNotepad()}),$("#headerMap_Collectible").one("click",function(){G.generateCollectiblesUI()}),$("#headerMap_Guild").one("click",function(){G.generateGuildUI()}),I.qTip.init("#plateMap label")})},loadHelpPlate:function(){$("#plateHelp").load(U.getPageSrc("help"),function(){I.bindAfterAJAXContent(I.PageEnum.Help),$(".jsCopyCode").click(function(){$(this).select()})})},initializeUIForHUD:function(){var e=200;$(".mapHUDContainer").each(function(){$(this).hover(function(){$(this).find(".cntComposition").show().animate({opacity:.8},e)},function(){$(this).find(".cntComposition").animate({opacity:0},e)})})},showHomeLink:function(){I.qTip.init($("<a title='&lt;dfn&gt;Switch back to full site.&lt;/dfn&gt;' href='./'> <img id='iconSimpleHome' src='img/ui/about.png' /></a>").appendTo("#itemHome"))},enforceProgramMode:function(){switch(I.loadStylesheet(I.ModeCurrent),I.ModeCurrent){case I.ModeEnum.Website:$("head").append("<link rel='alternate' media='only screen and (max-width: 640px)' href='http://gw2timer.com/?mode=Mobile'>");break;case I.ModeEnum.Overlay:I.cPANE_MENU_HEIGHT=32,I.loadImg("#mapGPSButton");break;case I.ModeEnum.Simple:I.isMapEnabled=!1,I.showHomeLink(),$("#itemTimeline").appendTo("#panelApp"),I.readjustSimple();break;case I.ModeEnum.Mobile:I.isMapEnabled=!1,I.isCustomScrollEnabled=!1,I.showHomeLink(),$("head").append("<meta name='viewport' content='width=device-width, initial-scale=1' />").append("<link rel='canonical' href='http://gw2timer.com' />");break;case I.ModeEnum.Tile:if(I.isMapEnabled=!1,K.iconOpacityChecked=.2,I.showHomeLink(),$("#itemLanguage").prependTo("#plateChains"),I.isProgramEmbedded)$("<style type='text/css'>.chnBar, .chnSlot {margin-bottom:4px !important; margin-right: 4px !important;}</style>").appendTo("head");else{var e=parseInt($("#chnProgressBar").css("margin-top"));$("#itemTimeline").prependTo("#panelApp"),$("#windowMain").scroll(function(){$("#itemTimeline").is(":visible")?$("#chnProgressBar").css("margin-top",Math.max(-$("#itemTimeline").outerHeight(!0)+e,-$("#windowMain").scrollTop())):$("#chnProgressBar").css("margin-top",e)})}I.initializeScrollbar("#windowMain")}I.ModeCurrent===I.ModeEnum.Website&&I.isProgramEmbedded===!1?$("#paneClockIcons img").addClass("curZoom"):$("#paneClockIcons img").addClass("curClick"),I.isProgramEmbedded&&($("#itemWarning").remove(),$(".mapHUDLinks").hide(),B.isDashboardEnabled=!1),I.ModeCurrent!==I.ModeEnum.Website&&I.ModeCurrent!==I.ModeEnum.Overlay&&(B.isDashboardEnabled=!1)},bindWindowResize:function(){$(window).on("resize",$.throttle(200,function(){switch(I.ModeCurrent){case I.ModeEnum.Simple:I.readjustSimple();break;case I.ModeEnum.Tile:I.readjustTile()}W.isWvWLoaded&&(W.readjustLeaderboard(),W.readjustLog()),A.isAccountInitialized&&A.adjustAccountPanel()}))},readjustSimple:function(){var e=$(window).height()/2,t=$(window).width()/2,n=I.cPANE_CLOCK_HEIGHT/2;$("#paneSimple").css({"margin-top":e-n-72}),$("#paneClock").css({"margin-top":e-n,"margin-left":t-n})},readjustTile:function(){if(I.ModeCurrent===I.ModeEnum.Tile){var e=T.stepFunction($(window).width(),14,22,400,3);$(".chnTitle h1").css({fontSize:e+"px"})}},initializeTooltip:function(){I.qTip.init("#chnOptions img, a, ins, kbd, span, time, fieldset, label, input, button")},qTip:{name:"qTip",offsetX:0,offsetY:0,TipElm:null,start:function(){this.TipElm=document.createElement("div"),this.TipElm.setAttribute("id",this.name),document.body.appendChild(this.TipElm),document.onmousemove=$.throttle(I.cTOOLTIP_MOUSEMOVE_MS,function(e){I.qTip.move(e)})},init:function(e){if(!I.isTouchEnabled){var t,n;$(e).each(function(){t=$(this)[0],n=t.getAttribute("title"),t&&n&&(t.setAttribute(I.cTooltipAttribute,n),t.removeAttribute("title"),t.removeAttribute("alt"),t.onmouseenter=function(){I.qTip.show(this.getAttribute(I.cTooltipAttribute))},t.onmouseleave=function(){I.qTip.hide()})})}},move:function(e){e&&(I.posX=e.pageX,I.posY=e.pageY);var t=$("#qTip").width(),n=$("#qTip").height(),i=$(window).width(),a=$(window).height();this.offsetX=I.cTOOLTIP_OFFSET_ADD_X,this.offsetY=-(n+I.cTOOLTIP_OFFSET_ADD_Y),I.posY+this.offsetY<0&&(I.posY+n+I.cTOOLTIP_OVERFLOW_ADD_Y<a?this.offsetY=I.cTOOLTIP_OVERFLOW_ADD_Y:this.offsetY=a-(n+I.posY+I.cTOOLTIP_PADDING_ADD_Y)),(I.posX+t>i||I.posX+I.cPANEL_WIDTH>i)&&(this.offsetX=-(t+I.cTOOLTIP_OVERFLOW_ADD_X)),this.TipElm.style.left=I.posX+this.offsetX+"px",this.TipElm.style.top=I.posY+this.offsetY+"px"},show:function(e){this.TipElm.innerHTML=e,this.TipElm.style.display="block",this.TipElm.classList.add("cssFadeIn");for(var t=0;t<I.cTOOLTIP_NUM_RERENDER;t++)I.qTip.move()},hide:function(){this.TipElm.innerHTML="",this.TipElm.style.display="none",this.TipElm.classList.remove("cssFadeIn")}}},I.initializeFirst(),O.initializeOptions(),T.initializeSchedule(),P.initializeMap(),K.initializeClock(),I.initializeLast()});